<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>Elliptic curve cryptography basics</title>
      <link href="/2020/01/04/Elliptic%20curve%20group/"/>
      <url>/2020/01/04/Elliptic%20curve%20group/</url>
      <content type="html"><![CDATA[<p>This is my first post about cryptography. Recently I learnt basics about <a href="https://en.wikipedia.org/wiki/Public-key_cryptography" target="_blank" rel="noopener">public key encryption</a> and the <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security" target="_blank" rel="noopener">TLS</a> handshake. But the key exhange in the TLS handshake inspected by Wireshark, i.e. <a href="https://en.wikipedia.org/wiki/Elliptic-curve_Diffie%E2%80%93Hellman" target="_blank" rel="noopener">ECDH</a>(Elliptic-curve Diffieâ€“Hellman) troubled me for a while. This this the first time I knew <a href="https://en.wikipedia.org/wiki/Elliptic_curve" target="_blank" rel="noopener">Elliptic curve</a>. After some investigation, Iâ€™m recording those knowledges in case that I forget them. </p><p>Note: in the following several posts, I would record more things I learnt about cryptography and its application in the computer network and Internet.</p><h3 id="First-glance"><a href="#First-glance" class="headerlink" title="First glance"></a>First glance</h3><p>A elliptic curve could be defined as:</p><script type="math/tex; mode=display">y^2 = x^3 + ax + b</script><p>where </p><script type="math/tex; mode=display">4a^3 + 27b^2 \ne 0</script><p>Some examples of elliptic curves are like:</p><p><img src="http://tao93.top/images/2020/01/04/1578180839.png" alt=""></p><p>equation for red line is <script type="math/tex">y^{2}=x^{3}+4x+4</script>, equation for purple line is <script type="math/tex">y^{2}=x^{3}-3x</script></p><h3 id="Group"><a href="#Group" class="headerlink" title="Group"></a>Group</h3><p>Now lets review the <a href="https://en.wikipedia.org/wiki/Group_(mathematics" target="_blank" rel="noopener">Group</a>) concept. </p><p>A group <script type="math/tex">G</script> is a set with a binary operation we define on the it, when 4 conditions are met. Usually we denote the operation as plus, then the 4 conditions are:</p><ol><li><strong>Closure</strong>: <script type="math/tex">m + n</script> is always in <script type="math/tex">G</script> as long as <script type="math/tex">m</script> and <script type="math/tex">n</script> in <script type="math/tex">G</script>.</li><li><strong>Associativity</strong>: for all <script type="math/tex">m</script>, <script type="math/tex">n</script> and <script type="math/tex">r</script> in <script type="math/tex">G</script>, <script type="math/tex">(m+n)+r = m+(n+r)</script>.</li><li><strong>Identity element</strong>: there is a element <script type="math/tex">0</script> in <script type="math/tex">G</script> such that <script type="math/tex">m + 0 = 0 + m = m</script> for any <script type="math/tex">m</script> in <script type="math/tex">G</script>.</li><li><strong>Inverse element</strong>: for any <script type="math/tex">m</script> in <script type="math/tex">G</script>, there is an element <script type="math/tex">n</script> in <script type="math/tex">G</script> such that <script type="math/tex">m + n = 0</script>, and we say <script type="math/tex">n = -m</script></li></ol><p>A group is a <a href="https://en.wikipedia.org/wiki/Abelian_group" target="_blank" rel="noopener">Abelian group</a> if the follwoing condition is also met:</p><p><strong>commutation</strong>: for any <script type="math/tex">m</script> and <script type="math/tex">n</script> in <script type="math/tex">G</script>, there is <script type="math/tex">m + n = n + m</script></p><p>Aparently the set of all real numbers <script type="math/tex">R</script> could be an Abelian group with the arithmetic adding operation. </p><h3 id="Define-group-on-the-elliptic-curves"><a href="#Define-group-on-the-elliptic-curves" class="headerlink" title="Define group on the elliptic curves"></a>Define group on the elliptic curves</h3><p>First, the set consists of all points in a elliptic curve. </p><p>The Identity element <script type="math/tex">0</script> would be a little special, itâ€™s defined as the infinitely far points of the curve.</p><p>Now, lets define the operation. For any points <script type="math/tex">a</script> and <script type="math/tex">b</script> in the curve:</p><ol><li>if <script type="math/tex">m = n</script> and <script type="math/tex">y_m = 0</script>, then <script type="math/tex">m + n =0</script></li><li>if <script type="math/tex">m = n</script> and <script type="math/tex">y_m \ne 0</script>, then <script type="math/tex">m + n</script> is the other intersection of the curve and the line tangent to the curve in <script type="math/tex">m</script>.</li><li>if <script type="math/tex">m \ne n</script> and <script type="math/tex">x_m = x_n</script>, then <script type="math/tex">m + n = n + m = 0</script></li><li>if <script type="math/tex">m \ne n</script> and <script type="math/tex">x_m \ne x_n</script>, then <script type="math/tex">-(m+n)</script> equals <script type="math/tex">-(m + n)</script> and is the 3rd intersection of the curve and the line cross <script type="math/tex">m</script> and <script type="math/tex">n</script>.</li></ol><p>From the 3rd and4th cases above, we know the relation between <script type="math/tex">m + n</script> and <script type="math/tex">m</script>, <script type="math/tex">n</script> would be like: </p><p><img src="http://tao93.top/images/2020/01/04/1578188228.png" alt=""></p><p>It can be proved that such a group is an Abelian group.</p><h4 id="Scalar-multiplication"><a href="#Scalar-multiplication" class="headerlink" title="Scalar multiplication"></a>Scalar multiplication</h4><p>We can also defin a scalar multiplication based on the plus operation upon the elliptic curve groups:</p><script type="math/tex; mode=display">dm = \sum_{i=1}^d m</script><p>where <script type="math/tex">d</script> is a positive integer and <script type="math/tex">m</script> is a element in the group.</p><p>The above expression could be calculated in time complexity of <script type="math/tex">O(logn)</script> by disassembling the <script type="math/tex">d</script> into factors that are powers of 2. </p><h4 id="The-logrithm-problem"><a href="#The-logrithm-problem" class="headerlink" title="The logrithm problem"></a>The logrithm problem</h4><p>In last section, we see given <script type="math/tex">d</script> and <script type="math/tex">m</script>, itâ€™s easy to get <script type="math/tex">dm</script>. However, given the <script type="math/tex">m</script> and result of <script type="math/tex">dm</script>, with some cleverly constructed instances it would be very hard to know the value of <script type="math/tex">d</script>, i.e. the times of operation performed to get the <script type="math/tex">dm</script>. And this hard problem is called logrithm problem.</p><h4 id="Field"><a href="#Field" class="headerlink" title="Field"></a>Field</h4><p><a href="https://en.wikipedia.org/wiki/Field_(mathematics" target="_blank" rel="noopener">Field</a> is a set on which addition and multiplication are defined. The two kinds of operations are <strong>closed</strong>, <strong>associative</strong> and <strong>commutative</strong>. Moreover, there are <strong>two identity elements</strong> for both kinds of operations respectively. Finally, there is distributiveness, i.e. <script type="math/tex">m(n+r) = mn + mr</script>.</p><h4 id="Finite-field-on-prime"><a href="#Finite-field-on-prime" class="headerlink" title="Finite field on prime"></a>Finite field on prime</h4><p>For a prime <script type="math/tex">P</script>, the set of integers from 0 to <script type="math/tex">P-1</script> could be a field. And the addition and multiplication are defined as:</p><script type="math/tex; mode=display">(m+n)\mod P</script><script type="math/tex; mode=display">(mn)\mod p</script><p>And the behavior or identity elements are:</p><script type="math/tex; mode=display">(m + (-m)) \mod P = 0</script><script type="math/tex; mode=display">(m(m^{-1})) \mod P = 1</script><p>Absolutely, arithmetic negation is the additional reverse in this field. But the multipilicational reverse is not that easy, actually the <a href="http://en.wikipedia.org/wiki/Extended_Euclidean_algorithm" target="_blank" rel="noopener">extended Euclidean algorithm</a> tell us this could be done in time complexity of <script type="math/tex">O(logP)</script>. As an example, 4 and 2 are mutual multipilicational reverse when <script type="math/tex">P</script> is 7 since <script type="math/tex">4*2 \mod 8 = 1</script>.</p><h4 id="Elliptic-curve-over-finite-fields"><a href="#Elliptic-curve-over-finite-fields" class="headerlink" title="Elliptic curve over finite fields"></a>Elliptic curve over finite fields</h4><p>Previously the elliptic curves consist of points with coordinates of real numbers. But now we restrict the curve upon a finite field which only contains integers betwen 0 and <script type="math/tex">p-1</script>.</p><script type="math/tex; mode=display">y^2 \equiv x^3 + ax + b \mod P</script><p>When </p><script type="math/tex; mode=display">4a^3 + 27b^2 \not\equiv 0 \mod P</script><p>Where <script type="math/tex">P</script> is a prime number, <script type="math/tex">x</script>, <script type="math/tex">y</script>, <script type="math/tex">a</script> and <script type="math/tex">b</script> are integers, and <script type="math/tex">0\le x, y\le P-1</script>.</p><p>Here is an example graph of <script type="math/tex">y^2 \equiv x^3 - 7x + 10 \mod 19</script>:</p><p><img src="http://tao93.top/images/2020/01/05/1578243411.png" alt=""></p><p>Note that most of the points in the above graph are symmetrical over the line <script type="math/tex">y=P/2</script> except the points on line <script type="math/tex">y=0</script>.</p><h4 id="Group-on-the-elliptic-curve-over-finite-fields"><a href="#Group-on-the-elliptic-curve-over-finite-fields" class="headerlink" title="Group on the elliptic curve over finite fields"></a>Group on the elliptic curve over finite fields</h4><p>To define a group, firstly we need to define the plus operation on the elliptic curve over finite fields. The plus operation is similar to the operation we defined previously for elliptic curve over real numbers.</p><p>The identity element is same as before. The reverse pair of elements are symmectircal over the line <script type="math/tex">y = p/2</script>.</p><p>For any pointers <script type="math/tex">m</script> and <script type="math/tex">n</script> on the discrete curve and <script type="math/tex">x_m \ne x_n</script>, <script type="math/tex">m+n</script> is the reverse proint of the 3rd intersection between the discrete curve points and the lines denoted by:</p><script type="math/tex; mode=display">y \equiv kx + t \mod P</script><p>when the lines cross <script type="math/tex">m</script> and <script type="math/tex">n</script>, and <script type="math/tex">k</script>, <script type="math/tex">t</script> are constants.</p><p>It could be proved with such a addition operation defined, a group is generated on the discrete elliptic curve over a finite field from prime <script type="math/tex">P</script>.</p><p>The number of points in such a group is called the <strong>order</strong> of the group. Similar with previous continuous elliptic curve, we can perform scalar multipilication:</p><script type="math/tex; mode=display">dm = \sum_{i=1}^d m</script><p>where <script type="math/tex">d</script> is a positive integer and <script type="math/tex">m</script> is a element in the group.</p><p>For any <script type="math/tex">m</script> in such a group <script type="math/tex">G</script>, the smallest integer <script type="math/tex">d</script> such that <script type="math/tex">dm</script> equals the identity element point is called the order of the subgroup which contains <script type="math/tex">m</script>, <script type="math/tex">2m</script>, <script type="math/tex">3m</script>, â€¦, <script type="math/tex">(d-1)m</script> and the identity element point. The subgroup is cyclic. And the number of elements in a subgroup is called <strong>order</strong> of the subgroup.</p><p>Letâ€™s say the order of the parent group is<script type="math/tex">D</script>.According to <a href="https://en.wikipedia.org/wiki/Lagrange%27s_theorem_(group_theory" target="_blank" rel="noopener">Lagrangeâ€™s theorem</a>), the order of a subgroup is a diviser of <script type="math/tex">D</script>. </p><p>Hence for any <script type="math/tex">m</script> in the parent group, we can check the divisers of <script type="math/tex">D</script> one by one to find out the order of subgroup based on <script type="math/tex">m</script>. On the contrary, for any prime diviser <script type="math/tex">d</script> of <script type="math/tex">D</script>, any element point <script type="math/tex">m</script> such that <script type="math/tex">(D/d)m</script> not equal the identity element is the base point to form a subgroup. (Hint: <script type="math/tex">Dm</script> is always the identity element.)</p><p>Given <script type="math/tex">m</script> and <script type="math/tex">n</script> in such a group G, getting a <script type="math/tex">k</script> such that <script type="math/tex">km=n</script> is also very harder for some instances, just like the logrithm problem we mentioned previously.</p><h4 id="Elliptic-curve-cryptography-applications"><a href="#Elliptic-curve-cryptography-applications" class="headerlink" title="Elliptic curve cryptography applications"></a>Elliptic curve cryptography applications</h4><p>To leverage elliptic curve group over finite fileds on primes, there are some parameters called domain parameters to determine the concrete instances.</p><ol><li><script type="math/tex">a</script> and <script type="math/tex">b</script>, real numbers to determine the <script type="math/tex">y^2 = x^3 + ax + b</script> equation</li><li><script type="math/tex; mode=display">p$$, a prime that determine the finite field of 1, 2, 3, ..., $$p-1</script></li><li><script type="math/tex">G</script>, a base point in the discrete elliptic curve to form a cyclic subgroup of <script type="math/tex">G</script>, <script type="math/tex">2G</script>, <script type="math/tex">3G</script>, â€¦, identity element</li><li><script type="math/tex">n</script>, which is order of the subgroup based on <script type="math/tex">G</script>, hence <script type="math/tex">nG</script> is the identity element</li><li><script type="math/tex">h</script>, called cofactor, which is result of <script type="math/tex">n</script> divides the number points of the parent group.</li></ol><p>The above <script type="math/tex">(p, a, b, G, n, h)</script> consists the domain parameters that determine the concrete instances.</p><p>In the Elliptic curve cryptography, The <strong>private key</strong> is a random number <script type="math/tex">d</script> such that <script type="math/tex">1 \le d \le n-1</script>. The <strong>public key</strong> is the result of <script type="math/tex">dG</script>.</p><h5 id="EC-Diffie-Hellman-key-exchange-algorithm"><a href="#EC-Diffie-Hellman-key-exchange-algorithm" class="headerlink" title="EC Diffie-Hellman key exchange algorithm"></a>EC Diffie-Hellman key exchange algorithm</h5><p>In EC Diffie-Hellman key exchange algorithm. Alice and Bob have their private keys <script type="math/tex">d_A</script> and <script type="math/tex">d_B</script>. With the public domain parameters, they would compute <script type="math/tex">d_A G</script> and <script type="math/tex">d_B G</script> and exchange these two values. Finally, they would compute <script type="math/tex">d_A d_B G</script> and <script type="math/tex">d_B d_A G</script> respectively as the shared secret key. Of course <script type="math/tex">d_A d_B G = d_B d_A G</script>.</p><p>The EC Diffie-Hellman key exchange is based on that given the domain parameters, itâ€™s hard to know <script type="math/tex">d_A d_B G</script> given <script type="math/tex">d_A G</script> and <script type="math/tex">d_B G</script>, and smae for <script type="math/tex">d_A</script> and <script type="math/tex">d_B</script>.</p><p>While the original Diffie-Hellman key exchange algorithm is based on exponential modular. Private keys are random numbers <script type="math/tex">d_A</script> and <script type="math/tex">d_B</script>, public keys are <script type="math/tex">k^{d_A} \mod p</script> and <script type="math/tex">k^{d_B} \mod p</script>, and the shared secret key is <script type="math/tex">k^{d_A} \mod p</script>.</p><p>The shared secret key in EC Diffie-Hellman key exchange algorithm are coordinates of the point <script type="math/tex">d_A d_B G</script>, which could be used to perform symmectirc encryption just like TLS does.</p><p>Actually in TLS, we often see ECDHE in which the ending E means ephemeral. Actually when TLS uses ECDHE, during the handshake procedure, the public and private keys generated in ECDHE wonâ€™t be used for encryption. TLS just want both sides to generate a shared private symmectric encryption key, which is really for encryption of application data.</p><h5 id="EC-digital-signature-algorithm"><a href="#EC-digital-signature-algorithm" class="headerlink" title="EC digital signature algorithm"></a>EC digital signature algorithm</h5><p>Alice could use her private key <script type="math/tex">d_A</script> to generate a signature for digest of a message. Bob would be able to verify the signature by using public key of Alice, i.e. <script type="math/tex">d_A G</script>.</p><h4 id="ECC-and-RSA"><a href="#ECC-and-RSA" class="headerlink" title="ECC and RSA"></a>ECC and RSA</h4><p>ECC(clliptic curve cryptography) is better than RSA in that key size of ECC is smaller to achieve same security level. Moreover, the security level improved by doubling key size of RSA is less than ECC. </p>]]></content>
      
      
        <tags>
            
            <tag> Math </tag>
            
            <tag> Cryptography </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Kotlin Summary</title>
      <link href="/2019/11/04/Kotlin%20Summary/"/>
      <url>/2019/11/04/Kotlin%20Summary/</url>
      <content type="html"><![CDATA[<h3 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a>Table of Contents</h3><ol><li><a href="#before-all">Before all</a></li><li><a href="#types">Types</a></li><li><a href="#conditionals">Conditionals</a></li><li><a href="#functions">Functions</a></li><li><a href="#anonymous-functions">Anonymous functions</a></li><li><a href="#null-safety-and-exceptions">Null Safety and Exceptions</a></li><li><a href="#collections">Collections</a></li><li><a href="#class-definition">Class definition</a></li><li><a href="#object-initialization">Object initialization</a></li><li><a href="#inheritance">Inheritance</a></li><li><a href="#objects">Objects</a></li><li><a href="#generics">Generics</a></li><li><a href="#extensions">Extensions</a></li><li><a href="#java-interoperability">Java Interoperability</a></li><li><a href="#coroutines">Corutines</a></li><li><a href="#functional-programming-basics">Functional Programming Basics</a></li><li><a href="#references">References</a></li></ol><h3 id="1-Before-all"><a href="#1-Before-all" class="headerlink" title="1. Before all "></a>1. Before all <a name="before-all"></a></h3><h4 id="Whatâ€™s-Kotlin"><a href="#Whatâ€™s-Kotlin" class="headerlink" title="Whatâ€™s Kotlin"></a>Whatâ€™s Kotlin</h4><ol><li>By Jetbrains which created Intellij IDEA</li><li>Targeting JVM and more, interoperatable with Java</li><li>Concise and safe, with many modern features</li></ol><h4 id="the-REPL-read-evaluate-print-loop"><a href="#the-REPL-read-evaluate-print-loop" class="headerlink" title="the REPL(read, evaluate, print, loop)"></a>the REPL(read, evaluate, print, loop)</h4><p>Install Kotlin commandline tools in macOS:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install kotlin</span><br></pre></td></tr></table></figure><p>Execute <code>kotlinc</code> to start REPL</p><p><img src="http://tao93.top/images/2019/11/05/1572994981.png" alt=""></p><h3 id="2-Types"><a href="#2-Types" class="headerlink" title="2. Types "></a>2. Types <a name="types"></a></h3><h4 id="Built-in-types"><a href="#Built-in-types" class="headerlink" title="Built-in types"></a>Built-in types</h4><p><code>String, Char, Boolean, Int, Double, List&lt;T&gt;, Set&lt;T&gt;, Map&lt;K, V&gt;, Array&lt;T&gt;</code></p><p>Not like Java, Kotlin has no primitives (int, float etc.) hence avoids the boxing between primitives and objects. </p><p>However, in byte code generated by Kotlin, primitives are used to improve performance.</p><h3 id="3-Conditionals"><a href="#3-Conditionals" class="headerlink" title="3. Conditionals "></a>3. Conditionals <a name="conditionals"></a></h3><h4 id="Conditional-operators"><a href="#Conditional-operators" class="headerlink" title="Conditional operators"></a>Conditional operators</h4><div class="table-container"><table><thead><tr><th style="text-align:center">Operator</th><th style="text-align:center">Description</th></tr></thead><tbody><tr><td style="text-align:center">&lt;</td><td style="text-align:center">Evaluates whether the value on the left is less than the value on the right.</td></tr><tr><td style="text-align:center">&lt;=</td><td style="text-align:center">Evaluates whether the value on the left is less than or equal to the value on the right.</td></tr><tr><td style="text-align:center">&gt;</td><td style="text-align:center">Evaluates whether the value on the left is greater than the value on the right.</td></tr><tr><td style="text-align:center">&gt;=</td><td style="text-align:center">Evaluates whether the value on the left is greater than or equal to the value on the right.</td></tr><tr><td style="text-align:center">==</td><td style="text-align:center">Evaluates whether the value on the left is equal to the value on the right (like equals in Java).</td></tr><tr><td style="text-align:center">!=</td><td style="text-align:center">Evaluates whether the value on the left is not equal to the value on the right.</td></tr><tr><td style="text-align:center">===</td><td style="text-align:center">Evaluates whether the two instances point to the same reference (like == in Java).</td></tr><tr><td style="text-align:center">!==</td><td style="text-align:center">Evaluates whether the two instances do not point to the same reference.</td></tr></tbody></table></div><h3 id="4-Functions"><a href="#4-Functions" class="headerlink" title="4. Functions "></a>4. Functions <a name="functions"></a></h3><h4 id="Kotlin-supports-file-level-functions"><a href="#Kotlin-supports-file-level-functions" class="headerlink" title="Kotlin supports file level functions"></a>Kotlin supports file level functions</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    println(fileLevelFunc())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">fileLevelFunc</span><span class="params">()</span></span> = <span class="string">"file level"</span> <span class="comment">// expression function</span></span><br></pre></td></tr></table></figure><h4 id="Default-value-of-parameters"><a href="#Default-value-of-parameters" class="headerlink" title="Default value of parameters"></a>Default value of parameters</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    greeting(<span class="string">"Earth"</span>) <span class="comment">// default value for 2nd parameter</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">greeting</span><span class="params">(name: <span class="type">String</span>, greeting: <span class="type">String</span> = <span class="string">"good morning"</span>)</span></span> &#123;</span><br><span class="line">    println(<span class="string">"<span class="subst">$&#123;greeting.capitalize()&#125;</span>! <span class="variable">$name</span>."</span>) <span class="comment">// e.g. Good morning! Saturn.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Named-function-parameters"><a href="#Named-function-parameters" class="headerlink" title="Named function parameters"></a>Named function parameters</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    greeting(greeting = <span class="string">"Hello"</span>, name = <span class="string">"Earth"</span>) <span class="comment">// named parameters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">greeting</span><span class="params">(name: <span class="type">String</span>, greeting: <span class="type">String</span> = <span class="string">"good morning"</span>)</span></span> &#123;</span><br><span class="line">    println(<span class="string">"<span class="subst">$&#123;greeting.capitalize()&#125;</span>! <span class="variable">$name</span>."</span>) <span class="comment">// e.g. Good morning! Saturn.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Function-names-in-backticks"><a href="#Function-names-in-backticks" class="headerlink" title="Function names in backticks"></a>Function names in backticks</h4><p>Itâ€™s said this is useful to call Java methods whose names are reserved words in Kotlin, or to name some special methods.</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> `ðŸ˜‚`<span class="params">()</span></span> &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    `ðŸ˜‚`() <span class="comment">// call a function</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Inline-functions"><a href="#Inline-functions" class="headerlink" title="Inline functions"></a>Inline functions</h4><p>Kotlin support inline functions, which is good for performance.</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">factorial</span><span class="params">(n: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">if</span> (n &gt; <span class="number">2</span>) &#123;</span><br><span class="line">        n * factorial(n - <span class="number">1</span>)  <span class="comment">// wrong, no recursion inside inline functions</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        n</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-Anonymous-functions"><a href="#5-Anonymous-functions" class="headerlink" title="5. Anonymous functions "></a>5. Anonymous functions <a name="anonymous-functions"></a></h3><p>The complete structure of an anoymous function should be like:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> funcVariable: (ParamType1, ParamType2) -&gt; ReturnType = </span><br><span class="line">&#123; param1: ParamType1, param2: ParamType2 -&gt;</span><br><span class="line">...</span><br><span class="line">expr_to_be_returned <span class="comment">// no return keyword, only the returned expression</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>An example of anoymous function:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> numLetters = <span class="string">"Mississippi"</span>.count(&#123; letter -&gt;</span><br><span class="line">    letter == <span class="string">'s'</span></span><br><span class="line">&#125;)</span><br><span class="line">print(numLetters) <span class="comment">// would Prints 4</span></span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns the number of characters matching the given [predicate].</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> CharSequence.<span class="title">count</span><span class="params">(predicate: (<span class="type">Char</span>)</span></span> -&gt; <span class="built_in">Boolean</span>): <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> (element <span class="keyword">in</span> <span class="keyword">this</span>) <span class="keyword">if</span> (predicate(element)) ++count</span><br><span class="line">    <span class="keyword">return</span> count</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Parameter types are usually omitted when they caould be inferred. Single parameterâ€™s name could be omitted if its type could ba inferred, and we take <code>it</code> as the parameter name. Unused parameter name could be marked as <strong><code>_</code></strong>.</p><p>Examples:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> numLetters = <span class="string">"Mississippi"</span>.count(&#123;</span><br><span class="line">    it == <span class="string">'s'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> afterFilter = <span class="string">"Mississippi"</span>.filterIndexed(&#123; _, char-&gt;</span><br><span class="line">    char != <span class="string">'s'</span></span><br><span class="line">&#125;)</span><br><span class="line">print(afterFilter) <span class="comment">// prints Miiippi</span></span><br></pre></td></tr></table></figure><p><strong><em>Note</em></strong>: an anonymous function must be called immediately, assigned to a variable, or be passed as a parameter.</p><p>Anonymous functions as parameter is often in a different style when it is required as the <strong>last</strong> parameter in another function:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// count starting from a specified index.</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">count</span><span class="params">(str: <span class="type">String</span>, startIdx: <span class="type">Int</span>, predicate: (<span class="type">Char</span>)</span></span> -&gt; <span class="built_in">Boolean</span>): <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> str.substring(startIdx).count(predicate)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// style 1</span></span><br><span class="line">count(<span class="string">"Mississippi"</span>, <span class="number">5</span>, &#123;</span><br><span class="line">    it == <span class="string">'s'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// style 2, looks like definition of count, </span></span><br><span class="line"><span class="comment">// but actually it's anonymous function as parameter</span></span><br><span class="line">count(<span class="string">"Mississippi"</span>, <span class="number">5</span>) &#123;</span><br><span class="line">    it == <span class="string">'s'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Want to declare a function type that returns something like <code>void</code> in Java? You need the <code>Unit</code>.</p><p>You can also refer a non anonymous function as parameter in call to another function by using <code>::</code>. But I donâ€™t think this is common.</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">isS</span><span class="params">(char: <span class="type">Char</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> char == <span class="string">'s'</span></span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">val</span> numLetters = <span class="string">"Mississippi"</span>.count(::isS)</span><br></pre></td></tr></table></figure><h3 id="6-Null-Safety-and-Exceptions"><a href="#6-Null-Safety-and-Exceptions" class="headerlink" title="6. Null Safety and Exceptions "></a>6. Null Safety and Exceptions <a name="null-safety-and-exceptions"></a></h3><p>For nullable variables, there are some common solutions to handle potential null pointer exceptions.</p><p><strong>Safe call operator</strong>:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> beverage = readLine()?.capitalize() <span class="comment">// the beverage would be String?.</span></span><br></pre></td></tr></table></figure><p><strong>Nonnull assertion</strong>:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> beverage = readLine()!!.capitalize() <span class="comment">// only if you're really confident</span></span><br></pre></td></tr></table></figure><p><strong>Check before use</strong>:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> result = readLine()</span><br><span class="line"><span class="keyword">var</span> beverage = <span class="keyword">if</span> (result != <span class="literal">null</span>) &#123; <span class="comment">// type of beverage would be String.</span></span><br><span class="line">    result.capitalize() + result.toLowerCase()</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="string">""</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>However, check before use isnâ€™t always safe, e.g. a field of an object might be assigned null by another thread between your null checking and usage of the field. For such case, you would need a local variable to get rid of this risk:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> localVar = a.b</span><br><span class="line"><span class="keyword">if</span> (localVar != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// do something refers localVar</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Elvis operator</strong>:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> beverage = readLine()?.capitalize() ?: <span class="string">""</span>  <span class="comment">// beverage would be String.</span></span><br></pre></td></tr></table></figure><h4 id="Exceptions-in-Kotlin"><a href="#Exceptions-in-Kotlin" class="headerlink" title="Exceptions in Kotlin"></a>Exceptions in Kotlin</h4><p>Kotlin doesnâ€™t require handling of those checked Exceptions of Java. Therefore you can do IO operations without try-catch and exception declaration in the method signature.</p><h3 id="7-Collections"><a href="#7-Collections" class="headerlink" title="7. Collections "></a>7. Collections <a name="collections"></a></h3><h4 id="destructuring"><a href="#destructuring" class="headerlink" title="destructuring"></a>destructuring</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> (type, name, price) = aList  <span class="comment">// fetch the leading 3 elements from a list.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> (type, _, price) = aList <span class="comment">// skip elements in specified indexes.</span></span><br></pre></td></tr></table></figure><h4 id="protection-of-immutable-list-is-not-valid-at-runtime"><a href="#protection-of-immutable-list-is-not-valid-at-runtime" class="headerlink" title="protection of immutable list is not valid at runtime"></a>protection of immutable list is not valid at runtime</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> a = listOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">(a <span class="keyword">as</span> MutableList&lt;<span class="built_in">Int</span>&gt;).<span class="keyword">set</span>(<span class="number">0</span>, <span class="number">100</span>)</span><br><span class="line">println(a) <span class="comment">// would print [100, 2, 3]</span></span><br></pre></td></tr></table></figure><h3 id="8-Class-definition"><a href="#8-Class-definition" class="headerlink" title="8. Class definition "></a>8. Class definition <a name="class-definition"></a></h3><h4 id="Visibility-modifiers-of-class-members"><a href="#Visibility-modifiers-of-class-members" class="headerlink" title="Visibility modifiers of class members"></a>Visibility modifiers of class members</h4><div class="table-container"><table><thead><tr><th style="text-align:center">Modifier</th><th style="text-align:center">Description</th></tr></thead><tbody><tr><td style="text-align:center">public (default)</td><td style="text-align:center">The function or property will be accessible by code outside of the class. By default, functions and properties without a visibility modifier are public.</td></tr><tr><td style="text-align:center">private</td><td style="text-align:center">The function or property will be accessible only within the same class.</td></tr><tr><td style="text-align:center">protected</td><td style="text-align:center">The function or property will be accessible only within the same class or its subclass.</td></tr><tr><td style="text-align:center">internal</td><td style="text-align:center">The function or property will be accessible within the same module.</td></tr></tbody></table></div><h4 id="Class-fields"><a href="#Class-fields" class="headerlink" title="Class fields"></a>Class fields</h4><p>For class fields, default <code>getter</code> is available for <code>val</code> and <code>var</code> fields. But <code>setter</code> is only for <code>var</code> fields. Yet we can override the default <code>setter</code> and <code>getter</code>:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span></span>(_name: String, _age: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// a field always return capitalized string when you get it</span></span><br><span class="line">    <span class="keyword">val</span> name = _name</span><br><span class="line">        <span class="keyword">get</span>() = field.capitalize()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// a field only allows increasing</span></span><br><span class="line">    <span class="keyword">var</span> age = _age</span><br><span class="line">        <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            <span class="keyword">if</span> (value &gt; field) &#123;</span><br><span class="line">                field = value</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>You can override the visibility of a setter to make it less permissive then fieldâ€™s visibility. E.g., you want to make a field readable everywhere but only writable in the file:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span></span>(_age: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="comment">// a field only allows increasing in current file.</span></span><br><span class="line">    <span class="keyword">var</span> age = _age</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            <span class="keyword">if</span> (value &gt; field) &#123;</span><br><span class="line">                field = value</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Computed-fields"><a href="#Computed-fields" class="headerlink" title="Computed fields"></a>Computed fields</h4><p>Has getter or/and setter but no real fields to store values.</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dice</span></span>() &#123;</span><br><span class="line">    <span class="keyword">val</span> rolledValue</span><br><span class="line">        <span class="keyword">get</span>() = (<span class="number">1.</span><span class="number">.6</span>).shuffled().first()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-Object-initialization"><a href="#9-Object-initialization" class="headerlink" title="9. Object initialization "></a>9. Object initialization <a name="object-initialization"></a></h3><h4 id="The-primary-contructor"><a href="#The-primary-contructor" class="headerlink" title="The primary contructor"></a>The primary contructor</h4><p>Add parameter list inside a pair of parenthesis after the class name, make it looks like a method. For fields <strong>using default getter and setter</strong>, you can declare them inside the parameter list by adding <code>var</code> or <code>val</code>:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// visibility modifier and default values are also available</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span></span>(<span class="keyword">val</span> name: String, <span class="keyword">private</span> <span class="keyword">var</span> age: <span class="built_in">Int</span> = <span class="number">0</span>)</span><br></pre></td></tr></table></figure><h4 id="secondary-constructor"><a href="#secondary-constructor" class="headerlink" title="secondary constructor"></a>secondary constructor</h4><p>Must call the primary constructor or another secondary constructor(of course no cycle call)</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span></span>(<span class="keyword">val</span> name: String, <span class="keyword">private</span> <span class="keyword">var</span> age: <span class="built_in">Int</span> = <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// call primary constructor with default parameter</span></span><br><span class="line">    <span class="keyword">constructor</span>(): <span class="keyword">this</span>(<span class="string">"Unknown"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Apart from default parameter values, named parameters are also available for constructors.</p><h4 id="Lazy-initialization"><a href="#Lazy-initialization" class="headerlink" title="Lazy initialization"></a>Lazy initialization</h4><p>Only initialize a field when itâ€™s accessed (by the getter)</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span> </span>&#123;</span><br><span class="line">    <span class="keyword">val</span> number: <span class="built_in">Int</span> <span class="keyword">by</span> lazy &#123;</span><br><span class="line">        (<span class="number">0</span> until <span class="number">10</span>).shuffled().first() <span class="comment">// not good example</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-Inheritance"><a href="#10-Inheritance" class="headerlink" title="10. Inheritance "></a>10. Inheritance <a name="inheritance"></a></h3><p>In Java, we only override methods. But in Kotlin, both class functions and fields could be overridden. Also, in Kotlin, classes, functions and fields must be marked <code>open</code> explicity to make them inheritable or able to be overridden. </p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Room</span></span>(<span class="keyword">val</span> name: String) &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">open</span> <span class="keyword">val</span> dangerLevel = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">description</span><span class="params">()</span></span> = <span class="string">"Room: <span class="variable">$name</span>\n"</span> +</span><br><span class="line">            <span class="string">"Danger level: <span class="variable">$dangerLevel</span>"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">load</span><span class="params">()</span></span> = <span class="string">"Nothing much to see here..."</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TownSquare</span> : <span class="type">Room</span></span>(<span class="string">"Town Square"</span>) &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> dangerLevel = <span class="keyword">super</span>.dangerLevel - <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">load</span><span class="params">()</span></span> = <span class="string">"The villagers cheer as you enter!"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Functions are final by default unless they are inherited from an open class. To prevent inherited functions from being overriden again, we can mark it <code>final</code>.</p><p>In Kotlinâ€™s inheritance, we always have:</p><p><img src="http://tao93.top/images/2019/11/05/1572968935.png" alt=""></p><p>However, when compiled into bytecode, the class Room doesnâ€™t inherits the class Any in JVM rule.</p><h3 id="11-Objects"><a href="#11-Objects" class="headerlink" title="11. Objects "></a>11. Objects <a name="objects"></a></h3><h4 id="singleton-by-object-keyword"><a href="#singleton-by-object-keyword" class="headerlink" title="singleton by object keyword"></a>singleton by <code>object</code> keyword</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    UserManager.getUser(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// constructors are not allowed for such objects</span></span><br><span class="line"><span class="keyword">object</span> UserManager &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> users = mutableListOf&lt;String&gt;(<span class="string">"A"</span>, <span class="string">"B"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getUser</span><span class="params">(idx: <span class="type">Int</span>)</span></span>: String? &#123;</span><br><span class="line">        <span class="keyword">return</span> users.getOrNull(idx)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Anonymous-inner-class"><a href="#Anonymous-inner-class" class="headerlink" title="Anonymous inner class"></a>Anonymous inner class</h4><p>In java, we often implement interfaces or extend simple classes as anonymous inner class, such as click listeners and view adapters.</p><p>In Kotlin, they could be divided into 2 categories. For interfaces with only one method and declared in Java, we can use a format called Lambda:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">generateButton.setOnClickListener &#123; view -&gt;</span><br><span class="line">    fetchData()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">useI</span><span class="params">(i: <span class="type">I</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">useI(I &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// I.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">I</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>For other cases, the format is like this:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">listView.adapter = <span class="keyword">object</span> : BaseAdapter() &#123;  <span class="comment">// call the constructor here.</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getView</span><span class="params">(pos: <span class="type">Int</span>, view: <span class="type">View</span>?, parent: <span class="type">ViewGroup</span>?)</span></span>: View &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getItem</span><span class="params">(pos: <span class="type">Int</span>)</span></span>: Any &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getItemId</span><span class="params">(pos: <span class="type">Int</span>)</span></span>: <span class="built_in">Long</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getCount</span><span class="params">()</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Nested classes by default cannot access members of the outer class, unless they are marked inner:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">outerFunc</span><span class="params">()</span></span> = <span class="string">"1"</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Nested</span> </span>&#123;</span><br><span class="line">        init &#123;</span><br><span class="line">            outerFunc()  <span class="comment">// wrong, unable to access</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    inner <span class="class"><span class="keyword">class</span> <span class="title">Inner</span> </span>&#123;</span><br><span class="line">        init &#123;</span><br><span class="line">            outerFunc()  <span class="comment">// ok</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">object</span> UserManager &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> users = mutableListOf&lt;String&gt;(<span class="string">"A"</span>, <span class="string">"B"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">        init &#123;</span><br><span class="line">            users <span class="comment">// ok. this is nested class inside an object class.</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Data-classes"><a href="#Data-classes" class="headerlink" title="Data classes"></a>Data classes</h4><p>Data classes are suitable for model, thatâ€™s what the <code>data</code> means.</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Coordinate</span></span>(<span class="keyword">var</span> x: <span class="built_in">Int</span>, <span class="keyword">var</span> y: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> inFirstQuadrant = (x &gt;<span class="number">0</span> &amp;&amp; y &gt; <span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>when use the data classes:</p><ul><li><p>Implementation of <code>toString</code>, <code>equal</code> and <code>copy</code> regarding the fields declared in the primary constructor;</p></li><li><p>Must have a primary constructor whose all parameters are marked with <code>val</code> or <code>var</code>;</p></li><li><p>Cannot be <code>abstract</code>, <code>open</code>, or <code>inner</code>.</p></li></ul><h4 id="Operator-overloading"><a href="#Operator-overloading" class="headerlink" title="Operator overloading"></a>Operator overloading</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Coordinate</span></span>(<span class="keyword">var</span> x: <span class="built_in">Int</span>, <span class="keyword">var</span> y: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">plusAssign</span><span class="params">(another: <span class="type">Coordinate</span>)</span></span> &#123;</span><br><span class="line">        x += another.x</span><br><span class="line">        y += another.y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> coo = Coordinate(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">coo += Coordinate(<span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> Fact &#123;</span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">invoke</span><span class="params">(n: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">if</span> (n &gt; <span class="number">2</span>)</span><br><span class="line">            n * <span class="keyword">this</span>(n<span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            n</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">println(Fact(<span class="number">5</span>))</span><br></pre></td></tr></table></figure><h3 id="12-Generics"><a href="#12-Generics" class="headerlink" title="12 Generics "></a>12 Generics <a name="generics"></a></h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span></span>(<span class="keyword">val</span> name: String)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Novel</span></span>(name: String): Book(name)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Textbook</span></span>(name: String): Book(name)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bookshelf</span>&lt;<span class="type">T: Book</span>&gt;</span>(<span class="keyword">vararg</span> <span class="keyword">val</span> books: T)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> shelf1 = Bookshelf(Novel(<span class="string">"A song of Ice &amp; Fire"</span>), </span><br><span class="line">                       Novel(<span class="string">"The load of the rings"</span>))</span><br><span class="line"><span class="keyword">val</span> shelf2 = Bookshelf(Novel(<span class="string">"A song of Ice &amp; Fire"</span>), </span><br><span class="line">                       Textbook(<span class="string">"Introduction to Algorithms"</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T: CharSequence&gt;</span> <span class="title">count</span><span class="params">(cs: <span class="type">T</span>, startIdx: <span class="type">Int</span>, char: <span class="type">Char</span>)</span></span> =</span><br><span class="line">    cs.substring(startIdx).count &#123;</span><br><span class="line">        it == char</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> list1: List&lt;Book&gt; = listOf&lt;Novel&gt;(Novel(<span class="string">"A"</span>), Novel(<span class="string">"B"</span>))</span><br><span class="line"><span class="comment">// the following line is wrong!</span></span><br><span class="line"><span class="keyword">val</span> list2: MutableList&lt;Book&gt; = mutableListOf&lt;Novel&gt;(Novel(<span class="string">"A"</span>), Novel(<span class="string">"B"</span>))</span><br></pre></td></tr></table></figure><p>Actually the <code>List</code> interface is like this:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">List</span>&lt;<span class="type">out E</span>&gt; : <span class="type">Collection</span>&lt;<span class="type">E</span>&gt; </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Here <code>out</code> means: any fields of a List whih the generic type <code>E</code> must be <code>val</code>. Thus <code>E</code> is a type only for readable fields.</p><p>On the other hand, there is <code>in</code>, which means a generic type is only for writable variables:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>&lt;<span class="type">in T</span>&gt; </span>&#123; <span class="comment">// no fields of type T can be available to outside</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> item: T? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">setItem</span><span class="params">(newItem: <span class="type">T</span>)</span></span> &#123;</span><br><span class="line">        item = newItem</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> a: A&lt;Novel&gt; = A&lt;Book&gt;()</span><br></pre></td></tr></table></figure><p>The wildcard in Java generics has some similarities with the <code>in</code> and <code>out</code> in Kotlin, but they are not equivalent concepts.</p><h3 id="13-Extensions"><a href="#13-Extensions" class="headerlink" title="13. Extensions "></a>13. Extensions <a name="extensions"></a></h3><p>Based on anonymous function and generics, Kotlin brings the extensions, which enable us to extend classes with new functions and fields without inheritance. The Kotlin standard library contains a large numbers of extensions.</p><p>The code below</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">count</span><span class="params">(str: <span class="type">String</span>, startIdx: <span class="type">Int</span>, predicate: (<span class="type">Char</span>)</span></span> -&gt; <span class="built_in">Boolean</span>) =</span><br><span class="line">    str.substring(startIdx).count(predicate)</span><br><span class="line">    </span><br><span class="line">count(<span class="string">"Mississippi"</span>, <span class="number">5</span>) &#123;</span><br><span class="line">    it == <span class="string">'s'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>could be refactored as</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// just like we have extended the String class, a final class.</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> String.<span class="title">count</span><span class="params">(startIdx: <span class="type">Int</span>, predicate: (<span class="type">Char</span>)</span></span> -&gt; <span class="built_in">Boolean</span>) =</span><br><span class="line">    substring(startIdx).count(predicate)</span><br><span class="line"></span><br><span class="line"><span class="string">"Mississippi"</span>.count(<span class="number">5</span>) &#123;</span><br><span class="line">    it == <span class="string">'s'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Extend with fields is also available:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> String.countS</span><br><span class="line">    <span class="keyword">get</span>() = count &#123; it == <span class="string">'s'</span> || it == <span class="string">'S'</span> &#125;</span><br><span class="line"></span><br><span class="line">println(<span class="string">"Mississippi"</span>.countS) <span class="comment">// would print 4</span></span><br></pre></td></tr></table></figure><p>Like computed properties, extended fields have no backing fields, actually the extended fields has no essential differences with extended methods.</p><p>Visibility modifiers are also valid for the extensions.</p><p>Extensions on nullable types:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> T?.<span class="title">chkNull</span><span class="params">(block1: (<span class="type">T</span>)</span></span> -&gt; <span class="built_in">Unit</span>, block2: () -&gt; <span class="built_in">Unit</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> != <span class="literal">null</span>) &#123; <span class="comment">// for such extension, the this is nullable</span></span><br><span class="line">        block1(<span class="keyword">this</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        block2()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>(<span class="keyword">val</span> x: String? = listOf&lt;String?&gt;(<span class="string">"s"</span>, <span class="literal">null</span>).shuffled().first())</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> c = C()</span><br><span class="line">c.x.chkNull(&#123;   <span class="comment">// no need to write c.x?. even that c.x is nullable.</span></span><br><span class="line">    <span class="comment">// it ...</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Generics in extensions:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> T.<span class="title">prt</span><span class="params">()</span></span> &#123;</span><br><span class="line">    println(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(<span class="number">1</span> + <span class="number">1</span>).prt()</span><br></pre></td></tr></table></figure><p>Extensions in Kotlin standard library:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Calls the specified function [block] with `this` value as its argument </span></span><br><span class="line"><span class="comment"> * and returns its result.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * For detailed usage information see the documentation for [scope functions]</span></span><br><span class="line"><span class="comment"> * (https://kotlinlang.org/docs/reference/scope-functions.html#let).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@kotlin</span>.<span class="keyword">internal</span>.InlineOnly</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T, R&gt;</span> T.<span class="title">let</span><span class="params">(block: (<span class="type">T</span>)</span></span> -&gt; R): R &#123;</span><br><span class="line">    contract &#123;</span><br><span class="line">        callsInPlace(block, InvocationKind.EXACTLY_ONCE)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> block(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Usage of the <code>let</code>:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Y</span></span>(<span class="keyword">val</span> pair: Pair&lt;String, String&gt;?)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> y = Y(Pair(<span class="string">"hello"</span>, <span class="string">"world"</span>))</span><br><span class="line"></span><br><span class="line">y.pair?.let &#123;</span><br><span class="line">    println(it.first + <span class="string">" "</span> + it.second)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> p = y.pair</span><br><span class="line"><span class="keyword">if</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">    println(p.first + <span class="string">" "</span> + p.second)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Extension function type:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> greetings: String.() -&gt; <span class="built_in">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">"Hello "</span> + <span class="keyword">this</span>.capitalize())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">"Mississippi"</span>.greetings()</span><br></pre></td></tr></table></figure><p>Another extension in Kotlin standard library:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Calls the specified function [block] with `this` value as its receiver </span></span><br><span class="line"><span class="comment"> * and returns its result.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * For detailed usage information see the documentation for [scope functions]</span></span><br><span class="line"><span class="comment"> * (https://kotlinlang.org/docs/reference/scope-functions.html#run).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@kotlin</span>.<span class="keyword">internal</span>.InlineOnly</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T, R&gt;</span> T.<span class="title">run</span><span class="params">(block: <span class="type">T</span>.()</span></span> -&gt; R): R &#123;</span><br><span class="line">    contract &#123;</span><br><span class="line">        callsInPlace(block, InvocationKind.EXACTLY_ONCE)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> block()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">File(<span class="string">"x.txt"</span>).run &#123;</span><br><span class="line">    setReadable(<span class="literal">true</span>)</span><br><span class="line">    setWritable(<span class="literal">true</span>)</span><br><span class="line">    setExecutable(<span class="literal">false</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="14-Java-Interoperability"><a href="#14-Java-Interoperability" class="headerlink" title="14. Java Interoperability "></a>14. Java Interoperability <a name="java-interoperability"></a></h3><h4 id="Nullity"><a href="#Nullity" class="headerlink" title="Nullity"></a>Nullity</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in java side, mark non-private fields, return type and parameter type</span></span><br><span class="line"><span class="comment">// with annotations, thus helps Kotlin side handle nullity</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JavaClass</span> </span>&#123;</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">public</span> String x = <span class="string">"x"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">public</span> String f(<span class="meta">@NotNull</span> String y) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Jetbrains created their annotations like this:<br><img src="http://tao93.top/images/2019/11/05/1572992024.png" alt=""></p><p>While the annotations by Google is like this:<br><img src="http://tao93.top/images/2019/11/05/1572992106.png" alt=""></p><h3 id="File-level-Kotlin-members"><a href="#File-level-Kotlin-members" class="headerlink" title="File level Kotlin members"></a>File level Kotlin members</h3><p>Letâ€™s say we have a kotlin file Hello.kt which is:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in Hello.kt file</span></span><br><span class="line"><span class="comment">// by default, the Hello.kt would generate a JVM class as HelloKt, </span></span><br><span class="line"><span class="comment">// but we can change it like the following line.</span></span><br><span class="line"><span class="meta">@file:JvmName</span>(<span class="string">"Hello"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// file level members would be static members in generated JVM class</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">f</span><span class="params">()</span></span> = <span class="string">"hello from kotlin."</span></span><br></pre></td></tr></table></figure><h3 id="Kotlin-functions-with-default-parameter-values"><a href="#Kotlin-functions-with-default-parameter-values" class="headerlink" title="Kotlin functions with default parameter values"></a>Kotlin functions with default parameter values</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add this annotation to make it generates several overloaded JVM methods</span></span><br><span class="line"><span class="meta">@JvmOverloads</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">f</span><span class="params">(name: <span class="type">String</span> = <span class="string">"Unknown"</span>, age: <span class="type">Int</span> = <span class="number">0</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Access-members-of-companion-object-in-Java"><a href="#Access-members-of-companion-object-in-Java" class="headerlink" title="Access members of companion object in Java"></a>Access members of companion object in Java</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">H</span> </span>&#123;</span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="meta">@JvmField</span>  <span class="comment">// then H.x is ok in Java, or we need H.companion.x</span></span><br><span class="line">        <span class="keyword">val</span> x = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">@JvmStatic</span>  <span class="comment">// then H.f is ok in Java</span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">f</span><span class="params">()</span></span>&#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Exceptions"><a href="#Exceptions" class="headerlink" title="Exceptions"></a>Exceptions</h4><p>As we said earlier, Kotlin doesnâ€™t require we to try-catch code blocks which may throw checked Java Exceptions or add a <code>throws</code> declaration in the method signatures. So if a Java method is called with <code>throws</code> declaration is called in kotlin, we might missed the exceptions warning by the Java method.</p><p>For Kotlin methods which would be called by Java and might throw checked exceptions, marked it with annotation:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Throws(IOException::class)</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">f</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> FileNotFoundException()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Referred-functions-of-Kotlin"><a href="#Referred-functions-of-Kotlin" class="headerlink" title="Referred functions of Kotlin"></a>Referred functions of Kotlin</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in Test.kt file</span></span><br><span class="line"><span class="keyword">val</span> translator = &#123; utterance: String -&gt;</span><br><span class="line">    println(utterance.toLowerCase().capitalize())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaClass</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Function1&lt;String, Unit&gt; translator = RoomKt.getTranslator();</span><br><span class="line">        translator.invoke(<span class="string">"MONey"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Whatâ€™s the <code>Function1</code>:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** A function that takes 1 argument. */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Function1</span>&lt;<span class="type">in P1, out R</span>&gt; : <span class="type">Function</span>&lt;<span class="type">R</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/** Invokes the function with the specified argument. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">invoke</span><span class="params">(p1: <span class="type">P1</span>)</span></span>: R</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="15-Corutines"><a href="#15-Corutines" class="headerlink" title="15. Corutines "></a>15. Corutines <a name="coroutines"></a></h3><h4 id="what-are-coroutines"><a href="#what-are-coroutines" class="headerlink" title="what are coroutines"></a>what are coroutines</h4><ul><li><p>coroutines are more lightweight than threads</p></li><li><p>a thread can schedule between multiple coroutines</p></li><li><p>a coroutine can switch between threads</p></li></ul><h3 id="async-amp-launch"><a href="#async-amp-launch" class="headerlink" title="async &amp; launch"></a><code>async</code> &amp; <code>launch</code></h3><p>the most common ways to create coroutines</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> CoroutineScope.<span class="title">launch</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    context: <span class="type">CoroutineContext</span> = EmptyCoroutineContext,</span></span></span><br><span class="line"><span class="function"><span class="params">    start: <span class="type">CoroutineStart</span> = CoroutineStart.DEFAULT,</span></span></span><br><span class="line"><span class="function"><span class="params">    block: <span class="type">suspend</span> <span class="type">CoroutineScope</span>.()</span></span> -&gt; <span class="built_in">Unit</span></span><br><span class="line">): Job</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Job</span> : <span class="type">CoroutineContext.Element &#123;</span></span></span><br><span class="line">    <span class="keyword">public</span> suspend <span class="function"><span class="keyword">fun</span> <span class="title">join</span><span class="params">()</span></span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> CoroutineScope.<span class="title">async</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    context: <span class="type">CoroutineContext</span> = EmptyCoroutineContext,</span></span></span><br><span class="line"><span class="function"><span class="params">    start: <span class="type">CoroutineStart</span> = CoroutineStart.DEFAULT,</span></span></span><br><span class="line"><span class="function"><span class="params">    block: <span class="type">suspend</span> <span class="type">CoroutineScope</span>.()</span></span> -&gt; T</span><br><span class="line">): Deferred&lt;T&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Deferred</span>&lt;<span class="type">out T</span>&gt; : <span class="type">Job &#123;</span></span></span><br><span class="line">    <span class="keyword">public</span> suspend <span class="function"><span class="keyword">fun</span> <span class="title">await</span><span class="params">()</span></span>: T</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Deferred&lt;T&gt;</code> is also a <code>job</code>, only that we can call its <code>await</code> to fetch an result returned by that coroutine. e.g:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">fetchData</span><span class="params">()</span></span> &#123;</span><br><span class="line">    GlobalScope.launch(Dispatchers.Main) &#123; </span><br><span class="line">        <span class="comment">// type of result: Deferred&lt;CharacterData&gt;</span></span><br><span class="line">        <span class="keyword">val</span> result = GlobalScope.async(Dispatchers.Default) &#123;</span><br><span class="line">            <span class="keyword">val</span> (race, name, dex, wis, str) = URL(</span><br><span class="line">            <span class="string">"https://chargen-api.herokuapp.com/"</span>).readText().split(<span class="string">","</span>)</span><br><span class="line">            CharacterData(race, name, dex, wis, str)</span><br><span class="line">        &#125;</span><br><span class="line">        characterData = result.await()</span><br><span class="line">        displayCharacterData() <span class="comment">// use the fetched characterData</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">displayCharacterData</span><span class="params">()</span></span> &#123;</span><br><span class="line">    characterData.run &#123;</span><br><span class="line">        nameTextView.text = name</span><br><span class="line">        raceTextView.text = race</span><br><span class="line">        dexterityTextView.text = dex</span><br><span class="line">        wisdomTextView.text = wis</span><br><span class="line">        strengthTextView.text = str</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="suspend-functions"><a href="#suspend-functions" class="headerlink" title="suspend functions"></a><code>suspend</code> functions</h3><p>In my oppnion, a function with <code>suspend</code> means 3 things:</p><ol><li>it might takes a not short period of time to finish it (but not blocking a thread);</li><li>if declared in <code>kotlinx.coroutines</code>, then itâ€™s a cancelable point;</li><li>might be a schedule point for threads.</li></ol><p>The most common <code>suspend</code> method, <code>delay</code>, fulfills the 3 conclusions, so does the <code>Deferred.await</code> method.</p><h3 id="the-cancelable-point"><a href="#the-cancelable-point" class="headerlink" title="the cancelable point"></a>the cancelable point</h3><p>Able to cancel:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> = runBlocking &#123;</span><br><span class="line">    <span class="keyword">val</span> job = launch &#123;</span><br><span class="line">        delay(<span class="number">3000</span>)</span><br><span class="line">        println(<span class="string">"You won't see me since I would be canceled."</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    delay(<span class="number">100</span>)</span><br><span class="line">    job.cancel()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Unable to cancel:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> = runBlocking &#123;</span><br><span class="line">    <span class="keyword">val</span> job = launch &#123;</span><br><span class="line">        compute()</span><br><span class="line">        println(<span class="string">"No way to cancel me!"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    delay(<span class="number">100</span>)</span><br><span class="line">    job.cancel()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">compute</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> startTime = System.currentTimeMillis()</span><br><span class="line">    <span class="keyword">var</span> lastTime = startTime</span><br><span class="line">    <span class="keyword">while</span> (lastTime - startTime &lt; <span class="number">3</span>_000) &#123;</span><br><span class="line">        <span class="keyword">if</span> (System.currentTimeMillis() - lastTime &gt;= <span class="number">1000</span>) &#123;</span><br><span class="line">            lastTime += <span class="number">1000</span></span><br><span class="line">            println((lastTime - startTime) / <span class="number">1000</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Note</strong>: <code>runBlocking</code> would be explained later.</p><h3 id="Coroutine-context"><a href="#Coroutine-context" class="headerlink" title="Coroutine context"></a>Coroutine context</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> = runBlocking&lt;<span class="built_in">Unit</span>&gt; &#123;</span><br><span class="line">    launch(Dispatchers.Default + CoroutineName(<span class="string">"test"</span>)) &#123;</span><br><span class="line">        println(<span class="string">"I'm working in thread <span class="subst">$&#123;Thread.currentThread().name&#125;</span>"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Coroutine-scope"><a href="#Coroutine-scope" class="headerlink" title="Coroutine scope"></a>Coroutine scope</h3><p><code>scope</code> is just like variables have scope in most programming languages</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">1</span> + <span class="number">1</span> == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">val</span> x = <span class="number">3</span> <span class="comment">// x belongs to the if scope</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>the <code>CoroutineScope</code> interface</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CoroutineScope</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">val</span> coroutineContext: CoroutineContext</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In kotlin, <code>CoroutineScope</code> is implemented by <code>AbstractCoroutine</code>, hence a coroutine means a <code>CoroutineScope</code>, but not vice versa.</p><p>Parent coroutine and child coroutine:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GlobalScope.launch &#123; </span><br><span class="line">    <span class="comment">// only inside a coroutine can we call launch &amp; async directly.</span></span><br><span class="line">    launch &#123; </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Direct calls of <code>launch</code> &amp; <code>async</code> also means children coroutines inherits <code>Dispatchers</code> from parent unless override by providing a <code>Dispatchers</code> parameter. </p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GlobalScope.launch(Dispatchers.Main) &#123; </span><br><span class="line">    <span class="comment">// only inside a coroutine can we call launch &amp; async directly.</span></span><br><span class="line">    launch(Dispatchers.Default) &#123; </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Normally, parent finish after all children finish. But there is a extension method of <code>CoroutineScope</code> naming <code>cancel</code>. When itâ€™s called, the whole coroutine tree are canceled.</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Cancels this scope, including its job and all its children with an </span></span><br><span class="line"><span class="comment"> * optional cancellation [cause].</span></span><br><span class="line"><span class="comment"> * A cause can be used to specify an error message or to provide other </span></span><br><span class="line"><span class="comment"> * details on a cancellation reason for debugging purposes.</span></span><br><span class="line"><span class="comment"> * Throws [IllegalStateException] if the scope does not have a job in it.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> CoroutineScope.<span class="title">cancel</span><span class="params">(cause: <span class="type">CancellationException</span>? = <span class="literal">null</span>)</span></span></span><br></pre></td></tr></table></figure><p>In kotlin, we have a <code>GlobalScope</code> which is an <code>object</code> singleton. Coroutines directly created from <code>GlobalScope</code> can last long as long as the JVM is on. <code>GlobalScope</code> is convenient for demo, however we may want coroutines to be canceled when an <code>Activity</code> is destroyed, for example.</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> mainScope = MainScope()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroy</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy()</span><br><span class="line">        mainScope.cancel()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    mainScope.launch(Dispatchers.Main) &#123; </span><br><span class="line">        <span class="comment">// type of result: Deferred&lt;CharacterData&gt;</span></span><br><span class="line">        <span class="keyword">val</span> result = mainScope.async(Dispatchers.Default) &#123;</span><br><span class="line">            <span class="keyword">val</span> (race, name, dex, wis, str) = URL(</span><br><span class="line">            <span class="string">"https://chargen-api.herokuapp.com/"</span>).readText().split(<span class="string">","</span>)</span><br><span class="line">            CharacterData(race, name, dex, wis, str)</span><br><span class="line">        &#125;</span><br><span class="line">        characterData = result.await()</span><br><span class="line">        displayCharacterData() <span class="comment">// use the fetched characterData</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now letâ€™s go back to explain <code>runBlocking</code>. <code>runBlocking</code> also starts a coroutine from <code>GlobeSope</code>, only that <code>runBlocking</code> coroutines prevent JVM from ending.</p><h4 id="the-coroutineScope-block-method"><a href="#the-coroutineScope-block-method" class="headerlink" title="the coroutineScope(block) method"></a>the <code>coroutineScope(block)</code> method</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">suspend <span class="function"><span class="keyword">fun</span> <span class="type">&lt;R&gt;</span> <span class="title">coroutineScope</span><span class="params">(block: <span class="type">suspend</span> <span class="type">CoroutineScope</span>.()</span></span> -&gt; R): R</span><br></pre></td></tr></table></figure><p>We can create a new scope with this <code>coroutineScope</code> method. The most common usage would be like this:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">suspend <span class="function"><span class="keyword">fun</span> <span class="title">doSomeThing</span><span class="params">()</span></span>: <span class="built_in">Int</span> = coroutineScope &#123;</span><br><span class="line">    <span class="keyword">val</span> deferred = async(Dispatchers.IO) &#123; </span><br><span class="line">        delay(<span class="number">500</span>)</span><br><span class="line">        <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">    deferred.await()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GlobalScope.launch(Dispatchers.Main) &#123; </span><br><span class="line">    <span class="keyword">val</span> result = doSomeThing()</span><br><span class="line">    <span class="comment">// use the result</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In the above code, we created a scope with <code>coroutineScope</code>. When <code>doSomeThing</code> is called from another coroutine, the scope we created would inherit context from the outer coroutine scope. More importantly, when the outer scope is cancelled, this scope would also be canceled.</p><p>In next section, we would see the <code>coroutineScope</code> has important role in exception handling.</p><h3 id="Exception-in-coroutines"><a href="#Exception-in-coroutines" class="headerlink" title="Exception in coroutines"></a>Exception in coroutines</h3><p>First, what is a crash in Android app? (excluding ANR).</p><p>The simplest and best way to handle exceptions, is catching exceptions locally, i.e. donâ€™t let exceptions be passed between coroutines. Like the following:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">suspend <span class="function"><span class="keyword">fun</span> <span class="title">doSomeThing</span><span class="params">()</span></span>: <span class="built_in">Int</span> = coroutineScope &#123;</span><br><span class="line">    <span class="keyword">val</span> deferred: Deferred&lt;<span class="built_in">Int</span>&gt; = async(Dispatchers.IO) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ... the regular code block.</span></span><br><span class="line">            <span class="number">3</span> <span class="comment">// assume 3 is a valid return</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (e: IndexOutOfBoundsException) &#123;</span><br><span class="line">            <span class="comment">// do something to handle</span></span><br><span class="line">            <span class="number">0</span> <span class="comment">// assume 0 is a default return</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    deferred.await()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Itâ€™s simple, but why best? Because when an exception is not caught inside a coroutine, the exception would mostly cancel the whole coroutine tree. </p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// all coroutines would be canceled, and the thread would crash</span></span><br><span class="line">    GlobalScope.launch &#123;</span><br><span class="line">        launch &#123;</span><br><span class="line">            delay(<span class="number">200</span>)</span><br><span class="line">            println(<span class="string">"You won't see me since I would be canceled."</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        launch &#123;</span><br><span class="line">            <span class="keyword">throw</span> IndexOutOfBoundsException()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        delay(<span class="number">200</span>)</span><br><span class="line">        println(<span class="string">"You won't see me since I would be canceled."</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    runBlocking &#123; delay(<span class="number">500</span>) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>However, with the <code>coroutineScope</code> method, we can do more.</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">suspend <span class="function"><span class="keyword">fun</span> <span class="title">doSomeThing</span><span class="params">()</span></span>: <span class="built_in">Int</span> = coroutineScope &#123;</span><br><span class="line">    <span class="keyword">val</span> deferred: Deferred&lt;<span class="built_in">Int</span>&gt; = async(Dispatchers.IO) &#123;</span><br><span class="line">        <span class="keyword">throw</span> IndexOutOfBoundsException()</span><br><span class="line">    &#125;</span><br><span class="line">    launch &#123; <span class="comment">// this would be canceled</span></span><br><span class="line">        delay(<span class="number">200</span>)</span><br><span class="line">        println(<span class="string">"You won't see me since I would be canceled."</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    deferred.await()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    GlobalScope.launch &#123;</span><br><span class="line">        launch &#123;</span><br><span class="line">            delay(<span class="number">200</span>)</span><br><span class="line">            println(<span class="string">"I wouldn't be canceled."</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        launch &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123; doSomeThing() &#125; <span class="comment">// doSomeThing throws the exception</span></span><br><span class="line">            <span class="keyword">catch</span> (e: IndexOutOfBoundsException) &#123;</span><br><span class="line">                println(<span class="string">"caught the exception: <span class="variable">$e</span>"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        delay(<span class="number">200</span>)</span><br><span class="line">        println(<span class="string">"I wouldn't be canceled, either."</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    runBlocking &#123; delay(<span class="number">500</span>) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="the-CancellationException"><a href="#the-CancellationException" class="headerlink" title="the CancellationException"></a>the <code>CancellationException</code></h3><p>It is thrown when a coroutine is canceled, but wonâ€™t crash the JVM thread.</p><p>just like nothing happen:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// just like nothing happen</span></span><br><span class="line">    GlobalScope.launch &#123;</span><br><span class="line">        <span class="keyword">throw</span> CancellationException()</span><br><span class="line">    &#125;</span><br><span class="line">    runBlocking &#123; delay(<span class="number">500</span>) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>JVM thread would crash:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    GlobalScope.launch &#123;</span><br><span class="line">        <span class="keyword">throw</span> IndexOutOfBoundsException()</span><br><span class="line">    &#125;</span><br><span class="line">    runBlocking &#123; delay(<span class="number">500</span>) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>CancellationException</code> seems useless, but it can be caught if you want. Just surround the cancel point inside a coroutine with try-catch.</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// just like nothing happen</span></span><br><span class="line">    GlobalScope.launch &#123;</span><br><span class="line">        launch &#123;</span><br><span class="line">            delay(<span class="number">100</span>)</span><br><span class="line">            <span class="keyword">throw</span> IndexOutOfBoundsException()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123; delay(<span class="number">50</span>) &#125; <span class="keyword">catch</span> (e: CancellationException) &#123;</span><br><span class="line">            println(<span class="string">"caught 1: <span class="variable">$e</span>"</span>)</span><br><span class="line">            <span class="keyword">throw</span> e <span class="comment">// usually you should throw it again</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123; delay(<span class="number">60</span>) &#125; <span class="keyword">catch</span> (e: CancellationException) &#123;</span><br><span class="line">            println(<span class="string">"caught 2: <span class="variable">$e</span>"</span>)</span><br><span class="line">            <span class="keyword">throw</span> e <span class="comment">// usually you should throw it again</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    runBlocking &#123; delay(<span class="number">500</span>) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Look the the code above, if you donâ€™t throw again the <code>CancellationException</code> again, the coroutine would continue executing, which usually is abnormal.</p><h3 id="the-CoroutineExceptionHandler"><a href="#the-CoroutineExceptionHandler" class="headerlink" title="the CoroutineExceptionHandler"></a>the <code>CoroutineExceptionHandler</code></h3><p>We can set an <code>CoroutineExceptionHandler</code> to the root scope or the root coroutine to let the handler handle exceptions throws inside all coroutines.</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> ceh = CoroutineExceptionHandler &#123; _, e -&gt;</span><br><span class="line">        println(<span class="string">"Handled crash: <span class="variable">$e</span>"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//CoroutineScope(Dispatchers.IO).launch(ceh) &#123;  // this also works</span></span><br><span class="line">    CoroutineScope(Dispatchers.IO + ceh).launch &#123;</span><br><span class="line">        launch(Dispatchers.Default) &#123;</span><br><span class="line">            <span class="keyword">throw</span> IndexOutOfBoundsException()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    runBlocking &#123; delay(<span class="number">500</span>) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// would crash!!</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> ceh = CoroutineExceptionHandler &#123; _, e -&gt;</span><br><span class="line">        println(<span class="string">"Handled crash: <span class="variable">$e</span>"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    CoroutineScope(Dispatchers.IO).launch &#123;</span><br><span class="line">        launch(Dispatchers.Default + ceh) &#123;</span><br><span class="line">            <span class="keyword">throw</span> IndexOutOfBoundsException()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    runBlocking &#123; delay(<span class="number">500</span>) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>If a coroutine is created from <code>async</code>, the <code>await</code> function would also throw the exception escaped from the coroutine:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> ceh = CoroutineExceptionHandler &#123; _, e -&gt;</span><br><span class="line">        println(<span class="string">"Handled crash: <span class="variable">$e</span>"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    CoroutineScope(Dispatchers.IO).launch(ceh) &#123;</span><br><span class="line">        <span class="keyword">val</span> d: Deferred&lt;<span class="built_in">Int</span>&gt; = async() &#123; oops(); <span class="number">3</span> &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            println(d.await())</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e: IndexOutOfBoundsException) &#123;</span><br><span class="line">            println(<span class="string">"caught: <span class="variable">$e</span>"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    runBlocking &#123; delay(<span class="number">500</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">oops</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> IndexOutOfBoundsException()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="16-Functional-Programming-Basics"><a href="#16-Functional-Programming-Basics" class="headerlink" title="16. Functional Programming Basics "></a>16. Functional Programming Basics <a name="functional-programming-basics"></a></h3><h3 id="Transforms"><a href="#Transforms" class="headerlink" title="Transforms"></a>Transforms</h3><p>A transform function works on the contents of a collection by walking through the collection and transforming each item with a transformer function provided as an argument.</p><p>the <code>map</code> method</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a list containing the results of applying the given [transform] </span></span><br><span class="line"><span class="comment"> * function to each element in the original collection.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@sample</span> samples.collections.Collections.Transformations.map</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T, R&gt;</span> Iterable<span class="type">&lt;T&gt;</span>.<span class="title">map</span><span class="params">(transform: (<span class="type">T</span>)</span></span> -&gt; R): List&lt;R&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> mapTo(ArrayList&lt;R&gt;(collectionSizeOrDefault(<span class="number">10</span>)), transform)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Filters"><a href="#Filters" class="headerlink" title="Filters"></a>Filters</h3><p>A filter function accepts a predicate function that checks each element in a collection against a condition and returns either true or false.</p><p>the <code>filter</code> method</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a list containing only elements matching the given [predicate].</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> Iterable<span class="type">&lt;T&gt;</span>.<span class="title">filter</span><span class="params">(predicate: (<span class="type">T</span>)</span></span> -&gt; <span class="built_in">Boolean</span>): List&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> filterTo(ArrayList&lt;T&gt;(), predicate)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Combines"><a href="#Combines" class="headerlink" title="Combines"></a>Combines</h3><p>Combining functions take different collections and merge them into a new one.</p><p>the <code>zip</code> method</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a sequence of values built from the elements of `this` sequence </span></span><br><span class="line"><span class="comment"> * and the [other] sequence with the same index.</span></span><br><span class="line"><span class="comment"> * The resulting sequence ends as soon as the shortest input sequence ends.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The operation is _intermediate_ and _stateless_.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@sample</span> samples.collections.Sequences.Transformations.zip</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">infix</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T, R&gt;</span> Sequence<span class="type">&lt;T&gt;</span>.<span class="title">zip</span><span class="params">(other: <span class="type">Sequence</span>&lt;<span class="type">R</span>&gt;)</span></span>: </span><br><span class="line">Sequence&lt;Pair&lt;T, R&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> MergingSequence(<span class="keyword">this</span>, other) &#123; t1, t2 -&gt; t1 to t2 &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Examples</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get primes</span></span><br><span class="line">(<span class="number">2.</span><span class="number">.1000</span>).filter &#123; num-&gt;</span><br><span class="line">    (<span class="number">2</span> until num).filter &#123; </span><br><span class="line">        num % it == <span class="number">0</span></span><br><span class="line">    &#125;.isEmpty()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// get primes with the none</span></span><br><span class="line"><span class="keyword">val</span> primes = (<span class="number">2.</span><span class="number">.1000</span>).filter &#123; num-&gt;</span><br><span class="line">    (<span class="number">2</span> until num).none &#123;</span><br><span class="line">        num % it == <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="References"><a href="#References" class="headerlink" title="References "></a>References <a name="references"></a></h3><ol><li><a href="https://www.bignerdranch.com/books/kotlin-programming-the-big-nerd-ranch-guide-2/" target="_blank" rel="noopener">Kotlin Programming: The Big Nerd Ranch Guide</a>, awailable in the <a href="https://learning.oreilly.com/home/" target="_blank" rel="noopener">Oâ€™Reilly Learning</a> platform.</li><li>Official <a href="https://kotlinlang.org/docs/reference/coroutines/coroutines-guide.html" target="_blank" rel="noopener">Kotlin coroutine guide</a>.</li><li><a href="https://medium.com/the-kotlin-chronicle/coroutine-exceptions-3378f51a7d33" target="_blank" rel="noopener">Exceptional Exceptions for Coroutines made easyâ€¦?</a></li></ol>]]></content>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>5 åˆ†é’Ÿæé«˜ macOS ä½¿ç”¨æ•ˆçŽ‡</title>
      <link href="/2019/08/09/macOS%20%E6%95%88%E7%8E%87/"/>
      <url>/2019/08/09/macOS%20%E6%95%88%E7%8E%87/</url>
      <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æèµ· macOSï¼Œå¤§å®¶å¯èƒ½ä¼šæƒ³åˆ°ç²¾è‡´ã€å¹¿å‘Šå°‘ã€è½¯ç¡¬æ­é…æžä½³ã€Unix ç­‰ç­‰ï¼Œè¿™äº›ä¹Ÿæ˜¯ macOS é€æ¸åœ¨è½¯ä»¶å¼€å‘è€…ã€è®¾è®¡å¸ˆã€æ–‡å­—å·¥ä½œè€…ç­‰ç¾¤é‡Œä¸­æˆä¸ºã€Œæ ‡é…ã€çš„åŽŸå› ã€‚ç„¶è€Œæ€»ç»“æˆ‘è¿™å‡ å¹´çš„ä½¿ç”¨ç»éªŒï¼Œæˆ‘è®¤ä¸ºæœ‰è®¸å¤šå·¥å…·å’Œæ–¹æ³•ï¼Œå¯ä»¥åœ¨é»˜è®¤çš„ macOS åŸºç¡€ä¸Šï¼Œæ›´è¿›ä¸€æ­¥æé«˜æˆ‘ä»¬çš„æ•ˆçŽ‡ã€‚æœ¬æ–‡åŸºäºŽ macOS 10.14.6ï¼Œä¸æ¯”è¾ƒ macOS å’Œå…¶å®ƒç³»ç»Ÿå­°ä¼˜å­°åŠ£ï¼Œè€Œæ˜¯é’ˆå¯¹ã€Œæ‰€æœ‰ç”¨æˆ·ã€å’Œã€Œç¨‹åºå‘˜ã€ä¸¤ä¸ªç¾¤ä½“åˆ†åˆ«åˆ†äº«ä¸€äº›æˆ‘çš„ç»éªŒï¼Œæ¬¢è¿Žè®¨è®ºå’Œäº¤æµã€‚å¦å¤–ï¼Œæœ¬æ–‡æŽ¨èçš„å‡ ä¹Žéƒ½æ˜¯å…è´¹æˆ–è€…å¼€æºçš„å·¥å…·ï¼Œå—¯ï¼Œæˆ‘å°±æ˜¯è¿™ä¹ˆä¸ºå¤§å®¶çš„é’±åŒ…ç€æƒ³ï¼ˆ<del>æˆ‘å¯ä¸ä¼šè¯´æ˜¯å› ä¸ºæˆ‘ç©·</del>ï¼‰ã€‚</p><h3 id="å¯¹æ‰€æœ‰ç”¨æˆ·"><a href="#å¯¹æ‰€æœ‰ç”¨æˆ·" class="headerlink" title="å¯¹æ‰€æœ‰ç”¨æˆ·"></a>å¯¹æ‰€æœ‰ç”¨æˆ·</h3><h4 id="å‰ªè´´æ¿ç®¡ç†"><a href="#å‰ªè´´æ¿ç®¡ç†" class="headerlink" title="å‰ªè´´æ¿ç®¡ç†"></a>å‰ªè´´æ¿ç®¡ç†</h4><p>å‰ªè´´æ¿ç®¡ç†å·¥å…·å¸®æˆ‘ä»¬ç»´æŠ¤æ–‡æœ¬å’Œ<strong>å›¾ç‰‡</strong>çš„å¤åˆ¶åŽ†å²ï¼Œä»Žè€Œè®©æˆ‘ä»¬èƒ½ç²˜è´´ä¸Šä¸Šä¸Šä¸Šä¸Šä¸Šä¸Šä¸Šä¸Šä¸Šä¸Šä¸Š(<del>è¯·ä¸è¦è¯´æˆ‘å‡‘å­—æ•°</del>)â€¦æ¬¡å¤åˆ¶çš„å†…å®¹ã€‚æ˜¾è€Œæ˜“è§è¿™æ˜¯å¯¹ä»»ä½•äººéƒ½éžå¸¸æœ‰ç”¨ enhancementï¼Œè¿™ä¹Ÿæ˜¯ä¸ºå•¥æˆ‘æŠŠå®ƒæ”¾åœ¨ç¬¬ä¸€ä¸ªä»‹ç»ã€‚çŽ°åœ¨ <a href="https://www.alfredapp.com/" target="_blank" rel="noopener">Alfred</a> ç­‰å·¥å…·å·²é›†æˆäº†å‰ªè´´æ¿ç®¡ç†çš„åŠŸèƒ½ï¼Œä¸è¿‡ï¼Œæœ¬ç€å¼€æºä¼˜å…ˆ(<del>å…è´¹</del>)çš„åŽŸåˆ™ï¼Œæˆ‘è¦æŽ¨èçš„æ˜¯ GitHub ä¸Šçš„ <a href="https://github.com/Clipy/Clipy" target="_blank" rel="noopener">Clipy</a>ï¼Œå®‰è£…å¹¶ç¨å¾®è®¾ç½®åŽï¼ŒæŒ‰ä¸‹è®¾å®šå¥½çš„å¿«æ·é”®ï¼Œå°±èƒ½å‡ºçŽ°ä¸‹å›¾çš„å¼¹æ¡†ï¼š</p><p><img src="http://tao93.top/images/2019/08/03/1564845517.png" alt=""></p><p>ç„¶åŽåªéœ€è¦æŒ‰ä¸Šä¸‹æ–¹å‘é”®é€‰æ‹©ï¼Œå°±å¯ä»¥ç²˜è´´ä¸Šä¸Šä¸Šä¸Šâ€¦æ¬¡å¤åˆ¶è¿‡çš„å†…å®¹äº†ã€‚ä¸è¿‡éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œåœ¨ Clipy çš„<a href="https://github.com/Clipy/Clipy/releases" target="_blank" rel="noopener">ä¸‹è½½é¡µé¢</a>ï¼ŒåŠ¡å¿…ä¸‹è½½ 1.15 ç‰ˆæœ¬ï¼Œå› ä¸º 1.2.0 å’Œ 1.2.1 éƒ½æœ‰ä¸€ä¸ª bug ä½¿å¾—å®ƒæ— æ³•å°†å¤åˆ¶çš„å›¾ç‰‡çº³å…¥ç®¡ç†ã€‚</p><h4 id="è½¯ä»¶å¸è½½"><a href="#è½¯ä»¶å¸è½½" class="headerlink" title="è½¯ä»¶å¸è½½"></a>è½¯ä»¶å¸è½½</h4><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒmacOS ä¸Šå®‰è£…è½¯ä»¶ä¸€èˆ¬æ˜¯å°†ä¸€ä¸ª XXX.app æ‹–åˆ°ä¸€ä¸ª Applications ç›®å½•ä¸­ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ‹·è´çš„åŠ¨ä½œï¼Œå®Œæˆè¿™ä¸ªåŽï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ Spotlight æœç´¢æˆ–è€…åœ¨ Launchpad ç‚¹å‡»å›¾æ ‡æ¥æ‰“å¼€å®ƒã€‚äº‹å®žä¸Šï¼ŒXXX.app å…¶å®žæ˜¯ä¸€ä¸ªç›®å½•ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªåŽç¼€ä¸º app çš„æ–‡ä»¶ï¼Œè¿™å¯ä»¥é€šè¿‡åœ¨ XXX.app ä¸Šå³é”®ï¼Œç„¶åŽç‚¹å‡»<code>Show Package contents</code>ï¼Œå¦‚å›¾ï¼š</p><p><img src="http://tao93.top/images/2019/08/03/1564845703.png" alt=""></p><p>XXX.app ç›®å½•åŒ…å«ä¸€ä¸ªè½¯ä»¶è¿è¡Œèµ·æ¥æ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä½†å½“æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªæ–°å®‰è£…çš„è½¯ä»¶ï¼Œå®ƒå¾€å¾€ä¼šåœ¨ä¸€äº›åˆ«çš„åœ°æ–¹ (ä¸åœ¨ Applications ä¹Ÿä¸åœ¨ XXX.app ä¸­) ç”Ÿæˆä¸€äº›é…ç½®æ–‡ä»¶ã€‚æ‰€ä»¥ä»…ä»…åœ¨ Applications ä¸­åˆ é™¤ XXX.app å¹¶ä¸èƒ½ç§»é™¤ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ï¼Œä»Žè€Œå¦‚æžœå“ªå¤©å†æ¬¡å®‰è£…è¿™ä¸ªè½¯ä»¶ï¼Œè€çš„é…ç½®ä¾ç„¶ä¼šäº§ç”Ÿä½œç”¨ã€‚è‹¥è¦å½»åº•å¸è½½è½¯ä»¶ï¼Œå¯ä»¥ä½¿ç”¨è½»é‡çº§çš„ <a href="https://freemacsoft.net/appcleaner/" target="_blank" rel="noopener">AppCleaner</a>ï¼Œå®ƒå¯ä»¥å¸®æˆ‘ä»¬æœç´¢å‡ºéœ€å¸è½½è½¯ä»¶çš„æœ¬ä½“å’Œæ‰€æœ‰é…ç½®æ–‡ä»¶ï¼Œç„¶åŽæˆ‘ä»¬é€‰æ‹©åˆ é™¤å“ªäº›ï¼š</p><p><img src="http://tao93.top/images/2019/08/03/1564846208.png" alt=""></p><h4 id="è§£åŽ‹ç¼©"><a href="#è§£åŽ‹ç¼©" class="headerlink" title="è§£åŽ‹ç¼©"></a>è§£åŽ‹ç¼©</h4><p>å¯¹äºŽè½¯ä»¶ï¼Œå…¶å®žæˆ‘æ˜¯èƒ½ç”¨ç³»ç»Ÿè‡ªå¸¦çš„å°±ç”¨ç³»ç»Ÿè‡ªå¸¦çš„ï¼Œç„¶è€Œ macOS ä¸Šé¢çš„ <code>Archive Utility.app</code> è§£åŽ‹æŸäº›æ ¼å¼æ—¶ä¼šå‡ºé”™ï¼Œä¹Ÿä¸èƒ½é€‰æ‹©æ–‡æœ¬ç¼–ç ï¼Œæ‰€ä»¥å°±æœ‰å¿…è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹è§£åŽ‹è½¯ä»¶äº†ï¼Œæ¯”å¦‚è½»é‡çš„ <a href="https://theunarchiver.com/" target="_blank" rel="noopener">The Unarchiver</a> äº†ã€‚</p><h4 id="æ–‡æœ¬ç¼–è¾‘å™¨"><a href="#æ–‡æœ¬ç¼–è¾‘å™¨" class="headerlink" title="æ–‡æœ¬ç¼–è¾‘å™¨"></a>æ–‡æœ¬ç¼–è¾‘å™¨</h4><p>åŒæ ·çš„ï¼ŒmacOS çš„ <code>TextEdit.app</code> ä¹Ÿæ˜¯ä¸å ªé‡ä»»ï¼Œå°±å¥½æ¯”æ˜¯ Windows ä¸Šçš„è®°äº‹æœ¬ä¸€æ ·ã€‚å¦‚æžœä½ ä¹Ÿä¸çŸ¥é“è‡ªå·±è¯¥ç”¨ä»€ä¹ˆæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œé‚£ <a href="http://www.sublimetext.com/" target="_blank" rel="noopener">Sublime Text</a> æ˜¯ä¸ªå¾ˆä¸é”™çš„é€‰æ‹©ã€‚è½»é‡ã€åŠŸèƒ½å¼ºå¤§ã€å®šåˆ¶è¡Œå¼ºã€æ”¯æŒå„ç§èŠ±å¼çš„æ’ä»¶ï¼Œè¿™å°±æ˜¯ Sublime Textã€‚æˆ‘æœ€å–œæ¬¢å®ƒçš„ä¸€ä¸ªåŠŸèƒ½æ˜¯ï¼Œåœ¨å®ƒçš„ä¸€ä¸ª tab ä¸­å†™ç‚¹ä¸œè¥¿ï¼Œä¸ç”¨ä¿å­˜ä¸ºæ–‡ä»¶å°±å¯ä»¥é€€å‡ºè½¯ä»¶ç”šè‡³å…³æœºï¼Œç­‰ä¸‹æ¬¡æ‰“å¼€å®ƒï¼Œä¸€åˆ‡å†…å®¹éƒ½æ¢å¤äº†ï¼Œè¿™ç‰¹åˆ«é€‚åˆç”¨æ¥è®°ç‚¹ä¸œè¥¿ã€‚</p><h4 id="çª—å£ç®¡ç†"><a href="#çª—å£ç®¡ç†" class="headerlink" title="çª—å£ç®¡ç†"></a>çª—å£ç®¡ç†</h4><p>çª—å£ç®¡ç†ä¹Ÿå°±æ˜¯æŠŠçª—å£æ”¾å¤§ç¼©å†™å’ŒæŒªåŠ¨çš„æ“ä½œã€‚macOS é»˜è®¤çš„çª—å£æ“ä½œè¢«ä¸€äº›äººè®¤ä¸ºä¸å¦‚ Windows å¥½ç”¨ï¼Œå…¶å®žæˆ‘è®¤ä¸ºç¨å¾®è®¾ç½®ä¸€ä¸‹ï¼Œå°±èƒ½è®©è¿™äº›äººçš„ðŸ¤å•¦ã€‚é¦–å…ˆï¼ŒmacOS å…¶å®žä¸éœ€è¦æˆ‘ä»¬ç»å¸¸å›žåˆ°æ¡Œé¢ï¼Œè¿™æœ‰åˆ«äºŽ Windows çš„ç»å¸¸å›žåˆ°æ¡Œé¢ç‚¹å‡»å›¾æ ‡å¯åŠ¨è½¯ä»¶ã€‚macOS ä¸­ï¼Œå½“éœ€è¦åˆ‡æ¢åˆ°åˆ«çš„è½¯ä»¶æ—¶ï¼Œä¸åº”è¯¥ç”¨æœ€å°åŒ– (å¿«æ·é”® Cmd+M) çš„æ“ä½œï¼Œå› ä¸ºæ°¸è¿œä¸çŸ¥é“æœ€å°åŒ–åŽéœ²å‡ºæ¥çš„æ˜¯å“ªä¸€ä¸ªè½¯ä»¶ï¼Œæ‰€ä»¥åº”è¯¥ç›´æŽ¥ç‚¹å‡»æˆ– Cmd+Tab å‰å¾€æƒ³è¦åŽ»çš„è½¯ä»¶ï¼Œé™¤éžä½ çš„æŸä¸ªè½¯ä»¶çœŸçš„æœ‰è§ä¸å¾—äººçš„ä¸œè¥¿ï¼Œåˆ«äººæ¥åˆ°ä½ ç”µè„‘å‰æ—¶ä½ å¯ä»¥ç–¾é€Ÿåœ°æŒ‰ä¸‹ Cmd+M ç»„åˆé”®ã€‚æ›´åˆ«ææœ€å°åŒ–åŽï¼Œé”®ç›˜æ“ä½œå°†ä¸èƒ½æŠŠè¯¥çª—å£æ‹‰å›žæ¥ï¼Œè€Œåªèƒ½é ç‚¹ å‡» (é¼ æ ‡æˆ–è§¦æ‘¸æ¿)ï¼Œè€Œé€šå¸¸é”®ç›˜æ“ä½œæ›´å¿«é€Ÿã€‚</p><p>æ‰¯è¿œäº†ï¼Œå›žåˆ°çª—å£ç®¡ç†ï¼Œå¦‚æžœæ„¿æ„ä»˜è´¹ï¼Œå¯ä»¥é€‰ç”¨ <a href="https://manytricks.com/moom/" target="_blank" rel="noopener">Moom</a> æˆ– <a href="https://www.folivora.ai/bettersnaptool" target="_blank" rel="noopener">BetterSnapTool</a> ä¸¤æ¬¾ä»˜è´¹è½¯ä»¶ï¼Œå½“ç„¶ä»–ä»¬éƒ½å¯å…è´¹è¯•ç”¨ã€‚å®ƒä»¬æä¾›è¶³å¤Ÿçš„åŠŸèƒ½è®©æˆ‘ä»¬èŠ±å¼ç®¡ç†çª—å£ï¼Œå¿«æ·é”®ä¹Ÿå¥½ï¼Œè§¦å‘è§’ä¹Ÿç½¢ã€‚å¦‚æžœä½ ä¸æƒ³å¤§åŠ¨å¹²æˆˆï¼Œå…¶å®žæˆ‘ä»¬æœ€éœ€è¦çš„åªæœ‰ä¸¤ä¸ªæ“ä½œï¼šçª—å£æœ€å¤§åŒ–(ä¸æ˜¯å¼€å¯å…¨å±è§†å›¾)å’Œçª—å£å¤§å°å›žé€€ã€‚å‰è€…è®©æˆ‘ä»¬å°†å½“å‰è½¯ä»¶å¡«æ»¡å±å¹•ï¼Œä»Žè€Œèšç²¾ä¼šç¥žå·¥ä½œ(<del>æ‘¸é±¼</del>)ï¼›åŽè€…æ„æ€æ˜¯è®©çª—å£ä»Žæœ€å¤§åŒ–å˜å›žæœ¬æ¥çš„å¤§å°ã€‚è¿™ä¸¤ä¸ªæ“ä½œä¸€èˆ¬å¯ä»¥é€šè¿‡ macOS è‡ªå¸¦çš„ Zoom æ“ä½œï¼Œä¹Ÿå°±æ˜¯ menu bar ä¸­ Window èœå•ä¸‹çš„ Zoomã€‚è¿™ä¸ª Zoom é»˜è®¤æ²¡æœ‰å¿«æ·é”®ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥åœ¨ç³»ç»Ÿä¸­è®¾ç½®ï¼š<code>System Preferences.app</code> &gt; <code>Keyboard</code> &gt; <code>Shortcuts</code> &gt; <code>App Shortcuts</code>ï¼Œç„¶åŽç‚¹<code>+</code>æŒ‰é’®å¹¶å¦‚ä¸‹æ·»åŠ ï¼š</p><p><img src="http://tao93.top/images/2019/08/04/1564848618.png" alt=""></p><p>æ­¤åŽæŒ‰ä¸Šé¢è®¾ç½®çš„å¿«æ·é”®ï¼Œå°±èƒ½æœ€å¤§çª—å£åŒ–å’Œå›žé€€çª—å£äº†ã€‚</p><h4 id="å¿«æ·é”®"><a href="#å¿«æ·é”®" class="headerlink" title="å¿«æ·é”®"></a>å¿«æ·é”®</h4><p>å¿«æ·é”®çš„ä¸–ç•Œçº·ç¹å¤æ‚ï¼Œæœ‰æ—¶å€™ç”šè‡³ä¸å°å¿ƒè§¦å‘äº†ä¸ªä»€ä¹ˆå¿«æ·é”®å´ä¸çŸ¥æƒ…ï¼Œç„¶åŽä¸€è„¸ðŸ˜³ã€‚è¨€å½’æ­£ä¼ ï¼Œé€‚ç”¨æœ€å¹¿ï¼Œä½¿ç”¨é¢‘çŽ‡æœ€é«˜çš„å°‘æ•°åŸºæœ¬å¿«æ·é”®æ‰æ˜¯æœ€å€¼å¾—æçš„ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">å¿«æ·é”®</th><th style="text-align:center">ä½œç”¨</th></tr></thead><tbody><tr><td style="text-align:center">Cmd + N</td><td style="text-align:center">ä¸€èˆ¬æ˜¯æ–°å»ºçª—å£</td><td></td></tr><tr><td style="text-align:center">Cmd + T</td><td style="text-align:center">ä¸€èˆ¬æ˜¯æ–°å»º Tab æ ‡ç­¾é¡µ</td></tr><tr><td style="text-align:center">Cmd + ` (ESC ä¸‹æ–¹æŒ‰é”®)</td><td style="text-align:center">åœ¨å½“å‰è½¯ä»¶çš„ä¸åŒçª—å£é—´åˆ‡æ¢</td></tr><tr><td style="text-align:center">Cmd + Shift + [</td><td style="text-align:center">å½“å‰çª—å£å‘å·¦ä¾§ Tab åˆ‡æ¢</td></tr><tr><td style="text-align:center">Cmd + Shift + ]</td><td style="text-align:center">å½“å‰çª—å£å‘å³ä¾§ Tab åˆ‡æ¢</td></tr><tr><td style="text-align:center">Cmd + W</td><td style="text-align:center">å…³é—­å½“å‰ Tab æˆ–å½“å‰çª—å£</td></tr><tr><td style="text-align:center">Cmd + Q</td><td style="text-align:center">å½»åº•é€€å‡ºè½¯ä»¶</td></tr><tr><td style="text-align:center">Ctrl + Cmd + Space</td><td style="text-align:center">å–èŒæ—¶å¯ç”¨ï¼Œè¯•è¯•ä½ å°±çŸ¥é“äº†</td></tr><tr><td style="text-align:center">Option + Cmd + C</td><td style="text-align:center">å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„</td></tr><tr><td style="text-align:center">Cmd + L</td><td style="text-align:center">Safari ä¸Ž Chrome ä¸­ focus åœ°å€æ </td></tr><tr><td style="text-align:center">Option + Cmd + Delete</td><td style="text-align:center">æ°¸ä¹…åˆ é™¤ç›®å½•æˆ–æ–‡ä»¶</td></tr><tr><td style="text-align:center">F11</td><td style="text-align:center">æ‰’å¼€æ‰€æœ‰çª—å£çœ‹ä¸‹æ¡Œé¢</td></tr><tr><td style="text-align:center">Cmd + ,</td><td style="text-align:center">è¿›åå¥½è®¾ç½®ï¼Œå¯¹å‡ ä¹Žæ‰€æœ‰è½¯ä»¶æœ‰æ•ˆ</td></tr></tbody></table></div><p>macOS æœ‰ Mission Control å’Œ App ExposÃ© ä¸¤ä¸ªåŠŸèƒ½ï¼Œåˆ†åˆ«æœ‰é»˜è®¤çš„å¿«æ·é”® Cmd + â†‘ å’Œ Cmd + â†“ï¼Œå‰è€…æ˜¾ç¤ºæ‰€æœ‰çª—å£ï¼ŒåŽè€…æ˜¾ç¤ºå½“å‰è½¯ä»¶çš„æ‰€æœ‰çª—å£ã€‚å½“ç„¶ï¼Œå®ƒä»¬è¿˜å¯ä»¥åœ¨è§¦æ‘¸æ¿è®¾ç½®ä¸­é€šè¿‡è®¾ç½®æ‰‹åŠ¿æ¥è§¦å‘ã€‚</p><p>Windows ä¸­å‡ºçŽ°ä¸€ä¸ªå¼¹æ¡†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ Tab é”®æ¥åˆ‡æ¢ focus åˆ°ä¸åŒæŒ‰é’®ä¸Šï¼Œç„¶åŽæŒ‰ Enter æˆ–ç©ºæ ¼æ¥ä»£æ›¿ç‚¹å‡»æŒ‰é’®ã€‚macOS å…¶å®žä¹Ÿå¯ä»¥ï¼Œä½†é»˜è®¤æœªå¼€å¯ï¼Œå¼€å¯æ–¹æ³•æ˜¯ï¼š<code>System Preferences.app</code> &gt; <code>Keyboard</code> &gt; <code>Shortcuts</code>ï¼Œç„¶åŽ <code>Full Keyboard Access</code> é€‰ä¸­ <code>All controls</code> å³å¯ã€‚</p><p>åœ¨ä¸€äº›å¤§é”®ç›˜ä¸Šï¼Œå³ä¾§ä¼šæœ‰å¾ˆå¤šæ²¡æœ‰å­˜åœ¨æ„Ÿçš„æŒ‰é”®ï¼Œæ¯”å¦‚ Home å’Œ Endã€‚å…¶å®žå®ƒä»¬çš„ä½œç”¨ä¹‹ä¸€æ˜¯å°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œé¦–/è¡Œæœ«ï¼Œæ‰€ä»¥å®ƒä»¬æ­é…ä¸Š Shift æŒ‰é”®ï¼Œå°±å¯ä»¥å¿«é€Ÿé€‰ä¸­å½“å‰å…‰æ ‡è‡³è¡Œé¦–/è¡Œæœ«çš„æ–‡æœ¬ï¼Œå³å¿«æ·é”® Home/End + Shiftã€‚è€Œè¦é€‰ä¸­æ•´è¡Œï¼Œä¹Ÿå¯å…ˆ Home ç„¶åŽ End + Shift å³å¯ã€‚macOS ä¸­ï¼ŒHome å’Œ End å¯åˆ†åˆ«ç”± Cmd + â† å’Œ Cmd + â†’ å®žçŽ°ï¼Œå¦‚æ­¤ä¸€æ¥ï¼ŒæŒ‰ä¸‹ Cmd å’Œ Shift å†æŒ‰å·¦å³æ–¹å‘é”®å³å¯ã€‚</p><p>æœ‰æ—¶å€™æˆ‘ä»¬æƒ³å¼ºé€€ä¸€äº›æ— å“åº”çš„è½¯ä»¶ï¼Œå¯ä»¥æŒ‰ Option + Cmd + ESC ç„¶åŽåœ¨çª—å£ä¸­å¼ºé€€æŸä¸ªè½¯ä»¶ã€‚å¦‚æžœä½ ä¸è®°å¾—è¿™ä¸ªå¿«æ·é”®ï¼Œé€šå¸¸åœ¨ Dock ä¸­å³é”®å›¾æ ‡ä¹Ÿä¼šæœ‰å¼ºé€€çš„é€‰é¡¹ã€‚æåˆ° ESCï¼Œé¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œç»å¤§éƒ¨åˆ†å„å¼å„æ ·çš„å°å¼¹æ¡†ï¼Œéƒ½å¯ä»¥é€šè¿‡æŒ‰ ESC æ¥æŠŠå¼¹æ¡†å…³é—­æŽ‰ã€‚</p><h4 id="å…‰æ ‡è¦å¿«"><a href="#å…‰æ ‡è¦å¿«" class="headerlink" title="å…‰æ ‡è¦å¿«"></a>å…‰æ ‡è¦å¿«</h4><p>å¦‚æžœä½ è®¤ä¸ºæˆ‘è¯´çš„æ˜¯å…‰æ ‡éšé¼ æ ‡æˆ–æ‰‹æŒ‡åœ¨è§¦æ‘¸æ¿ä¸Šç§»åŠ¨é€Ÿåº¦çš„å¿«æ…¢ï¼Œé‚£ä½ å°±é”™å•¦ï¼è™½ç„¶æˆ‘çš„ç¡®å»ºè®®å‰é¢è¯´çš„è¿™ä¸ªå¿«æ…¢å¯ä»¥â€¦æžå¿«ç‚¹ï¼ˆæ¯•ç«Ÿè¿™æ ·å¯ä»¥å‡å°‘æœ‰æ—¶å€™åœ¨è§¦æ‘¸æ¿ä¸Šæ‰‹æŒ‡æ»‘åŠ¨ä¸€æ¬¡è¿˜æ²¡åˆ°ç›®çš„åœ°ï¼Œéœ€è¦æŠ¬èµ·æ‰‹æŒ‡æŽ¥åŠ›ç»§ç»­æ»‘åŠ¨)ï¼Œå¯æˆ‘æ›´æƒ³è¯´çš„æ˜¯<strong>é•¿æŒ‰</strong>é”®ç›˜çš„å·¦å³æ–¹å‘é”®æ—¶ï¼Œå…‰æ ‡åœ¨å­—ç¬¦ä¹‹é—´ç§»åŠ¨çš„é€Ÿåº¦ã€‚é¦–æ¬¡ä½¿ç”¨ Mac æ—¶ï¼Œæˆ‘å°±å‘çŽ°è¿™ä¸ªç§»åŠ¨é€Ÿåº¦å¤ªæ…¢ï¼Œä»¤äººæŠ“ç‹‚ï¼å¹¸è€Œä¸å°±æˆ‘å°±å¾—çŸ¥åœ¨ <code>System Preferences.app</code> &gt; <code>Keyboard</code> ä¸­æŠŠ <code>Key Repeat</code> å’Œ <code>Delay Until Repeat</code> éƒ½è®¾ç½®åˆ°æœ€å³ä¾§ï¼Œå°±èƒ½é•¿æŒ‰å·¦å³æ–¹å‘é”®æ—¶ï¼Œå…‰æ ‡æ¯”è¾ƒå¿«åœ°ç§»åŠ¨äº†ã€‚</p><p>ä»€ä¹ˆï¼Ÿä½ è¿˜è¦æ›´å¿«ï¼Ÿå—¯ï¼ŒåŠžæ³•ä¹Ÿæ˜¯æœ‰çš„ï¼ŒæŒ‰ä½ Option çš„åŒæ—¶ï¼Œé•¿æŒ‰æˆ–è¿žå‡»å·¦å³æ–¹å‘é”®ï¼Œå…‰æ ‡å°†ä»¥è‹±æ–‡ word ä¸ºå•ä½ç§»åŠ¨ï¼Œæ‰€ä»¥ç§»åŠ¨é€Ÿåº¦ä¼šæ›´å¿«ã€‚</p><h4 id="é»˜è®¤æ‰“å¼€æ–¹å¼"><a href="#é»˜è®¤æ‰“å¼€æ–¹å¼" class="headerlink" title="é»˜è®¤æ‰“å¼€æ–¹å¼"></a>é»˜è®¤æ‰“å¼€æ–¹å¼</h4><p>è¯´åˆ°è¿™ä¸ªå°±æƒ³èµ· Xcodeï¼Œä½†å‡¡å’Œä»£ç æœ‰ç‚¹å…³ç³»çš„æ–‡ä»¶ï¼ŒmacOS éƒ½ä¼šé»˜è®¤è®© Xcode æ‰“å¼€ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œæˆ‘éƒ½æ˜¯ç–¾é€Ÿåœ° Cmd+Q é€€å‡º Xcode ç„¶åŽåœ¨ Finder ä¸­å³é”®åˆšåˆšæ‰“å¼€çš„æ–‡ä»¶ï¼Œæ­¤æ—¶<strong>æŒ‰ä½ Option</strong> å¹¶åœ¨ <code>Always Open With</code> èœå•ä¸­é€‰æ‹©æˆ‘æƒ³è¦çš„è½¯ä»¶ï¼Œæ¯”å¦‚ <code>Sublime Text</code>ï¼Œåˆ°è¿™ï¼ŒXcode å†ä¹Ÿæ— æ³•æŸ“æŒ‡è¿™ä¸ªæ–‡ä»¶æ ¼å¼äº† ðŸ˜ã€‚</p><h4 id="ç®€å•ç®¡ç†å¯åŠ¨é¡¹"><a href="#ç®€å•ç®¡ç†å¯åŠ¨é¡¹" class="headerlink" title="ç®€å•ç®¡ç†å¯åŠ¨é¡¹"></a>ç®€å•ç®¡ç†å¯åŠ¨é¡¹</h4><p>Windows ä¸­æˆ‘ä»¬å¾€å¾€ç”¨å„ç§ç”µè„‘ç®¡å®¶æ¥é™åˆ¶æŸäº›è½¯ä»¶å¼€æœºè‡ªå¯çš„æµæ°“è¡Œä¸ºï¼ŒmacOS ä¸­è¿™æ ·çš„æµæ°“å°‘å¾ˆå¤šï¼Œä½†å½“çœŸçš„æœ‰äº†çš„æ—¶å€™ï¼Œæˆ–è€…æˆ‘ä»¬åè¦æŠŠæŸäº›è½¯ä»¶è®¾ç½®è‡ªå¯ (æ¯”å¦‚æˆ‘ä¼šæŠŠé‚®ä»¶å®¢æˆ·ç«¯è®¾ç½®å¼€æœºè‡ªå¯ï¼Œè¿™æ ·ç”µè„‘é‡å¯åŽï¼Œæˆ‘ä¸ä¼šå¿˜è®°æ‰“å¼€å®ƒè€Œé”™è¿‡é‚®ä»¶é€šçŸ¥ï¼Œ<del>å—¯ï¼Œæˆ‘å°±æ˜¯çƒ­çˆ±å·¥ä½œ</del>)ã€‚æ“ä½œå¾ˆç®€å•ï¼Œ<code>System Preferences.app</code> &gt; <code>Users &amp; Groups</code> &gt; <code>Login Items</code>ï¼Œç„¶åŽä¸æƒ³è¦çš„ login item åˆ æŽ‰ï¼Œæƒ³å¢žåŠ çš„åŠ ä¸Šï¼ŒOKã€‚æŽ¨èæŠŠæ¯å¤©éƒ½ç”¨çš„å·¥å…·è½¯ä»¶åŠ ä¸ŠåŽ»ï¼Œæ¯”å¦‚å‰é¢è¯´çš„ Clipyã€‚</p><h4 id="æˆªå±ä¸Žå½•å±"><a href="#æˆªå±ä¸Žå½•å±" class="headerlink" title="æˆªå±ä¸Žå½•å±"></a>æˆªå±ä¸Žå½•å±</h4><p>macOS ç³»ç»Ÿè‡ªå¸¦çš„æˆªå±åŠŸèƒ½ï¼Œåœ¨ <code>System Preferences.app</code> &gt; <code>Keyboard</code> &gt; <code>Shortcuts</code> &gt; <code>Screenshots</code> ä¸­å¯ä¸€è§ˆæ— é—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://tao93.top/images/2019/08/04/1564911138.png" alt=""></p><p>æœ‰æˆªå–å…¨å±å’Œæˆªå–é€‰ä¸­åŒºåŸŸå¹¶æ”¾åˆ°å‰ªè´´æ¿ï¼›ä¹Ÿæœ‰æˆªå–å…¨å±å’Œæˆªå–é€‰ä¸­åŒºåŸŸå¹¶<strong>ä½œä¸ºæ–‡ä»¶ä¿å­˜</strong>åˆ°æ¡Œé¢ï¼Œå¹¶ä¸”è¿™ç§æ–¹å¼ä¸‹ï¼Œæˆªå›¾åˆšå®Œæˆæ—¶æ¡Œé¢å³ä¸‹è§’ä¼šå’Œ iOS ä¸€æ ·çŸ­æ—¶é—´å†…æ˜¾ç¤ºä¸€ä¸ªç¼©ç•¥å›¾ï¼Œç‚¹å‡»å®ƒçš„è¯å¯ä»¥ç¼–è¾‘åˆšåˆšçš„æˆªå›¾ã€‚ä»¥ä¸ŠåŠŸèƒ½æ— æ³•æˆªå›¾åˆ°å‰ªè´´æ¿åŒæ—¶æä¾›ç¼–è¾‘åŠŸèƒ½ï¼Œæ­¤å¤–å½•å±åŠŸèƒ½ä¹Ÿæ˜¯ç¼ºå¤±çš„ï¼Œæ‰€ä»¥å®‰è£…ç¬¬ä¸‰æ–¹æˆªå›¾è½¯ä»¶åŠ¿åœ¨å¿…è¡Œã€‚</p><p>è¯´å‡ºæ¥å¯èƒ½æœ‰ç‚¹ lowï¼Œå…¶å®žæˆ‘æˆªå±å’Œå½•å±ä¸€ç›´æ˜¯ç”¨ QQ å†…åµŒçš„æˆªå›¾åŠŸèƒ½ã€‚å¯¹ï¼Œå°±æ˜¯è…¾è®¯é‚£ä¸ª QQã€‚ç®€å•æ¥è¯´ï¼ŒQQ è¿™ä¸ªæˆªå›¾å·¥å…·æ˜¯å¯ä»¥å•ç‹¬è¿è¡Œçš„ï¼Œå¹¶ä¸ä¾èµ– QQ çš„è¿è¡Œï¼Œæˆ‘æŠŠè¿™ä¸ªå·¥å…·æŒ‰ä¸Šä¸€æ¡ã€Œç®€å•ç®¡ç†å¯åŠ¨é¡¹ã€ä¸­çš„æ–¹æ³•è®¾ç½®ä¸ºå¼€æœºè‡ªå¯ã€‚è¿™æ ·ä¸ç”¨ç®¡ QQ çš„æ­»æ´»å°±å¯ä»¥ä¸€ç›´ä½¿ç”¨å®ƒäº†ã€‚</p><p>æ­¥éª¤æ˜¯ï¼š</p><ul><li>æ‰“å¼€ QQ &gt; <code>Cmd + ,</code> è¿›å…¥è®¾ç½® &gt; <code>Function</code> &gt; ç‚¹ <code>Capture &amp; Record Screen</code> å³è¾¹çš„ <code>Preferences</code>ï¼Œè¿™æ—¶æ˜¾ç¤ºä¸‹é¢çš„è®¾ç½®ç•Œé¢ï¼š</li></ul><p><img src="http://tao93.top/images/2019/08/04/1564911840.png" alt=""></p><ul><li>è®¾ç½®å¥½ä½ æƒ³è¦çš„æˆªå±å¿«æ·é”®å’Œå½•å±å¿«æ·é”®ï¼Œå¹¶ç¡®ä¿<code>Runs in background after you quit QQ</code> å‹¾é€‰ä¸Šäº†ã€‚</li><li>åœ¨ Applications çš„ QQ.app ä¸Šå³é”®å†ç‚¹ <code>Show Package Contents</code>ï¼Œç„¶åŽæŒ‰å¦‚ä¸‹è·¯å¾„æ‰¾åˆ° <code>QQ jietu plugin.app</code>ï¼Œæœ€åŽå°†å®ƒæ‹–è¿› Login Items å³å¯ï¼š</li></ul><p><img src="http://tao93.top/images/2019/08/04/1564912051.png" alt=""></p><p>è‡³æ­¤ï¼ŒæŒ‰ä¸‹ä¹‹å‰è®¾ç½®çš„æˆªå›¾å¿«æ·é”®ï¼Œä¼šå‡ºçŽ° Screenshotï¼ŒScreen Recording å’Œ Recognition ä¸‰ä¸ªé€‰é¡¹ï¼Œåˆ†åˆ«æ˜¯æˆªå±ã€å½•å±ã€è¯†åˆ«å›¾ç‰‡ä¸­çš„æ–‡æœ¬ï¼ŒåŠŸèƒ½è¿˜ç®—å¤Ÿç”¨çš„ã€‚</p><p><img src="http://tao93.top/images/2019/08/04/1564912278.png" alt=""></p><h4 id="Finder"><a href="#Finder" class="headerlink" title="Finder"></a>Finder</h4><p>å…³äºŽ Finderï¼Œæœ‰ä¸€ä¸‹å‡ ç‚¹å»ºè®®ï¼š</p><ul><li>åœ¨ Finder çš„è®¾ç½®ä¸­ï¼Œå°† <code>New Finder windows show</code> æ”¹ä¸ºä½¿ç”¨é¢‘çŽ‡æœ€é«˜çš„ç›®å½•ï¼Œæ¯”å¦‚ Download æˆ–ä¸ªäººå·¥ä½œç›®å½•ï¼š</li></ul><p><img src="http://tao93.top/images/2019/08/04/1564912792.png" alt=""></p><ul><li>åœ¨ Finder çš„è®¾ç½®ä¸­ï¼Œå°†æœç´¢è®¾ç½®ä¸ºæœç´¢å½“å‰ç›®å½• (é»˜è®¤å±…ç„¶æ˜¯æœç´¢æ•´ä¸ª Mac ðŸ˜¢)ï¼š</li></ul><p><img src="http://tao93.top/images/2019/08/04/1564913032.png" alt=""></p><ul><li>åœ¨æµè§ˆç›®å½•æˆ–æ–‡ä»¶æ—¶ï¼Œå»ºè®®ç”¨ä¸‹é¢çš„è§†å›¾</li></ul><p><img src="http://tao93.top/images/2019/08/04/1564913106.png" alt=""></p><ul><li>å»ºè®®å¤šä½¿ç”¨ Tab æ ‡ç­¾é¡µï¼Œè€Œä¸æ˜¯æ‰“å¼€æ–°çš„ Finder çª—å£ã€‚</li></ul><h3 id="å¯¹ç¨‹åºå‘˜"><a href="#å¯¹ç¨‹åºå‘˜" class="headerlink" title="å¯¹ç¨‹åºå‘˜"></a>å¯¹ç¨‹åºå‘˜</h3><p>ä»¥ä¸‹æ˜¯é¢å‘ç¨‹åºå‘˜çš„å†…å®¹<del>ï¼Œéžæˆ˜æ–—äººå‘˜è¯·é€Ÿé€Ÿæ’¤é€€</del>ã€‚</p><h4 id="Terminal"><a href="#Terminal" class="headerlink" title="Terminal"></a>Terminal</h4><p>ç½‘ä¸Šå¾ˆå¤šæ–‡ç« ä¸€ä¸Šæ¥å°±æ˜¯ <a href="https://www.iterm2.com/" target="_blank" rel="noopener">iTerm2</a>ï¼Œä¸è¿‡æˆ‘å€’æ˜¯è§‰å¾— macOS è‡ªå¸¦çš„ Terminal å·²ç»å¤Ÿå¼ºå¤§äº†ï¼Œå¹¶ä¸”å­—ä½“æ›´å¥½çœ‹ç‚¹ï¼Œå†è¯´æœ¬ç€èƒ½ç”¨ç³»ç»Ÿè‡ªå¸¦å°±ä¸ç”¨ç¬¬ä¸‰æ–¹ï¼Œæˆ‘å°±ä¸€ç›´é»˜è®¤ä½¿ç”¨ Terminalã€‚</p><p>macOS ä¸Š Terminal çª—å£é»˜è®¤å¤ªå°äº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶è®¾ç½® &gt; Profiles &gt; Window &gt; Window Size ä¸­è®¾ç½®æ›´å¤§çš„è¡Œåˆ—æ•°ï¼Œä»Žè€Œå……åˆ†åˆ©ç”¨æˆ‘ä»¬çš„å±å¹•ï¼ŒçœåŽ»æ‹–æ‹½çª—å£è¾¹ç¼˜çš„è¡Œä¸ºã€‚</p><p>å¦‚æžœæ—¶å¸¸ä½¿ç”¨ Terminalï¼Œä»¥ä¸‹å¿«æ·é”®æ˜¯éžå¸¸ Life Saving çš„ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">å¿«æ·é”®</th><th style="text-align:center">ä½œç”¨</th></tr></thead><tbody><tr><td style="text-align:center">Ctrl + U</td><td style="text-align:center">æ¸…é™¤å·²è¾“å…¥çš„å†…å®¹</td></tr><tr><td style="text-align:center">Ctrl + A</td><td style="text-align:center">å…‰æ ‡ç§»åŠ¨åˆ°è¡Œé¦–</td></tr><tr><td style="text-align:center">Ctrl + E</td><td style="text-align:center">å…‰æ ‡ç§»åŠ¨åˆ°è¡Œæœ«</td></tr><tr><td style="text-align:center">Ctrl + K</td><td style="text-align:center">åˆ é™¤å…‰æ ‡ä¹‹åŽçš„å†…å®¹</td></tr></tbody></table></div><p>ç»†å¿ƒçš„è¯»è€…å¯èƒ½ä¼šå‘çŽ°ä¸Šé¢å¿«æ·é”®éƒ½æ˜¯ä½¿ç”¨åäººç±»çš„ Ctrl è€Œä¸æ˜¯ Mac ä¸Šçš„ Cmdï¼Œå…¶å®žä¸Šé¢çš„å¿«æ·é”®åŽ†å²éžå¸¸æ‚ ä¹… (é‚£æ—¶å¯èƒ½è¿˜æ²¡æœ‰è‹¹æžœå…¬å¸)ï¼Œæ˜¯ä»Žæ—©æœŸ Unix ç³»ç»Ÿæµä¼ ä¸‹æ¥ï¼Œæ‰€ä»¥åŒæ ·é€‚ç”¨äºŽ Linux (å¯èƒ½ä¼šæœ‰ç»†å¾®å·®åˆ«)ã€‚å¦å¤–ï¼Œä¹‹å‰ã€Œå…‰æ ‡è¦å¿«ã€è®²çš„æŒ‰ä½ Option æ—¶æŒ‰å·¦å³æ–¹å‘é”®æ¥å¿«é€Ÿç§»åŠ¨å…‰æ ‡ï¼Œåœ¨æ­¤åŒæ ·é€‚ç”¨ã€‚</p><p>é¡ºå¸¦è¯´ä¸‹å¯èƒ½å¤§å®¶ä¸çŸ¥é“çš„ä¸¤ä¸ªéžå¸¸æœ‰ç”¨çš„å‘½ä»¤ï¼Œfile å’Œ typeã€‚å‰è€…å¯æ ¹æ®æ–‡ä»¶ meta data åˆ¤æ–­æ–‡ä»¶ç±»åž‹ï¼ŒåŽè€…å¯å‘ŠçŸ¥ä½ ä¸€ä¸ªå‘½ä»¤æ˜¯ä»¥ä¸‹æ¥æºä¸­çš„å“ªä¸€ç§ï¼šå†…å»ºå‘½ä»¤ (æ¯”å¦‚ type, cd ç­‰)ã€æŒ‡å®šè·¯å¾„ä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶ã€ç¬¦å·é“¾æŽ¥ã€‚å¦å¤–å¦‚æžœç”µè„‘ä¸­ä¸å°å¿ƒæœ‰ä¸¤ä¸ªæŸå‘½ä»¤(æ¯”å¦‚ä¸¤ä¸ª python)ä¸”éƒ½åŠ å…¥äº† PATH çŽ¯å¢ƒå˜é‡ï¼Œ<code>type xxx</code> ä¼šæ˜¾ç¤ºå½“å‰ä½¿ç”¨çš„ xxx çš„è·¯å¾„ï¼Œè€Œ <code>which -a xxx</code> åˆ™æ˜¾ç¤ºæ‰€æœ‰å·²åŠ å…¥ PATH çŽ¯å¢ƒå˜é‡ çš„ xxxã€‚</p><h4 id="Oh-My-Zsh"><a href="#Oh-My-Zsh" class="headerlink" title="Oh My Zsh"></a>Oh My Zsh</h4><p><a href="https://ohmyz.sh/" target="_blank" rel="noopener">Oh My Zsh</a> æ˜¯ä¹…è´Ÿç››åçš„å¼€æºé¡¹ç›®ï¼Œå®ƒå‡ ä¹Žè®© macOS ä¸­ Zsh çš„ä¸Šæ‰‹éš¾åº¦å˜ä¸ºäº† 0ã€‚é¦–å…ˆå•°å—¦ä¸€ä¸‹ï¼ŒmacOS ä¸€ç›´ä½¿ç”¨ bash ä½œä¸ºé»˜è®¤ Shellï¼Œè¿™ä¹Ÿæ˜¯å¸¸è§ Linux å‘è¡Œç‰ˆçš„åšæ³•ã€‚</p><p>æˆ‘ä¸ªäººæœ€å–œæ¬¢ On My Zsh çš„ä¸€ä¸‹ç‰¹æ€§ï¼š</p><ul><li>æŒ‰å·²è¾“å…¥æ–‡æœ¬æœç´¢åŽ†å²å‘½ä»¤ã€‚å¤§å®¶éƒ½çŸ¥é“ bash ä¸­æŒ‰å‘ä¸Šæ–¹å‘é”®å¯ä»¥ä¸€æ¡æ¡æ˜¾ç¤ºåŽ†å²å‘½ä»¤ï¼Œè€Œ On My Zsh åˆ™å¯ä»¥æ¯”å¦‚è¾“å…¥ <code>adb shell</code> åŽæŒ‰å‘ä¸Šæ–¹å‘é”®ï¼Œæ˜¾ç¤ºçš„å…¨éƒ¨æ˜¯ <code>adb shell</code> å¼€å¤´çš„åŽ†å²å‘½ä»¤ï¼Œè¿™è®©æˆ‘ä»¬æ›´å¿«æ‰¾åˆ°æƒ³è¦çš„åŽ†å²å‘½ä»¤ã€‚</li><li>æ›´ç®€å•çš„ç›®å½•é€‰æ‹©ã€‚æ¯”å¦‚è¾“å…¥ ls åŽï¼ŒæŒ‰ tab é”®ï¼Œä¼šæ˜¾ç¤ºå½“å‰ç›®å½•æ‰€æœ‰ itemï¼Œç„¶åŽå¯ä»¥ç›´æŽ¥æŒ‰ä¸Šæ–¹å‘é”®é€‰ä¸­ item å†æŒ‰å›žè½¦ç¡®è®¤ã€‚</li><li>å¦‚æžœå½“å‰ç›®å½•åœ¨ Git é¡¹ç›®ä¸­ï¼Œä¼šæ˜¾ç¤ºå½“å‰åˆ†æ”¯ï¼Œä»¥åŠæ˜¯å¦æœ‰æœªæäº¤æ”¹åŠ¨çš„å°å‰å‰ã€‚</li><li>æ›´ä¸°å¯Œçš„é«˜äº®è‰²å’Œä¸»é¢˜å®šåˆ¶åŠŸèƒ½ã€‚</li></ul><p>å¦‚æžœä¸Šé¢æœ‰ä½ æƒ³è¦åŠŸèƒ½ï¼Œè¯·è‡ªè¡Œå®‰è£… ðŸ˜</p><h4 id="Homebrew"><a href="#Homebrew" class="headerlink" title="Homebrew"></a>Homebrew</h4><p><a href="https://brew.sh/" target="_blank" rel="noopener">Homebrew</a> æ˜¯åˆä¸€ä¸ªä¸Šä¸‡ star çš„å¼€æºé¡¹ç›®ï¼Œå¤§å®¶å¯èƒ½æ—©å°±çŸ¥é“äº†å®ƒï¼Œæ‰€ä»¥æˆ‘å°±åªç®€å•è¯´è¯´ã€‚</p><p>Homebrew è‡ªç§°æ˜¯ macOS ä¸Šç¼ºå¤±çš„åŒ…ç®¡ç†å™¨ï¼Œçš„ç¡®å¦‚æ­¤ï¼ŒLinux å‘è¡Œç‰ˆæœ‰å„ç§ç®¡ç†å‘½ä»¤è¡Œè½¯ä»¶åŒ…çš„åŒ…ç®¡ç†å™¨ï¼Œè€Œ macOS é»˜è®¤æ²¡æœ‰ã€‚</p><p>Homebrew çš„ <a href="https://github.com/Homebrew/homebrew-core" target="_blank" rel="noopener">core repo</a> ä¸ºæ¯ä¸ªåŒ…ç»´æŠ¤ä¸€ä¸ª ruby è„šæœ¬æ–‡ä»¶ï¼Œæ”¹æ–‡ä»¶è®°å½•äº†è¿™ä¸ªåŒ…çš„ä¾èµ–ä¿¡æ¯ï¼Œç‰ˆæœ¬æ›´è¿­ä¿¡æ¯ï¼Œä»Žå“ªé‡ŒèŽ·å– binary åŒ…æˆ–è€…æºä»£ç ã€ç¼–è¯‘æ–¹æ³•ç­‰ç­‰ä¿¡æ¯ã€‚æœ‰äº†è¿™äº›ä¿¡æ¯ï¼ŒHomebrew å°±å¯ä»¥ç®¡ç†åŒ…çš„å®‰è£…(åŒ…æ‹¬ä¸‹è½½æºç ç¼–è¯‘çš„æ–¹å¼)ã€å‡çº§ã€å¸è½½ã€ä¾èµ–ä¸‹è½½ç­‰ï¼Œä¹Ÿå°±å®žçŽ°äº†åŒ…ç®¡ç†å™¨çš„åŠŸèƒ½ã€‚è¿™ä¸ª core repo åœ¨æˆ‘ä»¬æœ¬åœ°ä¹Ÿæœ‰ä¸€ä»½ï¼ŒHomebrew çš„ updating å…¶å®žæœ¬åœ°çš„ repo pull è¿œç¨‹çš„å˜åŒ–ï¼Œä¹Ÿå°±æ˜¯è¿™äº› ruby è„šæœ¬çš„å¢žåˆ æ”¹ç»™ pull è¿‡æ¥ã€‚è½¯ä»¶åŒ…çš„åå­—æ˜¯å”¯ä¸€æ€§çš„ï¼Œå› è€Œä¸Šè¿° ruby è„šæœ¬ç›´æŽ¥ä»¥è½¯ä»¶åŒ…çš„åå­—å‘½åï¼Œä¹Ÿæ˜¯ä¸ä¼šé‡å¤çš„ã€‚</p><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒHomebrew æŠŠ core repo å’ŒåŽé¢è®²åˆ°çš„ cask repo å«åš tapï¼Œè€Œ tap é‡Œé¢ç®¡ç†çš„ä¾èµ–åŒ…ï¼Œå«åš formulaï¼Œäº†è§£è¿™äº›æœ¯è¯­æœ‰åˆ©äºŽçœ‹æ‡‚ Homebrew çš„æç¤ºã€‚</p><p>Homebrew å®‰è£…è½¯ä»¶åŒ…ï¼Œé€šå¸¸æ˜¯åœ¨ <code>/usr/local</code> ç›®å½•ä¸­ä»¥è¯¥è½¯ä»¶åŒ…åå­—ä¸ºåå»ºç«‹ç›®å½•ï¼Œç„¶åŽå…¶ä¸­å†ä»¥ç‰ˆæœ¬å·ä¸ºåå»ºç«‹ç›®å½•ï¼Œç‰ˆæœ¬å·ç›®å½•ä¸­å«æœ‰è¯¥ç‰ˆæœ¬çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä¸”å¾€å¾€æœ‰ä¸ª bin ç›®å½•æ¥åŒ…å«è½¯ä»¶åŒ…çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒHomebrew å¯ä»¥åŒäº‹ç»´æŠ¤å¤šä¸ªç‰ˆæœ¬ã€‚è€ŒçœŸæ­£åŠ å…¥åˆ° PATH çŽ¯å¢ƒå˜é‡çš„å…¶å®žæ˜¯ <code>/usr/local/bin</code> ç›®å½•ã€‚Homebrew æ¯æ›´æ–°æˆ–å®‰è£…ä¸€ä¸ªè½¯ä»¶åŒ…ï¼Œ<code>/usr/local/bin</code> ä¸­éƒ½ä¼šæ›´æ–°æˆ–æ–°å»ºä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼Œæ¥æŒ‡å‘æ­¤è½¯ä»¶åŒ…æœ€æ–°çš„ç‰ˆæœ¬çš„çœŸæ­£å¯æ‰§è¡Œæ–‡ä»¶ã€‚ä»Žè€Œæˆ‘ä»¬æ‰§è¡Œæ­¤ç¬¦å·é“¾æŽ¥ï¼Œå°±å¯ä»¥è¿è¡Œæœ€æ–°çš„è½¯ä»¶åŒ…ã€‚</p><p>Homebrew ç®¡ç†çš„å‘½ä»¤è¡Œè½¯ä»¶ï¼Œå¾ˆå¤šæ˜¯ GNU å¼€æºè½¯ä»¶ï¼Œè¿™äº›è½¯ä»¶çš„åˆ†å‘åœ¨å›½å†…æœ‰ä¸å°‘é•œåƒï¼Œä»Žè€Œèƒ½åŠ å¿«æˆ‘ä»¬çš„ä¸‹è½½é€Ÿåº¦ã€‚ä¸ºæ­¤ï¼Œcore repo åœ¨å›½å†…ä¹Ÿæœ‰é•œåƒ (æ¯”å¦‚<a href="http://mirrors.ustc.edu.cn/help/brew.git.html" target="_blank" rel="noopener">ä¸­å›½ç§‘å¤§çš„é•œåƒ</a>)ï¼Œåªä¸è¿‡è¿™ä¸ªé•œåƒå¹¶éžå’Œ Homebrew å®˜æ–¹çš„ repo å®Œå…¨ä¸€è‡´ï¼Œè€Œæ˜¯ä¸‹è½½é“¾æŽ¥æŒ‡å‘å›½å†…çš„ä¸€äº›è½¯ä»¶æºé•œåƒï¼Œä¹Ÿåªæœ‰è¿™æ ·æ‰èƒ½çœŸæ­£åŠ å¿«ä¸‹è½½è½¯ä»¶åŒ…çš„é€Ÿåº¦ã€‚</p><p>æ­¤å¤–ï¼ŒHomebrew ä¹Ÿæ”¯æŒä¸€äº› GUI è½¯ä»¶ (å¦‚ Google Chrome å’Œ Sublime Text ç­‰) çš„ç®¡ç†ã€‚GUI è½¯ä»¶çš„ç®¡ç†ï¼Œæ˜¯ç”± <a href="https://github.com/Homebrew/homebrew-cask" target="_blank" rel="noopener">cask repo</a> æ¥æ”¯æ’‘çš„ã€‚ä½¿ç”¨ Homebrew å®‰è£… GUI è½¯ä»¶ï¼Œé€šå¸¸ä¹Ÿä¼šåœ¨ <code>/usr/local/bin</code> ä¸­æ–°å»ºç¬¦å·é“¾æŽ¥æ¥ï¼Œä½¿æˆ‘ä»¬å¯ä»¥åœ¨ Shell ä¸­å¯åŠ¨ GUI è½¯ä»¶ã€‚æ¯”å¦‚ Sublime Text å®‰è£…å¥½åŽï¼Œå°±ä¼šæœ‰ subl è¿™ä¸ªç¬¦å·é“¾æŽ¥ï¼š</p><p><img src="http://tao93.top/images/2019/08/04/1564931295.png" alt=""></p><p>æˆ‘ä»¬ç›´æŽ¥æ‰§è¡Œ <code>subl</code> å³å¯æ‰“å¼€ Sublime Textï¼Œè€Œ <code>subl</code> åŠ ä¸Šæ–‡ä»¶åï¼Œè¿˜å¯æ‰“å¼€æŒ‡å®šæ–‡ä»¶ã€‚</p><h4 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h4><p>æ­£åˆ™è¡¨è¾¾å¼åœ¨æˆ‘ä»¬æœç´¢ã€æ›¿æ¢ç»“æž„å¤æ‚çš„æ–‡æœ¬æ—¶éžå¸¸æœ‰ç”¨ã€‚è¿‡åŽ»ï¼Œç¨‹åºå‘˜åªèƒ½ç”¨ grep å’Œ sed å‘½ä»¤æ¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æŸ¥æ‰¾ã€æ›¿æ¢æ–‡æœ¬ï¼Œè€ŒçŽ°åœ¨ï¼Œè®¸å¤š IDE å’Œæ–‡æœ¬ç¼–è¾‘å™¨éƒ½æ”¯æŒåœ¨æŸ¥æ‰¾å’Œæ›¿æ¢æ—¶ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚</p><h4 id="æœ€åŽçš„æœ€åŽ"><a href="#æœ€åŽçš„æœ€åŽ" class="headerlink" title="æœ€åŽçš„æœ€åŽ"></a>æœ€åŽçš„æœ€åŽ</h4><p>æ•ˆçŽ‡ï¼Œåœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­æ˜¯æŒ‡åŒæ ·æ—¶é—´å†…å®Œæˆå·¥ä½œçš„å¤šå°‘ã€‚è¿½æ±‚æ•ˆçŽ‡æ˜¯æ— å¯åŽšéžçš„ï¼Œç„¶è€Œå¤„åœ¨è¿™æ ·ä¸€ä¸ªå¿«èŠ‚å¥çš„çŽ°ä»£ç¤¾ä¼šä¸­ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ä¹Ÿéœ€è¦æ…¢ä¸‹æ¥ï¼Œæ‚ ç„¶å’Œç¼“çš„æ“æŒæˆ‘ä»¬çš„ç”µè„‘ï¼Œäº«å—ä»»åŠ¡å®ŒæˆåŽçš„ä¸€åˆ»å®é™<del>ï¼Œä¸ç„¶åˆ«äººä»¥ä¸ºäº¤ç»™æˆ‘ä»¬çš„ä»»åŠ¡å¤ªç®€å•äº†</del>ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> macOS </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ç»™ä¸‰æ˜Ÿ tablet SM-T830 åˆ·æœº</title>
      <link href="/2019/07/10/Flash%20stock%20firmware%20in%20SM-T830/"/>
      <url>/2019/07/10/Flash%20stock%20firmware%20in%20SM-T830/</url>
      <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>å‰å¤©å…¬å¸å‘ç»™æˆ‘ä¸€éƒ¨ä¸‰æ˜Ÿ tablet ä½œä¸ºæµ‹è¯•æœºï¼Œæ˜¯ Tab S4 wifi ç‰ˆï¼Œå…·ä½“åž‹å·æ˜¯ SM-T830ï¼Œè™½ç„¶ä¸æ˜¯æˆ‘æœŸå¾…çš„ Pixel 3 XLï¼Œä½†æ˜¯é…ç½®ä¹Ÿè¿˜ä¸é”™ï¼ŒåŠ ä¸Šå±å¹•ä¹Ÿæ¯”è¾ƒå¤§ã€‚ä½†æ˜¯å‘å°±å‘åœ¨ï¼Œè¿™æ˜¯ä¸€éƒ¨å›½è¡Œçš„æœºå™¨ï¼Œæ²¡æœ‰ Google Mobile Service (GMS) ä¸è¯´ï¼Œè¿˜å……æ–¥äº†ä¸å°‘å›½å†…ç”Ÿæ€çš„æ‚ç‰©ï¼Œæ¯”å¦‚ç³»ç»Ÿè®¾ç½®ä¸­çš„ device storage ç•Œé¢ï¼Œå±…ç„¶å†™ç€ã€Œpowered by 360ã€ï¼Œè¿˜æœ‰ä¸€äº›é¢„è£…çš„å›½å†…åº”ç”¨ã€‚</p><p>è¿™æ—¶æ‘†åœ¨æˆ‘å‰é¢çš„æœ‰ä¸‰ç§æ–¹æ³•ï¼šç¬¬ä¸€ï¼Œåˆ·æœºåˆ·å…¥ä¸€ä¸ªåŽŸç”Ÿ Android ç³»ç»Ÿï¼Œè¿™å½“ç„¶æ˜¯æœ€å®Œç¾Žçš„ï¼›ç¬¬äºŒï¼Œæ‰¾ä¸€ä¸ªä¸‰æ˜Ÿå®˜æ–¹çš„ä½†æ˜¯æ˜¯å›½å¤–ç‰ˆçš„ç³»ç»Ÿåˆ·å…¥ï¼Œè¿™ç§ç³»ç»Ÿä¼šæœ‰ GMSï¼›ç¬¬ä¸‰ï¼Œè‡ªå·±æŠŠç¡®å®žçš„ Google æœåŠ¡å®‰è£…ä¸ŠåŽ»ï¼Œå‡‘æ´»ç€ç”¨ã€‚</p><p>ä»¥ä¸Šç¬¬ä¸€ç§æ–¹æ³•ï¼Œæˆ‘åœ¨ç½‘ä¸ŠæŸ¥äº†æŸ¥ï¼Œå‡ ä¹Žä¸å¯èƒ½ï¼Œå› ä¸ºè¿™ä¸ª æœºåž‹æ¯”è¾ƒå°ä¼—ï¼Œç½‘ä¸Šæ ¹æœ¬æ²¡æœ‰ç»™å®ƒåˆ·åŽŸç”Ÿç³»ç»Ÿçš„æ–¹æ³•ï¼Œå°±è¿ž <a href="https://lineageos.org/" target="_blank" rel="noopener">LineageOS</a> ä¹Ÿæ²¡æœ‰æ”¯æŒè¿™ä¸ªæœºåž‹ã€‚ç¬¬äºŒç§æ–¹æ³•ï¼Œæ˜¯æ¯”è¾ƒå¯è¡Œçš„ï¼Œè¿™æ¬¾ tablet å³ä½¿å°ä¼—ï¼Œä¹Ÿæ˜¯åœ¨å…¨çƒé”€å”®çš„ï¼Œå›½å¤–ç»å¤§éƒ¨åˆ†åœ°åŒºé”€å”®çš„éƒ½æ˜¯å¸¦æœ‰ GMS çš„ï¼Œæ­¤å¤–è¿™æ˜¯ä¸ª WiFi ç‰ˆæœºåž‹ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒè¿è¥å•†å’Œç½‘ç»œåˆ¶å¼çš„é—®é¢˜ï¼Œæ‰€ä»¥åˆ·æˆåŠŸçš„è¯ï¼Œè™½ä¸æ˜¯åŽŸç”Ÿ Androidï¼Œä½†ä¹Ÿæœ‰å®Œæ•´å¯é çš„ GMS å…¨ä»¶å¥—ã€‚ç¬¬ä¸‰ç§æ–¹æ³•ï¼Œæ”¹åŠ¨æœ€å°ï¼Œä½†æ˜¯ä¹Ÿå¯èƒ½æœ‰åŽé—ç—‡ï¼Œå› ä¸ºè¿™æ ·è‡ªè¡Œè¡¥å……å®‰è£… Google service çš„æ–¹å¼æœ‰å¯èƒ½æ˜¯ä¸å®Œå¤‡å¯é çš„ï¼ŒæŒ‡ä¸å®šå•¥æ—¶å€™å°±å‡ºç‚¹ bugã€‚</p><p>æ‰€ä»¥æˆ‘å°±å¼€å§‹å®žæ–½ç¬¬äºŒç§æ–¹æ³•ï¼šåˆ·å…¥ä¸‰æ˜Ÿå®˜æ–¹å›ºä»¶çš„å›½å¤–ç‰ˆæœ¬ï¼Œæœ€åŽè¿™ä»¶äº‹æŠ˜è…¾äº†æˆ‘ä¸€å¤©å¤šã€‚</p><h4 id="ä¸‹è½½-é”™è¯¯çš„-å›ºä»¶åŒ…"><a href="#ä¸‹è½½-é”™è¯¯çš„-å›ºä»¶åŒ…" class="headerlink" title="ä¸‹è½½ (é”™è¯¯çš„) å›ºä»¶åŒ…"></a>ä¸‹è½½ (é”™è¯¯çš„) å›ºä»¶åŒ…</h4><p>é¦–å…ˆæ˜¯èŽ·å–å›ºä»¶åŒ…ï¼Œåœ¨ç½‘ä¸Šæ‰¾äº†ä¸€é€šï¼Œæ‰¾åˆ°äº† xda ä¸Šçš„<a href="https://forum.xda-developers.com/galaxy-tab-s4/how-to/sm-t830-t830xxu1arh1-t3831918" target="_blank" rel="noopener">è¿™ä¸ªå¸–å­</a>ï¼Œé‡Œé¢è´´å‡ºäº†å­˜æ”¾åœ¨ Google drive çš„é€‚ç”¨äºŽ SM-T830 çš„ä¸¤ä¸ªå®˜æ–¹å›ºä»¶çš„é“¾æŽ¥ï¼Œä¸€ä¸ªæ˜¯æ³•å›½ç‰ˆï¼Œå¦ä¸€ä¸ªæ˜¯é˜¿æ‹‰ä¼¯è”åˆé…‹é•¿å›½ç‰ˆã€‚å¸–å­çš„ä½œè€…è¿˜è¯´ï¼Œä»–å¯¹åˆ·æœºå¯èƒ½å‡ºçŽ°çš„åŽæžœä¸è´Ÿä»»ä½•è´£ä»»ï¼Œæä¾›è¿™ä¸¤ä¸ªåŒ…åªæ˜¯è®©å¤§å®¶å…æ”¶ä¸€äº›ç½‘ç«™è¦æ”¶è´¹æ‰èƒ½ä¸‹è½½å›ºä»¶åŒ…æˆ–è€…æ˜¯ä»˜è´¹æ‰èƒ½æé€Ÿä¸‹è½½çš„æ¶å¿ƒã€‚è¯è¯´ï¼ŒSM-T830 çš„å°ä¼—ï¼Œä»Žæˆ‘æœé xda ä¹Ÿæ²¡æ‰¾åˆ°å‡ ä¸ªå’Œå®ƒç›¸å…³çš„å¸–å­å³å¯ç•¥è§ä¸€æ–‘ã€‚</p><p>å›ºä»¶åŒ…å¤§å°çº¦æ˜¯ 3.6 GBï¼Œèµ·å…ˆæˆ‘ä»Žæµè§ˆå™¨ç›´æŽ¥ä¸‹è½½ Google drive ä¸Šçš„å›ºä»¶åŒ…ï¼Œç½‘é€Ÿå¾ˆæ…¢åªæœ‰ 100KB/S çš„æ ·å­ï¼Œä¸‹äº†æŒºä¹…æœ€åŽéƒ½å¤±è´¥äº†ã€‚åŽé¢æˆ‘å‘çŽ°ï¼Œå…ˆæŠŠå›ºä»¶æ·»åŠ åˆ°æˆ‘è‡ªå·±çš„ Google drive ç©ºé—´ï¼Œç„¶åŽåœ¨æ‰‹æœºä¸Šçš„ Google drive åº”ç”¨ä¸­ä¸‹è½½ï¼Œé…åˆå…¬å¸çš„ç½‘ç»œçŽ¯å¢ƒï¼Œé€Ÿåº¦å¯ä»¥å¾ˆå¿«ï¼Œå·®ä¸å¤šåŠä¸ªå°æ—¶å°±ä¸‹è½½å¥½äº†ã€‚</p><h4 id="ä¼å›¾ç”¨è™šæ‹Ÿæœºï¼Œå¤±è´¥"><a href="#ä¼å›¾ç”¨è™šæ‹Ÿæœºï¼Œå¤±è´¥" class="headerlink" title="ä¼å›¾ç”¨è™šæ‹Ÿæœºï¼Œå¤±è´¥"></a>ä¼å›¾ç”¨è™šæ‹Ÿæœºï¼Œå¤±è´¥</h4><p>ä¸‰æ˜Ÿçš„å†…éƒ¨åˆ·æœºå·¥å…· odinï¼Œåªèƒ½ç”¨ Windows è¿è¡Œï¼Œæˆ‘æ‰‹é‡Œåªæœ‰ Macï¼Œæ‰€ä»¥æˆ‘ä¸€å¼€å§‹å¸Œæœ›ç”¨ virtual box ä¸­çš„ win10 è™šæ‹Ÿæœºæ¥æ“ä½œã€‚æˆ‘ä»Žç¡¬ç›˜é‡Œé¢æŠŠå¾ˆä¹…å‰å¤‡ä»½çš„ win10 çš„ virtual disk image (ä¹Ÿå°±æ˜¯ä¸€ä¸ª .vdi æ–‡ä»¶) æ‹·è´åˆ°ç”µè„‘ï¼Œç„¶åŽä»¥æ­¤æ–°å»ºä¸€ä¸ªè™šæ‹Ÿæœºï¼ŒæˆåŠŸçš„è¿è¡Œï¼Œä½†æ˜¯é¼“æ£äº†åŠå¤©ï¼Œä¹Ÿæ— æ³•è®©è¿™ä¸ªè™šæ‹Ÿæœºè¿žæŽ¥ USB è®¾å¤‡ï¼Œåˆ«è¯´è¿™å° tablet ä¸è¡Œï¼Œè¿ž U ç›˜éƒ½ä¸è¡Œã€‚VirtualBox VM Extension Pack å®‰è£…äº†ï¼Œåœ¨ win10 é‡Œé¢ä¹Ÿå®‰è£…äº† Guest Additionsï¼ŒUSB device filters ä¹Ÿé…ç½®äº†ï¼Œå°±æ˜¯ä¸è¡Œï¼Œåªèƒ½æ”¾å¼ƒï¼Œæ‰¾åŒäº‹å€Ÿç”¨ Windows å°å¼æœºã€‚</p><p><strong>2019å¹´1æœˆ1æ—¥æ›´æ–°</strong>ï¼šæˆ‘åŽé¢ VirtualBox è£… Windows è™šæ‹Ÿæœºæ˜¯å¯ä»¥è¿žæŽ¥åˆ° Android è®¾å¤‡çš„ï¼Œå¹¶ä¸”å¯ä»¥åˆ·æœºï¼Œè§<a href="https://tao93.top/2019/01/01/%E7%BB%99%E4%B8%89%E6%98%9F%20tablet%20SM-T830%20%E5%88%B7%E6%9C%BA[%E7%BB%AD]/">ç»™ä¸‰æ˜Ÿ tablet SM-T830 åˆ·æœº[ç»­]</a> çš„æœ€åŽä¸€éƒ¨åˆ†</p><h4 id="å¤±è´¥çš„åˆ·æœº"><a href="#å¤±è´¥çš„åˆ·æœº" class="headerlink" title="å¤±è´¥çš„åˆ·æœº"></a>å¤±è´¥çš„åˆ·æœº</h4><p>åœ¨åŒäº‹çš„å°å¼æœºä¸Šæ“ä½œä¹‹å‰ï¼Œæˆ‘åœ¨ç½‘ä¸Šå·²ç»çœ‹äº†ä¸€æ®µè®²è§£åˆ·æœºè¿‡ç¨‹çš„è§†é¢‘ï¼Œæ„Ÿè§‰æŒºç®€å•çš„ï¼Œå°±å‡ ä¸ªæ­¥éª¤è€Œå·²ã€‚ç­‰åˆ°å¼€å§‹åœ¨ Windows ä¸Šé¢å¼€å§‹å¼„ï¼Œæˆ‘æŠŠå›ºä»¶åŒ…è§£åŽ‹ï¼Œç„¶åŽç”¨ odin å¼€å§‹ï¼Œè¿™æ‰å‘çŽ°é‚£ä¸ªè§†é¢‘å…¶å®žè¿‡æ—¶äº†ï¼Œè§†é¢‘ä¸­å›ºä»¶åŒ…è§£åŽ‹åŽåªæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯æˆ‘è§£åŽ‹åŽå…¶å®žæœ‰ 4 ä¸ªæ–‡ä»¶ã€‚å…¶å®žè¿™ä¸€ç‚¹ Odin ä¸­éƒ½å·²ç»æç¤ºäº†ï¼Œnew model éœ€è¦ 4 ä¸ªæ–‡ä»¶ï¼š</p><p><img src="http://tao93.top/images/2018/12/08/1544280785.png" alt=""></p><p>æ‰€ä»¥æˆ‘çš„å›ºä»¶åŒ…æ˜¯æ¯”è¾ƒæ–°çš„ï¼Œæ‰€ä»¥æœ‰å¤šä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯ä»”ç»†å¯¹æ¯”å‘çŽ°æœ‰ç‚¹é—®é¢˜ï¼Œodin éœ€è¦çš„æ˜¯ BL, AP, CP, HOME_CSC 4 éƒ¨åˆ†ï¼Œä½†æ˜¯æˆ‘çš„å›ºä»¶åŒ…è§£åŽ‹åŽ 4 ä¸ªæ–‡ä»¶çš„æ–‡ä»¶åæ˜¯å¦‚ä¸‹æ‰€ç¤º (æ–‡ä»¶æˆ‘å·²ç»åˆ æŽ‰äº†ï¼Œæ‰€ä»¥æ²¡æ³•è´´å‡ºå®Œæ•´æ–‡ä»¶å)ï¼š</p><blockquote><p>BLâ€¦<br>APâ€¦<br>CSCâ€¦<br>HOME_CSCâ€¦</p></blockquote><p>ç›¸å½“äºŽæ²¡æœ‰ CP å¼€å¤´çš„ï¼Œåè€Œä¼¼ä¹Žæœ‰ä¸¤ä¸ª CSC çš„ï¼Œè¿™æ—¶æˆ‘ä¹Ÿæ²¡å¤ºå¤šç®¡ï¼Œä¾æ¬¡ç‚¹å‡» odin ä¸­çš„ BL, AP, CP, CSC å››ä¸ªå®‰è£…ï¼Œç„¶åŽæŠŠ 4 ä¸ªæ–‡ä»¶éƒ½æ·»åŠ è¿›åŽ»ï¼Œç„¶åŽå°±ç‚¹ start äº†ï¼Œç„¶åŽå°±å¤±è´¥äº†ã€‚äºŽæ˜¯æˆ‘æŠŠ CP å’Œ CSC éœ€è¦çš„æ–‡ä»¶è°ƒæ¢äº†ä¸€ä¸‹ï¼Œè¿˜æ˜¯å¤±è´¥ã€‚</p><p>è¿™æ—¶å€™æˆ‘å°±æŸ¥äº†ä¸€ä¸‹ä¸ºå•¥å°‘äº† CP å¼€å¤´çš„æ–‡ä»¶ï¼Œè¿™æ‰å‘çŽ°ï¼ŒåŽŸæ¥ WiFi ç‰ˆå°±æ˜¯æ²¡æœ‰ CP æ–‡ä»¶ï¼Œè¿™æ˜¯å’ŒåŸºå¸¦ç›¸å…³çš„ï¼Œåªæœ‰å¯æ’å¡ä¸Šç½‘çš„ç‰ˆæœ¬æ‰æœ‰ã€‚é¡ºä¾¿ä¹Ÿå‘çŽ°äº†æˆ‘çš„ CSCâ€¦ å’Œ HOME_CSCâ€¦ ä¸¤ä¸ªæ–‡ä»¶çš„åŒºåˆ«ï¼Œæ®è¯´å‰è€…æ˜¯å½»åº•æ¸…ç©ºæ•°æ®ï¼ŒåŽè€…ä¼šä¿ç•™ç”¨æˆ·æ•°æ®ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªæ–‡ä»¶å…¶å®žä½œç”¨æ˜¯ç±»ä¼¼çš„ï¼Œå…¶å®žæˆ‘ä¹Ÿæ³¨æ„åˆ°å®ƒä»¬å¤§å°ä¹Ÿéžå¸¸ç›¸è¿‘ï¼Œéƒ½æ˜¯ 180MB å·¦å³ã€‚</p><p>äºŽæ˜¯æˆ‘å°±ç©ºå‡º CP é‚£é‡Œä¸æ·»åŠ æ–‡ä»¶ï¼Œå…¶ä½™ 3 ä¸ªæ·»åŠ ä¸Šï¼Œç„¶åŽ startï¼Œç»“æžœå·¦è¾¹æ–‡æœ¬æ¡†åœç•™åœ¨ â€˜setupconnection..â€™ï¼Œæˆ‘ä¸€æŸ¥ï¼Œå‘çŽ°å¾ˆå¤šè¯´å¡åœ¨è¿™ä¸€æ­¥çš„ï¼Œçº·çº·åœ¨æ±‚ helpã€‚æ²¡åŠžæ³•æˆ‘å°±åªèƒ½ç»§ç»­æŸ¥ï¼Œæœ‰è¯´è¦å…ˆè¿è¡Œ odin åŽè¿žæŽ¥ USB æ•°æ®çº¿çš„(è¯•äº†ä¸è¡Œ)ã€‚æŸ¥äº†ä¸€é˜µï¼Œç»ˆäºŽæŸ¥åˆ°ä¸€ä¸ªçœ‹èµ·æ¥æ¯”è¾ƒé è°±çš„<a href="https://forum.xda-developers.com/sprint-galaxy-s6/help/odin-stuck-setupconnection-t3574320" target="_blank" rel="noopener">æ–¹æ³•</a>ï¼Œä¾ç„¶æ˜¯ xda è®ºå›ä¸Šçš„ï¼š</p><p><img src="http://tao93.top/images/2018/12/08/1544281510.png" alt=""></p><p>æˆ‘æŒ‰ç…§ä¸Šé¢è¯´çš„ä¸€æ­¥ä¸€æ­¥èµ°ï¼Œä¾ç„¶å¤±è´¥ï¼Œä½†æ˜¯æ²¡å†å¡åœ¨ setupconnection äº†ã€‚æˆ‘æ€»ç»“å‘çŽ°ï¼Œodin åº”è¯¥ç¡®å®žæœ‰ bugï¼Œæ˜Žæ˜Žè®¾å¤‡è¿žæŽ¥æ­£å¸¸ï¼Œå®ƒå°±æ˜¯å¡åœ¨è¿™ä¸€æ­¥ï¼Œè¿™æ—¶å€™å¯ä»¥è¿™ä¹ˆåšï¼š1. é‡æ–°å¯åŠ¨è®¾å¤‡ï¼Œ1. æ–­å¼€ USB è¿žæŽ¥ï¼Œ3. è¿›å…¥ downloading modeï¼Œ4. è¿žæŽ¥ USB ç„¶åŽå†åœ¨ odin ä¸­ startï¼Œå°±ä¸ä¼šå¡åœ¨é‚£ä¸€æ­¥äº†ã€‚</p><p>è¿›å…¥ Download æ¨¡å¼çš„æ–¹æ³•ï¼šå…ˆå…³æœºï¼Œç„¶åŽåŒæ—¶æŒ‰ä½ Volumn Up å’Œ Power é”®ï¼Œç­‰å±å¹•äº®åŽç«‹å³æ¾æ‰‹ï¼Œæ­¤æ—¶ä¼šè¿›å…¥ Recovery mode (ä¸‰æ˜Ÿè‡ªå·±çš„ recovery æˆ–è€…ç¬¬ä¸‰æ–¹ recovery æ¯”å¦‚ TWRP)ã€‚å¦‚æžœæ˜¯ä¸‰æ˜Ÿçš„ recoveryï¼Œé€‰æ‹© boot to bootloader å³å¯ï¼Œå¦‚æžœæ˜¯ TWRPï¼Œé€‰æ‹©è¿›å…¥ Download æ¨¡å¼å³å¯ã€‚</p><p>å›žåˆ°åˆšåˆšè¯´çš„ï¼Œè™½ç„¶æ²¡å¡åœ¨ setupconnection äº†ï¼Œä½†æ˜¯ä¾ç„¶å¤±è´¥ï¼Œæç¤ºå¤§æ¦‚æ˜¯ï¼š</p><blockquote><p><id:0 004=""> abl.elf</id:0></p><p><id:0 004=""> FAIL! (Auth)</id:0></p><id:0 004=""><p><id:0 004=""> Complete(Write) operation failed.</id:0></p><p><osm> All threads completed. (succeed 0 / failed 1)</osm></p></id:0></blockquote><p>ä»¥ abl.elf ä¸ºå…³é”®å­—åˆæ˜¯ä¸€ç•ªåœ¨ç½‘ä¸Šæœç´¢ï¼Œæœ€åŽå‘çŽ°<a href="http://bbs.gfan.com/android-9245022-1-1.html" target="_blank" rel="noopener">è¿™ä¸ªå¸–å­æœ‰</a>äººé‡åˆ°è¿™ä¸ªé—®é¢˜æœ€åŽè§£å†³äº†ï¼š</p><p><img src="http://tao93.top/images/2018/12/08/1544281993.png" alt=""></p><p>èµ·åˆæˆ‘å¯¹ã€Œå›ºä»¶ç‰ˆæœ¬è½åŽäºŽçŽ°æœ‰ç‰ˆæœ¬ã€è¿™å¥è¯ä¸ä»¥ä¸ºç„¶ï¼Œå› ä¸ºæˆ‘è§‰å¾—è¿™ä¸å°±æ„å‘³ç€åªèƒ½å‡çº§ä¸èƒ½é™çº§å˜›ï¼Œä¸ç§‘å­¦ã€‚ä½†åŽé¢æˆ‘å¿½ç„¶æƒ³åˆ°ï¼Œè¿™å¥è¯æ„æ€å¯èƒ½æ˜¯åˆ·æœºä¸èƒ½åˆ·é‚£äº›ç‰ˆæœ¬æ¯”è®¾å¤‡å‡ºåŽ‚æ—¶ç³»ç»Ÿç‰ˆæœ¬è¿˜æ›´æ—§çš„å›ºä»¶ï¼Œå°±ä¸Šè¿™ä¸ªäººç¡®å®žè§£å†³äº†é—®é¢˜ï¼Œå¹¶ä¸”æˆ‘å‰é¢ä¸‹çš„å›ºä»¶åŒ…éƒ½æ˜¯ 2018 å¹´ 8 æœˆä»½çš„ï¼Œç¡®å®žæœ‰ç‚¹æ—§ï¼Œæ‰€ä»¥æˆ‘å¼€å§‹æƒ³æ€Žä¹ˆä¸‹æœ€æ–°çš„ç”¨äºŽ SM-T830 çš„å›ºä»¶ã€‚</p><h4 id="ä¸‹è½½æœ€æ–°çš„å›ºä»¶åŒ…"><a href="#ä¸‹è½½æœ€æ–°çš„å›ºä»¶åŒ…" class="headerlink" title="ä¸‹è½½æœ€æ–°çš„å›ºä»¶åŒ…"></a>ä¸‹è½½æœ€æ–°çš„å›ºä»¶åŒ…</h4><p>è¿™æ—¶ï¼Œå°±åˆå›žåˆ°å¼€å§‹æ‰¾å›ºä»¶åŒ…çš„æ­¥éª¤äº†ï¼Œç½‘ä¸Šæ»¡æ˜¯å‡é“¾æŽ¥ï¼Œæˆ–è€…æ˜¯è¦æ³¨å†Œï¼Œè¦äº¤è´¹çš„ï¼Œæ‰¾å¾—äººå¿ƒç´¯ã€‚ä¸è¿‡ï¼Œæœ€åŽç«Ÿç„¶æ‰¾åˆ°ä¸€ä¸ªå« SamFirm tool çš„ç¥žå™¨ï¼Œè¿™ä¸ªç¥žå™¨å¯ä»¥ç›´æŽ¥é«˜é€Ÿä¸‹è½½æƒ³è¦çš„æœ€æ–°å›ºä»¶ï¼Œç®€ç›´ä¸èƒ½æ›´æ£’ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¾“å…¥ç³»ç»Ÿåž‹å·ï¼Œç„¶åŽé€‰æ‹© auto æ¨¡å¼æ¥æŸ¥æ‰¾ï¼Œå°±èƒ½æ‰¾åˆ°æœ€æ–°çš„å›ºä»¶ï¼Œå¹¶ä¸”ä¸‹è½½é€Ÿåº¦è¿˜å¾ˆå¿«ï¼<a href="https://forum.xda-developers.com/galaxy-tab-s/general/tool-samfirm-samsung-firmware-t2988647" target="_blank" rel="noopener">è¿™ä¸ªå¸–å­</a>å¯ä»¥ä¸‹è½½åˆ°è¿™ä¸ªç¥žå™¨ã€‚</p><p><img src="http://tao93.top/images/2018/12/08/1544283275.png" alt=""></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå‡†ç¡®åœ°å¡«å…¥åž‹å·ï¼Œå¡«å…¥è¦ä¸‹è½½çš„å›ºä»¶çš„å›½å®¶æˆ–åœ°åŒºä»£å·ï¼ˆè¿™é‡Œæˆ‘è¦å¡«çš„å°±æ˜¯æŸä¸ªå¤–å›½æˆ–å›½å¤–åœ°åŒºï¼Œè¿™æ ·å›ºä»¶åŒ…æ‰ä¼šæœ‰ GMSï¼‰ã€‚è¿™ä¸ªå›½å®¶æˆ–åœ°åŒºä»£å·å¯ä»¥ä»Ž<a href="https://www.sammobile.com/firmwares/galaxy-tab-s4/SM-T830/" target="_blank" rel="noopener">è¿™é‡Œ</a>æ‰¾åˆ°ï¼Œæˆ‘åœ¨ä¸Šä¸€å¼ å›¾ä¸­å¡«å…¥çš„æ˜¯ XEFï¼Œå…¶å®žå°±æ˜¯ä»£è¡¨æ³•å›½ã€‚å¡«å¥½åŽå‹¾é€‰ Autoï¼Œç„¶åŽç‚¹å‡» Check Updateï¼Œå³å¯æ£€æŸ¥åˆ°æœ€æ–°å›ºä»¶åŒ…çš„ä¿¡æ¯ï¼Œæˆ‘åœ¨ä»Šå¤©ï¼ˆ2018å¹´12æœˆ8æ—¥ï¼‰æ£€æŸ¥åˆ°çš„ SM-T830 çš„æ³•å›½ç‰ˆæœ€æ–°å›ºä»¶åŒ…å¦‚ä¸Šå›¾ç®­å¤´æ‰€ç¤ºï¼Œæ˜¯ 2018å¹´10æœˆ24æ—¥æ›´æ–°çš„ã€‚ç„¶åŽå°±å¯ä»¥åœ¨ SamFirm å³è¾¹ç‚¹ä¸‹è½½äº†ã€‚å»ºè®®å‹¾é€‰ Decrypt automaticallyï¼Œå¦åˆ™ ä¸‹è½½å¥½å›ºä»¶åŒ…åŽè¿˜éœ€è¦é‡æ–°è§£å¯†ï¼Œè´¹æ—¶é—´ã€‚</p><p>å›½å®¶æˆ–åœ°åŒºä»£å·æˆªå›¾ï¼š</p><p><img src="http://tao93.top/images/2018/12/08/1544283882.png" alt=""></p><h4 id="æˆåŠŸåˆ·æœº"><a href="#æˆåŠŸåˆ·æœº" class="headerlink" title="æˆåŠŸåˆ·æœº"></a>æˆåŠŸåˆ·æœº</h4><p>ä¸‹è½½åˆ°æœ€æ–°å›ºä»¶åŽï¼Œè§£åŽ‹ï¼Œç„¶åŽç”¨ odin ä¾æ¬¡å¡«å…¥ BL AP CSC ä¸‰ä¸ªåœ°æ–¹çš„æ–‡ä»¶ï¼Œç‚¹ startï¼Œç»§ç»­å¡åœ¨ setupconnectionï¼ŒæŒ‰ç…§æˆ‘ä¹‹å‰çš„æ€»ç»“è·³è¿‡è¿™ä¸ª setupconnectionï¼Œç„¶åŽçœŸæ­£å¼€å§‹åˆ·æœºï¼Œå¤§æ¦‚ 10 åˆ†é’Ÿä¸åˆ°å°±åˆ·å¥½äº†ã€‚</p><h4 id="å†™åœ¨æœ€åŽ"><a href="#å†™åœ¨æœ€åŽ" class="headerlink" title="å†™åœ¨æœ€åŽ"></a>å†™åœ¨æœ€åŽ</h4><p>åˆ·ä¸ªæœºé‡åˆ°çš„å‘è¿˜çœŸæ˜¯æŒºå¤šï¼ŒæŠŠè¿™äº›è®°å½•ä¸‹æ¥ï¼Œè¯´ä¸å®šä»¥åŽå…¬å¸çš„å›½è¡Œè®¾å¤‡éœ€è¦åˆ·æœºï¼Œè¿™äº›è®°å½•å°±èƒ½æ´¾ä¸Šç”¨åœºäº†ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Firmware </tag>
            
            <tag> Samsung </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å†æ¬¡å°† hexo blog æ”¾ç½®åˆ° Github Pages</title>
      <link href="/2019/07/05/%E5%86%8D%E6%AC%A1%E5%B0%86%20hexo%20blog%20%E6%94%BE%E7%BD%AE%E5%88%B0%20Github%20Pages/"/>
      <url>/2019/07/05/%E5%86%8D%E6%AC%A1%E5%B0%86%20hexo%20blog%20%E6%94%BE%E7%BD%AE%E5%88%B0%20Github%20Pages/</url>
      <content type="html"><![CDATA[<h4 id="æ’è¯"><a href="#æ’è¯" class="headerlink" title="æ’è¯"></a>æ’è¯</h4><p>ç”µè„‘æ¢äº†åŽï¼Œæˆ‘æŠŠ hexo blog æ•´ä¸ªç›®å½•æ‹·è´åˆ°æ–°ç”µè„‘ï¼Œç„¶åŽæ–°ç”µè„‘å®‰è£… nodeï¼Œå®‰è£… hexoï¼Œç”¨ npm å®‰è£…ä¸»é¢˜æ‰€éœ€çš„ä¾èµ–ï¼Œç„¶åŽ generate å‡ºæ¥çš„ç½‘é¡µæ–‡ä»¶æ ·å¼æœ‰é—®é¢˜ï¼Œæœ€åŽå›žé€€åˆ° node v10 æ‰è§£å†³ã€‚ä¼¼ä¹Ž node å¯¹åŽ†å²ç‰ˆæœ¬çš„å…¼å®¹æ€§ä¸ä½³ï¼Œä¹Ÿå¯èƒ½æ˜¯ç”¨ npm å®‰è£…çš„ä¸€äº›ä¾èµ–æ²¡é€‚é…æœ€æ–°çš„ nodeï¼Œç¥žå‘ï¼</p><h4 id="ç¼˜èµ·"><a href="#ç¼˜èµ·" class="headerlink" title="ç¼˜èµ·"></a>ç¼˜èµ·</h4><p>ç§Ÿäº†ä¸€å¹´çš„é˜¿é‡Œäº‘ä½äºŽé¦™æ¸¯çš„ VPS åˆ°æœŸäº†ï¼Œä½†åˆ°æœŸä¸æ˜¯å…³é”®ï¼Œå…³é”®æ˜¯å¤§çº¦ä¸€ä¸ªå¤šæœˆå‰ï¼Œæˆ‘çš„ VPS å½»åº•è¢«å±è”½äº†ï¼Œåœ¨å›½å†… ping IP éƒ½å®Œå…¨ä¸é€šï¼Œåªæœ‰å¢ƒå¤–æ‰èƒ½æ­£å¸¸è®¿é—®ã€‚å‘é˜¿é‡Œäº‘åé¦ˆï¼Œå¯¹æ–¹å»ºè®®æˆ‘é‡æ–° deploy ä¸€ä¸ª VPSã€‚æˆ‘ä»¥ä¸ºé‡æ–° deploy ä¸€ä¸‹å¾ˆç®€å•ï¼Œç„¶è€Œäº‹å®žæ˜¯é‡æ–° deploy éœ€è¦æˆ‘é‡æ–°ä¸‹è®¢å•ï¼Œç„¶åŽç”¨æ–°è®¢å•æ¥ deployï¼ŒåŽŸæœ‰è®¢å•å°±å½“åºŸäº†ã€‚è€Œé˜¿é‡Œäº‘åªæä¾›æ•°æ®å¤‡ä»½å’Œæ¢å¤æœåŠ¡ï¼Œç”¨äºŽå°†åŽŸ VPS çš„æ•°æ®è¿ç§»åˆ°æ–° VPSï¼Œå¹¶ä¸”è¿™é¡¹æœåŠ¡ä¹Ÿæ˜¯æ”¶è´¹çš„ã€‚è¿™æ˜¯åœ¨è®©äººå¿æ— å¯å¿ã€‚è¿˜å¥½åŽŸè®¢å•å½“æ—¶åªå‰©ä¸€ä¸ªå¤šæœˆï¼Œæ‰€ä»¥æˆ‘æ‰“å®šæ³¨æ„ä¸ç”¨é˜¿é‡Œäº‘äº†ã€‚</p><p>å¦å¤–æˆ‘ç®€å•è¯•äº†ä¸€ä¸‹ Vultr çš„æœåŠ¡ï¼Œå…ˆè¯•äº†ä¸ª $2.5/Mo çš„ï¼Œç»“æžœå‘çŽ°åªæœ‰ IPv6 è€Œæ²¡æœ‰ IPv4ã€‚åŽé¢æˆ‘ç”³è¯·é€€æ¬¾ï¼Œé€€æ¬¾å€’æ˜¯å¾ˆè¿…é€Ÿï¼Œåªæ˜¯æ‰£æŽ‰äº†æˆ‘ä½™é¢çš„ä¸€éƒ¨åˆ†ï¼Œå·¥å•é‡Œé¢è¯¢é—®ï¼Œå¯¹æ–¹ä¹Ÿåªæ˜¯è¯´è¿™ä¸ªæ˜¯åè®®è§„å®šï¼Œæ—¢ç„¶æ‚¨å·²ä½¿ç”¨æˆ‘ä»¬çš„äº§å“ã€åŒæ„çš„åè®®ï¼Œé‚£ä¹ˆåªèƒ½è¯·æ‚¨è°…è§£ã€‚äºŽæ˜¯æˆ‘å¯¹ Vultr ä¹Ÿæ— å¥½æ„Ÿäº†ã€‚</p><p>åŠ ä¹‹å¬æˆ‘çš„åŒå­¦è®²èµ·äº†åˆ«çš„å¥½ä½¿çš„ç¿»å¢™æ–¹å¼ï¼ŒäºŽæ˜¯ç”¨ VPS ç¿»å¢™çš„éœ€æ±‚ä¹Ÿæ²¡ä»€ä¹ˆäº†ï¼ŒäºŽæ˜¯æˆ‘æƒ³åˆ°äº†ç”¨ Github Pages æ¥ host æˆ‘çš„ hexo blogã€‚</p><h4 id="å‰å¥"><a href="#å‰å¥" class="headerlink" title="å‰å¥"></a>å‰å¥</h4><p>å¦‚æˆ‘åœ¨ <a href="https://tao93.github.io/2018/09/26/%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB%E8%AE%B0%E5%BD%95/" target="_blank" rel="noopener">åšå®¢ç³»ç»Ÿè¿ç§»è®°å½•</a> ä¸­æ‰€è¯´ï¼Œæˆ‘ä½¿ç”¨è‡ªå·±å†™çš„ä¸€ä¸ª deploy.sh è„šæœ¬ï¼Œè¿™ä¸ªè„šæœ¬ä¼šå°†æˆ‘çš„ Markdown æ–‡ä»¶çš„æ”¹åŠ¨ push åˆ° VPS ä¸Šï¼ˆä»¥ä½œå¤‡ä»½ï¼Œé¿å…æœ¬åœ°ç”µè„‘æ•°æ®ä¸¢å¤±ï¼‰ï¼Œç„¶åŽè°ƒç”¨ hexo åœ¨ public ç›®å½•ç”Ÿæˆç½‘é¡µæ–‡ä»¶ï¼Œå¹¶ commit å† push åˆ° VPSï¼Œä»Žè€Œè®© blog ç½‘é¡µåˆ·æ–°ï¼Œæœ€åŽæˆ‘ blog ä¸­ç”¨åˆ°çš„å›¾ç‰‡ï¼Œæˆ‘éƒ½æ˜¯æ”¾ç½®åˆ° VPSï¼Œç„¶åŽè‡ªåŠ¨ç”Ÿæˆ image url å¹¶æ’å…¥åˆ° Markdown ä¸­çš„ï¼Œå› æ­¤ä¸ºé˜² VPS æ•°æ®ä¸¢å¤±ï¼Œè¿™ä¸ªè„šæœ¬è¿˜æŠŠ VPS ä¸­çš„å›¾ç‰‡ç›®å½• commitï¼Œç„¶åŽåœ¨æœ¬åœ°æŠŠå›¾ç‰‡ç›®å½• pull ä¸‹æ¥ã€‚è¿™æ ·ä¸€æ¥ï¼Œå›¾ç‰‡å’ŒåŽŸå§‹çš„ Markdown æ–‡ä»¶ï¼Œå°±éƒ½åœ¨æœ¬åœ°å’Œ VPS ä¸­éƒ½æœ‰å®Œæ•´å¤‡ä»½ï¼Œä¸€æ–¹æ•°æ®ä¸¢å¤±æ—¶ï¼Œå¦ä¸€æ–¹å¯ä»¥è¢«ç”¨æ¥æ¢å¤æ•°æ®ã€‚</p><p>å½“æ—¶èƒ½æœ‰è¿™ç§å¤‡ä»½æ€æƒ³ï¼Œä¹Ÿæ˜¯å› ä¸ºæ›¾ç›®ç¹ä¸€ä¸ªæœ‹å‹çš„äº‹æ•…ã€‚è¿™ä¸ªæœ‹å‹ä¹Ÿæ˜¯ç”¨ VPS æ¥ host hexo blogï¼Œè€Œ Markdown æ–‡ä»¶åªåœ¨æœ¬åœ°æœ‰ä¸€ä»½ï¼ŒæŸå¤©ä»–æœ¬åœ°æ•°æ®ä¸¢å¤±äº†ï¼Œæœ€åŽä»–ä¸å¾—ä¸å€ŸåŠ© VPS ä¸Šçš„ç½‘é¡µæ–‡ä»¶æ¥é‡å†™ Markdown æ–‡ä»¶ï¼Œè€Œä»–åˆæ˜¯ blog é«˜äº§ç”¨æˆ·ï¼Œå¯æƒ³è€ŒçŸ¥è¿™æ˜¯å¤šä¹ˆç¹çã€‚</p><h4 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h4><p>ä¹‹å‰æˆ‘æœ‰ 3 git repoï¼Œåˆ†åˆ«æ˜¯åŒ…å« Markdown æ–‡ä»¶çš„ sourceï¼ŒåŒ…å«ç”Ÿæˆçš„ç½‘é¡µæ–‡ä»¶çš„ publicï¼Œè¿˜æœ‰å°±æ˜¯ Imageã€‚å‰ä¸¤è€…éƒ½æ˜¯æˆ‘æœ¬åœ° commitï¼Œç„¶åŽ push åˆ° VPSï¼Œæœ€åŽçš„ Image åˆ™æ˜¯ VPS ä¸Šä¸æ–­å¢žåŠ æ–°å›¾ç‰‡ï¼Œç„¶åŽ VPS ä¸Š commitï¼Œæœ¬åœ°å† pullã€‚</p><p>çŽ°åœ¨æ”¹ç”¨ Github Pages åŽï¼Œæˆ‘åªèƒ½æœ‰ä¸€ä¸ª repo (<a href="https://github.com/Tao93/Tao93.github.io)æ¥" target="_blank" rel="noopener">https://github.com/Tao93/Tao93.github.io)æ¥</a> host blog æ‰€éœ€è¦çš„ç½‘é¡µæ–‡ä»¶å’Œé‚£äº›å›¾ç‰‡ï¼Œæ‰€ä»¥æˆ‘å°±æŠŠ Image å…¨éƒ¨æ”¾è¿› public ä¸­äº†ï¼Œè¿™æ ·å°±å°‘äº† Image è¿™ä¸ª git repoã€‚å¦å¤–ï¼ŒGithub Pages æ˜¯ https çš„ï¼Œæ‰€ä»¥æˆ‘è¿˜éœ€è¦åœ¨ hexo config ä¸­æŠŠ http æ”¹ä¸º httpsã€‚</p><p>å¦å¤–ï¼Œä¸ºäº†å¤‡ä»½ Markdown æ–‡ä»¶ï¼Œæˆ‘å¦å¤–å¼€äº† <a href="https://github.com/Tao93/hexo-blog-post" target="_blank" rel="noopener">https://github.com/Tao93/hexo-blog-post</a> è¿™ä¸ª repo æ¥ä¿å­˜æˆ‘çš„ Markdown æ–‡ä»¶ã€‚</p><p>å¾€åŽï¼Œæˆ‘æ›´æ–° blog çš„æµç¨‹å°±æ˜¯ï¼šæœ¬åœ° source repo ä¸­æ–°å¢žæˆ–ä¿®æ”¹ Markdown æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­éœ€è¦æ’å…¥å›¾ç‰‡æ—¶ï¼ŒæŠŠå›¾ç‰‡æ”¾å…¥ <code>public/Images</code> ä¸­æŒ‡å®šè·¯å¾„ï¼Œç„¶åŽä»¥æ­¤è·¯å¾„å¾—åˆ° image url å¹¶ä½¿ç”¨è¯¥ url æ¥æ’å…¥å›¾ç‰‡ï¼Œæœ€åŽåœ¨ source repo ä¸­ commitï¼›ç„¶åŽ deploy.sh è„šæœ¬å…ˆå°† source repo push åˆ° <a href="https://github.com/Tao93/hexo-blog-postï¼Œç„¶åŽè°ƒç”¨" target="_blank" rel="noopener">https://github.com/Tao93/hexo-blog-postï¼Œç„¶åŽè°ƒç”¨</a> hexo åœ¨ public ä¸­ç”Ÿæˆç½‘é¡µæ–‡ä»¶ï¼Œæœ€åŽå°† public repo push åˆ° <a href="https://github.com/Tao93/Tao93.github.ioï¼Œè‡³æ­¤" target="_blank" rel="noopener">https://github.com/Tao93/Tao93.github.ioï¼Œè‡³æ­¤</a> blog ç½‘é¡µå°±æ›´æ–°äº†ã€‚</p><p>ä»Žä¸Šé¢æ‰€è®²å¯çŸ¥ï¼ŒMarkdown æ–‡ä»¶å’Œ Image éƒ½æ˜¯ Github å’Œæœ¬åœ°éƒ½æœ‰ï¼Œäº’ä¸ºå¤‡ä»½ï¼Œç¡®ä¿å®‰å…¨ã€‚å¦å¤–ä¸Šé¢çš„æ’å…¥å›¾ç‰‡ï¼Œä¾ç„¶æ˜¯ä½¿ç”¨æˆ‘åœ¨ <a href="https://tao93.github.io/2018/09/26/%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB%E8%AE%B0%E5%BD%95/" target="_blank" rel="noopener">åšå®¢ç³»ç»Ÿè¿ç§»è®°å½•</a> è¯´çš„ upload_pic è„šæœ¬ï¼Œè¿™ä¸ªè„šæœ¬å¯ä»¥è‡ªåŠ¨å°†æˆ‘å¤åˆ¶çš„å›¾ç‰‡æ–‡ä»¶æˆ–è€…æ˜¯æˆªå›¾å†…å®¹å¤åˆ¶åˆ° <code>public/images</code> çš„æŒ‰æ—¥æœŸå‘½åçš„ç›®å½•å¹¶ç”¨æ—¶é—´æˆ³å‘½åï¼Œç„¶åŽå† generate ä¸€ä¸ªç”Ÿæˆçš„ url å¹¶æŠŠ url å¤åˆ¶åˆ°æˆ‘çš„å‰ªè´´æ¿ã€‚å› æ­¤æˆ‘åªéœ€è¦å¤åˆ¶æˆ–æˆªå›¾ï¼Œç„¶åŽå†è°ƒç”¨ upload_picï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ª url ç”¨äºŽåœ¨ Markdown ä¸­æ’å…¥å›¾ç‰‡ã€‚</p><p>æœ€åŽï¼Œä¸€å¹´å‰ä¹°äº†é˜¿é‡Œäº‘ 3 å¹´çš„åŸŸå tao93.topï¼Œæˆ‘è®©å®ƒæŒ‡å‘ tao93.github.io äº†ã€‚</p><p>æœ€åŽçš„æœ€åŽï¼Œæ’å…¥ä¸¤å¼ å›¾ç‰‡æµ‹è¯•ä¸€ä¸‹ï¼Œä¸€å¼ æ˜¯æˆªå›¾ï¼Œå¦ä¸€å¼ æ˜¯å¤åˆ¶å›¾ç‰‡æ–‡ä»¶ã€‚</p><p><img src="http://tao93.top/images/2019/07/06/1562381892.png" alt=""></p><p><img src="http://tao93.top/images/2019/07/06/1562381957.png" alt=""></p><p>&lt;å®Œ&gt;</p>]]></content>
      
      
        <tags>
            
            <tag> Hexo Blog </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Android è‡ªå®šä¹‰ç®€æ˜“ PickerView</title>
      <link href="/2019/04/07/Android%20%E8%87%AA%E5%AE%9A%E4%B9%89%E7%AE%80%E6%98%93%20PickerView/"/>
      <url>/2019/04/07/Android%20%E8%87%AA%E5%AE%9A%E4%B9%89%E7%AE%80%E6%98%93%20PickerView/</url>
      <content type="html"><![CDATA[<p>æœ€è¿‘çš„åšçš„ä¸€é¡¹ feature ä¸­ï¼Œéœ€è¦ä½¿ç”¨ç±»ä¼¼äºŽ iOS çš„ UIPickerView çš„æŽ§ä»¶ï¼ŒåŠŸèƒ½æ˜¯é€šè¿‡æ»šåŠ¨ item æ¥é€‰æ‹©å…¶ä¸­ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯ä¸‹å›¾è¿™æ ·çš„ï¼š</p><p><img src="http://tao93.top/images/2019/04/07/1554640301.png" alt=""></p><p>Android SDK å€’æ˜¯æœ‰ä¸€ä¸ª NumberPicker å’Œè¿™ä¸ªéžå¸¸ç±»ä¼¼ï¼Œä¸è¿‡ NumberPicker è®¾è®¡æœ‰ç‚¹é—®é¢˜ï¼Œæ»šåŠ¨å¾ˆæ…¢ï¼Œå³ä½¿æ˜¯æ‰‹æŒ‡å¿«é€Ÿæ»‘åŠ¨ï¼Œä¹Ÿåªèƒ½æ»šåŠ¨äº”å…­ä¸ª itemsï¼Œè€Œ Github ä¸Šç¡®å®žæœ‰ä¸å°‘ä¼˜ç§€çš„å®žçŽ°ï¼Œå¯ä»¥å’Œ iOS çš„ UIPickerView éžå¸¸ç›¸ä¼¼ï¼Œä¸è¿‡å…¶ä»£ç æœ‰äº›å¤æ‚ï¼Œä»¥è‡³äºŽæƒ³è¦é€Ÿè¯»ä»£ç ç„¶åŽè‡ªå·±å†™ä¸€ä»½ä¹Ÿæ¯”è¾ƒè´¹æ—¶é—´ã€‚æ‰€ä»¥ï¼Œæˆ‘å°±æƒ³åˆ°è‡ªå·±åŸºäºŽ Android çš„ ListView å†™ä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰ PickerViewã€‚</p><p>æ—¢ç„¶ä½¿ç”¨ ListViewï¼Œé‚£ä¹ˆé¦–å…ˆéœ€è¦è§£å†³é—®é¢˜æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š</p><ol><li>å¦‚ä½•è®©æ‰€æœ‰ item éƒ½èƒ½é€šè¿‡æ»‘åŠ¨è€Œæ»šåŠ¨åˆ°è§†å›¾ä¸­é—´ï¼Œä»Žè€Œè¡¨ç¤ºè¯¥ item è¢«é€‰ä¸­ï¼Ÿ</li><li>å¦‚æžœè®© ListView çš„ idle çŠ¶æ€å˜ä¸ºç¦»æ•£çš„ï¼Œè€Œéžæœ¬æ¥çš„ä»»æ„æ»šåŠ¨çŠ¶æ€éƒ½å¯ä»¥ä¸º idleï¼Ÿ</li><li>æ€Žä¹ˆèŽ·å–å½“å‰é€‰ä¸­çš„ item çš„åºå·ï¼Ÿ</li></ol><p>ç¬¬ä¸€ä¸ªé—®é¢˜æ¯”è¾ƒå¥½åŠžï¼Œåœ¨ list çš„é¦–å°¾å„å¡«å……ä¸€äº›ç©ºç™½çš„ itemï¼Œè¿™æ ·å°±èƒ½è®©ç”¨æˆ·å¯è§çš„æ‰€æœ‰ item éƒ½èƒ½æ»‘åŠ¨åˆ°æ­£ä¸­é—´ã€‚ç¬¬äºŒä¸ªé—®é¢˜ï¼Œæˆ‘çš„åšæ³•æ˜¯ï¼Œå¦‚æžœæ‰‹æŒ‡ç¦»å¼€æ—¶ï¼ŒListView ç¼“æ…¢æ»‘åŠ¨ï¼Œé‚£ä¹ˆå°±åœ¨é€Ÿåº¦ä½ŽäºŽæŸä¸ªé˜ˆå€¼æ—¶ï¼Œè®©å®ƒæ»‘åŠ¨åˆ°æ°å¥½å°†ä¸€äº› item æ˜¾ç¤ºå‡ºæ¥è€Œä¸è¦æœ‰æŸä¸ª item åªæ˜¾ç¤ºä¸€éƒ¨åˆ†ï¼›è€Œå¦‚æžœæ‰‹æŒ‡ç¦»å¼€æ—¶ ListView å¿«é€Ÿæ»‘åŠ¨ï¼Œé‚£ä¹ˆå°±åœ¨ ListView åˆšåˆšå˜ä¸º idle çŠ¶æ€æ—¶ï¼Œè®©å®ƒå°±è¿‘æ»‘åŠ¨åˆ°ã€Œæ°å¥½å°†ä¸€äº› item æ˜¾ç¤ºå‡ºæ¥ã€çš„çŠ¶æ€ã€‚ç¬¬ä¸‰ä¸ªé—®é¢˜å¥½åŠžï¼Œè®¡ç®—ä¸€ä¸‹å½“å‰æ˜¾ç¤ºçš„æ‰€æœ‰ item çš„ position å°±èƒ½çŸ¥é“æœ€ä¸­é—´æ˜¾ç¤ºçš„ item çš„ positionã€‚</p><p>å¦å¤–è¿˜æœ‰ä¸€äº›ç»†èŠ‚é—®é¢˜ï¼š</p><ol><li>éœ€è¦åœ¨ä¸­é—´ç»˜åˆ¶ä¸Šä¸¤æ¡ç°è‰²æ°´å¹³çº¿ï¼›</li><li>éœ€è¦åœ¨ canvas çš„æœ€ä¸Šå±‚ç»˜åˆ¶ä¸æ˜¯æ­£ä¸­é—´åŒºåŸŸç»˜åˆ¶åŠé€æ˜ŽçŸ©å½¢ï¼Œä»Žè€Œè®©éžé€‰ä¸­çš„ item çœ‹èµ·æ¥æ˜¯ç°è‰²çš„ï¼›</li><li>ç‚¹å‡»éžé€‰ä¸­çš„ item æ—¶ï¼Œéœ€è¦æ»šåŠ¨ ListView è®©è¯¥ item æ»‘åŠ¨åˆ°æ­£ä¸­é—´ã€‚</li></ol><p>å®žçŽ°çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Adapter interface for &#123;<span class="doctag">@link</span> PickerView&#125; which is like UIPickerView on iOS. </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PickerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="comment">/** get resource id of layout for each item of the picker view. */</span></span><br><span class="line">    <span class="meta">@LayoutRes</span> <span class="function"><span class="keyword">int</span> <span class="title">getItemLayoutResource</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** count of items in the picker view. */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** text string for the item at the specified position. */</span></span><br><span class="line">    <span class="function">String <span class="title">getItemAt</span><span class="params">(<span class="keyword">int</span> pos)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A view to let users to choose one item from a list, like UIPickerView on iOS.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PickerView</span> <span class="keyword">extends</span> <span class="title">FrameLayout</span> </span>&#123;</span><br><span class="line">    <span class="comment">/** the listView which is used to implement this PickerView */</span></span><br><span class="line">    <span class="keyword">private</span> ListView listView;</span><br><span class="line">    <span class="comment">/** the count of visible items, must be odd numbers, the middle item would be the the selected one. */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> visibleCount = <span class="number">5</span>; <span class="comment">// 5 items visible by default</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> itemHeight;</span><br><span class="line"></span><br><span class="line">    Paint dividerLinePaint;</span><br><span class="line">    Paint greyLayerPaint;</span><br><span class="line">    <span class="comment">/** adapter for this pickerView */</span></span><br><span class="line">    PickerAdapter adapter;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> dividerThickness;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> dividerMarginLeft;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> dividerMarginRight;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> velocityThreshold;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> VelocityTracker velocityTracker = VelocityTracker.obtain();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PickerView</span><span class="params">(@NonNull Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PickerView</span><span class="params">(@NonNull Context context, @Nullable AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PickerView</span><span class="params">(@NonNull Context context, @Nullable AttributeSet attrs, <span class="keyword">final</span> <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        setWillNotDraw(<span class="keyword">false</span>);</span><br><span class="line">        </span><br><span class="line">        itemHeight = getResources().getDimension(R.dimen.picker_view_item_height);</span><br><span class="line">        velocityThreshold = getResources().getDisplayMetrics().density * <span class="number">260</span>;</span><br><span class="line">        </span><br><span class="line">        TypedArray ta = context.obtainStyledAttributes(attrs, R.styleable.PickerView);</span><br><span class="line">        dividerThickness = ta.getDimension(R.styleable.PickerView_divider_thickness, getResources().getDisplayMetrics().density);</span><br><span class="line">        dividerMarginLeft = ta.getDimension(R.styleable.PickerView_divider_margin_left, <span class="number">0</span>);</span><br><span class="line">        dividerMarginRight = ta.getDimension(R.styleable.PickerView_divider_margin_right, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">int</span> dividerColor = ta.getColor(R.styleable.PickerView_divider_color, Color.LTGRAY);</span><br><span class="line">        ta.recycle();</span><br><span class="line"></span><br><span class="line">        dividerLinePaint = <span class="keyword">new</span> Paint();</span><br><span class="line">        dividerLinePaint.setColor(dividerColor);</span><br><span class="line">        dividerLinePaint.setStyle(Paint.Style.STROKE);</span><br><span class="line">        dividerLinePaint.setStrokeWidth(dividerThickness);</span><br><span class="line">        greyLayerPaint = <span class="keyword">new</span> Paint();</span><br><span class="line">        greyLayerPaint.setColor(<span class="number">0xb0ffffff</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAdapter</span><span class="params">(PickerAdapter adapter)</span> </span>&#123;</span><br><span class="line">        setAdapter(adapter, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAdapter</span><span class="params">(PickerAdapter adapter, <span class="keyword">int</span> initPos)</span> </span>&#123;</span><br><span class="line">        setAdapter(adapter, <span class="number">0</span>, initPos);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * set adapter and other two parameters.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> visibleCount count of visible items in the picker, must be odd numbers. </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> initPos position of the initially selected item, 0 means the first item would be selected.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAdapter</span><span class="params">(PickerAdapter adapter, <span class="keyword">int</span> visibleCount, <span class="keyword">int</span> initPos)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (adapter.getItemCount() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (visibleCount &gt; <span class="number">0</span> &amp;&amp; visibleCount % <span class="number">2</span> != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.visibleCount = visibleCount;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.adapter = adapter;</span><br><span class="line"></span><br><span class="line">        listView = <span class="keyword">new</span> ListView(getContext());</span><br><span class="line">        addView(listView, <span class="keyword">new</span> LinearLayout.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, (<span class="keyword">int</span>) (itemHeight * <span class="keyword">this</span>.visibleCount)));</span><br><span class="line">        listView.setOverScrollMode(View.OVER_SCROLL_NEVER);  <span class="comment">// remove over scroll effects.</span></span><br><span class="line">        listView.setVerticalScrollBarEnabled(<span class="keyword">false</span>);</span><br><span class="line">        listView.setDivider(<span class="keyword">null</span>);  <span class="comment">// remove listView's dividers</span></span><br><span class="line"></span><br><span class="line">        listView.setOnScrollListener(<span class="keyword">new</span> AbsListView.OnScrollListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScrollStateChanged</span><span class="params">(AbsListView view, <span class="keyword">int</span> scrollState)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (scrollState == AbsListView.OnScrollListener.SCROLL_STATE_IDLE) &#123;</span><br><span class="line">                    <span class="comment">// scroll to nearest place that fit the selection properly.</span></span><br><span class="line">                    scrollToNearest();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScroll</span><span class="params">(AbsListView view, <span class="keyword">int</span> firstVisibleItem, <span class="keyword">int</span> visibleItemCount, <span class="keyword">int</span> totalItemCount)</span> </span>&#123; &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        listView.setAdapter(<span class="keyword">new</span> InnerAdapter());</span><br><span class="line">        <span class="keyword">if</span> (initPos &gt; <span class="number">0</span> &amp;&amp; initPos &lt; adapter.getItemCount()) &#123;</span><br><span class="line">            listView.setSelection(initPos);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the position of the currently selected item, starting from 0.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSelectedPosition</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        listView.getFirstVisiblePosition();</span><br><span class="line">        View firstChild = listView.getChildAt(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (Math.abs(firstChild.getTop()) &lt; firstChild.getHeight() / <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> listView.getFirstVisiblePosition();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> listView.getFirstVisiblePosition() + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> superResult = <span class="keyword">super</span>.dispatchTouchEvent(ev);</span><br><span class="line">        </span><br><span class="line">        velocityTracker.addMovement(ev);</span><br><span class="line">        <span class="keyword">if</span> (ev.getActionMasked() == MotionEvent.ACTION_UP) &#123;</span><br><span class="line">            velocityTracker.computeCurrentVelocity(<span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">float</span> yVelocity = velocityTracker.getYVelocity();</span><br><span class="line">            <span class="comment">// scroll to nearest proper place directly if the fling is very slow</span></span><br><span class="line">            <span class="keyword">if</span> (Math.abs(yVelocity) &lt; velocityThreshold) &#123;</span><br><span class="line">                scrollToNearest();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> superResult;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** scroll the listView to fit the nearest proper position */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scrollToNearest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        View firstChild = listView.getChildAt(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (Math.abs(firstChild.getTop()) &gt; Math.abs(firstChild.getBottom())) &#123;</span><br><span class="line">            listView.smoothScrollToPosition(listView.getLastVisiblePosition());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            listView.smoothScrollToPosition(listView.getFirstVisiblePosition());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDetachedFromWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        velocityTracker.recycle();</span><br><span class="line">        <span class="keyword">super</span>.onDetachedFromWindow();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.draw(canvas);</span><br><span class="line">        <span class="comment">//canvas.drawRect(0, itemHeight * 2, getWidth(), itemHeight * 3, dividerLinePaint);</span></span><br><span class="line">        canvas.drawLine(dividerMarginLeft, itemHeight * <span class="number">2</span> - dividerThickness, </span><br><span class="line">                getWidth() - dividerMarginRight, itemHeight * <span class="number">2</span> - dividerThickness, dividerLinePaint);</span><br><span class="line">        canvas.drawLine(dividerMarginLeft, itemHeight * <span class="number">3</span> + dividerThickness, </span><br><span class="line">                getWidth() - dividerMarginRight, itemHeight * <span class="number">3</span> + dividerThickness, dividerLinePaint);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// draw two transparent rectangles to make not selected items looks grey</span></span><br><span class="line">        canvas.drawRect(<span class="number">0</span>, <span class="number">0</span>, getWidth(), itemHeight * <span class="number">2</span> - dividerThickness, greyLayerPaint);</span><br><span class="line">        canvas.drawRect(<span class="number">0</span>, getHeight() - <span class="number">2</span> * itemHeight + dividerThickness, getWidth(), getBottom(), greyLayerPaint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * the adapter for the listView</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">InnerAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="comment">// we would add visibleCount - 1 empty strings to the list View, so the count should plus visibleCount - 1.</span></span><br><span class="line">            <span class="keyword">return</span> adapter.getItemCount() + visibleCount - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// there're visibleCount - 1 items with empty text, they would be equally put at the starting and ending.</span></span><br><span class="line">            <span class="keyword">if</span> (position &lt; visibleCount / <span class="number">2</span> || position &gt;= getCount() - visibleCount / <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> adapter.getItemAt(position - visibleCount / <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getItemId</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> position;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (convertView == <span class="keyword">null</span>) &#123;</span><br><span class="line">                convertView = View.inflate(getContext(), adapter.getItemLayoutResource(), <span class="keyword">null</span>);</span><br><span class="line">                convertView.setBackgroundColor(Color.WHITE); <span class="comment">// to avoid the default touch effect of listView item</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// select a item when it's clicked by users</span></span><br><span class="line">            convertView.setOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">int</span> cur = getSelectedPosition() + visibleCount / <span class="number">2</span>;</span><br><span class="line">                    <span class="keyword">if</span> (position &gt; cur) &#123;</span><br><span class="line">                        listView.smoothScrollToPosition(position + visibleCount / <span class="number">2</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (position &lt; cur) &#123;</span><br><span class="line">                        listView.smoothScrollToPosition(position - visibleCount / <span class="number">2</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            TextView textView = convertView.findViewById(R.id.picker_text_view);</span><br><span class="line">            textView.setText((String) getItem(position));</span><br><span class="line">            <span class="keyword">return</span> convertView;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€äº›å°ç»†èŠ‚ã€‚æ¯”å¦‚ ListView çš„é«˜åº¦éœ€è¦æ­£å¥½æ˜¯ itemView çš„å¥‡æ•°å€ï¼Œè¿™æ ·æ‰èƒ½æ°å¥½åªæ˜¾ç¤ºä¸€äº› itemï¼Œå¹¶ä¸”æœ€ä¸­é—´æ˜¾ç¤ºå…¶ä¸­ä¸€ä¸ª itemã€‚å†æ¯”å¦‚ä¸ºäº†é¿å… ListView è‡ªå¸¦çš„ç‚¹å‡» item æ—¶çš„è§†è§‰æ•ˆæžœï¼Œéœ€è¦ç»™ itemView è®¾ç½®çº¯ç™½è‰²èƒŒæ™¯ã€‚</p><p>è‡³æ­¤ï¼Œä¸€ä¸ªç®€æ˜“çš„ PickerView å°±å®Œæˆäº†ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä¸€ä¸ªä¸ä¸€æ ·çš„ ANR</title>
      <link href="/2019/01/18/%E4%B8%80%E4%B8%AA%E4%B8%8D%E4%B8%80%E6%A0%B7%E7%9A%84%20ANR/"/>
      <url>/2019/01/18/%E4%B8%80%E4%B8%AA%E4%B8%8D%E4%B8%80%E6%A0%B7%E7%9A%84%20ANR/</url>
      <content type="html"><![CDATA[<p>æœ€è¿‘ç¢°åˆ°ä¸€ä¸ª ANR é—®é¢˜ï¼Œæ‹¿åˆ° traces æ–‡ä»¶åŽï¼Œæ˜¾ç¤ºä¸»çº¿ç¨‹çš„å †æ ˆæ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">at android<span class="selector-class">.os</span><span class="selector-class">.MessageQueue</span><span class="selector-class">.nativePollOnce</span>(Native method)</span><br><span class="line">at android<span class="selector-class">.os</span><span class="selector-class">.MessageQueue</span><span class="selector-class">.next</span>(MessageQueue<span class="selector-class">.java</span>:<span class="number">323</span>)</span><br><span class="line">at android<span class="selector-class">.os</span><span class="selector-class">.Looper</span><span class="selector-class">.loop</span>(Looper<span class="selector-class">.java</span>:<span class="number">135</span>)</span><br><span class="line">at android<span class="selector-class">.app</span><span class="selector-class">.ActivityThread</span><span class="selector-class">.main</span>(ActivityThread<span class="selector-class">.java</span>:<span class="number">5417</span>)</span><br><span class="line">at java<span class="selector-class">.lang</span><span class="selector-class">.reflect</span><span class="selector-class">.Method</span><span class="selector-class">.invoke</span>!(Native method)</span><br><span class="line">at com<span class="selector-class">.android</span><span class="selector-class">.internal</span><span class="selector-class">.os</span><span class="selector-class">.ZygoteInit</span><span class="variable">$MethodAndArgsCaller</span>.run(ZygoteInit<span class="selector-class">.java</span>:<span class="number">726</span>)</span><br><span class="line">at com<span class="selector-class">.android</span><span class="selector-class">.internal</span><span class="selector-class">.os</span><span class="selector-class">.ZygoteInit</span><span class="selector-class">.main</span>(ZygoteInit<span class="selector-class">.java</span>:<span class="number">616</span>)</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€æ®µå †æ ˆï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹è¡¨æ˜Žä¸»çº¿ç¨‹æ˜¯æ­£å¸¸çš„ï¼Œå³å¤„åœ¨ç­‰å¾…åŒºä¸‹ä¸€æ¡ä¸»çº¿ç¨‹æ¶ˆæ¯çš„è¿‡ç¨‹ä¸­ï¼Œè€Œä¸æ˜¯é™·åœ¨æŸä¸ªè€—æ—¶ç‰¹åˆ«é•¿çš„æ¶ˆæ¯ä¸­ã€‚</p><p>ç»è¿‡åå¤æµ‹è¯•ï¼Œæœ€åŽç¡®è®¤è¿™ä¸ª ANR å’Œè®¾ç½®äº† Default UncaughtExceptionHandler æœ‰å…³ï¼Œé—®é¢˜ä»£ç å¯ä»¥ç®€åŒ–æˆä¸‹é¢çš„æ ·å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        Thread.setDefaultUncaughtExceptionHandler(<span class="keyword">new</span> Thread.UncaughtExceptionHandler() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uncaughtException</span><span class="params">(<span class="keyword">final</span> Thread t, Throwable e)</span> </span>&#123;</span><br><span class="line">                Log.i(<span class="string">"uncaught"</span>, Thread.currentThread().toString());</span><br><span class="line">                Log.i(<span class="string">"uncaught"</span>, t.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Thread thread;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        findViewById(R.id.btn).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"hello world"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).start();</span><br><span class="line">                <span class="comment">//throw new RuntimeException("hello world!!");</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç çš„è¡¨çŽ°æ˜¯ï¼Œå¦‚æžœåªè®©ç¬¬ 26 è¡ŒæŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆä¸€åˆ‡çœ‹èµ·æ¥éƒ½æ­£å¸¸ï¼Œä½†æ˜¯å¦‚æžœè®©ç¬¬ 29 è¡ŒæŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆåº”ç”¨ç›´æŽ¥å°±æ— å“åº”äº†ã€‚</p><p>ç»è¿‡ä¸€ç•ªæŸ¥æ‰¾ä¸ŽéªŒè¯ï¼Œæˆ‘å‘çŽ°åŽŸå› å¤§è‡´æ˜¯ï¼Œå½“ä¸€ä¸ª Java çº¿ç¨‹æŠ›å‡ºäº†æœªæ•èŽ·çš„å¼‚å¸¸æ—¶ï¼ŒJVM å…ˆä¼šè°ƒç”¨åˆ° UncaughtExceptionHandlerï¼Œç„¶åŽå†ä¼šæŠŠæ­¤çº¿ç¨‹åœæ­¢æŽ‰ã€‚æ‰€ä»¥è¿™æ®µä»£ç ä¸­ï¼Œå¦‚æžœä¸»çº¿ç¨‹æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆç¬¬ 6 è¡Œçš„æ–¹æ³•ç»“æŸåŽï¼Œä¸»çº¿ç¨‹å°±ä¼šè¢« JVM ç»™åœæ­¢æŽ‰ï¼Œæ—¢ç„¶ä¸»çº¿ç¨‹éƒ½åœæ­¢æŽ‰äº†ï¼Œé‚£è‡ªç„¶å°±æ— å“åº”äº†ï¼Œä¹Ÿå°±ä¼šå‘ç”Ÿ ANR äº†ã€‚</p><p>äº‹å®žä¸Šï¼Œä¸€èˆ¬æˆ‘ä»¬è®¾ç½®è‡ªå®šä¹‰ UncaughtExceptionHandler æ—¶ï¼Œéƒ½ä¼šåœ¨è‡ªå®šä¹‰çš„ uncaughtException æ–¹æ³•æœ€åŽå†è°ƒç”¨ä¸€éè¢«æˆ‘ä»¬é¡¶æ›¿æŽ‰çš„ç³»ç»Ÿé»˜è®¤çš„ UncaughtExceptionHandlerï¼Œä»¥ä¾¿æŠŠåº”ç”¨ kill æŽ‰ï¼Œè€Œè¿™ä¸ªä¾‹å­ï¼Œå……åˆ†çš„æ˜¾ç¤ºäº†ï¼Œå½“æœªæ•èŽ·å¼‚å¸¸å‘ç”ŸåŽï¼Œå°±ç®—èµ–ç€ä¸ kill æŽ‰åº”ç”¨ä¹Ÿæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºå¯èƒ½ä¸»çº¿ç¨‹éƒ½å·²ç»è¢«åœæŽ‰äº†ã€‚</p><p>å…³äºŽ JVM å…ˆè°ƒç”¨ UncaughtExceptionHandler ç„¶åŽæŠŠå‘ç”Ÿæœªæ•èŽ·å¼‚å¸¸çš„çº¿ç¨‹åœæ­¢æŽ‰çš„è¯´æ³•ï¼Œè§äºŽ <a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-11.html#jls-11.3" target="_blank" rel="noopener">Java Language Specification 11.3</a>ï¼Œå¦‚ä¸‹æ‰€ç¤ºçš„ç‰‡æ®µï¼š</p><p><img src="http://tao93.top/images/2019/01/18/1547816082.png" alt=""></p><p>é‚£ä¹ˆä¸»çº¿ç¨‹è¢«åœæ­¢æŽ‰ï¼Œæ˜¯ä¸ªä»€ä¹ˆæ ·çš„çŠ¶æ€å‘¢ï¼Œæˆ‘ç”¨ä¸‹é¢çš„ä»£ç ï¼ŒæŠŠä¸»çº¿ç¨‹çš„çŠ¶æ€ç»™è¾“å‡ºæ¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        Thread.setDefaultUncaughtExceptionHandler(<span class="keyword">new</span> Thread.UncaughtExceptionHandler() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uncaughtException</span><span class="params">(<span class="keyword">final</span> Thread t, Throwable e)</span> </span>&#123;</span><br><span class="line">                Log.i(<span class="string">"uncaught"</span>, Thread.currentThread().toString());</span><br><span class="line">                Log.i(<span class="string">"uncaught"</span>, t.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Thread thread;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        findViewById(R.id.btn).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">final</span> Thread mainThread = Thread.currentThread();</span><br><span class="line">                Log.i(<span class="string">"&lt;&lt;&lt;"</span>, mainThread.getState().toString());</span><br><span class="line">                <span class="keyword">if</span> (thread == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    thread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i) &#123;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                                    e.printStackTrace();</span><br><span class="line">                                &#125;</span><br><span class="line">                                Log.i(<span class="string">"&lt;&lt;&lt;"</span>, mainThread.getState().toString());</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    thread.start();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"hello world!!"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„ç¬¬ 24 è¡Œå’Œç¬¬ 35 è¡Œä¸€å…±ä¼š 4 æ­¤è¾“å‡ºä¸»çº¿ç¨‹çš„çŠ¶æ€ï¼Œç»“æžœå¦‚ä¸‹é¢æ‰€ç¤ºï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">01<span class="selector-tag">-18</span> 21<span class="selector-pseudo">:00</span><span class="selector-pseudo">:24.308</span> 14533 14533 <span class="selector-tag">I</span> &lt;&lt;&lt;     : <span class="selector-tag">RUNNABLE</span></span><br><span class="line">01<span class="selector-tag">-18</span> 21<span class="selector-pseudo">:00</span><span class="selector-pseudo">:25.309</span> 14533 14570 <span class="selector-tag">I</span> &lt;&lt;&lt;     : <span class="selector-tag">NEW</span></span><br><span class="line">01<span class="selector-tag">-18</span> 21<span class="selector-pseudo">:00</span><span class="selector-pseudo">:26.310</span> 14533 14570 <span class="selector-tag">I</span> &lt;&lt;&lt;     : <span class="selector-tag">NEW</span></span><br><span class="line">01<span class="selector-tag">-18</span> 21<span class="selector-pseudo">:00</span><span class="selector-pseudo">:27.311</span> 14533 14570 <span class="selector-tag">I</span> &lt;&lt;&lt;     : <span class="selector-tag">NEW</span></span><br></pre></td></tr></table></figure><p>ä»Žä¸Šé¢ä»£ç å¯çŸ¥ï¼Œä¸»çº¿ç¨‹ä»Ž RUNNABLE çŠ¶æ€å˜æˆäº† NEW çŠ¶æ€ï¼Œä¸ºä»€ä¹ˆæ˜¯ NEW çŠ¶æ€ï¼Œæˆ‘ä¹Ÿä¸æ¸…æ¥šï¼Œä¹Ÿè®¸å°†æ¥å¯¹ JVM äº†è§£æ›´å¤šäº†ï¼Œä¼šæ¸…é™¤å§ã€‚</p><p>å›žåˆ°è¿™ä¸ª ANR æ¥ï¼Œè¿™ä¸ªä¾‹å­è¯´æ˜Žï¼Œæˆ‘ä»¬å¦‚æžœä½¿ç”¨è‡ªå®šä¹‰çš„ UncaughtExceptionHandlerï¼Œè®°å¾—è¦æŠŠåº”ç”¨ kill æŽ‰ï¼Œè¿˜æœ‰ default çš„ UncaughtExceptionHandler æ˜¯å…¨å±€å…¬ç”¨çš„ï¼Œå¾ˆå®¹æ˜“ä¼šå‡ºçŽ°è¢«é¡¶æ›¿ (è¦†ç›–)ï¼Œæ‰€ä»¥åˆ‡è®°åˆ«éšæ„è°ƒç”¨ï¼Œå…å¾—å‡ºçŽ°æ„æ–™ä¹‹å¤–çš„é—®é¢˜ã€‚</p><p>ä¿®å¤è¿™æ ·çš„ ANRï¼Œåˆ†æˆä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯å…ˆç§»é™¤æˆ–è€…ä¿®æ”¹ä¸æ°å½“çš„è®¾ç½® UncaughtExceptionHandler çš„ä»£ç ï¼Œå…ˆæ¶ˆé™¤ ANRï¼Œç„¶åŽè¿˜éœ€è¦æŠŠå¼•å‘ ANR çš„å¦ä¸€ä¸ªåŽŸå› ï¼Œä¹Ÿå°±æ˜¯æœªæ•èŽ·çš„å¼‚å¸¸ç»™ä¿®å¤æŽ‰ï¼Œä¸ç„¶åº”ç”¨ä¸ä¼š ANR äº†ä½†æ˜¯ä¼š Crashã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Android ç»˜åˆ¶åœ†å½¢å›¾ç‰‡</title>
      <link href="/2019/01/12/Android%20%E7%BB%98%E5%88%B6%E5%9C%86%E5%BD%A2%E5%9B%BE%E7%89%87/"/>
      <url>/2019/01/12/Android%20%E7%BB%98%E5%88%B6%E5%9C%86%E5%BD%A2%E5%9B%BE%E7%89%87/</url>
      <content type="html"><![CDATA[<p>è®°å½•ä¸€ä¸‹ï¼Œä»¥å…å¿˜è®°ï¼Œä»¥å¤‡ä½¿ç”¨ã€‚</p><p>æ–¹æ³•ä¸€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Paint paint = <span class="keyword">new</span> Paint();</span><br><span class="line">    Shader shader;</span><br><span class="line">    Matrix mat = <span class="keyword">new</span> Matrix();</span><br><span class="line">    Bitmap bitmap;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView</span><span class="params">(Context context, @Nullable AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView</span><span class="params">(Context context, @Nullable AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// create a bitmap from the image resource what we want to draw</span></span><br><span class="line">        bitmap = BitmapFactory.decodeResource(getResources(), R.drawable.dossier_icon);</span><br><span class="line">        <span class="comment">// a bitmap shader, would be set into paint, here we use repeat tile mode, but since we'll</span></span><br><span class="line">        <span class="comment">// scale to make the bitmap fill the canvas just right, so there would be no repeat.</span></span><br><span class="line">        shader = <span class="keyword">new</span> BitmapShader(bitmap, Shader.TileMode.REPEAT, Shader.TileMode.REPEAT);</span><br><span class="line">        <span class="comment">// after this, the paint would contains this bitmap.</span></span><br><span class="line">        paint.setShader(shader);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> left, <span class="keyword">int</span> top, <span class="keyword">int</span> right, <span class="keyword">int</span> bottom)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onLayout(changed, left, top, right, bottom);</span><br><span class="line">        <span class="comment">// scale to make bitmap fill the canvas</span></span><br><span class="line">        mat.setScale((<span class="keyword">float</span>)getWidth() / bitmap.getWidth(), (<span class="keyword">float</span>)getHeight() / bitmap.getHeight());</span><br><span class="line">        shader.setLocalMatrix(mat);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(canvas);</span><br><span class="line">        <span class="comment">// draw a circle with the paint.</span></span><br><span class="line">        canvas.drawCircle(getWidth() / <span class="number">2</span>, getHeight() / <span class="number">2</span>, getWidth() / <span class="number">2</span>, paint);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•äºŒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyView2</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Path mPath;</span><br><span class="line">    <span class="keyword">private</span> Drawable mDrawable;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView2</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView2</span><span class="params">(Context context, @Nullable AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView2</span><span class="params">(Context context, @Nullable AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        mPath = <span class="keyword">new</span> Path();</span><br><span class="line">        mDrawable = getResources().getDrawable(R.drawable.dossier_icon);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> left, <span class="keyword">int</span> top, <span class="keyword">int</span> right, <span class="keyword">int</span> bottom)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onLayout(changed, left, top, right, bottom);</span><br><span class="line">        <span class="comment">// make the path to be a circle whose diameter is width of the view.</span></span><br><span class="line">        mPath.reset();</span><br><span class="line">        mPath.addCircle(getWidth() / <span class="number">2</span>, getHeight() / <span class="number">2</span>, getWidth() / <span class="number">2</span>, Path.Direction.CW);</span><br><span class="line">        <span class="comment">// drawable must setBounds before draw</span></span><br><span class="line">        mDrawable.setBounds(<span class="number">0</span>, <span class="number">0</span>, getWidth(), getHeight());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(canvas);</span><br><span class="line">        <span class="comment">// save current (default) clip</span></span><br><span class="line">        canvas.save();</span><br><span class="line">        <span class="comment">// make the clip to be the circle </span></span><br><span class="line">        canvas.clipPath(mPath);</span><br><span class="line">        <span class="comment">// draw the bitmapDrawable</span></span><br><span class="line">        mDrawable.draw(canvas);</span><br><span class="line">        <span class="comment">// restore default clip</span></span><br><span class="line">        canvas.restore();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•ä¸‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyView3</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">    Paint mPaint = <span class="keyword">new</span> Paint();</span><br><span class="line">    Paint whitePaint = <span class="keyword">new</span> Paint();</span><br><span class="line">    <span class="keyword">private</span> Bitmap bitmap;</span><br><span class="line">    <span class="keyword">private</span> Matrix mat = <span class="keyword">new</span> Matrix();</span><br><span class="line">    <span class="keyword">private</span> Xfermode mXfermode;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView3</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView3</span><span class="params">(Context context, @Nullable AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView3</span><span class="params">(Context context, @Nullable AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        mXfermode = <span class="keyword">new</span> PorterDuffXfermode(PorterDuff.Mode.SRC_IN);</span><br><span class="line">        whitePaint.setColor(Color.RED);</span><br><span class="line">        bitmap = BitmapFactory.decodeResource(getResources(), R.drawable.dossier_icon);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> left, <span class="keyword">int</span> top, <span class="keyword">int</span> right, <span class="keyword">int</span> bottom)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onLayout(changed, left, top, right, bottom);</span><br><span class="line">        mat.setScale((<span class="keyword">float</span>)getWidth() / bitmap.getWidth(), (<span class="keyword">float</span>)getHeight() / bitmap.getHeight());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(canvas);</span><br><span class="line">        <span class="comment">// save current layer and create a new layer</span></span><br><span class="line">        <span class="keyword">int</span> count = canvas.saveLayer(<span class="number">0</span>, <span class="number">0</span>, getWidth(), getHeight(), mPaint);</span><br><span class="line">        <span class="comment">// draw a white circle in the new layer</span></span><br><span class="line">        canvas.drawCircle(getWidth() / <span class="number">2</span>, getHeight() / <span class="number">2</span>, getWidth() / <span class="number">2</span>, whitePaint);</span><br><span class="line">        <span class="comment">// this xfer mode is src_in type, which could make image to be drawn in only previous white circle area.</span></span><br><span class="line">        mPaint.setXfermode(mXfermode);</span><br><span class="line">        <span class="comment">// draw bitmap in new layer</span></span><br><span class="line">        canvas.drawBitmap(bitmap, mat, mPaint);</span><br><span class="line">        <span class="comment">// this is necessary, or the influence would last</span></span><br><span class="line">        mPaint.setXfermode(<span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">// back to previous layer.</span></span><br><span class="line">        canvas.restoreToCount(count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‰ä¸ªæ–¹æ³•ä¸­ï¼Œæ–¹æ³•äºŒæœ€ç®€ä¾¿æ˜“ç”¨ï¼Œæ–¹æ³•ä¸‰æœ€ä¸æŽ¨èï¼Œå› ä¸ºæ–°å¢žä¸€ä¸ª canvas layer æ˜¯å¼€é”€å¾ˆå¤§çš„ï¼Œè¿™ä¸€ç‚¹ saveLayerAlpha æ–¹æ³•çš„æ³¨é‡Šæœ‰è¯´æ˜Žã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ç»™ä¸‰æ˜Ÿ tablet SM-T830 åˆ·æœº[ç»­]</title>
      <link href="/2019/01/01/%E7%BB%99%E4%B8%89%E6%98%9F%20tablet%20SM-T830%20%E5%88%B7%E6%9C%BA%5B%E7%BB%AD%5D/"/>
      <url>/2019/01/01/%E7%BB%99%E4%B8%89%E6%98%9F%20tablet%20SM-T830%20%E5%88%B7%E6%9C%BA%5B%E7%BB%AD%5D/</url>
      <content type="html"><![CDATA[<p>äº‹æƒ…çš„èµ·å› æ˜¯ï¼Œä»Ž xda ä¸Šé¢<a href="https://forum.xda-developers.com/galaxy-tab-s4/help/lineage-development-t3852509" target="_blank" rel="noopener">è¿™ä¸ªå¸–å­</a> çœ‹åˆ°ï¼Œæœ‰äººåœ¨ä¸‰æ˜Ÿ Tab S4 å¹³æ¿ä¸Šé¢åˆ·äº†ä¸ªç±»åŽŸç”Ÿ Android çš„ç³»ç»Ÿï¼Œä»–è¡¨ç¤ºç”¨èµ·æ¥æŒºå¥½ï¼Œåªä¸è¿‡ 4 ä¸ªæ‰¬å£°å™¨åªæœ‰åº•éƒ¨ä¸¤ä¸ªå¯ä»¥å‘å£°ã€‚çœ‹åˆ°è¿™ä¸ªæˆ‘å¿ƒé‡Œå°±ç—’ç—’ï¼Œå› ä¸ºä¸‰æ˜Ÿçš„å®˜æ–¹ rom æˆ‘å¹¶ä¸å–œæ¬¢ï¼Œé‡Œé¢æœ‰ä¸‰æ˜Ÿçš„ app storeï¼Œè¿˜æœ‰ä¸‰æ˜Ÿçš„ä¸€å¥—è´¦æˆ·ç³»ç»Ÿï¼Œè°ƒè¯•åˆ°ç³»ç»Ÿä»£ç çš„æ—¶å€™ï¼Œè¡Œå·ä¹Ÿå®Œå…¨å¯¹ä¸ä¸Š(Pixelæ˜¯å¯ä»¥å¯¹ä¸Šè¡Œå·çš„)ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿæƒ³ç»™æ‰‹é‡Œçš„ Tab S4 å¹³æ¿åˆ·ä¸€ä¸ªç±»åŽŸç”Ÿç³»ç»Ÿã€‚</p><p>ç„¶åŽæˆ‘å°±åœ¨ xda ä¸Šé¢æŸ¥äº†æŸ¥ï¼Œå‘çŽ°æˆ‘åº”è¯¥éœ€è¦å…ˆåˆ·å…¥ä¸€ä¸ª TWRP recoveryï¼Œç„¶åŽå†ä½¿ç”¨ TWRP åˆ·å…¥ç±»åŽŸç”Ÿç³»ç»Ÿã€‚å¦å¤–æˆ‘ä¹Ÿæ³¨æ„åˆ°ï¼Œä¹‹æ‰€ä»¥èƒ½åˆ·å¹¶æ²¡æœ‰é€‚é… Tab S4 çš„ ROMï¼Œå¾—å½’åŠŸäºŽ Project Trableã€‚è°·æ­Œæå‡º Project Trable æ˜¯ä¸ºäº†è®© Android ç³»ç»Ÿçš„å¼€å‘å’Œåº•å±‚é©±åŠ¨çš„å¼€å‘åˆ†ç¦»å¼€ï¼Œä¸¤è€…åªè¦æ»¡è¶³åè®®ï¼Œå°±å¯ä»¥ç»„åˆåœ¨ä¸€èµ·ï¼Œè¿™æ ·å°±å¯å‡å° Android ç³»ç»Ÿå‡çº§æ—¶åŽ‚å•†å¼€å‘é©±åŠ¨çš„å·¥ä½œï¼Œä»Žè€Œè®©è®¾å¤‡æ›´å¿«å‡çº§ Android ç³»ç»Ÿã€‚Project Trable ä¹Ÿä½¿å¾—é‚£äº›ç¬¦åˆè¦æ±‚çš„è®¾å¤‡ï¼Œå¯ä»¥åˆ·å¤§é‡æ»¡è¶³ Project Trable è¦æ±‚çš„ General System Image (GSI)ã€‚Tab S4 å°±æ˜¯ç¬¦åˆ Project Trable è¦æ±‚çš„ï¼Œæ‰€ä»¥æˆ‘å°±æ˜¯è¦ç»™å®ƒåˆ· GSIã€‚</p><p>å›žåˆ°å‰é¢è¯´çš„ TWRP çš„äº‹æƒ…ï¼ŒTWRP å®˜æ–¹å¹¶æ²¡æœ‰é€‚é… Tab S4 çš„ç‰ˆæœ¬ï¼Œä¸è¿‡æˆ‘åœ¨<a href="https://forum.xda-developers.com/galaxy-tab-s4/development/recovery-twrp-3-2-3-1-galaxy-tab-s4-t3843211" target="_blank" rel="noopener">è¿™ä¸ªå¸–å­</a>é‡Œé¢å‘çŽ°äº†ç”¨äºŽ Tab S4 çš„éžå®˜æ–¹ TWRPï¼Œå¹¶å†™å‡ºäº†æ­¥éª¤ï¼š</p><ol><li>ç¡®è®¤ OEM å·²è§£é”ï¼›</li><li>è®¾å¤‡è¿›å…¥ download æ¨¡å¼ï¼›</li><li>ä½¿ç”¨ odin çš„ AP slot æ¥åˆ·å…¥ TWRP åŽ‹ç¼©åŒ…ï¼Œè®°å¾—è¦å–æ¶ˆå‹¾é€‰ã€ŒAuto Rebootã€;</li><li>å…³æœºï¼Œç„¶åŽå†è¿›å…¥ TWRPï¼›</li><li>è¿›å…¥ TWRPï¼Œç„¶åŽåˆ·å…¥ Forced encryption disabler patchï¼Œformat DATA ä¸€ä¸‹ï¼›</li><li>è¿›å…¥ TWRPï¼Œåˆ·å…¥ Magisk åŽ‹ç¼©åŒ…ï¼ŒäºŽæ˜¯è®¾å¤‡å°± root äº†ã€‚</li></ol><p>æ­¥éª¤å…¶å®žå¾ˆç®€å•ï¼Œä¸è¿‡æˆ‘åœ¨è¿™é‡ŒæŠ˜è…¾äº† 3 å¤©ã€‚æˆ‘å…ˆæŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤æ¥ï¼Œç»“æžœå‘çŽ°è¿› TWRP åŽå°±æ— æ³•è®¿é—® internal storageï¼Œè‡ªç„¶å°±åˆ·ä¸äº† Forced encryption disabler patchã€‚æˆ‘è¯•äº†éžå¸¸å¤šæƒ³æ³•ï¼Œæ¯”å¦‚é‡åˆ·ä¸‰æ˜Ÿå®˜æ–¹å›ºä»¶ï¼Œåˆ·æ›´æ—§çš„å®˜æ–¹å›ºä»¶(åŽŸå› æ˜¯è¿™ä¸ªå¸–å­é‡Œé¢å·¥å…·å‘å‡ºæ¥æ—¶ï¼Œå®˜æ–¹å›ºä»¶è¿˜æ›´æ—§ä¸€äº›ï¼Œè€Œæˆ‘çœ‹åˆ°è¿™å¸–å­æ—¶å·²ç»æ›´æ–°åˆ°æ¯”è¾ƒæ–°äº†)ï¼Œåˆ·å›½è¡Œçš„å®˜æ–¹å›ºä»¶ï¼Œéƒ½ä¸è¡Œï¼Œå…¶ä¸­åˆ·æ›´ä½Žç‰ˆæœ¬çš„å›ºä»¶è¿˜æœ‰é™åˆ¶å³ BootLoader ä¸èƒ½é™çº§ï¼Œæ‰€ä»¥å…¶å®žå®˜æ–¹å›ºä»¶é™ä¸äº†å¤šå°‘çº§ã€‚æˆ‘è¿˜çœ‹åˆ°äº†<a href="https://www.thecustomdroid.com/install-twrp-samsung-galaxy-tab-s4-root-guide/" target="_blank" rel="noopener">è¿™ç§å¸–å­</a>ï¼Œé‡Œé¢å‘Šè¯‰æˆ‘è¯´ï¼Œéœ€è¦å…ˆåˆ·ä¸€ä¸ª DM-Verity patched bootï¼Œæˆ‘ä¹Ÿè¯•äº†ï¼Œå‘çŽ°åˆ·å®Œè¿™ä¸ª DM-Verity patched boot åŽç›´æŽ¥æ— æ³•è¿›å…¥ç³»ç»Ÿï¼ŒæŠ¥ Verification Failed é”™è¯¯ï¼Œå¿…é¡»é‡ç½®è®¾å¤‡æ‰è¡Œã€‚ç¿»é xda é‚£ä¸ª 40 å‡ é¡µçš„å¸–å­åŽï¼Œæˆ‘å‘çŽ°å…¶å®žè¿™ä¸ªå¸–å­å°±æ˜¯æŠ„ xda é‚£ä¸ªå¸–å­ï¼Œåªä¸è¿‡æŠ„çš„æ—¶å€™ï¼Œxda å¸–å­ä¸Šé¢çš„æ­¥éª¤ç¡®å®žç¬¬ä¸€æ­¥æ˜¯åˆ· DM-Verity patched bootï¼Œä¸è¿‡åŽæ¥ xda å¸–å­æ­¥éª¤æ›´æ–°äº†ï¼Œæˆäº†çŽ°åœ¨è¿™æ ·çš„ã€‚</p><p>ä¸æ˜¯æ— æ³•è®¿é—® internal storage å˜›ï¼ŒåŽæ¥æˆ‘ä¹°äº†ä¸ª micro SD å¡ï¼Œæ’è¿›è®¾å¤‡ï¼Œåœ¨ TWRP ä¸­è¿™ä¸ª micro SD æ˜¯å¯ä»¥è®¿é—®çš„ï¼Œæ‰€ä»¥æˆ‘å°±å¯ä»¥ç»§ç»­åˆ·å…¥ Forced encryption disabler patch å¹¶ format DATAï¼Œç„¶åŽæˆ‘å°± boot loop äº†ï¼ŒçœŸæ°”äººã€‚å³ä½¿æˆ‘å†åˆ·å…¥ GSIï¼Œä¾ç„¶æ˜¯ boot loopã€‚</p><p>åŽæ¥é‚£ä¸ª xda å¸–å­çš„ä½œè€…å›žå¤æˆ‘è¯´ã€Œå…¨ç¨‹æ²¡çœ‹åˆ°æˆ‘åˆ· Magisk çš„æè¿°ï¼Œä½† Magisk æ˜¯å¿…è¦çš„ï¼Œå¦åˆ™ä¼š boot loopã€ã€‚æˆ‘ç¡®å®žæ²¡åˆ· Magiskï¼Œå› ä¸ºæˆ‘å¹¶æ²¡æœ‰åƒ rootï¼Œæˆ‘åªæƒ³æžä¸ª TWRP ç„¶åŽåˆ· GSI è€Œå·²ã€‚äºŽæ˜¯æˆ‘å°±åˆ·äº† Magiskï¼Œå‘çŽ°ä¸åœ¨ boot loop äº†ï¼Œç„¶åŽå†<a href="https://github.com/phhusson/treble_experimentations/releases/tag/v108" target="_blank" rel="noopener">è¿™é‡Œ</a> ä¸‹è½½äº† system-arm64-aonly-gapps-su.img.xz è¿™ä¸ª GSI å¹¶åˆ·å…¥ï¼Œè¿™æ¬¡ç»ˆäºŽæˆåŠŸäº†ï¼Œè¿›å…¥äº†ä¸€ä¸ªç±»ä¼¼ AOSP user-debug ç±»åž‹çš„ aosp ç³»ç»Ÿï¼Œå¾ˆç®€é™‹ï¼Œè¿ž Contactï¼ŒSettingsï¼Œç­‰è¿™äº›åº”ç”¨éƒ½æ˜¯ aosp ç‰ˆæœ¬çš„ï¼Œå’Œæ­£å¸¸çš„å¾ˆä¸ä¸€æ ·ï¼Œç›¸æœºåº”ç”¨åˆ™ç›´æŽ¥æ‰“å¼€å°± crashã€‚é¡ºä¾¿è®°å½•ä¸€ä¸‹ TWRP åˆ· GSI çš„æ–¹æ³•ï¼Œå¾ˆç®€å•ï¼š</p><ol><li>è¿›å…¥ TWRPï¼Œwipe ä¸€ä¸‹ï¼›</li><li>è¿›å…¥ installï¼Œåˆ‡æ¢åˆ° install image æ¨¡å¼ï¼Œæ‰¾åˆ° GSIï¼›</li><li>partition é€‰æ‹© system imageï¼Œflashï¼›</li><li>é‡å¯</li></ol><p>å…³é”®æ˜¯ï¼Œè¿™ä¸ª aosp ç³»ç»Ÿæœ‰äº› bugï¼Œæœ€å—ä¸äº†çš„ bug æ˜¯ï¼Œé”å±ã€æ—‹è½¬æ—¶å±å¹•éƒ½ä¼šå˜å½¢ä¸€ä¸‹ï¼Œæˆªå±å¾—åˆ°çš„å›¾ç‰‡ä¹Ÿæ˜¯ä¼šå˜å½¢ä¸€ä¸‹ã€‚è¿™å’Œæˆ‘æœ€åˆçœ‹åˆ°çš„ xda å¸–å­é‡Œé¢é‚£äººè¯´çš„åªæ˜¯æ‰¬å£°å™¨æ²¡æœ‰å…¨éƒ¨å‘å£°å·®è¿œäº†ã€‚æ‰€ä»¥æˆ‘å°±æƒ³æ‰¾æ›´å¥½äº›çš„ GSIã€‚é—®äº†é‚£ä¸ªäººï¼Œç»“æžœæ²¡å›žå¤æˆ‘ã€‚</p><p>æœ€åŽæ‰¾åˆ°äº† <a href="https://forum.xda-developers.com/project-treble/trebleenabled-device-development/9-0-pixelexperience-p-t3833294" target="_blank" rel="noopener">Pixel Experience</a> ï¼Œè™½ç„¶ä¾ç„¶æœ‰ä¸€äº› bugï¼Œä¸è¿‡æ„Ÿè§‰è¿˜å¯ä»¥ã€‚</p><p>æ”¾å‡ å¼ æˆªå›¾ï¼š</p><p><img src="http://tao93.top/images/2019/01/01/1546351524.png" alt=""></p><p>æœ€åŽè¿˜æœ‰ä¸€ç‚¹ï¼Œè¿™æ¬¡æˆ‘æ˜¯ç”¨ Virtual Box ä¸­çš„ Win 10 è™šæ‹Ÿæœºåˆ·çš„ï¼Œè®© VirtualBox ä¸­çš„ Win 10 è™šæ‹Ÿæœºè¿žæŽ¥ä¸Š Android è®¾å¤‡ï¼Œéœ€è¦ç»™ VirtualBox å®‰è£… extension packï¼Œåœ¨ Win 10 è™šæ‹Ÿæœºä¸­å®‰è£… guest additionsï¼Œç„¶åŽè¿˜éœ€è¦åœ¨æ­¤ win 10 è™šæ‹Ÿæœºçš„è®¾ç½®ä¸­æ·»åŠ å¯¹åº”çš„ USB filter (éœ€è¦è®¾å¤‡è¿žæŽ¥ä¸ŠåŽæ‰èƒ½æ·»åŠ )ï¼Œå¹¶æŒ‰ç…§ USB ç±»åž‹å‹¾é€‰ USB 2.0 è¿˜æ˜¯ 3.0ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://tao93.top/images/2019/01/01/1546352547.png" alt=""></p><p>æœ€åŽï¼Œåœ¨è®¾å¤‡è¿žæŽ¥ä¸Šç”µè„‘åŽï¼ŒæŠŠ win 10 çš„çª—å£æ”¾åœ¨æœ€å‰é¢ï¼Œç„¶åŽå† macOS çš„èœå•æ å‹¾é€‰å¯¹åº”çš„ USB deviceï¼Œå‹¾é€‰çš„è¯ï¼Œå°±æ˜¯ win 10 è™šæ‹Ÿæœºè¿žæŽ¥è¯ USB è®¾å¤‡ï¼Œå¦åˆ™é©¾é©¶ macOS è¿žæŽ¥æ­¤ USB deviceï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="http://tao93.top/images/2019/01/01/1546353760.png" alt=""></p><p><strong>2019 å¹´ 5 æœˆ 29 æ—¥æ›´æ–°</strong></p><p>æœ€è¿‘å¾—çŸ¥ä¸‰æ˜Ÿå·²ç»ç»™ä¸€äº›è®¾å¤‡æŽ¨é€äº† Android Pie çš„æ›´æ–°ï¼Œè€Œç»„é‡Œé¢å‡ éƒ¨ Tab S4 éƒ½æ˜¯è¿è¡Œå›½å†…ç‰ˆç³»ç»Ÿçš„å›½è¡Œæœºå™¨ï¼Œæ‰€ä»¥æ²¡æœ‰æ”¶åˆ°æ›´æ–°é€šçŸ¥ï¼Œæ‰€ä»¥æˆ‘å°±æœ‰äº†æŠŠæˆ‘æ‰‹é‡Œçš„ Tab S4 åˆ·å›žåŸºäºŽ Android Pie çš„å›½å¤–ç‰ˆä¸‰æ˜Ÿç³»ç»Ÿã€‚</p><p>æ­¥éª¤å¾ˆç®€å•ï¼Œå…ˆç”¨ SamFirm tool ä¸‹è½½åŸºäºŽ Android Pie çš„ stock firmware åŒ…ï¼Œç„¶åŽè®¾å¤‡å…ˆè¿›å…¥ TWRP recovery (æˆ‘ä¹‹å‰åˆ·äº† TWRPï¼Œæ‰€ä»¥æœ‰è¿™ä¸ª)ï¼Œç„¶åŽç‚¹ Reboot å†ç‚¹ Download å³å¯è¿›å…¥ä¸‰æ˜Ÿè®¾å¤‡çš„ Download æ¨¡å¼ï¼Œç„¶åŽå°±æ˜¯å¾ˆç®€å•åœ°ä½¿ç”¨ odin å·¥å…·æŠŠç³»ç»Ÿåˆ·è¿›åŽ»å°±å¥½äº†ã€‚</p><p>æ³¨æ„ Download æ¨¡å¼å’Œ Recovery æ˜¯ä¸ä¸€æ ·çš„ã€‚TWRP æ˜¯ custom recoveryï¼Œè€Œä¸‰æ˜Ÿè‡ªå¸¦çš„ recovery æ˜¯ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„:</p><p><img src="http://tao93.top/images/2019/05/29/1559062868.png" alt=""></p><p>å³ä½¿ç”¨ TWRP å–ä»£äº†è‡ªå¸¦çš„ Recoveryï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥è¿›å…¥ Download æ¨¡å¼ï¼Œä»Žè€Œç”¨ odin åˆ·å›žåˆ°å®˜æ–¹ firmwareã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> GSI </tag>
            
            <tag> Project Treble </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Android Toast ä¸¤ä¸ª Crash</title>
      <link href="/2018/12/22/Android%20Toast%20%E4%B8%A4%E4%B8%AA%20Crash/"/>
      <url>/2018/12/22/Android%20Toast%20%E4%B8%A4%E4%B8%AA%20Crash/</url>
      <content type="html"><![CDATA[<p>Toast æ˜¯ Android ç³»ç»Ÿä¸€ç§éžå¸¸ç®€å•çš„æç¤ºæ€§å°å·¥å…·ï¼Œæœ€è¿‘æˆ‘å°è¯•ä¿®å¤ Toast ç›¸å…³çš„ä¸¤ç§ Crashï¼Œæ‰€ä»¥æŠŠç›¸å…³çš„åŽŸå§”å’Œè¿‡ç¨‹è®°å½•äº†ä¸‹æ¥ã€‚å…ˆæ¥çœ‹ä¸€ä¸‹ç¬¬ä¸€ç§ Crash çš„ log:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">android.view.WindowManager$BadTokenException: Unable to add window -- token android.os.BinderProxy<span class="meta">@e</span>2815e is not valid; is your activity running?</span><br><span class="line">        at android.view.ViewRootImpl.setView(ViewRootImpl.java:<span class="number">679</span>)</span><br><span class="line">        at android.view.WindowManagerGlobal.addView(WindowManagerGlobal.java:<span class="number">342</span>)</span><br><span class="line">        at android.view.WindowManagerImpl.addView(WindowManagerImpl.java:<span class="number">93</span>)</span><br><span class="line">        at android.widget.Toast$TN.handleShow(Toast.java:<span class="number">459</span>)</span><br><span class="line">        at android.widget.Toast$TN$<span class="number">2</span>.handleMessage(Toast.java:<span class="number">342</span>)</span><br><span class="line">        at android.os.Handler.dispatchMessage(Handler.java:<span class="number">102</span>)</span><br><span class="line">        at android.os.Looper.loop(Looper.java:<span class="number">154</span>)</span><br><span class="line">        at android.app.ActivityThread.main(ActivityThread.java:<span class="number">6119</span>)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Native Method)</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ stack trace ä¸­çš„ä»£ç å…¨éƒ¨æ˜¯å…³äºŽ UI çº¿ç¨‹ä¸­å¤„ç†ä¸€ä¸ªæ¶ˆæ¯çš„ï¼Œè¿™ä¸ªæ¶ˆæ¯éœ€è¦åšçš„æ˜¯æŠŠ Toast éœ€è¦æ˜¾ç¤ºçš„ view æ·»åŠ åˆ° WindowManager ä¸­ï¼Œä»Žè€Œå¯ä»¥æ˜¾ç¤ºå‡ºæ¥ã€‚è¿™æ ·çš„ crash æ˜¯æ²¡æœ‰ä»»ä½• app ä»£ç ç‰µæ¶‰å…¶ä¸­çš„ï¼Œæ‰€ä»¥æ— æ³•ç¡®å®šæ˜¯ app ä½•å¤„çš„ä»£ç å¯¼è‡´çš„è¿™ä¸ª crashã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ Toast æ˜¾ç¤ºçš„å¤§è‡´è¿‡ç¨‹ã€‚</p><p>é¦–å…ˆæ˜¯é€šè¿‡ <code>Toast#makeText</code> æ–¹æ³•æˆ–è€… <code>Toast</code> æž„é€ å‡½æ•°åˆ›å»º Toast å¯¹è±¡ï¼Œç„¶åŽå°±å¯ä»¥è°ƒç”¨å®ƒçš„ show æ–¹æ³•äº†ã€‚ä¸è¿‡æ­¤æ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œå®ƒä»…ä»…æ˜¯å°†è¯¥ toast æ·»åŠ åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…æ˜¾ç¤ºï¼Œå³æ­¤æ–¹æ³•ä¸ç­‰ toast çœŸæ­£æ˜¾ç¤ºå°±å·²ç»è¿”å›žäº†ï¼Œè€Œ toast çš„æ˜¾ç¤ºéœ€è¦ç”¨ä¸€ä¸ªæ–°çš„ UI çº¿ç¨‹æ¶ˆæ¯ä¸­çš„ä»£ç æ¥æ˜¾ç¤ºå‡ºæ¥ã€‚</p><p><code>Toast#show</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Show the view for the specified duration.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mNextView == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"setView must have been called"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    INotificationManager service = getService();</span><br><span class="line">    String pkg = mContext.getOpPackageName();</span><br><span class="line">    TN tn = mTN;</span><br><span class="line">    tn.mNextView = mNextView;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        service.enqueueToast(pkg, tn, mDuration);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">        <span class="comment">// Empty</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„ç¬¬ 15 è¡Œæ˜¯ä¸€ä¸ªè·¨è¿›ç¨‹è°ƒç”¨äº† NotificationServiceManager çš„æ–¹æ³•ï¼Œè€Œä½œä¸ºå‚æ•°çš„ TN å¯¹è±¡æ˜¯å®žçŽ°äº† <a href="https://developer.android.com/reference/android/os/IInterface" target="_blank" rel="noopener">IInterface</a> çš„ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ Binder ä¼ ç»™å…¶ä»–è¿›ç¨‹ã€‚Toast çœŸæ­£çš„æ˜¾ç¤ºï¼Œéœ€è¦ç­‰ NotificationServiceManager å›žè°ƒå›žæ¥ï¼Œè¿™ä¸ªå›žè°ƒä¹Ÿå°±æ˜¯è°ƒç”¨ Toast å†…éƒ¨ç±» TN çš„ show æ–¹æ³•ã€‚è€Œä»Ž api 25 å¼€å§‹ï¼Œæ­¤æ–¹æ³•è¿˜ä¼šå°† NotificationServiceManager äº§ç”Ÿçš„ä¸€ä¸ª window token ä¼ é€’è¿‡æ¥ã€‚</p><p>api 25 ä¸­çš„ <code>TN#show</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * schedule handleShow into the right thread</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(IBinder windowToken)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (localLOGV) Log.v(TAG, <span class="string">"SHOW: "</span> + <span class="keyword">this</span>);</span><br><span class="line">    mHandler.obtainMessage(<span class="number">0</span>, windowToken).sendToTarget();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>api 24 ä¸­çš„ <code>TN#show</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * schedule handleShow into the right thread</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (localLOGV) Log.v(TAG, <span class="string">"SHOW: "</span> + <span class="keyword">this</span>);</span><br><span class="line">    mHandler.post(mShow);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤ <code>TN#show</code> æ–¹æ³•æ˜¯è¢«è¿œç¨‹è°ƒç”¨çš„ï¼Œæ‰€ä»¥å®žé™…ä¼šè¿è¡Œåœ¨ app çš„ Binder çº¿ç¨‹æ± çš„çº¿ç¨‹ä¸­ï¼Œæ‰€ä»¥æ­¤æ–¹æ³•å‘ä¸»çº¿ç¨‹å‘äº†ä¸€ä¸ªæ¶ˆæ¯ï¼Œè¿™ä¸ªæ¶ˆæ¯æ‰æ˜¯çœŸæ­£è®© toast æ˜¾ç¤ºçš„åœ°æ–¹ã€‚ä¸åŒçš„æ˜¯ api 25 çš„ä»£ç è¿˜ä¼šæŠŠ window token ä¹Ÿä¼ é€’åˆ°æ¶ˆæ¯ä¸­ã€‚å¤„ç†è¿™ä¸ªæ¶ˆæ¯çš„ä»£ç ï¼Œä¼šè°ƒç”¨ <code>TN#handleShow</code> æ–¹æ³•ï¼Œè¿™ä¸ª <code>handleShow</code> æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleShow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (localLOGV) Log.v(TAG, <span class="string">"HANDLE SHOW: "</span> + <span class="keyword">this</span> + <span class="string">" mView="</span> + mView</span><br><span class="line">            + <span class="string">" mNextView="</span> + mNextView);</span><br><span class="line">    <span class="keyword">if</span> (mView != mNextView) &#123;</span><br><span class="line">        <span class="comment">// remove the old view if necessary</span></span><br><span class="line">        handleHide();</span><br><span class="line">        mView = mNextView;</span><br><span class="line">        Context context = mView.getContext().getApplicationContext();</span><br><span class="line">        String packageName = mView.getContext().getOpPackageName();</span><br><span class="line">        <span class="keyword">if</span> (context == <span class="keyword">null</span>) &#123;</span><br><span class="line">            context = mView.getContext();</span><br><span class="line">        &#125;</span><br><span class="line">        mWM = (WindowManager)context.getSystemService(Context.WINDOW_SERVICE);</span><br><span class="line">        <span class="comment">// We can resolve the Gravity here by using the Locale for getting</span></span><br><span class="line">        <span class="comment">// the layout direction</span></span><br><span class="line">        <span class="keyword">final</span> Configuration config = mView.getContext().getResources().getConfiguration();</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> gravity = Gravity.getAbsoluteGravity(mGravity, config.getLayoutDirection());</span><br><span class="line">        mParams.gravity = gravity;</span><br><span class="line">        <span class="keyword">if</span> ((gravity &amp; Gravity.HORIZONTAL_GRAVITY_MASK) == Gravity.FILL_HORIZONTAL) &#123;</span><br><span class="line">            mParams.horizontalWeight = <span class="number">1.0f</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ((gravity &amp; Gravity.VERTICAL_GRAVITY_MASK) == Gravity.FILL_VERTICAL) &#123;</span><br><span class="line">            mParams.verticalWeight = <span class="number">1.0f</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        mParams.x = mX;</span><br><span class="line">        mParams.y = mY;</span><br><span class="line">        mParams.verticalMargin = mVerticalMargin;</span><br><span class="line">        mParams.horizontalMargin = mHorizontalMargin;</span><br><span class="line">        mParams.packageName = packageName;</span><br><span class="line">        mParams.removeTimeoutMilliseconds = mDuration ==</span><br><span class="line">            Toast.LENGTH_LONG ? LONG_DURATION_TIMEOUT : SHORT_DURATION_TIMEOUT;</span><br><span class="line">        <span class="keyword">if</span> (mView.getParent() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (localLOGV) Log.v(TAG, <span class="string">"REMOVE! "</span> + mView + <span class="string">" in "</span> + <span class="keyword">this</span>);</span><br><span class="line">            mWM.removeView(mView);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (localLOGV) Log.v(TAG, <span class="string">"ADD! "</span> + mView + <span class="string">" in "</span> + <span class="keyword">this</span>);</span><br><span class="line">        mWM.addView(mView, mParams);</span><br><span class="line">        trySendAccessibilityEvent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„ç¬¬ 37 è¡Œï¼Œæ‰æ˜¯çœŸæ­£æŠŠ toast çš„ view æ·»åŠ åˆ° WindowManagerï¼Œä¹Ÿå°±æ˜¯è®© toast æ˜¾ç¤ºå‡ºæ¥ï¼Œè‡³æ­¤ç†äº†ä¸€é toast æ˜¾ç¤ºçš„æµç¨‹ã€‚è€Œæœ€å‰é¢çš„ crash log è¡¨æ˜Žï¼Œcrash æ˜¯å‘ç”Ÿåœ¨ <code>ViewRootImpl#setView</code> æ–¹æ³•ä¸­çš„ï¼Œå¹¶ä¸”æç¤º window token invalidã€‚è¿™å…¶å®žå°±æ˜¯æç¤º ä»Ž NotificationManagerService ä¼ è¿‡æ¥ç»™ TN çš„ token å¯¹è±¡å¤±æ•ˆäº†ã€‚è€Œå¤±æ•ˆçš„åŽŸå› ï¼Œå…¶å®žå¾—ä»Ž NotificationManagerService ä¸­æ‰¾ã€‚</p><p><code>NotificationManagerService#showNextToastLocked</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showNextToastLocked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ToastRecord record = mToastQueue.get(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">while</span> (record != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (DBG) Slog.d(TAG, <span class="string">"Show pkg="</span> + record.pkg + <span class="string">" callback="</span> + record.callback);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            record.callback.show(record.token);</span><br><span class="line">            scheduleTimeoutLocked(record);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">            Slog.w(TAG, <span class="string">"Object died trying to show notification "</span> + record.callback</span><br><span class="line">                    + <span class="string">" in package "</span> + record.pkg);</span><br><span class="line">            <span class="comment">// remove it from the list and let the process die</span></span><br><span class="line">            <span class="keyword">int</span> index = mToastQueue.indexOf(record);</span><br><span class="line">            <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                mToastQueue.remove(index);</span><br><span class="line">            &#125;</span><br><span class="line">            keepProcessAliveIfNeededLocked(record.pid);</span><br><span class="line">            <span class="keyword">if</span> (mToastQueue.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                record = mToastQueue.get(<span class="number">0</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                record = <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ–¹æ³•å°±æ˜¯ NotificationManagerService å‘èµ·æ˜¾ç¤ºä¸‹ä¸€ä¸ª toast çš„ä»£ç ï¼Œæ³¨æ„åˆ°ç¬¬ 6 è¡Œè°ƒç”¨çš„ show æ–¹æ³•ï¼Œå…¶å®žå°±æ˜¯è¿œç¨‹è°ƒç”¨ TN å¯¹è±¡çš„ show æ–¹æ³•ï¼Œè€Œç¬¬ 6 è¡Œçš„ callback å…¶å®žå°±æ˜¯ TN å¯¹è±¡æ‰€å¯¹åº”çš„è¿œç¨‹ä»£ç†å¯¹è±¡ã€‚ç´§æŽ¥ç€ç¬¬ 7 è¡Œè°ƒç”¨çš„ scheduleTimeoutLocked æ–¹æ³•ï¼Œå…¶å®žè®¾å®šäº†ä¸€ä¸ªå¤±æ•ˆé™åˆ¶ï¼Œä½¿å¾—ç¬¬ 6 è¡Œä¼ é€’çš„ token ä¼šåœ¨å‡ ç§’å†…å¤±æ•ˆã€‚</p><p><code>scheduleTimeoutLocked</code> æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scheduleTimeoutLocked</span><span class="params">(ToastRecord r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mHandler.removeCallbacksAndMessages(r);</span><br><span class="line">    Message m = Message.obtain(mHandler, MESSAGE_TIMEOUT, r);</span><br><span class="line">    <span class="keyword">long</span> delay = r.duration == Toast.LENGTH_LONG ? LONG_DELAY : SHORT_DELAY;</span><br><span class="line">    mHandler.sendMessageDelayed(m, delay);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç å‘é€ä¸€ä¸ª delayed æ¶ˆæ¯(æˆªæ­¢ api 27ï¼Œæ­¤ delay æ—¶é•¿æ˜¯ 2 ç§’æˆ– 3.5 ç§’ï¼‰ï¼Œå¤„ç†ä¸Šé¢æ–¹æ³•å‘é€çš„æ¶ˆæ¯çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (msg.what)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> MESSAGE_TIMEOUT:</span><br><span class="line">            handleTimeout((ToastRecord)msg.obj);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¢«è°ƒç”¨çš„ <code>handleTimeOut</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handleTimeout</span><span class="params">(ToastRecord record)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (DBG) Slog.d(TAG, <span class="string">"Timeout pkg="</span> + record.pkg + <span class="string">" callback="</span> + record.callback);</span><br><span class="line">    <span class="keyword">synchronized</span> (mToastQueue) &#123;</span><br><span class="line">        <span class="keyword">int</span> index = indexOfToastLocked(record.pkg, record.callback);</span><br><span class="line">        <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            cancelToastLocked(index);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ç¬¬ 7 è¡Œè¢«è°ƒç”¨çš„ <code>cancelToastLocked</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">cancelToastLocked</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    ToastRecord record = mToastQueue.get(index);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        record.callback.hide();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">        Slog.w(TAG, <span class="string">"Object died trying to hide notification "</span> + record.callback</span><br><span class="line">                + <span class="string">" in package "</span> + record.pkg);</span><br><span class="line">        <span class="comment">// don't worry about this, we're about to remove it from</span></span><br><span class="line">        <span class="comment">// the list anyway</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ToastRecord lastToast = mToastQueue.remove(index);</span><br><span class="line">    mWindowManagerInternal.removeWindowToken(lastToast.token, <span class="keyword">true</span>, DEFAULT_DISPLAY);</span><br><span class="line"></span><br><span class="line">    keepProcessAliveIfNeededLocked(record.pid);</span><br><span class="line">    <span class="keyword">if</span> (mToastQueue.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// Show the next one. If the callback fails, this will remove</span></span><br><span class="line">        <span class="comment">// it from the list, so don't assume that the list hasn't changed</span></span><br><span class="line">        <span class="comment">// after this point.</span></span><br><span class="line">        showNextToastLocked();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ç¬¬ 13 è¡Œå°±æ˜¯ä½¿ window token å¤±æ•ˆçš„ä»£ç ã€‚è‡³æ­¤å¯çŸ¥ï¼ŒNotificationServiceManager è¿œç¨‹è°ƒç”¨ <code>TN#show</code> æ–¹æ³•åŽå‡ ç§’å†…ï¼Œæ­¤ token å°±ä¼šå¤±æ•ˆï¼Œåœ¨è¿™å‡ ç§’å†…å¦‚æžœ toast æ²¡æœ‰çœŸæ­£æ·»åŠ åˆ° WindowManagerï¼Œé‚£ä¹ˆç­‰æ·»åŠ çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºçŽ° BadTokenExceptionï¼Œåº”ç”¨å°±ä¼š crashã€‚è€Œé˜»ç¢ toast çš„ view è¢«æ·»åŠ åˆ° WindowManagerï¼Œåªæœ‰ UI çº¿ç¨‹çš„å¿™ç¢Œï¼Œä¹Ÿå°±æ˜¯å¦‚æžœ UI çº¿ç¨‹å·²ç»åœ¨æ‰§è¡Œæˆ–è€…é©¬ä¸Šè¦æ‰§è¡Œçš„å…¶ä»–æ¶ˆæ¯æ¯”è¾ƒè€—æ—¶ï¼Œé‚£ä¹ˆ toast çš„ view å°±æ— æ³•åŠæ—¶æ·»åŠ ã€‚</p><p>ä¸è¿‡ï¼ŒGoogle ä¹Ÿæ„è¯†åˆ°è¿™ç§ UI çº¿ç¨‹ block ä¸åˆ° ANR æ—¶é•¿å°± crash çš„çŽ°è±¡äº†ï¼Œæ‰€ä»¥åœ¨ api 26 ä¸­ï¼Œæ­¤ BadTokenException ç›´æŽ¥è¢«æ•èŽ·äº†ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢çš„ç¬¬ 42 è¡Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleShow</span><span class="params">(IBinder windowToken)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span> (mView != mNextView) &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">if</span> (localLOGV) Log.v(TAG, <span class="string">"ADD! "</span> + mView + <span class="string">" in "</span> + <span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">// Since the notification manager service cancels the token right</span></span><br><span class="line">        <span class="comment">// after it notifies us to cancel the toast there is an inherent</span></span><br><span class="line">        <span class="comment">// race and we may attempt to add a window after the token has been</span></span><br><span class="line">        <span class="comment">// invalidated. Let us hedge against that.</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mWM.addView(mView, mParams);</span><br><span class="line">            trySendAccessibilityEvent();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (WindowManager.BadTokenException e) &#123;</span><br><span class="line">            <span class="comment">/* ignore */</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æ­¤ crashï¼Œä»…ä»…å‘ç”Ÿåœ¨ api 25 çš„ç³»ç»Ÿä¸­ï¼Œè¦ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å‚è€ƒ github ä¸Šçš„ <a href="https://github.com/drakeet/ToastCompat" target="_blank" rel="noopener">ToastCompat</a> ä¸­çš„æ–¹æ³•ã€‚</p><p>å†æ¥çœ‹ä¸€ä¸‹å¦ä¸€ç§ Crash logï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalStateException: View android.widget.LinearLayout&#123;41a97eb8 V.E..... ......ID 0,0-540,105 #7f0b020d app:id/toast_layout_root&#125; has already been added to the window manager.</span><br><span class="line">   at android.view.WindowManagerGlobal.addView(WindowManagerGlobal.java:<span class="number">223</span>)</span><br><span class="line">   at android.view.WindowManagerImpl.addView(WindowManagerImpl.java:<span class="number">69</span>)</span><br><span class="line">   at android.widget.Toast$TN.handleShow(Toast.java:<span class="number">402</span>)</span><br><span class="line">   at android.widget.Toast$TN$<span class="number">1</span>.run(Toast.java:<span class="number">310</span>)</span><br><span class="line">   at android.os.Handler.handleCallback(Handler.java:<span class="number">730</span>)</span><br><span class="line">   at android.os.Handler.dispatchMessage(Handler.java:<span class="number">92</span>)</span><br><span class="line">   at android.os.Looper.loop(Looper.java:<span class="number">137</span>)</span><br><span class="line">   at android.app.ActivityThread.main(ActivityThread.java:<span class="number">5136</span>)</span><br><span class="line">   at java.lang.reflect.Method.invokeNative(Method.java)</span><br><span class="line">   at java.lang.reflect.Method.invoke(Method.java:<span class="number">525</span>)</span><br><span class="line">   at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:<span class="number">737</span>)</span><br><span class="line">   at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:<span class="number">553</span>)</span><br><span class="line">   at dalvik.system.NativeStart.main(NativeStart.java)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª crash åŽŸå› æ˜¯åŒä¸€ä¸ª view è¢«é‡å¤æ·»åŠ åˆ° WindowManager å¯¼è‡´çš„ã€‚æŠ›å‡ºå¼‚å¸¸çš„åœ°æ–¹æ˜¯ <code>WindowManagerGlobal#addView</code> æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢çš„ä»£ç ç¬¬ 15 è¡Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addView</span><span class="params">(View view, ViewGroup.LayoutParams params,</span></span></span><br><span class="line"><span class="function"><span class="params">            Display display, Window parentWindow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (view == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"view must not be null"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (display == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"display must not be null"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">            <span class="keyword">int</span> index = findViewLocked(view, <span class="keyword">false</span>);</span><br><span class="line">            <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mDyingViews.contains(view)) &#123;</span><br><span class="line">                    <span class="comment">// Don't wait for MSG_DIE to make it's way through root's queue.</span></span><br><span class="line">                    mRoots.get(index).doDie();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"View "</span> + view</span><br><span class="line">                            + <span class="string">" has already been added to the window manager."</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// The previous removeView() had not completed executing. Now it has.</span></span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><p>ä»Žä¸Šé¢ä»£ç å¯çŸ¥ï¼Œç¬¬ 10 è¡Œ index éžè´Ÿï¼Œä¸” mDyingViews åŒ…å«éœ€æ·»åŠ çš„ viewï¼Œåˆ™ä¼šæŠ›å‡ºæ­¤å¼‚å¸¸ã€‚ç¬¬ 10 è¡Œ index éžè´Ÿçš„åŽŸå› ï¼Œæ˜¯ mViews åŒ…å«æ­¤ viewï¼Œå¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">findViewLocked</span><span class="params">(View view, <span class="keyword">boolean</span> required)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> index = mViews.indexOf(view);</span><br><span class="line">    <span class="keyword">if</span> (required &amp;&amp; index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"View="</span> + view + <span class="string">" not attached to window manager"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> index;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œä¹Ÿå°±æ˜¯å½“éœ€è¦æ·»åŠ ä¸€ä¸ª view æ—¶ï¼Œå¦‚æžœæ­¤ view åœ¨ mViews ä¸­å´ä¸åœ¨ mDyingViews ä¸­ï¼Œé‚£å°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚çŽ°åœ¨æˆ‘ä»¬çœ‹ä¸€ä¸‹ <code>Toast#TN#handleShow</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleShow</span><span class="params">(IBinder windowToken)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span> (mView != mNextView) &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">if</span> (mView.getParent() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (localLOGV) Log.v(TAG, <span class="string">"REMOVE! "</span> + mView + <span class="string">" in "</span> + <span class="keyword">this</span>);</span><br><span class="line">            mWM.removeView(mView);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (localLOGV) Log.v(TAG, <span class="string">"ADD! "</span> + mView + <span class="string">" in "</span> + <span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">// Since the notification manager service cancels the token right</span></span><br><span class="line">        <span class="comment">// after it notifies us to cancel the toast there is an inherent</span></span><br><span class="line">        <span class="comment">// race and we may attempt to add a window after the token has been</span></span><br><span class="line">        <span class="comment">// invalidated. Let us hedge against that.</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mWM.addView(mView, mParams);</span><br><span class="line">            trySendAccessibilityEvent();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (WindowManager.BadTokenException e) &#123;</span><br><span class="line">            <span class="comment">/* ignore */</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç æ˜¾ç¤ºï¼Œå®žé™…ä¸Šï¼ŒToast è¢«çŽ°å®žæ—¶ï¼Œå…¶å®žä¼šå…ˆæŠŠ view ä»Ž WindowManager ç§»é™¤ï¼ˆæ³¨æ„ä¸€ä¸‹ç§»é™¤çš„å‰ææ˜¯ view çš„ parent ä¸ç©ºï¼‰ï¼Œç„¶åŽå†å°è¯•æ·»åŠ ã€‚æˆ‘ä»¬çœ‹çœ‹ WindowManagerGlobal#removeView æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeView</span><span class="params">(View view, <span class="keyword">boolean</span> immediate)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (view == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"view must not be null"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">        <span class="keyword">int</span> index = findViewLocked(view, <span class="keyword">true</span>);</span><br><span class="line">        View curView = mRoots.get(index).getView();</span><br><span class="line">        removeViewLocked(index, immediate);</span><br><span class="line">        <span class="keyword">if</span> (curView == view) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Calling with view "</span> + view</span><br><span class="line">                + <span class="string">" but the ViewAncestor is attached to "</span> + curView);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„ä¸Šé¢æ–¹æ³•æœ‰ä¸ª immediate å‚æ•°ï¼Œä¸è¿‡ä»Ž <code>Toast#TN#handleShow</code> è°ƒç”¨è¿‡æ¥æ—¶ï¼Œè¿™ä¸ªå‚æ•°ä¼šæ˜¯ falseã€‚çŽ°åœ¨å‡è®¾ view åŒ…å«åœ¨ mViews ä¸­ï¼Œé‚£ä¹ˆä¸Šé¢ç¬¬ 7 è¡Œ index å°†éžè´Ÿï¼Œä¸Šé¢ç¬¬ 9 è¡Œè°ƒç”¨äº† removeViewLocked æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">removeViewLocked</span><span class="params">(<span class="keyword">int</span> index, <span class="keyword">boolean</span> immediate)</span> </span>&#123;</span><br><span class="line">    ViewRootImpl root = mRoots.get(index);</span><br><span class="line">    View view = root.getView();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (view != <span class="keyword">null</span>) &#123;</span><br><span class="line">        InputMethodManager imm = InputMethodManager.getInstance();</span><br><span class="line">        <span class="keyword">if</span> (imm != <span class="keyword">null</span>) &#123;</span><br><span class="line">            imm.windowDismissed(mViews.get(index).getWindowToken());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">boolean</span> deferred = root.die(immediate);</span><br><span class="line">    <span class="keyword">if</span> (view != <span class="keyword">null</span>) &#123;</span><br><span class="line">        view.assignParent(<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">if</span> (deferred) &#123;</span><br><span class="line">            mDyingViews.add(view);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç  ç¬¬ 11 è¡Œå› ä¸º immediate ä¸º falseï¼Œæ‰€ä»¥è¿”å›žçš„ deferred æ˜¯ trueï¼Œé‚£ä¹ˆç¬¬ 15 è¡Œå°±ä¼šæŠŠ view æ·»åŠ åˆ° mDyingViewsã€‚</p><p>è‡³æ­¤æ€»ç»“ä¸€ä¸‹ï¼Œåªè¦ view çš„ parent ä¸ç©ºï¼Œé‚£ä¹ˆå®ƒå°±ä¼šå°è¯•è¢«ç§»é™¤ï¼Œå¦‚æžœ mViewæ˜¯ä¸­æœ‰æ¬¡ viewï¼Œåˆ™å°è¯•ç§»é™¤çš„ç»“æžœå°±æ˜¯ mDyingViews ä¹Ÿä¼šåŒ…å«æ­¤ viewï¼Œåˆ™ crash ä¸ä¼šå‘ç”Ÿã€‚</p><p>ç»è¿‡åˆ†æžç³»ç»Ÿä»£ç ï¼Œæˆ‘å‘çŽ°ç»™ view è®¾ç½® parent æ˜¯åœ¨ ViewRootImpl ä¸­çš„ setView æ–¹æ³•è°ƒç”¨ <code>view.assignParent(this)</code> åšåˆ°çš„ï¼Œè€Œ ViewRootImpl #setView æ˜¯åœ¨ WindowManagerGlobal#addView è°ƒç”¨çš„ã€‚ç½®ç©º parent åˆ™æ˜¯åœ¨ WindowManagerGlobal#removeViewLocked åšçš„ï¼Œè€Œä»Ž mViews ç§»é™¤ view æ˜¯åœ¨ WindowManagerGlobal#doRemoveView åšçš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">doRemoveView</span><span class="params">(ViewRootImpl root)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> index = mRoots.indexOf(root);</span><br><span class="line">        <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            mRoots.remove(index);</span><br><span class="line">            mParams.remove(index);</span><br><span class="line">            <span class="keyword">final</span> View view = mViews.remove(index);</span><br><span class="line">            mDyingViews.remove(view);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ThreadedRenderer.sTrimForeground &amp;&amp; ThreadedRenderer.isAvailable()) &#123;</span><br><span class="line">        doTrimForeground();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºŽè¿™äº›æ–¹æ³•éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹è°ƒç”¨çš„ï¼Œæ‰€ä»¥å¯ä»¥è‚¯å®šï¼Œåœ¨ addView æ—¶ï¼ŒmView åŒ…å« view æ—¶ï¼Œåˆ™æ­¤ view çš„ parentä¸ç©ºã€‚è€Œ mView ä¸åŒ…å« view æ—¶ï¼Œå®ƒçš„ parent ä¸ºç©ºã€‚çœ‹èµ·æ¥ä¼¼ä¹Žæ— æ‡ˆå¯å‡»ï¼Œç³»ç»Ÿä»£ç ç¡®ä¿äº† toast çš„æ˜¾ç¤ºä¸ä¼šå‡ºçŽ°é‡å¤æ·»åŠ  view å¯¼è‡´çš„ IllegalStateExceptionã€‚ä½†æ˜¯æ˜Žæ˜Ž crash å°±æ˜¯å‘ç”Ÿäº†ï¼Œåˆ†æžå †æ ˆä¹Ÿå¯çŸ¥å°±æ˜¯å‡ºçŽ°äº† view åœ¨ mViews ä¸­ä½†å´ä¸åœ¨ mDyingViews ä¸­çš„æƒ…å†µã€‚</p><p>ç»è¿‡åˆ†æžï¼Œæˆ‘å¯èƒ½æ‰¾åˆ°äº†ä¸€ç§åŽŸå› ã€‚å…ˆæ¥çœ‹ WindowManagerGlobal#addView æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addView</span><span class="params">(View view, ViewGroup.LayoutParams params,</span></span></span><br><span class="line"><span class="function"><span class="params">            Display display, Window parentWindow)</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">        ViewRootImpl root;</span><br><span class="line">        View panelParentView = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="keyword">int</span> index = findViewLocked(view, <span class="keyword">false</span>);</span><br><span class="line">            <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mDyingViews.contains(view)) &#123;</span><br><span class="line">                    <span class="comment">// Don't wait for MSG_DIE to make it's way through root's queue.</span></span><br><span class="line">                    mRoots.get(index).doDie();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"View "</span> + view</span><br><span class="line">                            + <span class="string">" has already been added to the window manager."</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// The previous removeView() had not completed executing. Now it has.</span></span><br><span class="line">            &#125;</span><br><span class="line">            ...</span><br><span class="line">            root = <span class="keyword">new</span> ViewRootImpl(view.getContext(), display);</span><br><span class="line"></span><br><span class="line">            view.setLayoutParams(wparams);</span><br><span class="line"></span><br><span class="line">            mViews.add(view);</span><br><span class="line">            mRoots.add(root);</span><br><span class="line">            mParams.add(wparams);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// do this last because it fires off messages to start doing things</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                root.setView(view, wparams, panelParentView);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">                <span class="comment">// BadTokenException or InvalidDisplayException, clean up.</span></span><br><span class="line">                <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    removeViewLocked(index, <span class="keyword">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">throw</span> e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆä¸Šé¢ä»£ç å¯èƒ½å­˜åœ¨ä¸€å¤„æ¼æ´žã€‚å‡è®¾ view ä¹‹å‰ä»Žæœªæ·»åŠ è¿‡ï¼Œé‚£ä¹ˆä½Ž 9 è¡Œè¿”å›ž -1ï¼Œç¬¬ 25 è‡³ 27 è¡ŒæŠŠ view æ·»åŠ åˆ°äº† mViews ä¸­ï¼Œç„¶åŽå‡è®¾æ­¤ view æ·»åŠ è¿‡ç¨‹ä¸­å¤±è´¥äº†ï¼Œå³ç¬¬ 31 è¡ŒæŠ›å‡ºäº†å¼‚å¸¸ï¼Œå¯æ˜¯æ­¤æ—¶ index æ˜¯ -1ï¼Œæ‰€ä»¥ç¬¬ 15 è¡Œä¼å›¾ç§»é™¤æ­¤ view æ˜¯åšä¸åˆ°çš„ï¼ŒäºŽæ˜¯æ­¤ view å°±ç•™åœ¨äº† mViews ä¸­ï¼Œè¿™å¯èƒ½æ˜¯ç³»ç»Ÿçš„ç§»é™¤æ¼æ´žã€‚å¦ä¸€ç§æƒ…å†µï¼Œå‡è®¾ç¬¬ 9 è¡Œè¿”å›žéžè´Ÿå€¼ï¼Œé‚£ä¹ˆæ­¤ view åœ¨ç¬¬ 13 è¡Œä¼šç«‹å³ç§»é™¤ï¼Œç¬¬ 25 è¡Œé‡æ–°æ·»åŠ åˆ° mView ä¸­æ—¶ï¼Œæ­¤ view æ–°çš„ index å·²ç»ä¸æ˜¯ç¬¬ 9 è¡Œçš„å€¼äº†ï¼Œç„¶åŽå¦‚æžœç¬¬ 31 è¡Œæ·»åŠ å¤±è´¥ï¼Œé‚£ä¹ˆç¬¬ 35 è¡Œå°†ä¼šè¢«æ‰§è¡Œï¼Œå¯æ˜¯ index æ˜¯é”™è¯¯çš„ï¼Œè¿™å°†ä¼šå¯¼è‡´é”™è¯¯çš„ view è¢«ç§»é™¤ï¼</p><p>ä¸Šé¢å¯èƒ½çš„æ¼æ´žè¦å‘ç”Ÿï¼Œéœ€è¦ç¬¬ 35 è¡ŒæŠ›å‡ºå¼‚å¸¸ï¼Œè€ŒæŸ¥çœ‹ <code>ViewRootImpl#setView</code> æ–¹æ³•å¯çŸ¥ï¼Œå¦‚æžœå¼‚å¸¸æŠ›å‡ºï¼Œé‚£ä¹ˆ view çš„ parent å°†å°šæœªè®¾ç½®:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setView</span><span class="params">(View view, WindowManager.LayoutParams attrs, View panelParentView)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mView == <span class="keyword">null</span>) &#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="keyword">if</span> (res &lt; WindowManagerGlobal.ADD_OKAY) &#123;</span><br><span class="line">                mAttachInfo.mRootView = <span class="keyword">null</span>;</span><br><span class="line">                mAdded = <span class="keyword">false</span>;</span><br><span class="line">                mFallbackEventHandler.setView(<span class="keyword">null</span>);</span><br><span class="line">                unscheduleTraversals();</span><br><span class="line">                setAccessibilityFocus(<span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">                <span class="keyword">switch</span> (res) &#123;</span><br><span class="line">                    <span class="keyword">case</span> WindowManagerGlobal.ADD_BAD_APP_TOKEN:</span><br><span class="line">                    <span class="keyword">case</span> WindowManagerGlobal.ADD_BAD_SUBWINDOW_TOKEN:</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> WindowManager.BadTokenException(</span><br><span class="line">                                <span class="string">"Unable to add window -- token "</span> + attrs.token</span><br><span class="line">                                + <span class="string">" is not valid; is your activity running?"</span>);</span><br><span class="line">                    <span class="keyword">case</span> WindowManagerGlobal.ADD_NOT_APP_TOKEN:</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> WindowManager.BadTokenException(</span><br><span class="line">                                <span class="string">"Unable to add window -- token "</span> + attrs.token</span><br><span class="line">                                + <span class="string">" is not for an application"</span>);</span><br><span class="line">                    <span class="keyword">case</span> WindowManagerGlobal.ADD_APP_EXITING:</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> WindowManager.BadTokenException(</span><br><span class="line">                                <span class="string">"Unable to add window -- app for token "</span> + attrs.token</span><br><span class="line">                                + <span class="string">" is exiting"</span>);</span><br><span class="line">                    <span class="keyword">case</span> WindowManagerGlobal.ADD_DUPLICATE_ADD:</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> WindowManager.BadTokenException(</span><br><span class="line">                                <span class="string">"Unable to add window -- window "</span> + mWindow</span><br><span class="line">                                + <span class="string">" has already been added"</span>);</span><br><span class="line">                    <span class="keyword">case</span> WindowManagerGlobal.ADD_STARTING_NOT_NEEDED:</span><br><span class="line">                        <span class="comment">// Silently ignore -- we would have just removed it</span></span><br><span class="line">                        <span class="comment">// right away, anyway.</span></span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    <span class="keyword">case</span> WindowManagerGlobal.ADD_MULTIPLE_SINGLETON:</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> WindowManager.BadTokenException(<span class="string">"Unable to add window "</span></span><br><span class="line">                                + mWindow + <span class="string">" -- another window of type "</span></span><br><span class="line">                                + mWindowAttributes.type + <span class="string">" already exists"</span>);</span><br><span class="line">                    <span class="keyword">case</span> WindowManagerGlobal.ADD_PERMISSION_DENIED:</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> WindowManager.BadTokenException(<span class="string">"Unable to add window "</span></span><br><span class="line">                                + mWindow + <span class="string">" -- permission denied for window type "</span></span><br><span class="line">                                + mWindowAttributes.type);</span><br><span class="line">                    <span class="keyword">case</span> WindowManagerGlobal.ADD_INVALID_DISPLAY:</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> WindowManager.InvalidDisplayException(<span class="string">"Unable to add window "</span></span><br><span class="line">                                + mWindow + <span class="string">" -- the specified display can not be found"</span>);</span><br><span class="line">                    <span class="keyword">case</span> WindowManagerGlobal.ADD_INVALID_TYPE:</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> WindowManager.InvalidDisplayException(<span class="string">"Unable to add window "</span></span><br><span class="line">                                + mWindow + <span class="string">" -- the specified window type "</span></span><br><span class="line">                                + mWindowAttributes.type + <span class="string">" is not valid"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</span><br><span class="line">                        <span class="string">"Unable to add window -- unknown error code "</span> + res);</span><br><span class="line">            &#125;</span><br><span class="line">            ...</span><br><span class="line">            view.assignParent(<span class="keyword">this</span>);</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»Žä¸Šé¢ä»£ç å¯çŸ¥ï¼Œå¦‚æžœæŠ›å‡ºå¼‚å¸¸ï¼Œ<code>view.assignParent(this)</code> å°†æœªè¢«è°ƒç”¨ã€‚</p><p>è‡³æ­¤ï¼Œå¯å°†æˆ‘çš„çŒœæµ‹æ€»ç»“ä¸ºï¼šå½“ä½¿ç”¨åŒä¸€ä¸ª view å¤šæ¬¡æ˜¾ç¤º toast æ—¶ï¼Œå¯èƒ½æŸä¸€æ¬¡æ·»åŠ å¤±è´¥ï¼Œå¯¼è‡´ view ç•™åœ¨ mViews ä¸­ï¼Œå¯æ˜¯ view çš„ parent åˆå› ä¸ºæ·»åŠ å¤±è´¥è€Œä¸ºç©ºï¼Œæ‰€ä»¥ Toast#TN#handleShow æ–¹æ³•æ²¡æœ‰è°ƒç”¨ä»Ž WindowManager ç§»é™¤æ­¤ view çš„ä»£ç ï¼Œæ‰€ä»¥ WindowManagerGlobal#addView è¢«è°ƒç”¨æ—¶ï¼Œview ä¸åœ¨ mDyingViews ä¸­ï¼Œæ‰€ä»¥ crash å‘ç”Ÿäº†ã€‚</p><p>å¯æ˜¯è¿™åªæ˜¯çŒœæµ‹ï¼Œæ— æ³•éªŒè¯çŒœæµ‹æ˜¯å¦æ­£ç¡®ã€‚</p><p>----- ä»¥ä¸‹æ˜¯ 2019 å¹´ 1 æœˆ 11 æ—¥çš„æ›´æ–° ------</p><p>çŽ°å·²å‘çŽ°å¤çŽ°ç¬¬äºŒç§ crash (IllegalStateException: view has already been added to the window manager) çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å¦‚ä¸‹çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> View toastLayout;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        toastLayout = LayoutInflater.from(<span class="keyword">this</span>).inflate(R.layout.connection_toast, <span class="keyword">null</span>);</span><br><span class="line">        </span><br><span class="line">        findViewById(R.id.btn).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                Toast toast = <span class="keyword">new</span> Toast(MainActivity.<span class="keyword">this</span>);</span><br><span class="line">                toast.setView(toastLayout);</span><br><span class="line">                toast.show();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1980</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ï¼Œç‚¹å‡»å‡ æ¬¡æŒ‰é’®æ¥æ‰§è¡Œ onClick æ–¹æ³•ï¼Œå°±å¯ä»¥å¤çŽ° crashã€‚å¤çŽ°æ€è·¯æ˜¯ï¼Œå…ˆè®©å‰ä¸€ä¸ª toast æŠŠ view æ·»åŠ åˆ° WindowManagerï¼Œä½†è¦è®©å®ƒæ·»åŠ å¤±è´¥ï¼Œç„¶åŽç¬¬äºŒæ¬¡å¦ä¸€ä¸ª toast å†æ·»åŠ æ­¤ viewï¼Œæ­¤æ¬¡å‘ç”Ÿ crashï¼Œè¿™ä¸ªæ€è·¯ä¹Ÿæ˜¯æŒ‰ç…§å‰é¢çš„çŒœæƒ³æ¥çš„ã€‚é¦–å…ˆï¼Œä¸Šé¢çš„ä»£ç æ˜¯å°†åŒä¸€ä¸ª view æ·»åŠ åˆ°ä¸åŒçš„ toast å¯¹è±¡åŽ» showï¼Œå½“æ·»åŠ åˆ°ç¬¬ä¸€ä¸ª toast è°ƒç”¨ show æ–¹æ³•åŽï¼Œä¸»çº¿ç¨‹ sleep 1980 æ¯«ç§’ï¼Œè¿™ä¸ªæ—¶é—´æ˜¯å¾ˆå¾®å¦™çš„ï¼ŒæŽ¥è¿‘ 2000 æ¯«ç§’ä½†æ˜¯å´ç•¥å°‘ã€‚è¿™ä¸ªæ—¶é—´å¯ä»¥ä½¿å¾—ä¸»çº¿ç¨‹é†’æ¥æ—¶ï¼Œtoast çš„ token å³å°†å¤±æ•ˆã€‚ä¸èƒ½ç”¨æ›´é•¿çš„ sleep æ—¶é—´æ˜¯å› ä¸ºé‚£æ ·çš„è¯ï¼Œä¸»çº¿ç¨‹è¿˜åœ¨ sleep ä¸­ token å·²å¤±æ•ˆï¼Œtoken çš„å¤±æ•ˆæ˜¯åœ¨ NotificationManagerService ä¸­äº§ç”Ÿçš„ï¼Œå¤±æ•ˆåŽï¼ŒNotificationManagerService ä¼šå¤„ç† MESSAGE_DURATION_REACHED æ¶ˆæ¯ï¼Œæœ€ç»ˆä¼šè·¨è¿›ç¨‹è°ƒç”¨åˆ° Toast#TN#hide æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•ä¼šè®©æˆ‘ä»¬ app çš„ä¸»çº¿ç¨‹æ¶ˆæ¯é˜Ÿåˆ—å¢žåŠ ä¸€ä¸ª HIDE æ¶ˆæ¯ï¼š</p><p><img src="http://tao93.top/images/2019/01/11/1547217156.png" alt=""></p><p>å¦‚æ­¤ä¸€æ¥ï¼Œå½“ä¸»çº¿ç¨‹ sleep ç»“æŸæ‰§è¡Œ Toast#TN#handleShow æ–¹æ³•æ—¶ï¼Œå°±ä¼šå› æ¶ˆæ¯é˜Ÿåˆ—å·²æœ‰ HIDE æ¶ˆæ¯è€Œæå‰è¿”å›ž:</p><p><img src="http://tao93.top/images/2019/01/11/1547217419.png" alt=""></p><p>æ—¢ç„¶éƒ½æå‰è¿”å›žäº†ï¼Œview ä¹Ÿå°±ä¸ä¼šè¢«ç¬¬ä¸€ä¸ª toast æ·»åŠ åˆ° WindowManagerï¼Œé‚£ä¹ˆä¹Ÿå°±ä¸ç¬¦åˆæˆ‘ä»¬çš„æ€è·¯ä¸­ã€Œè®©ç¬¬ä¸€ä¸ª toast æŠŠ view æ·»åŠ åˆ° WindowManager æ˜¯å‘ç”Ÿå¼‚å¸¸ã€çš„æƒ³æ³•ã€‚</p><p>æ‰€ä»¥ï¼Œéœ€è¦ 1980 æ¯«ç§’è¿™æ ·ä¸€ä¸ªæ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´ä½¿å¾—ä¸»çº¿ç¨‹é†’æ¥æ‰§è¡Œåˆ°ç¬¬ä¸€ä¸ª toast çš„ Toast#TN#handleShow æ—¶ï¼Œtoken è¿˜æ²¡å¤±æ•ˆï¼Œæ‰€ä»¥ handleShow æ–¹æ³•ä¸ä¼šæå‰è¿”å›žï¼Œæ‰€ä»¥ view ä¼šç»§ç»­å¾€ WindowManager æ·»åŠ ï¼Œä½†æ˜¯ 20 æ¯«ç§’ä¸è¶³ä»¥è®©è¿™ä¸ªæ·»åŠ é¡ºåˆ©å®Œæˆï¼Œç›¸åï¼Œå¾ˆå¯èƒ½æ·»åŠ æ—¶ token å¤±æ•ˆäº†ï¼Œ äºŽæ˜¯æ·»åŠ å¤±è´¥ï¼Œå‘ç”Ÿç¬¬ä¸€ç§ crash çš„ BadTokenException (Anddroid 8 ä»¥ä¸Šæ­¤å¼‚å¸¸ä¼šè¢«æ•èŽ·ï¼Œå‰æ–‡å·²æè¿°)ï¼Œè¿™æ ·å°±ç¬¦åˆæˆ‘ä»¬çš„æ€è·¯äº†ã€‚ä¸‹é¢æˆªå›¾è¯æ˜Žäº†ç¡®å®žå‘ç”Ÿäº† BadTokenExceptionï¼š</p><p><img src="http://tao93.top/images/2019/01/11/1547217762.png" alt=""></p><p>è‡³æ­¤ï¼ŒæŒ‰ç…§å‰é¢çš„æ€è·¯ï¼Œæ­¤ view å°†ä¼šæ—  parentï¼Œä½†æ˜¯å´ç•™åœ¨äº† WindowManagerGlobal çš„ mViews ä¸­ï¼Œå´åˆä¸åœ¨ mDyingViews ä¸­ï¼ŒäºŽæ˜¯ï¼Œå½“å†æ¬¡æŒ‰ä¸‹æŒ‰é’®ï¼Œæ‰§è¡Œå¦ä¸€ä¸ª toast æ·»åŠ æ­¤ view çš„ä»£ç æ—¶ï¼ŒWindowManagerGlobal#addView ä¸­å°†å‘ç”Ÿ IllegalStateExceptionï¼Œcrash ä¹Ÿå°±å¤çŽ°äº†ï¼Œæˆªå›¾ä¸ºè¯ï¼š</p><p><img src="http://tao93.top/images/2019/01/11/1547217909.png" alt=""></p><p>è‡³æ­¤ï¼Œtoast crash çš„åˆ†æžç®—æ˜¯æœ‰äº†ä¸€ä¸ªæ¯”è¾ƒå®Œæ»¡çš„ç»“å°¾ã€‚å¯¹äºŽæœ¬æ–‡ä¸­ 2019 å¹´ 1 æœˆ 11 æ—¥æ›´æ–°çš„éƒ¨åˆ†ï¼Œåœ¨æ­¤æ„Ÿè°¢åˆ˜æˆåŒå­¦æä¾›çš„å¸®åŠ©ï¼Œä»–æœ¬æ¥ç”¨æ¥å¤çŽ°é—®é¢˜çš„æ–¹å¼æ˜¯ã€Œå…ˆè°ƒä¸€ä¸ª toast çš„ showï¼Œsleep ä¸‰å››ç§’ï¼Œç„¶åŽå†ç”¨åŒä¸€ä¸ª view è°ƒå¦ä¸€ä¸ª toast çš„ showã€ï¼Œè¿™ä¸ªæ–¹å¼å› ä¸ºå‰é¢è®²çš„åŽŸå› è€Œæ— æ³•å¤çŽ° crashï¼Œä½†å´ç»™äº†æˆ‘çµæ„Ÿï¼Œè®©æˆ‘æƒ³åˆ°äº† 1980 æ¯«ç§’è¿™ä¸ªæ—¶é—´ï¼Œæœ€ç»ˆæˆåŠŸå¤çŽ°äº† crashã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Java Comparable Contracts</title>
      <link href="/2018/12/22/Java%20Comparable%20Contracts/"/>
      <url>/2018/12/22/Java%20Comparable%20Contracts/</url>
      <content type="html"><![CDATA[<p>å®žçŽ° Java ä¸­çš„ Comparable æŽ¥å£çš„å¯¹è±¡ï¼Œå¯ä»¥ç”¨åœ¨ Collections#sort ç­‰æ–¹æ³•ä¸­è¿›è¡ŒæŽ’åºç­‰ã€‚é€šå¸¸æ¥è¯´ï¼ŒComparable æŽ¥å£çš„ compareTo æ–¹æ³•éƒ½æ˜¯å†™èµ·æ¥æ¯”è¾ƒç®€å•çš„ã€‚ä¸è¿‡ï¼Œå¶å°”è¿˜æ˜¯å¯èƒ½ç¿»è½¦çš„ã€‚æ¯”å¦‚ä¸‹é¢çš„ crash logï¼Œå°±æ˜¯ç¿»è½¦çš„çŽ°åœºï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">java<span class="selector-class">.lang</span><span class="selector-class">.IllegalArgumentException</span>: Comparison method violates its general contract! </span><br><span class="line">  at java<span class="selector-class">.util</span><span class="selector-class">.TimSort</span><span class="selector-class">.mergeHi</span>(TimSort<span class="selector-class">.java</span>:<span class="number">868</span>) </span><br><span class="line">  at java<span class="selector-class">.util</span><span class="selector-class">.TimSort</span><span class="selector-class">.mergeAt</span>(TimSort<span class="selector-class">.java</span>:<span class="number">485</span>) </span><br><span class="line">  at java<span class="selector-class">.util</span><span class="selector-class">.TimSort</span><span class="selector-class">.mergeCollapse</span>(TimSort<span class="selector-class">.java</span>:<span class="number">408</span>) </span><br><span class="line">  at java<span class="selector-class">.util</span><span class="selector-class">.TimSort</span><span class="selector-class">.sort</span>(TimSort<span class="selector-class">.java</span>:<span class="number">214</span>) </span><br><span class="line">  at java<span class="selector-class">.util</span><span class="selector-class">.TimSort</span><span class="selector-class">.sort</span>(TimSort<span class="selector-class">.java</span>:<span class="number">173</span>) </span><br><span class="line">  at java<span class="selector-class">.util</span><span class="selector-class">.Arrays</span><span class="selector-class">.sort</span>(Arrays<span class="selector-class">.java</span>:<span class="number">659</span>) </span><br><span class="line">  at java<span class="selector-class">.util</span><span class="selector-class">.Collections</span><span class="selector-class">.sort</span>(Collections<span class="selector-class">.java</span>:<span class="number">217</span>)</span><br></pre></td></tr></table></figure><p>å¼‚å¸¸æ˜¾ç¤ºè¿åäº† general contractï¼Œè¿™äº› contract å…¶å®žåœ¨ Comparable#compareTo æ–¹æ³•çš„æ³¨é‡Šä¸­å°±è®²åˆ°äº†ï¼Œä¸»è¦å°±æ˜¯ç›¸åæ€§ã€ä¼ é€’æ€§ã€ç­‰ä»·æ€§ä¸‰æ¡ contractã€‚è¿™äº› contract å¯ä»¥å†™æˆä¸‹é¢è¿™æ ·çš„å½¢å¼ï¼š</p><ol><li><p>$sgn(x.compareTo(y)) = -sgn(y.compareTo(x)) $</p></li><li><p>$sgn(x.compareTo(y)) &gt; 0$ and $sgn(y.compareTo(z)) &gt; 0$ implies $sgn(x.compareTo(z)) &gt; 0$</p></li><li><p>$sgn(x.compareTo(y)) = 0$ implies sgn(x.compareTo(z)) = sgn(y.compareTo(z))$</p></li></ol><p>ä¸Šé¢çš„ $sgn$ å‡½æ•°å°±æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p><p><img src="http://tao93.top/images/2018/12/22/1545477555.png" alt=""></p><p>æ‰€ä»¥ç¬¬ä¸€æ¡çš„æ„æ€æ˜¯ x ä¸Ž y çš„æ¯”è¾ƒç»“æžœå’Œ y ä¸Ž x çš„æ¯”è¾ƒç»“æžœå¿…é¡»ç›¸åï¼›ç¬¬äºŒæ¡çš„æ„æ€æ˜¯ï¼Œæ¯”è¾ƒç»“æžœæ˜¯å…·æœ‰ä¼ é€’æ€§çš„ï¼Œç¬¬ 3 æ¡æ˜¯å¦‚æžœ x å’Œ y çš„æ¯”è¾ƒç»“æžœæ˜¯ç›¸ç­‰çš„ï¼Œé‚£ä¹ˆå®ƒä»¬ä¸Žä»»ä½• z çš„æ¯”è¾ƒç»“æžœç›¸åŒã€‚</p><p>ç®€å•å®žçŽ°çš„ compareTo æ–¹æ³•é€šå¸¸ä¸ä¼šè¿èƒŒä¸Šé¢çš„åè®®ï¼Œä¸è¿‡ï¼Œç¨å¾®å¤æ‚ç‚¹çš„ï¼Œå°±ä¸ä¸€å®šäº†ã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Object o2)</span> </span>&#123;</span><br><span class="line">    Data d2 = (Data) o2</span><br><span class="line">    <span class="keyword">if</span> (isSortByName()) &#123;</span><br><span class="line">        <span class="keyword">return</span> getName().compareTo(d2.getName());</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isSortByAge()) &#123;</span><br><span class="line">        <span class="keyword">return</span> getAge() - d2.getAge();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šé¢ä»£ç æ¥å®žçŽ° Comparable æŽ¥å£çš„å¯¹è±¡ï¼Œç„¶åŽè¿›è¡ŒæŽ’åºï¼Œæ˜¯å¯èƒ½å­˜åœ¨çš„é—®é¢˜çš„ã€‚åœ¨ä¸€æ¬¡å®Œæ•´çš„æŽ’åºè¿‡ç¨‹ä¸­ï¼Œä¸Šé¢çš„ compareTo æ–¹æ³•éœ€è¦è°ƒç”¨å¤šæ¬¡ï¼Œä½†æ˜¯ä¸Šé¢çš„ isSortByName å’Œ isSortByAge æ–¹æ³•çš„è¿”å›žæ˜¯å¯èƒ½å˜åŒ–çš„ï¼Œæ¯”å¦‚å¤šçº¿ç¨‹æƒ…å†µä¸‹å…¶ä»–çº¿ç¨‹å¯èƒ½ä¿®æ”¹äº† isSortByName æ–¹æ³•æ‰€ä½¿ç”¨çš„å˜é‡çš„å€¼ã€‚å½“ isSortByName çš„ç»“æžœå˜åŒ–æ—¶ï¼Œæ„å‘³ç€æŽ’åºçš„æ¯”è¾ƒæ ‡å‡†ä¹Ÿå˜äº†ï¼Œè‡ªç„¶éžå¸¸å®¹æ˜“è¿åå‰é¢è¯´åˆ°çš„ contractã€‚</p><p>è€Œä¸‹é¢çš„ä»£ç ç‰‡æ®µï¼ŒåŒæ ·æ˜¯æœ‰é—®é¢˜çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Object o2)</span> </span>&#123;</span><br><span class="line">    Data d2 = (Data) o2</span><br><span class="line">    <span class="keyword">boolean</span> date1Empty = TextUtils.isEmpty(getDateStr());</span><br><span class="line">    <span class="keyword">boolean</span> date2Empty = TextUtils.isEmpty(d2.getDateStr());</span><br><span class="line">    <span class="keyword">if</span> (date1Empty &amp;&amp; date2Empty) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (! date1Empty &amp;&amp; ! date2Empty) &#123;</span><br><span class="line">        SimpleDateFormat format = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"...."</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Date date1 = format.format(getDateStr());</span><br><span class="line">            Date date2 = format.format(d2.getDateStr());</span><br><span class="line">            <span class="keyword">return</span> date1.compareTo(date2);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(ParseException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„é—®é¢˜åœ¨äºŽï¼ŒParseException è¢«æ•èŽ·å¹¶ä¸”ç›´æŽ¥è¿”å›ž 0 äº†ã€‚è¿™æ„å‘³ç€ä¸¤ä¸ª date string åªè¦æœ‰ä¸€ä¸ªæ˜¯æ— æ³•è§£æžçš„ï¼Œé‚£ä¹ˆæ¯”è¾ƒç»“æžœå°±æ˜¯0ï¼Œä¹Ÿå°±æ˜¯ç›¸ç­‰ã€‚åŠ å…¥ a, b, c ä¸‰ä¸ª date stringï¼Œåªæœ‰ b æ˜¯æ— æ³•è§£æžçš„ï¼Œé‚£ä¹ˆ a å’Œ b æ¯”è¾ƒç»“æžœä¸º 0ï¼Œb å’Œ c æ¯”è¾ƒç»“æžœä¹Ÿæ˜¯ 0ï¼Œåˆ™æ ¹æ®ç¬¬ 3 æ¡ contractï¼Œa å’Œ c çš„æ¯”è¾ƒç»“æžœä¹Ÿåº”è¯¥æ˜¯ 0ï¼Œå¯æ˜¯ a å’Œ c éƒ½æ˜¯å¯ä»¥æ­£å¸¸è§£æžçš„ï¼Œå®ƒä»¬çš„æ¯”è¾ƒç»“æžœä¸ä¸€å®šæ˜¯ 0ã€‚æ‰€ä»¥ç¬¬ 3 æ¡ contract ä¼šè¢«è¿åã€‚</p><p>è¦æ”¹æ­£ä¸Šé¢çš„ä»£ç ç‰‡æ®µï¼Œå¯ä»¥ç›´æŽ¥æŠŠå¼‚å¸¸æŠ›å‡ºï¼Œä»¥æœŸæå‰å°†ä¸å¯è§£æžçš„ date string é¿å…æŽ‰ã€‚å¦ä¸€ç§æ–¹å¼æ›´å•°å—¦ç‚¹ï¼Œå°±æ˜¯ä¸¤ä¸ªä¸å¯è§£æžçš„ date string è®¤ä¸ºæ˜¯ç›¸ç­‰çš„ï¼Œç„¶åŽå¯è§£æžå’Œä¸å¯è§£æžçš„å­—ç¬¦ä¸²çš„æ¯”è¾ƒçº¦å®šå¥½å¤§å°å…³ç³»ï¼Œå¹¶ç¡®ä¿ç¬¦åˆç›¸åæ€§ contractã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>çŸ©é˜µè¿ç®—åœ¨ Android ä¸­çš„ç®€å•åœºæ™¯</title>
      <link href="/2018/12/04/%E7%9F%A9%E9%98%B5%E8%BF%90%E7%AE%97%E5%9C%A8%20Android%20%E4%B8%AD%E7%9A%84%E7%AE%80%E5%8D%95%E5%9C%BA%E6%99%AF/"/>
      <url>/2018/12/04/%E7%9F%A9%E9%98%B5%E8%BF%90%E7%AE%97%E5%9C%A8%20Android%20%E4%B8%AD%E7%9A%84%E7%AE%80%E5%8D%95%E5%9C%BA%E6%99%AF/</url>
      <content type="html"><![CDATA[<p>è®©æˆ‘ä»¬å…ˆä»Žä½äºŽ android.graphics åŒ…ä¸­çš„ Bitmap ç±»çš„ä¸€ä¸ªæ–¹æ³•å¼€å§‹è¯´èµ·ï¼Œä¹Ÿå°±æ˜¯ createBitmap(Bitmap source, int x, int y, int width, int height, Matrix m, boolean filter) è¿™æ ·ä¸€ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¸­æœ‰ä¸ªçŸ©é˜µå‚æ•°ï¼Œé€šè¿‡ä¼ å…¥æ­¤çŸ©é˜µå‚æ•°ï¼Œå¯ä»¥å°† source Bitmap ç»è¿‡ä¸€å®šçš„è½¬æ¢å†åˆ›å»ºç›®æ ‡ Bitmapã€‚é‚£ä¹ˆè¿™ä¸ªçŸ©é˜µæ˜¯æ€Žä¹ˆèµ·ä½œç”¨çš„å‘¢ï¼Ÿå…ˆçœ‹ä¸€æ®µç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Matrix matrix = <span class="keyword">new</span> Matrix();</span><br><span class="line">matrix.postRotate(<span class="number">90</span>);</span><br><span class="line">Bitmap bitmap2 = Bitmap.createBitmap(bitmap1, <span class="number">0</span>, <span class="number">0</span>, bitmap1.width(), bitmap1.getHeight(), matrix, <span class="keyword">true</span>);</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç åšçš„äº‹æƒ…æ˜¯å°† bitmap1 é¡ºæ—¶é’ˆæ—‹è½¬ 90Â° å¾—åˆ° bitmap2ï¼Œèµ·å…³é”®ä½œç”¨çš„å°±æ˜¯è¿™ä¸ª matrixã€‚ç¬¬ä¸€è¡Œä»£ç ä¼šå¾—åˆ°ä¸€ä¸ª 3Ã—3 çš„å•ä½çŸ©é˜µï¼Œè€Œç¬¬äºŒè¡Œä»£ç ä¹‹åŽï¼ŒçŸ©é˜µå°†ä¼šå˜æˆä¸‹é¢è¿™æ ·ï¼š</p><script type="math/tex; mode=display">  \begin{bmatrix}   0 & -1 & 0 \\   1 & 0 & 0 \\   0 & 0 & 1  \end{bmatrix} Â·  \begin{bmatrix}   1 & 0 & 0 \\   0 & 1 & 0 \\   0 & 0 & 1  \end{bmatrix} =  \begin{bmatrix}  0 & -1 & 0 \\  1 & 0 & 0 \\  0 & 0 & 1  \end{bmatrix}</script><p>æ³¨æ„åœ¨ xy å¹³é¢å†…é¡ºæ—¶é’ˆ rotate 90Â° çš„æ“ä½œå¯¹åº”çš„çŸ©é˜µæ˜¯ </p><script type="math/tex; mode=display">\begin{bmatrix}cos 90Â° & -sin 90Â° & 0 \\sin 90Â° & cos90Â° & 0 \\0 & 0 & 1\end{bmatrix} = \begin{bmatrix}   0 & -1 & 0 \\   1 & 0 & 0 \\   0 & 0 & 1  \end{bmatrix}</script><p>è®°ä¸Šé¢çš„çŸ©é˜µä¸º R90ï¼Œè®°ä¸Šé¢ä»£ç ä¸­çš„ matrix ä¸º Mï¼Œè®°å•ä½çŸ©é˜µä¸º Iï¼Œé‚£ä¹ˆç¬¬ 2 è¡Œçš„æ“ä½œåˆ™æ˜¯ç­‰åŒäºŽä¸‹é¢çš„è¡¨è¾¾å¼ï¼š</p><script type="math/tex; mode=display">M = R90Â·M</script><p>ä¹Ÿå°±æ˜¯:</p><script type="math/tex; mode=display">M = R90Â·I</script><p>æ³¨æ„ä¸Šé¢çš„ç‚¹ä¹˜é¡ºåºæ˜¯ R90 åœ¨å‰ï¼ŒI åœ¨åŽï¼ˆè™½ç„¶è¿™é‡Œ R90Â·I å’Œ IÂ·R90 ç»“æžœæ˜¯ä¸€æ ·ï¼Œä½†åˆ«çš„åœºæ™¯æœªå¿…å¦‚æ­¤ï¼‰ã€‚åŽŸå› æ˜¯ ä»£ç ä¸­æ˜¯ <code>postRotate</code> æ–¹æ³•ï¼Œè¿™é‡Œ <code>post</code> è¡¨ç¤ºæ˜¯æŠŠ rotate æ”¾åœ¨å˜æ¢çš„æœ€åŽä¸€æ­¥ã€‚è€Œå˜æ¢çŸ©é˜µä½œç”¨ R90Â·M ä½œç”¨åœ¨ç›®æ ‡å‘é‡ V æ—¶ï¼Œå°†ä¼šæ˜¯è¡¨è¾¾å¼ï¼š</p><script type="math/tex; mode=display">R90Â·MÂ·V</script><p>è¿™æ ·å°±å¯ä»¥ç†è§£ä¸ºæ˜¯å…ˆ MÂ·V ç„¶åŽè¿™ä¸ªç»“æžœå†è¢« R90 ä¹˜ï¼Œæ‰€ä»¥æ˜¯å…ˆåš M æœ¬æ¥çš„å˜æ¢ï¼Œç„¶åŽå†åš R90 çš„å˜æ¢ï¼Œä¹Ÿå°±æ˜¯ rotate 90Â° åœ¨æœ€åŽä¸€æ­¥ã€‚è¿™ä¹Ÿå°±æ˜¯ç¬¬ 2 è¡Œä»£ç çš„ postRotate 90Â° ç­‰ä»·äºŽ M = R90Â·M ä¹Ÿå°±æ˜¯ M = R90Â·I çš„åŽŸå› ã€‚</p><p>æ‰€ä»¥ç¬¬ 3 è¡Œä»£ç ä¼ å…¥çš„ matrix å°±æ˜¯ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}   0 & -1 & 0 \\   1 & 0 & 0 \\   0 & 0 & 1  \end{bmatrix}</script><p>çŽ°åœ¨æˆ‘ä»¬è¿›å…¥å‰é¢è¯´çš„ createBitmap è¿™ä¸ªæ–¹æ³•ä¸­åŽ»çœ‹çœ‹æºç æ˜¯æ€Žä¹ˆå®žçŽ°è¿™ä¸ªå˜æ¢çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">createBitmap</span><span class="params">(Bitmap source, <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> width, <span class="keyword">int</span> height, Matrix m, <span class="keyword">boolean</span> filter)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    Rect srcR = <span class="keyword">new</span> Rect(x, y, x + width, y + height);</span><br><span class="line">    RectF dstR = <span class="keyword">new</span> RectF(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">    RectF deviceR = <span class="keyword">new</span> RectF();</span><br><span class="line">    m.mapRect(deviceR, dstR);</span><br><span class="line">    neww = Math.round(deviceR.width());</span><br><span class="line">    newh = Math.round(deviceR.height());</span><br><span class="line">    bitmap = createBitmap(neww, newh, transformedConfig, transformed || source.hasAlpha());</span><br><span class="line">    </span><br><span class="line">    Canvas canvas = <span class="keyword">new</span> Canvas(bitmap);</span><br><span class="line">    canvas.translate(-deviceR.left, -deviceR.top);</span><br><span class="line">    canvas.concat(m);</span><br><span class="line">    canvas.drawBitmap(source, srcR, dstR, paint);</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> bitmap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ç¬¬ 3 è¡Œ srcR å°†æ˜¯ source Bitmap ä¸­è¦è¢«è½¬æ¢çš„éƒ¨åˆ†ã€‚è€Œ dstR æ˜¯åŒæ ·å®½é«˜ä½†æ˜¯å·¦ä¸Šè§’åœ¨ (0, 0) çš„çŸ©å½¢ã€‚ç¬¬ 6 è¡Œåˆ™æ˜¯å°† dstR å˜æ¢åŽå¾—åˆ° deviceRï¼Œæ ¹æ®å‰é¢æ‰€çŸ¥ çš„ m çš„å€¼ï¼Œå¯çŸ¥deviceR å°†ä¼šæ˜¯ left, top, right, bottom åˆ†åˆ«æ˜¯ -height, 0, 0, width:</p><p><img src="http://tao93.top/images/2018/12/04/1543937277.png" alt=""></p><p>å³ deviceR æ˜¯ dstR ç»•åŽŸç‚¹é¡ºæ—¶é’ˆæ—‹è½¬ 90Â° å¾—åˆ°çš„ã€‚ç´§æŽ¥ç€ä»£ç  7ã€8 è¡Œå¾—åˆ°è½¬æ¢åŽçš„ Bitmap çš„å®½é«˜ã€‚ç„¶åŽç¬¬ 9 è¡Œä»¥æ­¤å®½é«˜åˆ›å»ºäº†æ–°çš„ Bitmapã€‚ç¬¬ 11 è¡ŒåŸºäºŽæ­¤ Bitmap åˆ›å»ºäº† canvasã€‚</p><p>é‡ç‚¹æ¥äº†ï¼Œç¬¬ 12 è¡Œå¯¹æ­¤ canvas è¿›è¡Œå¹³ç§»å˜æ¢ï¼Œå¹³ç§»çš„ç›®çš„æ˜¯è®© deviceR çš„å·¦ä¸Šè§’ç§»åŠ¨åˆ°åŽŸç‚¹ã€‚ä»Žè€Œè®©å®ƒä½äºŽ x éžè´Ÿä¸” y éžè´Ÿçš„è±¡é™ã€‚è€Œç¬¬ 13 è¡Œåˆ™å°† m çŸ©é˜µçš„å˜æ¢ä½œç”¨åœ¨æ­¤ canvas æ˜¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¬¬ 12ã€13 è¡Œçš„å˜æ¢ï¼Œéƒ½æ˜¯ pre çš„å˜æ¢è€Œä¸æ˜¯ post çš„ã€‚æ‰€ä»¥å¯ä»¥çœ‹æˆ 13 è¡Œçš„å˜æ¢å…¶å®žæ˜¯æ¯”ç¬¬ 12 è¡Œçš„å¹³ç§»å…ˆæ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªå˜æ¢è¿‡ç¨‹å¯ç†è§£ä¸ºå…ˆç»•åŽŸç‚¹é¡ºæ—¶é’ˆæ—‹è½¬ 90Â°ï¼Œç„¶åŽå†å°†å·¦ä¸Šè§’å¹³ç§»åˆ°åŽŸç‚¹ï¼Œè¿™æ ·å°±æˆåŠŸçš„å®Œæˆäº†å°†åŽŸ Bitmap æ—‹è½¬ 90Â° å¹¶åˆ›å»ºæ–° Bitmap çš„æ“ä½œï¼Œè™½ç„¶è¿™é‡Œé™¤äº† rotateï¼Œå…¶å®žè¿˜åˆ©ç”¨äº† translation æ“ä½œã€‚</p><p>ç”¨ 3Ã—3 çŸ©é˜µåœ¨ xy å¹³é¢å†…å˜æ¢ï¼Œå¯ä»¥åˆ†ä¸º translate, rotate, scale, skew ä¸€å…± 4 ç§ï¼Œè¡¨ç¤ºè¿™å››ç§æ“ä½œçš„çŸ©é˜µåˆ†åˆ«è®°ä½œï¼š</p><script type="math/tex; mode=display">T(a, b),\ R(\theta),\ S(u, v),\ SKx(\theta), SKy(\theta)</script><p>é‚£ä¹ˆå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}   1 & 0 & a \\   0 & 1 & b \\   0 & 0 & 1\end{bmatrix},\ \begin{bmatrix}   cos(\theta) & -sin(\theta) & 0 \\   sin(\theta) & cos(\theta) & 0 \\   0 & 0 & 1\end{bmatrix},\ \begin{bmatrix}   u & 0 & 0 \\   0 & v & 0 \\   0 & 0 & 1\end{bmatrix},\ \begin{bmatrix}   1 & tan(\theta) & 0 \\   0 & 1 & 0 \\   0 & 0 & 1\end{bmatrix},\ \begin{bmatrix}   1 & 0 & 0 \\   tan(\theta) & 1 & 0 \\   0 & 0 & 1\end{bmatrix}</script><p>åˆ†åˆ«è¡¨ç¤ºçš„å«ä¹‰æ˜¯ï¼š</p><ol><li>å‘ +x æ–¹å‘å¹³ç§» a ä¸”å‘ +y æ–¹å‘å¹³ç§» bï¼›</li><li>ä»¥åŽŸç‚¹ä¸ºä¸­å¿ƒåœ¨ xy å¹³é¢æ—‹è½¬ theta è§’åº¦ï¼›</li><li>ä»¥åŽŸç‚¹ä¸º pivotï¼Œx æ–¹å‘å’Œ y æ–¹å‘åˆ†åˆ«ä¼¸ç¼©å€¼ä¸º u å’Œ v çš„æ¯”ä¾‹ï¼›</li><li>æ¯ä¸ªç‚¹çš„ $x$ åæ ‡å˜ä¸º $x + yÂ·tan(\theta)$ï¼Œè€Œ $y$ åæ ‡ä¸å˜ï¼Œè§†è§‰è¡¨çŽ°ä¸ºå›¾å½¢å‘ +y æ–¹å‘å€¾æ–œï¼Œå€¾æ–œè§’åº¦ä¸º $\theta$;</li><li>æ¯ä¸ªç‚¹çš„ $y$ åæ ‡å˜ä¸º $xÂ·tan(\theta) + y$ï¼Œè€Œ $x$ åæ ‡ä¸å˜ï¼Œè§†è§‰è¡¨çŽ°ä¸ºå›¾å½¢å‘ +x æ–¹å‘å€¾æ–œï¼Œå€¾æ–œè§’åº¦ä¸º $\theta$.</li></ol><p>æ³¨æ„, $T(a, 0)$ å’Œ $T(0, b)$ ç»„åˆèµ·æ¥çš„å˜æ¢ï¼Œç­‰ä»·äºŽ $T(a, b)$ï¼Œä¸”å’Œç»„åˆé¡ºåºæ— å…³ï¼Œè¿™ä»ŽçŸ©é˜µä¹˜æ³•ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}1 & 0 & a \\0 & 1 & 0 \\0 & 0 & 1\end{bmatrix}Â·\begin{bmatrix}1 & 0 & 0 \\0 & 1 & b \\0 & 0 & 1\end{bmatrix}=\begin{bmatrix}1 & 0 & 0 \\0 & 1 & b \\0 & 0 & 1\end{bmatrix}Â·\begin{bmatrix}1 & 0 & a \\0 & 1 & 0 \\0 & 0 & 1\end{bmatrix}=\begin{bmatrix}1 & 0 & a \\0 & 1 & b \\0 & 0 & 1\end{bmatrix}</script><p>åŒæ ·çš„ï¼Œ$S(u, 0)$ å’Œ $S(0, v)$ ç»„åˆèµ·æ¥ç­‰ä»·äºŽ $S(u, v)$ ä¸”å’Œç»„åˆé¡ºåºæ— å…³ã€‚è€Œ Skew æ— æ­¤æ€§è´¨ã€‚äº‹å®žä¸Šï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}1 & tan(\alpha) & 0 \\0 & 1 & 0 \\0 & 0 & 1\end{bmatrix}Â·\begin{bmatrix}1 & 0 & 0 \\tan(\beta) & 1 & 0 \\0 & 0 & 1\end{bmatrix}=\begin{bmatrix}1+tan(\alpha)tan(\beta) & tan(\alpha) & 0 \\tan(\beta) & 1 & 0 \\0 & 0 & 1\end{bmatrix}</script><p>è€Œï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}1 & 0 & 0 \\tan(\beta) & 1 & 0 \\0 & 0 & 1\end{bmatrix}Â·\begin{bmatrix}1 & tan(\alpha) & 0 \\0 & 1 & 0 \\0 & 0 & 1\end{bmatrix}=\begin{bmatrix}1 & tan(\alpha) & 0 \\tan(\beta) & 1+tan(\alpha)tan(\beta) & 0 \\0 & 0 & 1\end{bmatrix}</script><p>æŽ¥ä¸‹æ¥è¯´è¯´ Android ä¸­å’Œ 3Ã—3 çŸ©é˜µç›¸å…³çš„ä¸€äº›ç±»ï¼Œä¹Ÿå°±æ˜¯ <a href="https://developer.android.com/reference/android/graphics/Matrix" target="_blank" rel="noopener">Matrix</a>, <a href="https://developer.android.com/reference/android/graphics/Canvas" target="_blank" rel="noopener">Canvas</a>, <a href="https://developer.android.com/reference/android/graphics/Camera" target="_blank" rel="noopener">Camera</a> è¿™ 3 ä¸ªç±»ï¼Œæ³¨æ„æœ€åŽè¿™ä¸ª  Camera ç±»æ˜¯ android.graphics åŒ…ä¸­çš„ï¼Œè€Œä¸æ˜¯ android.hardware ä¸­çš„ã€‚</p><p>Matrix å¯¹è±¡è¡¨ç¤ºä¸€ä¸ª 3Ã—3 çŸ©é˜µï¼Œå¸¸ç”¨äºŽæŒ‡ç¤º x y å¹³é¢å†…çš„å˜æ¢ï¼Œæž„é€ å‡½æ•°åˆ›å»ºçš„éƒ½æ˜¯å•ä½çŸ©é˜µã€‚Matrix æœ‰ä¸€ç³»åˆ— set æ–¹æ³•ï¼Œç”¨äºŽè®¾ç½®çŸ©é˜µçš„å€¼ï¼Œè¿™äº›æ–¹æ³•å¯¹åº”äºŽä¸€äº›å¸¸è§çš„å˜æ¢æ“ä½œï¼Œæ¯”å¦‚ setScale(int sx, int sy) æ–¹æ³•ï¼Œå…¶å®žå°±æ˜¯æŠŠçŸ©é˜µ(ä¸ç®¡åŽŸæ¥æ˜¯ä»€ä¹ˆå€¼)å˜æˆä¸‹é¢çš„å€¼ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}sx & 0 & 0 \\0 & sy & 0 \\0 & 0 & 1\end{bmatrix}</script><p>ä¸Šé¢çš„ç¼©æ”¾æ˜¯ä»¥åŽŸç‚¹ä¸º pivot ç¼©æ”¾çš„ï¼Œæ­¤å¤–ï¼Œè¿˜æœ‰ setScale(float sx, float sy, float px, float py) è¿™æ ·ä»¥ (px, py) ä¸º pivot è¿›è¡Œç¼©æ”¾çš„æ“ä½œï¼Œç­‰ä»·äºŽæŠŠçŸ©é˜µå˜ä¸ºä¸‹é¢è¿™æ ·ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}sx & 0 & px(1-sx) \\0 & sy & py(1-sy) \\0 & 0 & 1\end{bmatrix}</script><p>æ³¨æ„ä»¥ä¸ŠçŸ©é˜µæ˜¯å¯ä»¥åˆ†è§£çš„ï¼Œåˆ†è§£ä¸ºä¸¤ä¸ªçŸ©é˜µï¼Œä¸”è¿™ä¸¤ä¸ªçŸ©é˜µäº¤æ¢ä½ç½®åŽçš„ç§¯ä¹Ÿæ˜¯ä¸Šé¢çš„çŸ©é˜µã€‚å…¶ä»–çš„ set æ–¹æ³•ä¸Žæ­¤ç±»ä¼¼ï¼Œå°±ä¸å¤šè¯´äº†ã€‚</p><p>Matrix è¿˜æœ‰ä¸€ç³»åˆ— post æ–¹æ³•å’Œ pre æ–¹æ³•ï¼Œæ¯”å¦‚ postRotate(int degrees) å’Œ preSkew(int kx, int ky) æ–¹æ³•ï¼Œå‰è€…ç›¸å½“äºŽ $M=R(degrees)Â·M$ï¼ŒåŽè€…ç›¸å½“äºŽ $M=MÂ·SK(kx,\ ky)$. æ³¨æ„è¿™é‡ŒçŸ©é˜µç›¸ä¹˜çš„é¡ºåºå–å†³äºŽæ˜¯ post è¿˜æ˜¯ pre.</p><p>å…¶å®ž Matrix ä¹Ÿå¯ä»¥åœ¨ 3 ç»´ç©ºé—´ä¸­å˜æ¢ï¼Œæ¯”å¦‚ä½¿ç”¨å®ƒçš„ setPolyToPoly æ–¹æ³•ï¼Œå¯ä»¥å¾—åˆ°æ»¡è¶³æŒ‡å®šçš„æ˜ å°„å…³ç³»çš„çŸ©é˜µã€‚è€Œè¿™ç§æ˜ å°„å…³ç³»å¯èƒ½éœ€è¦ 3 ä¸ºç©ºé—´çš„å˜æ¢æ‰èƒ½æ»¡è¶³ã€‚</p><p>Canvas ç±»åŒ…å«ä¸€ä¸ªå˜æ¢çŸ©é˜µï¼Œè¿™ä¸ªçŸ©é˜µå¯ä»¥ get ä¹Ÿå¯ä»¥ setï¼Œä¹Ÿå¯ä»¥ç”¨ concact(Matrix mat) æ¥æ”¹å˜ Canvas çš„å˜æ¢çŸ©é˜µçš„å€¼ï¼Œè¿™ä¸ªè¿‡ç¨‹ç­‰ä»·äºŽ $M=MÂ·mat$. å¦å¤–ï¼ŒCanvas çš„ drawBitmap æ–¹æ³•ä¹Ÿå¯ä»¥ä¼ å…¥ Matrix å¯¹è±¡æ¥æŽ§åˆ¶ bitmap è¢« draw æ—¶éœ€è¦çš„æ–½åŠ çš„å˜æ¢ã€‚Canvas çš„ translate å’Œ rotate ç­‰æ–¹æ³•ï¼Œéƒ½æ˜¯ pre ç±»åž‹çš„ï¼Œå¹¶ä¸”è¿™ç§å˜åŒ–ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯å¯¹ canvas çš„åæ ‡ç³»è¿›è¡Œå˜åŒ–ã€‚æ— å˜æ¢æ—¶ï¼Œåæ ‡ç³»åŽŸç‚¹åœ¨å¯è§åŒºåŸŸçš„å·¦ä¸Šè§’ï¼Œè€Œ +x å‘å³ï¼Œ+y å‘ä¸‹ã€‚translate(10, 0) åŽï¼Œcanvas åŽŸç‚¹å‘å³ç§»åŠ¨ 10ï¼Œæ­¤åŽç»˜åˆ¶åœ¨ (0, 0) ä½ç½®çš„ä¸œè¥¿ï¼Œå…¶å®žæ˜¯ä½äºŽå¯è§åŒºåŸŸçš„å·¦ä¸Šè§’å³ä¾§è·ç¦»ä¸º 10 çš„åœ°æ–¹ã€‚</p><p>ä»¥ä¸Šè¯´çš„å¯è§åŒºåŸŸï¼Œå…¶å®žæ˜¯ Canvas ä¸­çš„ clip æ¦‚å¿µï¼Œè¿™æ˜¯ä¸€ä¸ªæè¿°å¯è§åŒºåŸŸçš„çŸ©å½¢ã€‚ä¸€èˆ¬ Canvas çš„åˆå§‹ clip çš„ ltrb fåˆ†åˆ«ä¸º 0, 0, view width, view height. å½“ Canvas å˜æ¢æ—¶ï¼Œå¯ç†è§£ä¸ºå…¶åæ ‡ç³»å˜æ¢äº†ï¼Œé‚£ä¹ˆè‡ªç„¶ clip ä¹Ÿä¼šè·Ÿç€å˜åŒ–ï¼Œæ¯”å¦‚ translate(10, 0) åŽï¼Œclip çš„ ltrb å°±å˜ä¸º -10, 0, view width - 10, view height.</p><p>Canvas å‡ºäºŽçµæ´»æ€§è€ƒè™‘ï¼Œæœ‰ save å’Œ restore ä¸¤ä¸ªæ–¹æ³•ç”¨äºŽä¿å­˜å’Œæ¢å¤å˜æ¢çš„çŠ¶æ€ï¼Œå¸¸ç”¨åšæ³•æ˜¯ï¼Œåœ¨æ— å˜æ¢æ—¶ save ä¸€ä¸‹ï¼Œç„¶åŽå˜æ¢å¹¶åšç»˜åˆ¶ï¼Œæœ€åŽrestoreï¼Œä»¥é¿å…å½±å“å…¶å®ƒç»˜åˆ¶å·¥ä½œã€‚å‡ºäº†translateã€rotateã€Skewã€Scale è¿™äº› 2 ç»´å˜æ¢ï¼ŒCanvas è¿˜æœ‰ä¸€ç³»åˆ— clip æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å°† Canvas è¿›ä¸€æ­¥å‰ªè£ï¼Œå¹¶æ ¹æ®å‰ªè£åŽå¯è§åŒºåŸŸæ˜¯å¦ä¸ºç©ºè¿”å›žå¸ƒå°”å€¼ã€‚å‰ªè£æ“ä½œä¹Ÿæ˜¯å¯ä»¥ save å’Œ restore çš„ï¼Œä½†æ˜¯æ³¨æ„å‰ªè£æ“ä½œå¹¶ä¸å˜æ¢åæ ‡ç³»ã€‚</p><p>Camera å¯¹è±¡ä¸“é—¨ç”¨äºŽè®¡ç®—å˜æ¢ï¼Œä¸”åŒ…å« 3 ç»´ç©ºé—´ä¸­çš„å˜æ¢(ç›¸å Matrix å¯¹è±¡å…¶å®žåªæ˜¯ xy å¹³é¢å†…çš„å˜æ¢)ï¼Œå®ƒçš„å˜æ¢è®¡ç®—ç»“æžœæ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œå¯é€šè¿‡ getMatrix æ–¹æ³•å¾—åˆ°ï¼Œä¸€èˆ¬ä¼šå°†æ­¤çŸ©é˜µç”¨ä½œå®ƒç”¨ï¼Œå¯ä»¥å°† Camera ç†è§£ä¸ºä¸€ä¸ªå˜æ¢è®¡ç®—å™¨ã€‚å‡ºäºŽçµæ´»æ€§çš„è€ƒè™‘ï¼ŒCamera å¯¹è±¡ä¸­æœ‰ save å’Œ restore æ“ä½œï¼Œè¿™å°±åƒæ˜¯ git ä¸­çš„ stash å’Œ pop stash æ“ä½œä¸€æ ·ï¼Œå¯ä»¥æŠŠå½“å‰çš„å˜æ¢ä¿å­˜ï¼Œå¹¶åœ¨åŽé¢æŸä¸ªæ—¶å€™æ¢å¤å‡ºæ¥ï¼Œæ¢å¤ä¹‹å‰çš„å€¼å°†ä¼šä¸¢å¤±ã€‚ä¸åŒçš„æ˜¯ï¼Œgit stash åŽ working tree å°†æ˜¯ clean çš„ï¼Œå³å·²ä¿®æ”¹çš„å†…å®¹éƒ½æ¸…ç©ºäº†ï¼Œè€Œ Camera å¯¹è±¡ save åŽï¼Œå®ƒçš„çŸ©é˜µè¿˜æ˜¯ save ä¹‹å‰çš„ï¼Œå¹¶ä¸ä¼šå˜æˆå•ä½çŸ©é˜µã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCamera çš„åæ ‡ç³»ï¼Œ+x æ˜¯å‘å³çš„ï¼Œ+y æ˜¯å‘ä¸Šçš„ï¼Œè€Œ +z æ˜¯å‘å±å¹•é‡Œé¢çš„ã€‚æ‰€ä»¥æ¯”å¦‚ Camera çš„ rotateZ(int degrees) æ–¹æ³•å’Œ Matrix çš„ [pre|post]Rotate(int degree) çš„æ—‹è½¬æ–¹å‘æ˜¯åè¿‡æ¥çš„ã€‚å‰è€…ç­‰ä»·äºŽé€†æ—¶é’ˆæ–¹å‘è½¬ï¼ŒåŽè€…åˆ™æ˜¯é¡ºæ—¶é’ˆæ–¹å‘è½¬ã€‚ä¸‹é¢çš„ä¾‹å­å¯ä»¥è¯´æ˜Žè¿™ä¸€ç‚¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Matrix mat1 = <span class="keyword">new</span> Matrix();</span><br><span class="line">Camera camera = <span class="keyword">new</span> Camera();</span><br><span class="line"></span><br><span class="line">camera.rotateZ(-<span class="number">90</span>);</span><br><span class="line">camera.getMatrix(mat1);</span><br><span class="line"></span><br><span class="line">Matrix mat2 = <span class="keyword">new</span> Matrix();</span><br><span class="line">mat2.preRotate(<span class="number">90</span>);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç æ‰§è¡ŒåŽ mat1 å’Œ mat2 éƒ½æ˜¯ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}0 & -1 & 0 \\1 & 0 & 0 \\0 & 0 & 1\end{bmatrix}</script><p>å¯¹äºŽ Camera å¯¹è±¡ï¼Œ è°ƒç”¨å®ƒçš„ translate ç­‰æ–¹æ³•ï¼Œä¼šä½¿å¾—å®ƒçš„ matrix å˜ä¸º Camera çš„åæ ‡ç³»ä¸­å¯¹åº”æ­¤å˜æ¢çš„å€¼ï¼Œè€Œè¿™æ ·çš„çŸ©é˜µï¼Œåœ¨åº”ç”¨åœ¨ Canvas ä¸Šè¿›è¡Œç»˜åˆ¶æ—¶ï¼Œåˆæ˜¯ä½œç”¨åœ¨ +y å‘ä¸‹çš„åæ ‡ç³»ä¸­ã€‚æ‰€ä»¥æ¯”å¦‚ Camera translate(10, -20, 0) åŽå¾—åˆ°çš„çŸ©é˜µæ˜¯ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}1 & 0 & 10 \\0 & 1 & 20 \\0 & 0 & 1\end{bmatrix}</script><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ Camera åœ¨ z æ–¹å‘è¿›è¡Œ translate æ“ä½œæ—¶ï¼Œå˜æ¢å¯¹è±¡åœ¨å±å¹•ä¸Šçš„æŠ•å½±å¤§å°å‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥ï¼Œå®žé™…å˜æ¢æ•ˆæžœæ˜¯ä¸€ä¸ªç¼©æ”¾å˜æ¢ï¼Œæ‰€ä»¥ Camera getMatrix çš„ç»“æžœï¼Œä¹Ÿæ˜¯ä¸€ä¸ªäºŒç»´ç¼©æ”¾å˜æ¢çš„çŸ©é˜µã€‚Camera çš„ location ä¹Ÿå°±æ˜¯ 3D æŠ•å½±ä¸­çš„ camera ä½ç½®ï¼ˆè§‚å¯Ÿè€…ä½ç½®ï¼‰ï¼Œæ­¤ä½ç½®é»˜è®¤æ˜¯ (0, 0, -8)ï¼Œæ³¨æ„è¿™ä¸ª -8 å®žé™…ç›¸å½“äºŽ -576 ä¸ªåƒç´ ã€‚å½“ z æ–¹å‘ translate è·ç¦»ä¸ºæ­£æ—¶ï¼Œç›¸å½“äºŽè¿œç¦»è§‚å¯Ÿè€…ï¼Œæœ€ç»ˆå°±æ˜¯ç¼©å°çš„å˜æ¢ï¼Œåæ­£æ˜¯æ”¾å¤§çš„å˜æ¢ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å¾®ä¿¡ Android ç‰ˆæ˜¯å¦‚ä½•è®¡æ­¥çš„</title>
      <link href="/2018/11/23/%E5%BE%AE%E4%BF%A1%20Android%20%E7%89%88%E6%98%AF%E5%A6%82%E4%BD%95%E8%AE%A1%E6%AD%A5%E7%9A%84/"/>
      <url>/2018/11/23/%E5%BE%AE%E4%BF%A1%20Android%20%E7%89%88%E6%98%AF%E5%A6%82%E4%BD%95%E8%AE%A1%E6%AD%A5%E7%9A%84/</url>
      <content type="html"><![CDATA[<p>å¾ˆæ—©ä»¥å‰ï¼Œæˆ‘ä½¿ç”¨ä¸€éƒ¨ iPhone 5S æ‰‹æœºï¼Œè¿™æ˜¯ç¬¬ä¸€æ¬¾å¸¦æœ‰è®¡æ­¥åŠŸèƒ½çš„ iPhone æœºåž‹ï¼Œè‹¹æžœç§°ä¹‹ä¸ºæ­è½½è¿åŠ¨åå¤„ç†å™¨ã€‚å¦‚æžœæˆ‘æ²¡è®°é”™ï¼ŒiOS çš„è¿åŠ¨æ•°æ®ï¼Œæ—¢å¯ä»¥è¢«ç¬¬ä¸‰æ–¹ app è¯»å–ï¼Œä¹Ÿå¯ä»¥è¢«å†™å…¥ã€‚è¯»å–å¥½è¯´ï¼Œå†™å…¥æ˜¯å› ä¸ºç”¨æˆ·å¯èƒ½ä½¿ç”¨æ‰‹çŽ¯ä¹‹ç±»çš„ä¸œè¥¿æ¥è®°å½•æ•°æ®ï¼Œé‚£ä¹ˆè¿™äº›æ•°æ®å¯èƒ½æ¯” iOS ç³»ç»Ÿä¸­çš„æ•°æ®æ›´å—ç”¨æˆ·é‡è§†ï¼Œæ‰€ä»¥å°±å¯ä»¥æŠŠ iOS ç³»ç»Ÿä¸­çš„æ•°æ®æ›¿æ¢ä¸ºæ‰‹çŽ¯äº§ç”Ÿçš„æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦å…è®¸å†™å…¥ã€‚ä¸è¿‡ç›®å‰è€Œè¨€ï¼ŒAndroid ç³»ç»Ÿä¸­ï¼Œç¬¬ä¸‰æ–¹åº”ç”¨ä¼¼ä¹Žæ— æ³•å†™å…¥ç³»ç»Ÿçš„è¿åŠ¨æ•°æ®ï¼Œè€Œåªèƒ½è¯»å–ã€‚</p><p>å›žåˆ°æ­£é¢˜ï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œå¾®ä¿¡æœ‰ä¸ªå¾®ä¿¡è¿åŠ¨åŠŸèƒ½ã€‚Android ç‰ˆå¾®ä¿¡æ˜¯æ€Žä¹ˆè®¡æ­¥çš„å‘¢ï¼Ÿæˆ‘æœ€å…ˆæ˜¯åœ¨å¾®ä¿¡çš„æƒé™é¡µå‘çŽ°å¾®ä¿¡å£°æ˜Žäº† Body Sensors æƒé™ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="http://tao93.top/images/2018/11/23/1542956043.png" alt=""></p><p>è¿™ä¸ªæƒé™å¾ˆæœ‰è¿·æƒ‘æ€§ï¼Œè®©äººä»¥ä¸ºæœ‰è¿™ä¸ªå°±å¯ä»¥è¯» Android ç³»ç»Ÿäº§ç”Ÿçš„è®¡æ­¥æ•°æ®äº†ã€‚äº‹å®žä¸Šï¼ŒæŠŠè¿™ä¸ªæƒé™å…³äº†ï¼Œç„¶åŽæ™ƒåŠ¨æ‰‹æœº 20 æ¬¡ï¼Œå†è¿›å…¥å¾®ä¿¡è¿åŠ¨ï¼Œæ­¥æ•°å¾ˆå‡†ç¡®çš„å¢žåŠ äº† 20 æ¬¡å·¦å³ï¼Œæ‰€ä»¥è¿™ä¸ªæƒé™å¹¶ä¸å½±å“è¯»å–è®¡æ­¥æ•°æ®ã€‚</p><p>é‚£è¿™ä¸ªæƒé™å¯ä»¥å¹²å˜›å‘¢ï¼ŸBody Sensors æƒé™è¢«åˆ—ä¸º dangerous permissionï¼Œæ‰€å±žçš„ permission group ä»…æœ‰è¿™ä¸€ä¸ªæƒé™ã€‚ä¸è¿‡å¾ˆé—æ†¾ï¼Œæˆ‘åœ¨ç½‘ä¸ŠæŸ¥äº†æŒºä¹…ï¼Œæ²¡æœ‰æŸ¥åˆ°èŽ·å¾—è¿™ä¸ªæƒé™åŽå¯ä»¥ç”¨æ¥å†™ä»€ä¹ˆä»£ç åšä»€ä¹ˆäº‹æƒ…ã€‚å€˜è‹¥æƒ³è¦äº†è§£æ­¤æƒé™çš„æ ¹åº•ï¼Œä¼°è®¡éœ€è¦åœ¨ AOSP ä¸­æ‰¾ç­”æ¡ˆäº†ã€‚å¯æƒœæˆ‘ç”µè„‘ä¸Šæ¬¡å‡çº§å¤±è´¥åŽï¼Œç›®å‰æˆ‘ç”µè„‘ä¸­æ²¡æœ‰å®Œæ•´çš„ AOSPã€‚</p><p>å°±ç›®å‰æˆ‘åœ¨ç½‘ä¸Šäº†è§£åˆ°çš„ä¿¡æ¯è€Œè¨€ï¼Œæ­¤æƒé™ä¼¼ä¹Žæ²¡ä»€ä¹ˆç”¨ï¼Œå¾ˆå¤šå¸–å­éƒ½åœ¨è¯¢é—® Google Play Services ä¸ºä½•è¦ä½¿ç”¨æ­¤æƒé™ä»¥åŠæ˜¯å¦å¯ä»¥å…³é—­è¯¥æƒé™ã€‚æˆ‘æ‰‹ä¸­çš„ Pixel XL ä¹Ÿä»…æœ‰ Google Play Services å’Œå¾®ä¿¡å£°æ˜Žäº†æ­¤æƒé™ï¼š</p><p><img src="http://tao93.top/images/2018/11/24/1543033517.png" alt=""></p><p>æ ¹æ®ç½‘ä¸Šçš„å¸–å­ï¼Œåœ¨ Android 7 æ—¶ä»£çš„æŸä¸ªæ—¶å€™ï¼ŒGmail æœ‰ä¸ª bugï¼Œå³å…³é—­ Google Play Services çš„ Body Sensors æƒé™åŽï¼ŒGmail ç–¯ç‹‚å¼¹æ¡†æ˜¾ç¤ºã€ŒThis app wonâ€™t work properly unless you allow Google Play Servicesâ€™ request to access the foloowing: <strong>Body Sensors</strong>ã€ï¼Œå°½ç®¡ Gmail ä»èƒ½æ­£å¸¸å·¥ä½œã€‚å› ä¸ºæ­¤å¼¹æ¡†å¤ªè¿‡æ€ªå¼‚ï¼ŒéšåŽè°·æ­Œä¿®å¤äº†æ­¤é—®é¢˜ï¼Œè¿™è¯´æ˜Žå³ä½¿æ˜¯ Google è‡ªå·±çš„åº”ç”¨ï¼Œä¹Ÿæ²¡æœ‰ä¸¥æ ¼å®¡æŸ¥è‡ªå·±æ˜¯å¦å£°æ˜Žäº†ä¸å¿…è¦çš„æƒé™ã€‚</p><p>å½“ç„¶æŠŠ Google Play Services çš„ Body Sensors æƒé™å…³é—­åŽï¼Œæ‰“å¼€ Google Fit åº”ç”¨æ—¶ï¼Œå¼¹å‡ºå’Œä¸Šé¢ç±»ä¼¼çš„æ¶ˆæ¯ï¼Œå¹¶ä¸” Google Fit ä¸å†æ˜¾ç¤ºæˆ‘çš„æ­¥æ•°ï¼Œä¹ä¸€çœ‹ï¼Œè¿™ä¼¼ä¹Žè¯´å¾—é€šã€‚ä½†æ˜¯ï¼Œæ­¤æ—¶å¾®ä¿¡ä»ç„¶å¯ä»¥æ­£å¸¸è®¡æ­¥ã€‚è¿™è¯´æ˜Žä½†å°±è®¡æ­¥è¿™ä¸€åŠŸèƒ½çœ‹ï¼ŒBody Sensors å¹¶éžå¿…è¦çš„ã€‚</p><p>äº‹å®žä¸Šæˆ‘çš„è®¡æ­¥ Demo åº”ç”¨å¦‚ä¸Šè¿°å¾®ä¿¡ä¸€æ ·ï¼Œä¹Ÿè¿˜å¯ä»¥è®¡æ­¥ã€‚è®¡æ­¥ Demo ä¸­çš„ä»£ç éžå¸¸ç®€å•ï¼ŒGoogle è‡ªå·±ä¹Ÿæœ‰ä¸ªå±•ç¤ºæ­¤åŠŸèƒ½çš„ç®€å•é¡¹ç›® <a href="https://github.com/googlesamples/android-BatchStepSensor" target="_blank" rel="noopener">android-BatchStepSensor</a>ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒGoogle çš„ç®€å•é¡¹ç›®ä¸­ manifest å£°æ˜Žäº†ä¸¤é¡¹ use-featureï¼Œä½†å…¶å®žè¿™ä¹Ÿä¸æ˜¯å¿…è¦çš„ã€‚ç¬¬ä¸‰æ–¹åº”ç”¨æ— éœ€å£°æ˜Žä»»ä½•æƒé™ï¼Œæ— éœ€å£°æ˜Žä»»ä½• use-featureï¼Œåªéœ€æ³¨å†Œä¸€ä¸ª android.hardware.SensorEventListener æŽ¥å£ï¼Œå³å¯åœ¨æ­¤æŽ¥å£çš„ onSensorChanged æ–¹æ³•ä¸­æºæºä¸æ–­çš„æ”¶åˆ°æ­¥æ•°æ›´æ–°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSensorChanged</span><span class="params">(SensorEvent event)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (event.sensor.getType()) &#123;</span><br><span class="line">        <span class="keyword">case</span> Sensor.TYPE_STEP_DETECTOR:</span><br><span class="line">            stepDetector ++;</span><br><span class="line">            tvDetector.setText(stepDetector + <span class="string">""</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> Sensor.TYPE_STEP_COUNTER:</span><br><span class="line">            <span class="comment">// event.values[0] is step count since last reboot of Android device</span></span><br><span class="line">            stepCounter = (<span class="keyword">int</span>) event.values[<span class="number">0</span>];</span><br><span class="line">            tvCounter.setText(stepCounter + <span class="string">""</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ç¬¬ä¸‰æ–¹åº”ç”¨å°±å¯ä»¥è®¡æ­¥äº†ï¼Œå³ä½¿ç¬¬ä¸‰æ–¹åº”ç”¨è¿›ç¨‹ç»ˆæ­¢ï¼Œä¹Ÿå¯ä»¥åœ¨åº”ç”¨å†æ¬¡è¿è¡Œæ—¶ï¼Œåœ¨ onSensorChanged æ–¹æ³•ä¸­å¾—çŸ¥æ–°çš„æ­¥æ•°ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç³»ç»Ÿè¿”å›žçš„æ­¥æ•°å§‹ç»ˆæ˜¯ä¸Šæ¬¡é‡å¯è®¾å¤‡åŽçš„æ€»æ­¥æ•°ã€‚é‚£ä¹ˆç¬¬ä¸‰æ–¹åº”ç”¨ä½¿ç”¨è¿™ç§æ–¹å¼è®¡æ­¥æ—¶ï¼Œä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå³åº”ç”¨è¿›ç¨‹è¢«æ€åŽï¼Œå¦‚æžœç”¨æˆ·å…ˆè¿åŠ¨ï¼Œç„¶åŽé‡å¯è®¾å¤‡ï¼Œç„¶åŽæ‰æ‰“å¼€ç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œé‚£ä¹ˆç¬¬ä¸‰æ–¹åº”ç”¨ä¼šä¸¢å¤±ä»Žåº”ç”¨è¢«æ€åˆ°è®¾å¤‡é‡å¯ä¹‹é—´çš„æ­¥æ•°ï¼Œè€ŒåªçŸ¥é“è®¾å¤‡é‡å¯åŽæ–°å¢žäº†å¤šå°‘æ­¥æ•°ã€‚</p><p>ç»è¿‡éªŒè¯ï¼Œæˆ‘çš„ demoã€å¾®ä¿¡è¿˜æœ‰ Google Fit å‡å­˜åœ¨æ­¤é—®é¢˜ã€‚è¿™è¯´æ˜Žå¾®ä¿¡å’Œ Google Fit (æˆ–è€…å®ƒä¾èµ–çš„ Google Play Services) éƒ½æ˜¯é€šè¿‡æ³¨å†Œ SensorEventListener æŽ¥å£æ¥èŽ·çŸ¥æ­¥æ•°çš„ã€‚è¿™ä¹Ÿè¯´æ˜Žäº†å¾®ä¿¡å£°æ˜Ž Body Sensors æƒé™æ˜¯å†—ä½™çš„ã€‚</p><p>é‚£ä¹ˆ Body Sensors æƒé™åˆ°åº•å¯ä»¥ç”¨æ¥åšä»€ä¹ˆï¼Ÿè¿™æ˜¯ä¸€ä¸ªå¾…å¡«çš„å‘ã€‚</p><p>å¯¹äº†ï¼Œç½‘ä¸Šè¿˜æœ‰ç§æ–¹å¼ï¼Œé€šè¿‡ç›‘å¬æ‰‹æœºåŠ é€Ÿåº¦æ„Ÿåº”å™¨çš„äº‹ä»¶æ¥è‡ªå·±è®¡æ­¥ï¼Œè‡³äºŽå‡†ç¡®æ€§ï¼Œé‚£å°±å—è‡ªå·±çš„ç®—æ³•çš„ç§‘å­¦æ€§å’Œå¤æ‚æ€§çš„é™åˆ¶äº†ã€‚æ–¹æ³•ä¹Ÿæ˜¯æ³¨å†Œ SensorEventListenerï¼Œä¸è¿‡æ³¨å†Œçš„ type æ˜¯ android.hardware.Sensor.TYPE_ACCELEROMETER è€Œéžå‰é¢çš„ TYPE_STEP_COUNTERã€‚æ›´å¤šç»†èŠ‚è§<a href="http://www.gadgetsaint.com/android/create-pedometer-step-counter-android/#.W_jYq5MzYkp" target="_blank" rel="noopener">æ­¤å¸–å­</a>ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä¸ä¸€æ ·çš„ RelativeLayout measure è¿‡ç¨‹</title>
      <link href="/2018/11/01/%E4%B8%8D%E4%B8%80%E6%A0%B7%E7%9A%84%20RelativeLayout%20measure%20%E8%BF%87%E7%A8%8B/"/>
      <url>/2018/11/01/%E4%B8%8D%E4%B8%80%E6%A0%B7%E7%9A%84%20RelativeLayout%20measure%20%E8%BF%87%E7%A8%8B/</url>
      <content type="html"><![CDATA[<p>ç›´æŽ¥ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­å±•ç¤º RelativeLayout çš„ä¸ä¸€æ ·ä¹‹å¤„ï¼š</p><p><img src="http://tao93.top/images/2018/11/01/1541079447.png" alt=""></p><p>å›¾ä¸­ï¼Œå·¦è¾¹æ˜¯ä¸€ä¸ªç®€å•çš„ Android layout ä¾‹å­ï¼Œä¾‹å­ä¸­åœ¨å¤–ä¾§æ˜¯ä¸€ä¸ªæœ€å¤§çš„ horizontal çš„ LinearLayoutï¼Œå®ƒæœ‰ 3 ä¸ª childï¼Œåˆ†åˆ«æ˜¯å·¦éƒ¨ã€åˆ†å‰²çº¿å’Œå³éƒ¨ã€‚å·¦éƒ¨å’Œå³éƒ¨éžå¸¸ç›¸ä¼¼ï¼Œéƒ½æ˜¯å¤–é¢ä¸€ä¸ª ViewGroup å†…åµŒä¸€ä¸ª TextViewï¼Œä¸” ViewGroup çš„é«˜åº¦éƒ½æ˜¯ wrapContent è€Œå†…åµŒçš„ TextView çš„é«˜åº¦éƒ½æ˜¯ matchParent.</p><p>å› ä¸º TextView èƒŒæ™¯éƒ½æ˜¯çº¢è‰²ï¼Œæ‰€ä»¥ä»Ž preview å¯ä»¥æ¸…æ™°çœ‹åˆ°ï¼Œå·¦éƒ¨çš„ TextView ç­‰æ•ˆäºŽ wrapContentï¼Œè€Œå³éƒ¨çš„ TextView åˆ™ç­‰æ•ˆäºŽ matchParentï¼Œè¿™å°±æ˜¯ RelativeLayout çš„ä¸ä¸€æ ·ã€‚ç®€è€Œè¨€ä¹‹å°±æ˜¯ï¼ŒRelativeLayout ä¸­å†…åµŒçš„ child tree çš„æ ¹èŠ‚ç‚¹ size å¦‚æžœæ˜¯ matchParentï¼Œé‚£ä¹ˆæ­¤ child tree æµ‹é‡å¾—åˆ°çš„ size å°†ä¼šæ˜¯æœ€å¤§åŒ–çš„ï¼Œå¯è¾¾åˆ° RelativeLayout size çš„ä¸Šé™ï¼Œè€Œå…¶ä½™å¸¸è§ ViewGroup æ²¡æœ‰æ­¤ç‰¹ç‚¹ï¼Œæ¯”å¦‚ LinearLayout, FrameLayout, ConstraintLayout ç­‰ã€‚</p><p>ç©¶å…¶åŽŸå› ï¼Œå¯ä»¥ä»Ž RelativeLayout ä¸­çš„ onMeasure æ–¹æ³•æ‰¾ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">        <span class="keyword">final</span> View child = views[i];</span><br><span class="line">        <span class="keyword">if</span> (child.getVisibility() != GONE) &#123;</span><br><span class="line">            <span class="keyword">final</span> LayoutParams params = (LayoutParams) child.getLayoutParams();</span><br><span class="line"></span><br><span class="line">            applyVerticalSizeRules(params, myHeight, child.getBaseline());</span><br><span class="line">            measureChild(child, params, myWidth, myHeight);</span><br><span class="line">            ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯ RelativeLayout#onMeasure çš„ç‰‡æ®µï¼Œå¯çŸ¥å¯¹æ‰€æœ‰ child è°ƒç”¨äº† measureChild æ–¹æ³•ï¼Œè€Œè¿™æ˜¯ä¸ª RelativeLayout çš„ private æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Measure a child. The child should have left, top, right and bottom information</span></span><br><span class="line"><span class="comment"> * stored in its LayoutParams. If any of these values is VALUE_NOT_SET it means</span></span><br><span class="line"><span class="comment"> * that the view can extend up to the corresponding edge.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> child Child to measure</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params LayoutParams associated with child</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> myWidth Width of the the RelativeLayout</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> myHeight Height of the RelativeLayout</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">measureChild</span><span class="params">(View child, LayoutParams params, <span class="keyword">int</span> myWidth, <span class="keyword">int</span> myHeight)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> childWidthMeasureSpec = getChildMeasureSpec(params.mLeft,</span><br><span class="line">            params.mRight, params.width,</span><br><span class="line">            params.leftMargin, params.rightMargin,</span><br><span class="line">            mPaddingLeft, mPaddingRight,</span><br><span class="line">            myWidth);</span><br><span class="line">    <span class="keyword">int</span> childHeightMeasureSpec = getChildMeasureSpec(params.mTop,</span><br><span class="line">            params.mBottom, params.height,</span><br><span class="line">            params.topMargin, params.bottomMargin,</span><br><span class="line">            mPaddingTop, mPaddingBottom,</span><br><span class="line">            myHeight);</span><br><span class="line">    child.measure(childWidthMeasureSpec, childHeightMeasureSpec);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»Žä¸Šè¿°æ–¹æ³•çœ‹ï¼Œå…ˆèŽ·å–åˆ° child measureSpecï¼Œç„¶åŽä¾æ¬¡ä¸ºå‚æ•°æ¥ measure æ¯ä¸ª childã€‚å†è¿›å…¥åˆ° RelativeLayout#getChildMeasureSpec è¿™ä¸ªæ–¹æ³•ä¸­çœ‹çœ‹ä¸‹é¢çš„é€»è¾‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (childStart != VALUE_NOT_SET &amp;&amp; childEnd != VALUE_NOT_SET) &#123;</span><br><span class="line">    <span class="comment">// Constraints fixed both edges, so child must be an exact size.</span></span><br><span class="line">    childSpecMode = isUnspecified ? MeasureSpec.UNSPECIFIED : MeasureSpec.EXACTLY;</span><br><span class="line">    childSpecSize = Math.max(<span class="number">0</span>, maxAvailable);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (childSize &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// Child wanted an exact size. Give as much as possible.</span></span><br><span class="line">        childSpecMode = MeasureSpec.EXACTLY;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (maxAvailable &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// We have a maximum size in this dimension.</span></span><br><span class="line">            childSpecSize = Math.min(maxAvailable, childSize);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// We can grow in this dimension.</span></span><br><span class="line">            childSpecSize = childSize;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childSize == LayoutParams.MATCH_PARENT) &#123;</span><br><span class="line">        <span class="comment">// Child wanted to be as big as possible. Give all available</span></span><br><span class="line">        <span class="comment">// space.</span></span><br><span class="line">        childSpecMode = isUnspecified ? MeasureSpec.UNSPECIFIED : MeasureSpec.EXACTLY;</span><br><span class="line">        childSpecSize = Math.max(<span class="number">0</span>, maxAvailable);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childSize == LayoutParams.WRAP_CONTENT) &#123;</span><br><span class="line">        <span class="comment">// Child wants to wrap content. Use AT_MOST to communicate</span></span><br><span class="line">        <span class="comment">// available space if we know our max size.</span></span><br><span class="line">        <span class="keyword">if</span> (maxAvailable &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// We have a maximum size in this dimension.</span></span><br><span class="line">            childSpecMode = MeasureSpec.AT_MOST;</span><br><span class="line">            childSpecSize = maxAvailable;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// We can grow in this dimension. Child can be as big as it</span></span><br><span class="line">            <span class="comment">// wants.</span></span><br><span class="line">            childSpecMode = MeasureSpec.UNSPECIFIED;</span><br><span class="line">            childSpecSize = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»Žä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼ŒchileSpecMode èµ‹å€¼ä¸º MeasureSpec.AT_MOST çš„åœ°æ–¹åªæœ‰ 27 è¡Œä¸€ä¸ªåœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯åªè¦ child å£°æ˜Žä¸º match_parentï¼Œé‚£ä¹ˆ child çš„ specMode ä¸å‡ºæ„å¤–å°±ä¼šæ˜¯ EXACTLYã€‚è€Œ EXACTLY æ„å‘³ç€æ­¤ child ä¸ºæ ¹èŠ‚ç‚¹çš„ view tree çš„æµ‹é‡ç»“æžœå°†ä¼šæ˜¯æ­¤ child çš„ specSizeï¼Œè€Œè¿™ä¸ª specSize æ˜¾ç„¶å°±æ˜¯ RelativeLayout èƒ½è¾¾åˆ°çš„æœ€å¤§ size (å¯èƒ½éœ€è¦å‡åŽ» paddingï¼ŒRelativeLayout å…¶å®ƒ child å æ®çš„ç©ºé—´ç­‰)ã€‚</p><p>é¡ºä¾¿å†çœ‹çœ‹ LinearLayout ç­‰ç­‰ä¸ºå•¥ä¸æ˜¯è¿™æ ·çš„ï¼Œäº‹å®žä¸Š LinearLayout ç­‰ä½¿ç”¨çš„æ˜¯ ViewGroup è¿™ä¸ªæŠ½è±¡åŸºç±»ä¸­çš„ getChildMeasureSpec æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getChildMeasureSpec</span><span class="params">(<span class="keyword">int</span> spec, <span class="keyword">int</span> padding, <span class="keyword">int</span> childDimension)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> specMode = MeasureSpec.getMode(spec);</span><br><span class="line">    <span class="keyword">int</span> specSize = MeasureSpec.getSize(spec);</span><br><span class="line">    <span class="keyword">int</span> size = Math.max(<span class="number">0</span>, specSize - padding);</span><br><span class="line">    <span class="keyword">int</span> resultSize = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> resultMode = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">switch</span> (specMode) &#123;</span><br><span class="line">    <span class="comment">// Parent has imposed an exact size on us</span></span><br><span class="line">    <span class="keyword">case</span> MeasureSpec.EXACTLY:</span><br><span class="line">        <span class="keyword">if</span> (childDimension &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            resultSize = childDimension;</span><br><span class="line">            resultMode = MeasureSpec.EXACTLY;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == LayoutParams.MATCH_PARENT) &#123;</span><br><span class="line">            <span class="comment">// Child wants to be our size. So be it.</span></span><br><span class="line">            resultSize = size;</span><br><span class="line">            resultMode = MeasureSpec.EXACTLY;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == LayoutParams.WRAP_CONTENT) &#123;</span><br><span class="line">            <span class="comment">// Child wants to determine its own size. It can't be</span></span><br><span class="line">            <span class="comment">// bigger than us.</span></span><br><span class="line">            resultSize = size;</span><br><span class="line">            resultMode = MeasureSpec.AT_MOST;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Parent has imposed a maximum size on us</span></span><br><span class="line">    <span class="keyword">case</span> MeasureSpec.AT_MOST:</span><br><span class="line">        <span class="keyword">if</span> (childDimension &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// Child wants a specific size... so be it</span></span><br><span class="line">            resultSize = childDimension;</span><br><span class="line">            resultMode = MeasureSpec.EXACTLY;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == LayoutParams.MATCH_PARENT) &#123;</span><br><span class="line">            <span class="comment">// Child wants to be our size, but our size is not fixed.</span></span><br><span class="line">            <span class="comment">// Constrain child to not be bigger than us.</span></span><br><span class="line">            resultSize = size;</span><br><span class="line">            resultMode = MeasureSpec.AT_MOST;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == LayoutParams.WRAP_CONTENT) &#123;</span><br><span class="line">            <span class="comment">// Child wants to determine its own size. It can't be</span></span><br><span class="line">            <span class="comment">// bigger than us.</span></span><br><span class="line">            resultSize = size;</span><br><span class="line">            resultMode = MeasureSpec.AT_MOST;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">//noinspection ResourceType</span></span><br><span class="line">    <span class="keyword">return</span> MeasureSpec.makeMeasureSpec(resultSize, resultMode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»Žä¸Šè¿°ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æžœ child å£°æ˜Žä¸º matchParent ä½†æ˜¯ RelativeLayout çš„ specMode æ˜¯ AT_MOST çš„è¯ï¼Œé‚£ä¹ˆ child çš„ specMode å¦‚ç¬¬ 35 è¡Œæ‰€ç¤ºå°†ä¼šæ˜¯ AT_MOSTï¼Œè¿™å°±æ˜¯å’Œ RelativeLayout çš„ä¸åŒä¹‹å¤„ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œå³ä½¿ RelativeLayout çš„ specMode æ˜¯ AT_MOSTï¼Œåªè¦å®ƒçš„ child å£°æ˜Ž matchParentï¼Œé‚£ä¹ˆ child çš„ SpecMode ä¸€èˆ¬ä¼šæ˜¯ EXACTLYï¼Œæ­¤ child ä¸ºæ ¹èŠ‚ç‚¹çš„ viewTree çš„æµ‹é‡ç»“æžœå°±æ˜¯æœ€å¤§åŒ–çš„ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä¸€é”®è®¾ç½® Android http proxy çš„å°è¯•</title>
      <link href="/2018/10/31/%E4%B8%80%E9%94%AE%E8%AE%BE%E7%BD%AE%20Android%20http%20proxy%20%E7%9A%84%E5%B0%9D%E8%AF%95/"/>
      <url>/2018/10/31/%E4%B8%80%E9%94%AE%E8%AE%BE%E7%BD%AE%20Android%20http%20proxy%20%E7%9A%84%E5%B0%9D%E8%AF%95/</url>
      <content type="html"><![CDATA[<p>è‡ªæ‰“æ¥åˆ°æ­å·žåŽï¼Œè°ƒè¯• Android app æ—¶ç”¨ Charles åšä»£ç†çš„åœºæ™¯æˆäº†éžå¸¸å¸¸è§çš„æ“ä½œï¼Œè€Œè®©äººçƒ¦æ¼çš„æ˜¯ï¼Œæ¯æ¬¡éƒ½éœ€è¦è¿›å…¥æ‰‹æœºçš„ WiFi -&gt; ç‚¹å‡»å½“å‰ WiFi -&gt; ç‚¹å‡»ç¼–è¾‘ -&gt; ç‚¹å‡» Advanced options -&gt; proxy é€‰æ‹© None æˆ–è€… Manual -&gt; ä¸Šä¸€æ­¥å¦‚æžœé€‰äº† Manual, åˆ™éœ€è¦è¾“å…¥ IP åœ°å€å’Œç«¯å£å· -&gt; ä¿å­˜ã€‚</p><p>è¿™æ ·ä¸€ä¸ªå…­ä¸ƒæ­¥çš„æ­¥éª¤ï¼ŒçœŸçš„å¾ˆè®©äººçƒ¦ï¼Œè€Œå¦‚æžœç”µè„‘çš„å±€åŸŸç½‘ IP åœ°å€ä¸å›ºå®šçš„è¯ï¼Œå°±æ›´åŠ è®©äººä¸çˆ½äº†ï¼Œæ„å‘³ç€æ¯æ¬¡ç”µè„‘é‡æ–°è”ç½‘åŽï¼Œæ‰‹æœºéƒ½éœ€è¦é‡æ–°è®¾ç½®ä»£ç†çš„ IPã€‚å°±ç®—ç”µè„‘ IP å›ºå®šï¼Œå½“æ‰‹æœºéœ€è¦ä½¿ç”¨ Charles ä»£ç†æˆ–è€…å…³é—­ä»£ç†ï¼Œéƒ½æ¯”è¾ƒéº»çƒ¦ã€‚æ‰€ä»¥å¾ˆä¹…å‰æˆ‘å°±æƒ³æœ‰æ²¡æœ‰æ–¹æ³•å¯ä»¥ä¸€é”®è®¾ç½®ä»£ç†ã€‚</p><p>æˆ‘çš„æž„æƒ³æ˜¯ï¼Œå¦‚æžœç”µè„‘ IP åœ°å€ä¸å›ºå®šï¼Œé‚£ä¹ˆä¸€é”®è®¾ç½®éœ€è¦åœ¨ç”µè„‘ä¸Šæ“ä½œï¼Œä¸ç„¶æ— æ³•èŽ·çŸ¥ç”µè„‘çš„ IPï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”µè„‘è¿è¡Œä¸ª socket serverï¼Œç„¶åŽæ‰‹æœºè¿žæŽ¥ï¼Œç„¶åŽç”µè„‘æŠŠ IP å‘ç»™æ‰‹æœºã€‚å¦‚æžœç”µè„‘ IP åœ°å€å›ºå®šï¼Œæœ€ç†æƒ³çš„åˆ™æ˜¯æ‰‹æœºä¸Šä¸€é”®è®¾ç½®ï¼Œè¿™æ ·å°±ä¸éœ€è¦ adb è¿žæŽ¥äº†ã€‚</p><p>ç»è¿‡ä¸€ç•ª google å’Œæƒ¨ç—›çš„å°è¯•ï¼Œæˆ‘å¾—çŸ¥äº†ä¸¤ç§å¹¶ä¸å®Œç¾Žçš„æ–¹æ³•ã€‚</p><p>æ–¹æ³•ä¸€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®ä»£ç†ä¿¡æ¯ exclListæ˜¯æ·»åŠ ä¸ç”¨ä»£ç†çš„ç½‘å€ç”¨çš„</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setHttpProxySetting</span><span class="params">(Context context, String host, <span class="keyword">int</span> port)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ClassNotFoundException, NoSuchMethodException, InvocationTargetException,</span></span><br><span class="line"><span class="function">            IllegalAccessException, NoSuchFieldException </span>&#123;</span><br><span class="line">        WifiManager wifiManager =(WifiManager)context.getSystemService(Context.WIFI_SERVICE);</span><br><span class="line">        WifiConfiguration config = getCurrentWifiConfiguration(wifiManager);</span><br><span class="line">        ProxyInfo mInfo = ProxyInfo.buildDirectProxy(host,port);</span><br><span class="line">        <span class="keyword">if</span> (config != <span class="keyword">null</span>)&#123;</span><br><span class="line">            Class clazz = Class.forName(<span class="string">"android.net.wifi.WifiConfiguration"</span>);</span><br><span class="line">            Class parmars = Class.forName(<span class="string">"android.net.ProxyInfo"</span>);</span><br><span class="line">            Method method = clazz.getMethod(<span class="string">"setHttpProxy"</span>,parmars);</span><br><span class="line">            method.invoke(config,mInfo);</span><br><span class="line">            Object mIpConfiguration = getDeclaredFieldObject(config,<span class="string">"mIpConfiguration"</span>);</span><br><span class="line"></span><br><span class="line">            setEnumField(mIpConfiguration, <span class="string">"STATIC"</span>, <span class="string">"proxySettings"</span>);</span><br><span class="line">            setDeclardFildObject(config,<span class="string">"mIpConfiguration"</span>, mIpConfiguration);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// save the settings</span></span><br><span class="line">            wifiManager.updateNetwork(config);</span><br><span class="line">            wifiManager.disconnect();</span><br><span class="line">            wifiManager.reconnect();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å–æ¶ˆä»£ç†è®¾ç½®</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">unSetHttpProxy</span><span class="params">(Context context)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ClassNotFoundException, InvocationTargetException, IllegalAccessException,</span></span><br><span class="line"><span class="function">            NoSuchFieldException, NoSuchMethodException </span>&#123;</span><br><span class="line">        WifiManager wifiManager = (WifiManager) context.getSystemService(Context.WIFI_SERVICE);</span><br><span class="line">        WifiConfiguration configuration = getCurrentWifiConfiguration(wifiManager);</span><br><span class="line">        ProxyInfo mInfo = ProxyInfo.buildDirectProxy(<span class="keyword">null</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (configuration != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;</span><br><span class="line">                configuration.setHttpProxy(mInfo);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Class clazz = Class.forName(<span class="string">"android.net.wifi.WifiConfiguration"</span>);</span><br><span class="line">                Class parmars = Class.forName(<span class="string">"android.net.ProxyInfo"</span>);</span><br><span class="line">                Method method = clazz.getMethod(<span class="string">"setHttpProxy"</span>,parmars);</span><br><span class="line">                method.invoke(configuration,mInfo);</span><br><span class="line">                Object mIpConfiguration = getDeclaredFieldObject(configuration,<span class="string">"mIpConfiguration"</span>);</span><br><span class="line">                setEnumField(mIpConfiguration, <span class="string">"NONE"</span>, <span class="string">"proxySettings"</span>);</span><br><span class="line">                setDeclardFildObject(configuration,<span class="string">"mIpConfiguration"</span>,mIpConfiguration);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            wifiManager.updateNetwork(configuration);</span><br><span class="line">            wifiManager.disconnect(); </span><br><span class="line">            wifiManager.reconnect();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ–¹æ³•ç›´æŽ¥èŽ·å–åˆ°å½“å‰è¿žæŽ¥çš„ WiFi configurationï¼Œç„¶åŽæŠŠå®ƒçš„ http proxy ç±»åž‹ (æžšä¸¾å˜é‡ï¼Œä¸»è¦æ˜¯ NONE å’Œ STATIC ä¸¤ä¸ªå€¼)ï¼Œå’Œå€¼ (å³ IP å’Œ port) ç”¨åå°„çš„æ–¹æ³•è®¾ç½®è¿›åŽ»ï¼Œç„¶åŽæ›´æ–° WiFi configurationï¼Œå¹¶æ–­å¼€ WiFi å¹¶é‡æ–°è¿žæŽ¥ WiFiã€‚ä»¥ä¸Šè®¾ç½®ä»£ç†å’Œå…³é—­ä»£ç†çš„åŠ¨ä½œï¼Œå…¨éƒ¨ç”±ä¸Šé¢çš„ä»£ç ä¸€é”®å®Œæˆï¼Œç›´æŽ¥åœ¨æ‰‹æœºä¸Šè¿è¡Œå³å¯ï¼Œå¹¶ä¸”ä»£ç è¿è¡Œç»“æžœå’Œæ‰‹æœº Settings ä¸­çš„ UI ç»“æžœæ˜¯ä¸€è‡´çš„ï¼Œæ„Ÿè§‰ç›¸å½“å®Œç¾Žã€‚</p><p>ç„¶è€Œæ–¹æ³•ä¸€ä¸æ”¯æŒ API 23 ä»¥ä¸Šçš„ Android ç³»ç»Ÿï¼Œè€Œæ‰€ç”¨ API 21 æµ‹è¯•æ˜¯å¯ä»¥å®Œç¾Žè¿è¡Œçš„ï¼Œåœ¨å¦‚ä»Š API 28 éƒ½å‘å¸ƒäº†çš„æ—¶å€™ï¼Œä¸æ”¯æŒ API 23 ä»¥ä¸Šå¯ä»¥è¯´è®©å®žç”¨æ€§å¤§æ‰“æŠ˜æ‰£ã€‚ä¸è¿‡è¿™æ˜¯å¯ä»¥ç†è§£çš„ï¼Œæ¯•ç«Ÿå¤„äºŽå®‰å…¨è€ƒè™‘ï¼Œä¸èƒ½è®©ç”¨æˆ·çš„æ‰‹æœºéšä¾¿è¢«ç¬¬ä¸‰æ–¹ app é»˜é»˜ä¿®æ”¹äº†ä»£ç†ï¼Œè¿™å¤ªå±é™©äº†ã€‚</p><p>æ–¹æ³•äºŒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell settings put global http_proxy &lt;ip&gt;:&lt;port&gt;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä»¥ä¸Šå‘½ä»¤åŽï¼ŒSettings ä¸­çš„ UI å¹¶æœªæ›´æ”¹ï¼Œä½†æ˜¯ä»£ç†å·²ç»ç”Ÿæ•ˆã€‚è¿™ä¸€æ–¹æ³•å®žé™…æ˜¯æ–°å¢žäº† Settings Provider ä¸­çš„ key valueï¼Œæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥æŸ¥çœ‹åˆ°è¿™ä¸€æ–°å¢ž key value:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb shell settings get global http_proxy</span><br><span class="line">adb shell settings get global global_http_proxy_host</span><br><span class="line">adb shell settings get global global_http_proxy_port</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String httpProxy = android.provider.Settings.Global.getString(contentResolver, android.provider.Settings.Global.HTTP_PROXY);</span><br><span class="line">String httpProxyHost = android.provider.Settings.Global.getString(contentResolver, android.provider.Settings.Global.GLOBAL_HTTP_PROXY_HOST);</span><br><span class="line">String httpProxyPort = android.provider.Settings.Global.getString(contentResolver, android.provider.Settings.Global.GLOBAL_HTTP_PROXY_PORT);</span><br></pre></td></tr></table></figure><p>Android ä¸è¿è¡Œç¬¬ä¸‰æ–¹åº”ç”¨æ–°å¢žè¿™æ ·çš„å±žæ€§å€¼ï¼Œè€Œåªæœ‰ read çš„æƒé™ï¼Œæ‰€ä»¥éœ€è¦ adb æ¥æ–°å¢žè¿™äº›å±žæ€§å€¼ï¼Œé™¤äº†è¿™ä¸ªç¼ºç‚¹ï¼Œè¿˜æœ‰æ›´è‡´å‘½çš„ç¼ºé™·ã€‚æ–¹æ³•äºŒçš„ reset proxy çš„æ–¹æ³•æ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">adb shell settings delete global http_proxy</span><br><span class="line">adb shell settings delete global global_http_proxy_host</span><br><span class="line">adb shell settings delete global global_http_proxy_port</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¯çš„ï¼Œç›®å‰æˆ‘å·²çŸ¥çš„æ–¹æ³•ï¼Œåªæœ‰é‡å¯æ‰èƒ½è®©ä¸Šè¿° delete ç”Ÿæ•ˆï¼Œå½“ç„¶æ‰‹åŠ¨é‡å¯éƒ½å¯ä»¥ã€‚</span></span><br><span class="line">adb reboot</span><br></pre></td></tr></table></figure><p>è¦ reset proxyï¼Œåˆ é™¤ key value å’Œé‡å¯ (ç›®å‰æˆ‘åªçŸ¥é“é‡å¯å¯ä»¥) ç¼ºä¸€ä¸å¯ï¼Œå¦åˆ™è®¾å¤‡åªèƒ½é€šè¿‡ proxy ä½¿ç”¨ httpã€‚ä¹Ÿå°±æ˜¯è¿žåˆ«çš„ wifi æˆ–è€…ä½¿ç”¨æ•°æ®æµé‡éƒ½ä¸èƒ½ä½¿ç”¨ httpï¼è¦æƒ³ä¸é‡å¯ï¼Œé™¤éžåœ¨å°† key value è®¾ç½®ä¸ºå¦ä¸€ä¸ªæœ‰æ•ˆçš„ proxy é…ç½®ï¼Œè¿™ä¸ªç¼ºé™·å¯ä»¥è¯´éžå¸¸è‡´å‘½äº†ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ShadowSocks for Gradle &amp; Shell</title>
      <link href="/2018/10/18/%E6%B3%A8%E6%84%8F%E4%B8%8B%E9%9D%A2%E7%9A%84%E7%AB%AF%E5%8F%A3%E5%8F%B7%E4%B8%8D%E4%B8%80%E5%AE%9A%E6%98%AF%201086/"/>
      <url>/2018/10/18/%E6%B3%A8%E6%84%8F%E4%B8%8B%E9%9D%A2%E7%9A%84%E7%AB%AF%E5%8F%A3%E5%8F%B7%E4%B8%8D%E4%B8%80%E5%AE%9A%E6%98%AF%201086/</url>
      <content type="html"><![CDATA[<p><a href="https://shadowsocks.org/" target="_blank" rel="noopener">ShadowSocks</a> æ˜¯ä¸ªå¾ˆå¥½çš„å·¥å…·ï¼Œå®ƒè‡ªå¸¦ PAC æ¨¡å¼å’Œå…¨å±€æ¨¡å¼ã€‚</p><p>ä¸è¿‡è¿™ä¸ªå…¨å±€æ¨¡å¼å¹¶ä¸èƒ½å®Œå…¨è®©æ•´å°ç”µè„‘çš„æ‰€æœ‰ç½‘ç»œè®¿é—®å…¨éƒ¨é€šè¿‡ä»£ç†è¿›è¡Œï¼Œæ¯”å¦‚ç»ˆç«¯å‘½ä»¤å°±ä¸å¯ä»¥ã€‚æˆ‘æ‰“å¼€å…¨å±€ä»£ç†åŽï¼Œç„¶åŽåœ¨ç»ˆç«¯æ‰§è¡Œ curl ip.cn å‘½ä»¤ï¼Œç»“æžœæ˜¾ç¤ºæ£€æŸ¥åˆ°çš„ IP åœ°å€ä¾ç„¶æ˜¯æœ¬æœºçœŸå®žçš„å…¬ç½‘ IP:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">âžœ  ~ <span class="selector-tag">curl</span> <span class="selector-tag">ip</span><span class="selector-class">.cn</span></span><br><span class="line">å½“å‰ <span class="selector-tag">IP</span>ï¼š122<span class="selector-class">.225</span><span class="selector-class">.224</span><span class="selector-class">.218</span> æ¥è‡ªï¼šæµ™æ±Ÿçœæ­å·žå¸‚ ç”µä¿¡</span><br></pre></td></tr></table></figure><p>è¦è®© shell ä¹Ÿä½¿ç”¨ä»£ç†ï¼Œå¯ä»¥æ‰§è¡Œä¸€ä¸‹å‘½ä»¤æ¥è®¾ç½®ä»£ç†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„ä¸‹é¢çš„ç«¯å£å·ä¸ä¸€å®šæ˜¯ 1086</span></span><br><span class="line"><span class="built_in">export</span> ALL_PROXY=socks5://127.0.0.1:1086</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æˆ‘ä½¿ç”¨çš„ç«¯å£å·æ˜¯ 1086ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘çš„ ShadowSocks å®¢æˆ·ç«¯çš„åå¥½è®¾ç½®ä¸­å¦‚ä¸‹æ‰€ç¤ºçš„è®¾ç½®é¡¹æ˜¯ 1086:</p><p><img src="http://tao93.top/images/2018/10/18/1539842647.png" alt=""></p><p>ä½†æ˜¯æ¯æ¬¡éƒ½æ‰§è¡Œä¸Šé¢çš„ export å‘½ä»¤å¾ˆéº»çƒ¦ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ shell çš„é…ç½®æ–‡ä»¶ä¸­è®¾ç½® aliasï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># enable proxy</span></span><br><span class="line"><span class="built_in">alias</span> proxy=<span class="string">"export ALL_PROXY=socks5://127.0.0.1:1086"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># disable proxy</span></span><br><span class="line"><span class="built_in">alias</span> unproxy=<span class="string">"unset ALL_PROXY"</span></span><br></pre></td></tr></table></figure><p>å‰ä¸¤å¤©æˆ‘å‘çŽ°åœ¨å®¶çš„æ—¶å€™ï¼ŒAndroid Studio æ— æ³•è®¿é—® Google çš„ maven ä»“åº“ï¼Œå³ä½¿æˆ‘å¼€å…¨å±€ä»£ç†ä¹Ÿä¸è¡Œï¼Œå³ä½¿æˆ‘åœ¨ terminal ä¸­æŒ‰å‰é¢æ–¹æ³•è®¾ç½® proxy å¹¶ä¸”ä½¿ç”¨ gradle å‘½ä»¤æ¥æž„å»ºä¹Ÿä¸è¡Œã€‚</p><p>ä¸ºæ­¤ï¼Œæˆ‘æ‰¾åˆ°äº†å‘ gradle è®¾ç½® proxy çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯åœ¨é¡¹ç›®çš„ local.properties æ–‡ä»¶ï¼ˆä¹‹æ‰€ä»¥é€‰è¿™ä¸ªæ–‡ä»¶æ˜¯å› ä¸ºè¿™ä¸ªæ–‡ä»¶ä¸€èˆ¬æ˜¯ä¸çº³å…¥ git ç®¡ç†çš„ï¼Œæ‰€ä»¥æˆ‘å¯ä»¥éšä¾¿è‡ªå®šä¹‰åœ°ä¿®æ”¹ï¼‰åŠ å…¥ä¸‹é¢çš„è®¾ç½®ï¼Œå³å¯è®© gradle ä½¿ç”¨ä»£ç†ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.gradle.<span class="attribute">jvmargs</span>=-Xmx4536m <span class="attribute">-DsocksProxyHost</span>=127.0.0.1 <span class="attribute">-DsocksProxyPort</span>=1086</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ç«¯å£å·å’Œå‰é¢çš„æ–¹æ³•ä¸­æ˜¯ä¸€è‡´çš„ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> ShadowSocks </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Don&#39;t let Your App Drain your Users&#39; Battery</title>
      <link href="/2018/10/10/Don&#39;t%20let%20Your%20App%20Drain%20your%20Users&#39;%20Battery/"/>
      <url>/2018/10/10/Don&#39;t%20let%20Your%20App%20Drain%20your%20Users&#39;%20Battery/</url>
      <content type="html"><![CDATA[<h3 id="What-drives-battery-Life"><a href="#What-drives-battery-Life" class="headerlink" title="What drives battery Life?"></a>What drives battery Life?</h3><ol><li>Hardware (Screen etc.)</li><li>Operating System</li><li>Apps &amp; Services</li><li>User Interaction</li></ol><h3 id="Efforts-to-improve-battery"><a href="#Efforts-to-improve-battery" class="headerlink" title="Efforts to improve battery"></a>Efforts to improve battery</h3><ol><li><a href="https://developer.android.google.cn/reference/android/app/job/JobScheduler" target="_blank" rel="noopener">Job Scheduler</a> (Since API 21)</li><li>Doze &amp; App Standby(Since API 23)</li><li>Doze on-the-go (Since API 24)</li><li>Background Limits (Since API 26)</li><li>Adaptive Battery, Background Restrictions etc. (Since API 28)</li></ol><p>Among the above <strong>only Job Scheduler</strong> could be directly leveraged by app developers in the code.</p><h4 id="Job-Scheduler-Since-API-21"><a href="#Job-Scheduler-Since-API-21" class="headerlink" title="Job Scheduler (Since API 21)"></a>Job Scheduler (Since API 21)</h4><p>Job Scheduler is suitable when we want to do something in a specified circumstance, such as:</p><blockquote><p>Batterry is not Low</p><p>With specified Netwoek Status</p><p>Is Charging</p><p>Storage is not Low</p><p>Device is Idle</p></blockquote><p>Without Job Scheduler, we may need to keep a service running to monitor specified system broadcast and then do what we want, which is not optimized for battery comparing to Job Scheduler. </p><p>Here is a simple example of Job Scheduler:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyJobService</span> <span class="keyword">extends</span> <span class="title">JobService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onStartJob</span><span class="params">(<span class="keyword">final</span> JobParameters params)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> AsyncTask&lt;Void, Void, Void&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> Void <span class="title">doInBackground</span><span class="params">(Void... voids)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// stuffs that consumes a lot of time like making a backup to the cloud</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPostExecute</span><span class="params">(Void aVoid)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// tell scheduler our job is done</span></span><br><span class="line">                jobFinished(params, <span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.execute();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// return true to tell scheduler our job is not finished.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onStopJob</span><span class="params">(JobParameters params)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> sJobId = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> JobScheduler mJobScheduler;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        mJobScheduler = (JobScheduler)getSystemService(Context.JOB_SCHEDULER_SERVICE);</span><br><span class="line"></span><br><span class="line">        findViewById(R.id.schedule_btn).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                scheduleAJob();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scheduleAJob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (JobInfo info : mJobScheduler.getAllPendingJobs()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (info.getId() == sJobId) &#123;</span><br><span class="line">                <span class="comment">// the last scheduled job is not finished yet</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// build the jobInfo that requires charging, idle and network that won't charge.</span></span><br><span class="line">        JobInfo jobInfo = <span class="keyword">new</span> JobInfo.Builder(++ sJobId, <span class="keyword">new</span> ComponentName(<span class="keyword">this</span>, MyJobService.class))</span><br><span class="line">                .setRequiresCharging(<span class="keyword">true</span>)</span><br><span class="line">                .setRequiresDeviceIdle(<span class="keyword">true</span>)</span><br><span class="line">                .setRequiredNetworkType(JobInfo.NETWORK_TYPE_UNMETERED)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        mJobScheduler.schedule(jobInfo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Doze-Since-API-23"><a href="#Doze-Since-API-23" class="headerlink" title="Doze (Since API 23)"></a>Doze (Since API 23)</h4><p>Unplugged and stationary for a period of time, a device would be in doze mode, which restricts all apps regardless whether they targets api 23. However, the OS periodically exits Doze for a brief time to let apps complete their deferred jobs. The bried time slot is called Maintenance window. Below is a figure showing the mode changing:</p><p><img src="http://tao93.top/images/2018/10/10/1539151703.png" alt=""></p><p>In doze mode, the following are restricted:</p><ol><li>Network access is suspended</li><li>WakeLock is ignored</li><li>Standard AlarmManager alarms (setExact() and setWindow()) are deferred to the next maintenance window</li><li>No Wi-Fi scaning</li><li>No <a href="https://developer.android.com/reference/android/content/AbstractThreadedSyncAdapter.html" target="_blank" rel="noopener">Sync Adapters</a></li><li>No JobScheduler jobs</li></ol><p>Stuffs not restricted by Doze:</p><ol><li>FCM high priority msg</li><li>Alarms set with setAndAllowWhileIdle() and setExactAndAllowWhileIdle()</li></ol><p>Testing Doze:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># if your device is connected with a cable, use the following to disable charging</span></span><br><span class="line">adb shell dumpsys battery unplug</span><br><span class="line"></span><br><span class="line"><span class="comment"># Force the system into Doze mode</span></span><br><span class="line">adb shell dumpsys deviceidle force-idle</span><br><span class="line"></span><br><span class="line"><span class="comment"># exit idle mode &amp; reactivate the device</span></span><br><span class="line">adb shell dumpsys deviceidle unforce</span><br><span class="line">adb shell dumpsys battery reset <span class="comment"># this also recovers charging</span></span><br></pre></td></tr></table></figure><h4 id="App-Standby-Since-API-23"><a href="#App-Standby-Since-API-23" class="headerlink" title="App Standby (Since API 23)"></a>App Standby (Since API 23)</h4><p>An app is idle if the followings are satisfies:</p><ol><li>No user touching for a certain period of time</li><li>No processes in the foreground (either as an activity or foreground service)</li><li>No notifications showing on the lock screen or in the notification center.</li><li>Not charging</li></ol><p>Testing App Standby:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># if your device is connected with a cable, use the following to disable charging</span></span><br><span class="line">adb shell dumpsys battery unplug</span><br><span class="line"></span><br><span class="line"><span class="comment"># check whether your app is in standby mode. A 'Idle=false' output means not in standby mode</span></span><br><span class="line">adb shell am get-inactive &lt;packageName&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Force the app into App Standby mode</span></span><br><span class="line">adb shell am <span class="built_in">set</span>-inactive &lt;packageName&gt; <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># exit Standby mode for your app</span></span><br><span class="line">adb shell am <span class="built_in">set</span>-inactive &lt;packageName&gt; <span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="Doze-on-the-go-Since-API-24"><a href="#Doze-on-the-go-Since-API-24" class="headerlink" title="Doze on-the-go (Since API 24)"></a>Doze on-the-go (Since API 24)</h3><p>A lighter Doze mode which activates when the phone is moving in our pockets or hands. Doze on-the-go allows WakeLock, Wifi Scaning and GPS etc, thatâ€™s why itâ€™s lighter than former Doze mode introduced in API 23.</p><p>Ignore Doze configuration:</p><p><img src="http://tao93.top/images/2018/10/10/1539154768.png" alt=""></p><h4 id="Background-Limits-Since-API-26"><a href="#Background-Limits-Since-API-26" class="headerlink" title="Background Limits (Since API 26)"></a>Background Limits (Since API 26)</h4><p>Background Limits affects apps that targets API 26 or higher and includes Background Service Limitations and Broadcast Limitations.</p><h5 id="Background-Service-Limitations"><a href="#Background-Service-Limitations" class="headerlink" title="Background Service Limitations"></a>Background Service Limitations</h5><p>For an app that targets API 26 or higher, itâ€™s in background if:</p><ol><li>No visible Activity</li><li>No foreground Service</li><li>Not InputMethod Service, Wallpaper service etc.</li></ol><p>After several minutes of being in background, background services are stopped by the OS. Replacing background services with Scheduler Jobs is fine in many cases.</p><h5 id="Broadcast-Limitations-Introduced-in-API-25-and-strengthened-in-API-26"><a href="#Broadcast-Limitations-Introduced-in-API-25-and-strengthened-in-API-26" class="headerlink" title="Broadcast Limitations (Introduced in API 25 and strengthened in API 26)"></a>Broadcast Limitations (Introduced in API 25 and strengthened in API 26)</h5><p>For an app that targets API 26 or higher, it:</p><ol><li>canâ€™t register receivers for implicit broadcasts in Manifest file</li><li>can register receivers for explicit broadcasts in Manifest file</li><li>can register receivers for any broadcasts runtimely</li></ol><p>Broadcasts that require a <a href="https://developer.android.com/guide/topics/manifest/permission-element.html#plevel" target="_blank" rel="noopener">signature permission</a> are exempted from this restriction.</p><p>In some cases, registering system broadcasts could be replaced by Scheduler Jobs, such as if we want to do something when the device is charging.</p><h3 id="Adaptive-Battery-Since-API-29"><a href="#Adaptive-Battery-Since-API-29" class="headerlink" title="Adaptive Battery (Since API 29)"></a>Adaptive Battery (Since API 29)</h3><p>A new feature based on Machine Learning.</p><ol><li>Limit battery for apps that are not used often.</li><li>Apps should be able to run quickly when they are needed.</li><li>Donâ€™t bother users to manage manually.</li></ol><p>Apps are arranged into 4 standby buckets: <code>Active</code>, <code>Working set</code>, <code>Frequent</code> and <code>Rare</code>. Limits are increased from <code>Active</code> to <code>Rare</code>:</p><p><img src="http://tao93.top/images/2018/10/10/1539157914.png" alt=""></p><p>An app is in <code>Active</code> if it:</p><ol><li>has launched an activity</li><li>is running a foreground service</li><li>has a sync adapter associated with a content provider used by a foreground app</li><li>has a notification clicked by the user</li></ol><p>An app is in <code>Working set</code> if it runs often but isnâ€™t active.</p><p>An app is in <code>Frequent</code> if it is used regularly, but not necessarily every day.</p><p>An app is in <code>Rare</code> if it is not often used.</p><p>Find out what bucket the app is currently in programmatically:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UsageStatsManager.getAppStandbyBucket()</span><br></pre></td></tr></table></figure><p>Test Standby Buckets:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># assgin your app into a specified bucket</span></span><br><span class="line">adb shell am <span class="built_in">set</span>-standby-bucket &lt;packagename&gt; active|working_set|frequent|rare</span><br><span class="line"></span><br><span class="line"><span class="comment"># check bucket assignments for one app or all apps</span></span><br><span class="line"><span class="comment"># the output '10 20 30 40' mean Active, Working set, Frequent, Rare respectively</span></span><br><span class="line">adb shell am get-standby-bucket [&lt;packagename&gt;]</span><br></pre></td></tr></table></figure><h3 id="Battery-Saver"><a href="#Battery-Saver" class="headerlink" title="Battery Saver"></a>Battery Saver</h3><p>New battery saver in API 29:</p><ol><li>No red status bar and has animation</li><li>Location service is off when screen is off</li><li>Battery level threshold is adjustable</li></ol><p>Apps are encouraged to switch to dark theme when battery saver is on.</p><p>Check whether battery saver is on programmatically:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((PowerManager)getSystemService(Context.POWER_SERVICE)).isPowerSaveMode()</span><br></pre></td></tr></table></figure><p>Test battery saver:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pretend to be in low battery status</span></span><br><span class="line">adb shell settings put global low_power 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># reset all configurations</span></span><br><span class="line">adb shell dumpsys battery reset</span><br></pre></td></tr></table></figure><h3 id="Background-Restrictions-Since-API-29"><a href="#Background-Restrictions-Since-API-29" class="headerlink" title="Background Restrictions (Since API 29)"></a>Background Restrictions (Since API 29)</h3><p>Two criterias:</p><ol><li>Apps targeting pre-Oreo and using background services</li><li>Excessive WakeLocks (&gt; 1hr in background)</li></ol><p>Background restrictions are decided by the users:</p><p><img src="http://tao93.top/images/2018/10/10/1539156945.png" alt=""></p><p>When Background Restrictions is enabled for an app, fllowings are restricted:</p><ol><li>Background jobs, alarms, services and network accessing</li><li>Location related updates </li><li>Foreground services</li></ol><p>Except GUI operation, Background restrictions could alse be finished via adb:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># enable background restrictions</span></span><br><span class="line">adb shell appops <span class="built_in">set</span> &lt;package_name&gt; RUN_ANY_IN_BACKGROUND ignore</span><br><span class="line"></span><br><span class="line"><span class="comment"># disable background restrictions</span></span><br><span class="line">adb shell appops <span class="built_in">set</span> &lt;package_name&gt; RUN_ANY_IN_BACKGROUND allow</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>é€šè¿‡ wifi è¿žæŽ¥ adb</title>
      <link href="/2018/09/26/%E9%80%9A%E8%BF%87%20wifi%20%E8%BF%9E%E6%8E%A5%20adb/"/>
      <url>/2018/09/26/%E9%80%9A%E8%BF%87%20wifi%20%E8%BF%9E%E6%8E%A5%20adb/</url>
      <content type="html"><![CDATA[<p>Android è°ƒè¯•æœ‰ä¸ªè®©äººä¸å¼€å¿ƒçš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯å¦‚æžœç”¨çœŸæœºè°ƒè¯•ï¼Œéœ€è¦ç”¨æ•°æ®çº¿è¿žæŽ¥åˆ° Android è®¾å¤‡ï¼Œè€Œå¯¹äºŽ type C æŽ¥å£çš„ MacBookï¼Œå¦‚æžœæ²¡æœ‰åŒç«¯ type C æ•°æ®çº¿ï¼Œé‚£ä¹ˆè¿˜å¾—ç”¨è½¬æŽ¥å™¨æ‰è¡Œã€‚ç›¸æ¯”è¾ƒçœŸæœºè°ƒè¯•ï¼Œå…¶å®žè¿˜å¯ä»¥ç”¨æ¨¡æ‹Ÿå™¨ï¼Œä¸è¿‡æ¨¡æ‹Ÿå™¨åªèƒ½æ”¯æŒ x86 ç±»åž‹çš„ native åº“ï¼Œå¹¶ä¸”ä¹Ÿè¿˜ä¼šæœ‰ä¸€äº›å…¶ä»–å±€é™æ€§ã€‚</p><p>å…¶å®žï¼ŒçœŸæœºä¹Ÿæ˜¯å¯ä»¥ç”¨å±€åŸŸç½‘æ— çº¿è¿žæŽ¥çš„ï¼Œåªéœ€è¦ç”µè„‘å’Œ Android è®¾å¤‡åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…ã€‚å¤§è‡´æ­¥éª¤å°±æ˜¯ä¸‹é¢å‡ æ¡å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…ˆç”¨æ•°æ®çº¿è¿žæŽ¥ï¼Œç¡®ä¿ adb devices å¯ä»¥çœ‹åˆ°è®¾å¤‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®© adb server é‡æ–°ä»¥ tcp æ¨¡å¼å¯åŠ¨ï¼Œç«¯å£æŒ‡å®šä¸º 5555</span></span><br><span class="line">adb tcpip 5555</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”µè„‘å’Œæ‰‹æœºä¹‹é—´å»ºç«‹æ— çº¿è¿žæŽ¥</span></span><br><span class="line">adb connect &lt;IP address of your Computer&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹”æŽ‰æ•°æ®çº¿ï¼Œæ­¤æ—¶å†æ£€æŸ¥ä¸€éæ˜¯å¦æ— çº¿è¿žæŽ¥æˆåŠŸ</span></span><br><span class="line">adb devices</span><br></pre></td></tr></table></figure><p>æ¯æ¬¡éƒ½æƒ³ä¸Šé¢è¿™æ ·æ‰§è¡Œä¸¤ä¸‰æ¡å‘½ä»¤æ˜¾ç„¶å¤ªç¹æ‚ï¼Œå°¤å…¶æ˜¯å…¶ä¸­è¿˜æœ‰ä¸€æ­¥è¦æ›¿æ¢ä¸ºç”µè„‘çš„å½“å‰å†…ç½‘ IPï¼Œæ‰€ä»¥åº”è¯¥å†™ä¸€ä¸ªè„šæœ¬æ¥æŠŠä¸Šé¢çš„ä¸œè¥¿ä¸€é”®æžå®šï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ˆæ–­å¼€ä¸€ä¸‹</span></span><br><span class="line">adb disconnect</span><br><span class="line"></span><br><span class="line">adb tcpip 5555</span><br><span class="line"></span><br><span class="line"><span class="comment"># sleep ä¸¤ç§’ï¼Œä¸ç„¶çš„è¯å› ä¸ºåˆšæ‰§è¡Œ adb tcpip 5555 é‚£ä¹ˆåŽç»­çš„å‘½ä»¤ä¼šæ‰¾ä¸åˆ° devices</span></span><br><span class="line">sleep 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥æ˜¯å¦å®‰è£…äº†é»‘åŸŸ</span></span><br><span class="line">adb shell pm list packages | grep <span class="string">'me\.piebridge\.brevent'</span></span><br><span class="line">has_brevent=$?</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$has_brevent</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="comment"># é‡æ–°å¯åŠ¨é»‘é˜ˆ</span></span><br><span class="line">    adb -d shell sh /data/data/me.piebridge.brevent/brevent.sh</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># èŽ·å– android è®¾å¤‡çš„ IP åœ°å€</span></span><br><span class="line">android_ip=`adb shell <span class="string">"ifconfig"</span> | grep <span class="string">'inet.*cast'</span> | awk <span class="string">'&#123;print $2&#125;'</span> | awk -F<span class="string">':'</span> <span class="string">'&#123;print $2&#125;'</span>`</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'Android device IP: '</span> <span class="variable">$android_ip</span></span><br><span class="line">adb connect <span class="variable">$android_ip</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„è„šæœ¬ä¸­ï¼Œä¼šæ£€æŸ¥æ˜¯å¦å®‰è£…äº†<a href="https://play.google.com/store/apps/details?id=me.piebridge.brevent&amp;hl=zh" target="_blank" rel="noopener">é»‘é˜ˆ</a>ï¼Œå¦‚æžœå®‰è£…äº†ï¼Œå°±ä¼šé‡æ–°å¯åŠ¨é»‘é˜ˆã€‚é»‘é˜ˆæ˜¯ä¸€æ¬¾ç®¡ç† Android åº”ç”¨è¿è¡ŒçŠ¶æ€çš„åº”ç”¨ï¼Œç”¨æ¥é™åˆ¶åº”ç”¨å”¤é†’å’Œå¸¸é©»åŽå°ã€‚Android 8.0 ä»¥ä¸Šçš„ç³»ç»Ÿï¼Œåªè¦ USB è°ƒè¯•é€‰é¡¹å‘ç”Ÿå˜æ›´ï¼Œé»‘é˜ˆå°±ä¼šåœæ­¢èµ·ä½œç”¨ï¼Œæ‰€ä»¥æ­¤å¤„éœ€è¦é‡æ–°è®©å®ƒè¿è¡Œèµ·æ¥ã€‚å¦å¤–ä¸Šé¢çš„è„šæœ¬ä¸­è¿˜é€šè¿‡ ifconfig å‘½ä»¤æ¥èŽ·å–åˆ°ç”µè„‘çš„å†…ç½‘ IPï¼Œç”¨äºŽæ‰§è¡Œ adb connect å‘½ä»¤ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> adb </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>è®°ä¸€æ¬¡æ··æ·†é—®é¢˜å¯¼è‡´çš„ bug</title>
      <link href="/2018/09/26/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B7%E6%B7%86%E9%97%AE%E9%A2%98%E5%AF%BC%E8%87%B4%E7%9A%84%20bug/"/>
      <url>/2018/09/26/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B7%E6%B7%86%E9%97%AE%E9%A2%98%E5%AF%BC%E8%87%B4%E7%9A%84%20bug/</url>
      <content type="html"><![CDATA[<p>æœ€è¿‘æŠŠ <a href="https://github.com/card-io/card.io-Android-SDK" target="_blank" rel="noopener">Card.IO</a> æ”¹é€ æˆä¸€ä¸ª aar ä¾èµ–æä¾›ç»™å…¬å¸çš„é¡¹ç›®ä½¿ç”¨ã€‚è¿™ä¸ª aar ä¸­ä½¿ç”¨äº†å‡ ä¸ª so åº“ã€‚åªä¸è¿‡æ²¡æœ‰æä¾› armeabi ç±»åž‹çš„ so åº“ï¼Œè€Œåªæœ‰ armeabi-v7a å’Œ armeabi-v8a ä¹‹ç±»çš„ so åº“ã€‚æ‰€ä»¥åˆæ¬¡æä¾›ç»™å…¬å¸é¡¹ç›®ä½¿ç”¨æ—¶ï¼Œå‡ºçŽ°äº†æ‰¾ä¸åˆ° so çš„é”™è¯¯ï¼Œä¹Ÿå°±æ˜¯ UnsatisfiedLinkError é”™è¯¯ã€‚ä¹Ÿå°±æ˜¯ä¸‹é¢è¿™æ ·çš„æç¤ºï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535807292.png" alt=""></p><p>åŽé¢æˆ‘æƒ³å°½åŠžæ³•æä¾›äº† armeabi ç±»åž‹çš„ so åº“ï¼Œè¿™ä¸ªé—®é¢˜å°±ç®—å‘Šä¸€æ®µè½äº†ï¼Œç„¶åŽè¿™è¿˜ä¸æ˜¯ç»“æŸã€‚ä»Šå¤©ï¼Œæµ‹è¯•åˆå‘äº†ä¸€æ®µå´©æºƒæ—¥å¿—ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢è¿™æ ·çš„æ—¥å¿—ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535807316.png" alt=""></p><p>å› ä¸ºä¹‹å‰å‡ºçŽ°è¿‡æ‰¾ä¸åˆ° so åº“çš„é—®é¢˜ï¼Œæ‰€ä»¥ä¹ä¸€çœ‹ä¸Šé¢çš„æ—¥å¿—ï¼Œæˆ‘ä»¬éƒ½ä»¥ä¸ºåˆæ˜¯æ‰¾ä¸åˆ° so åº“ (ä¸ºæˆ‘ä»¬çš„èœè¡¨ç¤ºç¾žæ„§ ðŸ¤©)ã€‚ç„¶åŽç»è¿‡ä¸Šç½‘æŸ¥æ‰¾ï¼Œå¹¶å’Œ native çš„ä»£ç å¯¹æ¯”ï¼Œæˆ‘æ‰æ„è¯†åˆ°ï¼Œä¸Šé¢çš„æ—¥å¿—å…¶å®žæ˜¯ so åº“æ˜¯æ‰¾åˆ°äº†çš„ï¼Œåªä¸è¿‡æ˜¯åŠ è½½ so åº“æ—¶ï¼Œè°ƒç”¨ JNI_onLoad è¿™ä¸ª native æ–¹æ³•æ—¶å‡ºé”™äº†ã€‚æ­¤å¤–ï¼Œå‘æµ‹è¯•è¦äº† debug åŒ…ï¼Œå‘çŽ°æ²¡æœ‰é—®é¢˜ï¼Œæ‰€ä»¥åˆæ­¥æ–­å®šæ˜¯æ··æ·†çš„é—®é¢˜ï¼Œç„¶åŽå°±æ˜¯æŽ’æŸ¥äº†ã€‚</p><p>æˆ‘æŠŠæµ‹è¯•æä¾›ç»™æˆ‘çš„ release åŒ…åç¼–è¯‘ï¼Œç„¶åŽå’Œ JNI_onLoad æ–¹æ³•ä¸­çš„ native ä»£ç å¯¹æ¯”ï¼Œç»ˆäºŽæ‰¾åˆ°åŽŸå› äº†ï¼šrelease åŒ…ä¸­ï¼Œæˆ‘æä¾›çš„åº“çš„æŸä¸ªæ–¹æ³•è¢«æ··æ·†æŽ‰äº†ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•æ˜¯éœ€è¦è¢« JNI_onLoad æ–¹æ³•è°ƒç”¨çš„ã€‚æ‰€ä»¥é—®é¢˜å°±æ˜¯ï¼šä¸€ä¸ªéœ€è¦è¢« so åº“è°ƒç”¨çš„ Java æ–¹æ³•è¢«æ··æ·†äº†ï¼å…¶å®žï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬çš„é¡¹ç›®å¼•å…¥ä¸€äº›è‘—åçš„ç¬¬ä¸‰æ–¹åŒ… (æ¯”å¦‚ Knife ä¹‹ç±»çš„) æ—¶ï¼Œéƒ½ä¼šåœ¨æˆ‘ä»¬çš„é¡¹ç›®çš„ Proguard é…ç½®æ–‡ä»¶ä¸­å£°æ˜Žä¸è¦æ··æ·†è¿™äº›ä¸‰æ–¹åŒ…çš„ä»£ç ï¼Œä¸ºçš„å°±æ˜¯é¿å…ä¸Šé¢è¿™ä¸ªé—®é¢˜ã€‚è¯´ä¸€å¥æ˜¾å¾—æœ‰ç‚¹åºŸè¯çš„è¯ï¼šç¬¬ä¸‰æ–¹åŒ…å‘å¸ƒæ··æ·†åŒ…æ—¶ï¼Œä»–ä»¬çš„ Proguard é…ç½®æ–‡ä»¶åªèƒ½åœ¨ä»–ä»¬çš„ aar åŒ…æž„å»ºæ—¶ç”Ÿæ•ˆï¼Œè€Œåœ¨ä»–ä»¬çš„ aar æž„å»ºåˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­æ—¶ï¼Œä»–ä»¬çš„ Proguard æ—©å·²éž­é•¿èŽ«åŠä¸èµ·ä½œç”¨äº†ã€‚</p><p>å›žåˆ°æˆ‘é‡åˆ°çš„è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æœ¬åœ°è‡ªæµ‹æ—¶ï¼Œå¾ˆå°‘ä¼šè¿›è¡Œæ··æ·†ï¼Œæœ¬åœ°çš„ release é»˜è®¤éƒ½æ˜¯æœªæ··æ·†çš„ (minifyEnabled æ˜¯ false)ï¼Œæ‰€ä»¥è‡ªæµ‹çš„æ—¶å€™æ ¹æœ¬æ²¡æœ‰æ³¨æ„åˆ°è¿™ä¸ªé—®é¢˜ã€‚è¿™æ¬¡è¿™ä¸ª bug çš„è§£å†³åŠžæ³•ä¹‹ä¸€æ˜¯ï¼Œåœ¨æœ€ç»ˆä½¿ç”¨æˆ‘çš„ aar çš„é¡¹ç›®ä¸­ï¼Œæ˜¾ç¤ºå£°æ˜Žä¸è¦æ··æ·†æˆ‘è¿™ä¸ª aar ä¸­çš„æŸäº›ä»£ç ï¼Œè¿™å°±å’Œä¸Šä¸€æ®µè¯´çš„å£°æ˜Žä¸æ··æ·†ç¬¬ä¸‰æ–¹åŒ…çš„ä»£ç æ˜¯ä¸€æ ·çš„ã€‚Butï¼Œè¿˜æœ‰ä¸€ç§æ›´å¥½çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯ä½¿ç”¨ com.android.support.support-annotations æ”¯æŒåº“ä¸­çš„ @Keep æ³¨è§£ï¼Œæ­¤æ³¨è§£å¯ä»¥æ ‡è®°å“ªäº›æ–¹æ³•æˆ–è€…ç±»åœ¨æœ€ç»ˆæž„å»º apk æ—¶ä¸ä¼šè¢«æ··æ·†æŽ‰ (å½“ç„¶åœ¨å‰é¢çš„ aar æž„å»ºç­‰è¿‡ç¨‹è‡ªç„¶ä¹Ÿä¸ä¼šæ··æ·†)ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œå½“å‰é¡¹ç›®çš„ Proguard é…ç½®æ–‡ä»¶åªèƒ½åœ¨å½“å‰é¡¹ç›®æž„å»ºè¾“å‡ºäº§ç‰©æ—¶èµ·ä½œç”¨ï¼Œè€Œæ— æ³•ç¡®ä¿è¾“å‡ºçš„äº§ç‰©äº¤ç»™å…¶ä»–é¡¹ç›®é›†æˆæ—¶ä¸è¢«æ··æ·†ã€‚è‹¥è¦ç¡®ä¿åŽè€…ï¼Œé‚£å°±å¯ä»¥ç”¨ support-annotations æ”¯æŒåº“ä¸­çš„æ³¨è§£äº†ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>è®°ä¸€ä¸ªç®€å•çš„é€’å½’é—®é¢˜ä¸Žè§£æ³•</title>
      <link href="/2018/09/26/%E8%AE%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E9%80%92%E5%BD%92%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E6%B3%95/"/>
      <url>/2018/09/26/%E8%AE%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E9%80%92%E5%BD%92%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E6%B3%95/</url>
      <content type="html"><![CDATA[<p>é€’å½’é—®é¢˜å°±åƒæ˜¯ä¿„ç½—æ–¯å¥—å¨ƒä¸€æ ·ç²¾å¦™ï¼Œå¤§çš„å¥—å°çš„ï¼Œä¸€å±‚ä¸€å±‚å¥—åœ¨ä¸€èµ·ã€‚</p><p>å‰äº›æ—¥å­ï¼Œä¸€ä¸ªæœ‹å‹è¯´çœ‹åˆ°ä¸€ä¸ªç®—æ³•é¢˜ç›®ï¼Œç„¶åŽé—®æˆ‘æœ‰æ€è·¯å—ï¼Ÿé—®é¢˜å°±æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535807089.png" alt=""></p><p>è¿™ä¸ªé—®é¢˜å¾ˆæ˜Žæ˜¾æ˜¯ä¸ªé€’å½’é—®é¢˜ã€‚æˆ‘å½“æ—¶å°±å¤¸ä¸‹æµ·å£è¯´ï¼Œ10åˆ†é’Ÿç»™ä½ å†™ä¸ª Python è„šæœ¬ã€‚è™½ç„¶å®žé™…ä¸Šç”¨äº†æŽ¥è¿‘ 30 åˆ†é’Ÿã€‚ã€‚ã€‚</p><p>è¨€å½’æ­£ä¼ ï¼Œè¿™ä¸ªé—®é¢˜çš„é€’å½’å…³ç³»åŒ…å«ä¸¤ç§ï¼Œ<strong>åµŒå¥—å…³ç³»</strong>å’Œ<strong>å¹¶åˆ—å…³ç³»</strong>ã€‚æ¯”å¦‚ 2[a]3[c] æœ€å¤–å±‚æ˜¯å¹¶åˆ—å…³ç³»ï¼Œå³ 2[a] å’Œ 3[c] æ˜¯ä¸¤ä¸ªäº’ç›¸å¹¶åˆ—çš„å­é—®é¢˜ï¼Œä»–ä»¬çš„è§£ç­”ä¸²èµ·æ¥å°±æ˜¯ 2[a]3[c] çš„è§£ç­”ã€‚è€Œ 2[2[a]] æœ€å¤–å±‚åˆ™æ˜¯ä¸€ä¸ªåµŒå¥—å…³ç³»ï¼Œå³è¦æ±‚ 2[2[a]] çš„è§£ç­”éœ€è¦å…ˆæ±‚å­é—®é¢˜ 2[a] çš„è§£ç­” (è¿™ä¸ªè§£ç­”æ˜¾ç¤ºå°±æ˜¯ aa)ï¼Œæ‰€ä»¥é—®é¢˜åŒ–è§£ä¸º 2[aa]ã€‚</p><p>æ‰€ä»¥æ€è·¯å°±æ˜¯ï¼Œå¯¹äºŽä¸€ä¸ªé—®é¢˜ Xï¼Œå…ˆæŒ‰å¹¶åˆ—å…³ç³»åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå­é—®é¢˜ X1, X2, â€¦, Xnï¼›å¦‚æžœ n å¤§äºŽ 1ï¼Œé‚£ä¹ˆå„ä¸ªå­é—®é¢˜çš„ç­”æ¡ˆä¸²èµ·æ¥å°±æ˜¯ç­”æ¡ˆäº†ï¼›å¦‚æžœ n ç­‰äºŽ 1ï¼Œé‚£ä¹ˆè¯´æ˜Ž X æœ€å¤–å±‚å¹¶ä¸æ˜¯å¹¶åˆ—å…³ç³»è€Œæ˜¯åµŒå¥—å…³ç³»æˆ–è€…æ ¹æœ¬å°±æ˜¯å•ä¸ªå­—æ¯ï¼Œå¦‚æžœ X æ˜¯å•ä¸ªå­—æ¯ï¼Œé‚£ä¹ˆç­”æ¡ˆå°±æ˜¯å®ƒæœ¬èº«ï¼Œåä¹‹ï¼Œé‚£ä¹ˆ X ä¸€å®šæ˜¯ s[Y] çš„å½¢å¼ï¼Œç­”æ¡ˆå°±æ˜¯ s ä¸ª Y çš„ç­”æ¡ˆä¸²èµ·æ¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">p_loc</span><span class="params">(input, left)</span>:</span></span><br><span class="line">    count = <span class="number">1</span></span><br><span class="line">    i = left</span><br><span class="line">    <span class="keyword">while</span> count &gt; <span class="number">0</span>:</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> input[i] == <span class="string">']'</span>:</span><br><span class="line">            count -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> input[i] == <span class="string">'['</span>:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do</span><span class="params">(input)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'['</span> <span class="keyword">not</span> <span class="keyword">in</span> input:</span><br><span class="line">        <span class="keyword">return</span> input</span><br><span class="line">    first = input.find(<span class="string">'['</span>)</span><br><span class="line">    i = p_loc(input, first)</span><br><span class="line">    <span class="keyword">if</span> i &lt; len(input) <span class="number">-1</span>:</span><br><span class="line">        parts = []</span><br><span class="line">        <span class="keyword">while</span> i &lt; len(input) <span class="number">-1</span>:</span><br><span class="line">            parts.append(input[:i+<span class="number">1</span>])</span><br><span class="line">            input = input[i+<span class="number">1</span>:]</span><br><span class="line">            first = input.find(<span class="string">'['</span>)</span><br><span class="line">            i = p_loc(input, first)</span><br><span class="line">        parts.append(input[:i+<span class="number">1</span>])</span><br><span class="line">        res = <span class="string">''</span></span><br><span class="line">        <span class="keyword">for</span> part <span class="keyword">in</span> parts:</span><br><span class="line">            res += do(part)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        right = p_loc(input, first)</span><br><span class="line">        sub_res = do(input[first+<span class="number">1</span>:right])</span><br><span class="line">        <span class="keyword">return</span> int(input[:first]) * sub_res</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">print(do(<span class="string">'2[a]3[c]'</span>))</span><br><span class="line">print(do(<span class="string">'2[2[a]]'</span>))</span><br><span class="line">print(do(<span class="string">'2[2[a]]3[c]'</span>))</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Algorithm </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æ—¥å¸¸ä¿® Bug</title>
      <link href="/2018/09/26/%E6%97%A5%E5%B8%B8%E4%BF%AE%20Bug/"/>
      <url>/2018/09/26/%E6%97%A5%E5%B8%B8%E4%BF%AE%20Bug/</url>
      <content type="html"><![CDATA[<p>å‰å‡ å¤©æœ‰äººæŠ¥å‘Šå·´è¥¿ç‰ˆæœ¬ä¹˜å®¢ç«¯æ‰«æé“¶è¡Œå¡çš„ç•Œé¢æœ‰ bugï¼Œå³å±å¹•å³ä¾§æœ‰ä¸€æ¡ç™½çº¿ï¼Œä¹Ÿå°±æ˜¯ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="http://tao93.top/images/2018/09/01/1535790364.png" alt=""></p><p>é‰´äºŽæŠ¥å‘Šäººæ²¡æå…·ä½“çš„ç‰ˆæœ¬å·ï¼Œä¹Ÿæ²¡ææ€Žä¹ˆå‡ºçŽ°çš„ï¼Œä¹Ÿæ²¡ææ˜¯ä»€ä¹ˆæœºåž‹å‡ºçŽ°çš„ï¼Œæˆ‘å°±å’ŒæŠ¥å‘Šäººè¯´æ²Ÿé€šäº†ä¸€ç•ªã€‚æŠ¥å‘Šäººè¯´åº”è¯¥æ˜¯å°ç±³ 6 å‡ºçŽ°è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘é‚å€Ÿäº†ä¸€éƒ¨å°ç±³ 6ï¼Œç„¶åŽè¿è¡Œ demo å¹¶æ²¡æœ‰å¤çŽ°ã€‚çŽ°åœ¨å°±æœ‰ä¸¤ç§å¯èƒ½ï¼Œç¬¬ä¸€æ˜¯åªæœ‰æŠ¥å‘Šäººé‚£å°å°ç±³ 6 æœ‰é—®é¢˜ï¼Œç¬¬äºŒæ˜¯ demo æ²¡é—®é¢˜ä½†æ˜¯é›†æˆåˆ°å·´è¥¿ç‰ˆæœ¬åŽå°±æœ‰é—®é¢˜äº†ã€‚ç»è¿‡è‰°è‹¦äº¤æ¶‰ï¼Œç»ˆäºŽä»Žå¯¹æ–¹é‚£é‡Œè¦åˆ°äº†ä¸€ä¸ªå®‰è£…åŒ…åŽï¼Œæˆ‘æ‰‹é‡Œæ‰‹æœºå¤çŽ°äº†æ­¤é—®é¢˜ï¼Œäº‹å®žå¾ˆå¿«å°±æ¸…æ¥šäº†ï¼šdemo æ²¡é—®é¢˜ä½†æ˜¯é›†æˆåŽæœ‰é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯å’Œæœºåž‹åŽ‹æ ¹æ²¡å…³ç³»ã€‚</p><p>å…ˆç›´æŽ¥ç»™å‡ºæœ€åŽä¿®å¤çš„æ–¹æ³•ï¼Œä¿®å¤æ–¹æ³•æ˜¯åœ¨æˆ‘çš„æ‰«å¡åº“çš„ activity ä¸­ï¼Œè°ƒç”¨ä»¥ä¸‹ä¸€è¡Œå°± OK äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»™ PhoneWindow è®¾ç½®ä¸€ä¸ªèƒŒæ™¯ </span></span><br><span class="line">getWindow().setBackgroundDrawable(<span class="keyword">new</span> ColorDrawable(Color.TRANSPARENT));</span><br></pre></td></tr></table></figure><p>å—¯ï¼Œä¿®å¤æ–¹æ³•å¾ˆç®€å•ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¿™æ ·åšå°± work äº†å‘¢ï¼ŸæŽ¥ä¸‹æ¥å°±æ˜¯è°ƒè¯•çš„è¿‡ç¨‹äº†.</p><p>é¦–å…ˆèŽ·å–ä¸€ä¸‹è¿™ä¸ªç•Œé¢çš„ layout ä¿¡æ¯ï¼Œå°è¯•çœ‹çœ‹å³ä¾§ç™½è‰²ç»†çº¿æ˜¯ä¸æ˜¯é¢å¤–å¡žè¿›åŽ»çš„è§†å›¾ï¼Œç»“æžœå¹¶ä¸æ˜¯ã€‚ç„¶åŽæˆ‘å†çœ‹æ˜¯å¦æ˜¯è®¾ç½®äº†ä»€ä¹ˆ padding å¯¼è‡´äº†è¿™ä¸ªé—®é¢˜ã€‚äº‹å®žä¸Šï¼Œæ­£å¼è¿™æ ·çš„ï¼Œå¯æƒœæˆ‘å¯èƒ½æ˜¯çžŽäº†çœ¼ï¼Œå±…ç„¶æ²¡æœ‰çœ‹åˆ°ä¸‹é¢çš„çº¿ç´¢ï¼Œå³ DecorView çš„å³ä¾§ padding æ˜¯ 2ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535790424.png" alt=""></p><p>æˆ‘åªçœ‹åˆ°äº†ä¸‹é¢çš„ LinearLayout çš„å®½åº¦æ˜¯1438ï¼Œæ¯”æˆ‘çš„æ‰‹æœºå±å¹•å®½åº¦1440å°‘äº†2ä¸ªåƒç´ ï¼Œæ˜¾ç„¶å°±æ˜¯å³ä¾§çš„ç™½çº¿äº†ã€‚</p><p><img src="http://tao93.top/images/2018/09/01/1535790483.png" alt=""></p><p>æ‰€ä»¥æˆ‘æ€Žä¹ˆåŠžå‘¢ï¼Œæˆ‘å¼€å§‹è°ƒè¯• measure å’Œ layout çš„è¿‡ç¨‹ã€‚å› ä¸º DecorView çš„å®½åº¦æ˜¯ 1440 æ²¡é”™ï¼Œå¯æ˜¯å®ƒçš„ Child LinearLayout å®½åº¦åªæœ‰ 1438ï¼Œæ‰€ä»¥æˆ‘å…ˆæ¡ä»¶æ–­ç‚¹åœ¨ LinearLayout ç±»ä¸­çš„ onMeasure æ–¹æ³•ã€‚æ–­ç‚¹çš„æ¡ä»¶æˆ‘æœ¬æ¥æƒ³å†™ getParent() instance DecorViewï¼Œç»“æžœå‘çŽ°æ— æ³•åº”ç”¨ DecorViewï¼ŒäºŽæ˜¯æˆ‘å°±æ”¹æˆäº† getParent() != null &amp;&amp; getParent().getParent() == nullï¼Œå…¶å®žè¿™æ˜¯ä¸å¯¹çš„ï¼ŒDecorView åŒæ ·æœ‰ Parentï¼Œä¹Ÿå°±æ˜¯ ViewRootImpl å¯¹è±¡ï¼Œæˆ‘æŠŠè¿™ä¸ªç»™å¿˜äº†ã€‚æ‰€ä»¥æ–­ç‚¹æ¡ä»¶å°±æˆäº†ä¸‹é¢è¿™æ ·è‡ƒè‚¿çš„äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getParent() != <span class="keyword">null</span> &amp;&amp; getParent().getParent() != <span class="keyword">null</span> &amp;&amp; getParent().getParent().getParent() == <span class="keyword">null</span> </span><br><span class="line"><span class="comment">// å½“ç„¶å…¶å®žè¿˜æœ‰æ›´ç®€æ´çš„æ–¹å¼ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ · </span></span><br><span class="line">getClass().getName.endswith(<span class="string">"DecorView"</span>)</span><br></pre></td></tr></table></figure><p>ç„¶åŽå‘çŽ°ä¸ç®¡æ˜¯ measure è¿˜æ˜¯ layout çš„è¿‡ç¨‹ï¼ŒLinearLayout å®½åº¦å§‹ç»ˆå°±æ˜¯ 1438ï¼ŒDecorView å°±åªç»™å®ƒç•™äº†è¿™ä¸ªå¤§ç©ºé—´ã€‚ç„¶åŽæˆ‘å¼€å§‹è°ƒè¯•åˆ° DecorView çš„æµ‹é‡è¿‡ç¨‹ä¸­ï¼Œæœ€åŽå‘çŽ°åœ¨ ViewGroup (è¿™é‡Œä»…ä»…æ˜¯ç”±äºŽ DecorView æ˜¯ç»§æ‰¿è‡ª ViewGroup çš„) çš„ measureChildWithMargins æ–¹æ³•ä¸­ï¼Œæ‰¾åˆ°äº†å…³é”®çº¿ç´¢ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535790538.png" alt=""></p><p>ä¹Ÿå°±æ˜¯ä¸Šé¢çš„ mPaddingRight çš„å€¼å±…ç„¶æ˜¯ 2 è€Œä¸æ˜¯ 0ï¼Œè¿™æ„å‘³ç€ DecorView çš„å³ä¾§ padding æ˜¯2ï¼Œè¿™æ ·å°±èƒ½è§£é‡Šé€šä¸ºå•¥ DecorView çš„ child å®½åº¦å°äº† 2 äº†ã€‚è¿™æ˜¯æˆ‘èµ¶ç´§å›žåŽ»çœ‹ layout ä¿¡æ¯ï¼Œç„¶åŽå°±å‘çŽ°äº†æˆ‘æœ¬æ¥æ—©å°±è¯¥å‘çŽ°çš„çº¿ç´¢äº†ã€‚</p><p>OKï¼ŒæŽ¥ä¸‹æ¥æ˜¯è¦çŸ¥é“ï¼Œè°æŠŠ DecorView çš„å³ä¾§ padding åŠ äº† 2 çš„ã€‚æˆ‘å¯¹ View ç±»çš„ mPaddingRight å±žæ€§åŠ äº†ä¸‹å›¾æ‰€ç¤ºçš„æ–­ç‚¹ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535790585.png" alt=""></p><p>æžœç„¶ï¼Œä¸ä¸€ä¼šå„¿ï¼Œæˆ‘å°±æœ‰äº†æ”¶èŽ·ï¼Œå¾—åˆ°äº†ä¸‹é¢çš„å †æ ˆï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535790614.png" alt=""></p><p>ä¸Šé¢å †æ ˆæ¸…æ™°äº†å±•ç¤ºäº†å³ä¾§ padding æ˜¯æ€Žä¹ˆè¢«è®¾ç½®ä¸º 2 çš„ï¼Œæ¦‚æ‹¬æ¥è¯´ï¼Œå°±æ˜¯ PhoneWindow åœ¨å‡†å¤‡ DecorView æ—¶ï¼Œæ£€æŸ¥åˆ°æœ‰ä¸€ä¸ª Drawableï¼Œç„¶åŽåœ¨è®¾ç½®è¿™ä¸ª Drawable æ—¶ï¼ŒåŽ»è®¾ç½®äº† paddingã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè®¾ç½® Drawable éœ€è¦è®¾ç½® padding å‘¢ï¼Ÿçœ‹ä¸‹å›¾å°±æ˜Žç™½äº†ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535790640.png" alt=""></p><p>åŽŸæ¥ï¼Œè¿™æ˜¯ä¸ªè‡ªå¸¦ padding çš„ NinePatchDrawableã€‚æŽ¥ä¸‹æ¥ï¼Œæˆ‘å°±æŸ¥æ‰¾äº†ä¸€ä¸‹ï¼Œå‘çŽ°è¿™ä¸ª drawable å°±æ˜¯ PhoneWindow ä¸­çš„ mBackgroundsource å±žæ€§è§£æžè€Œæ¥ã€‚è¿™ä¸ªå±žæ€§æ˜¯ä»Žåº”ç”¨ä¸»é¢˜ä¸­æŒ‡å®šçš„ã€‚çŽ°åœ¨å›žåˆ°å‰é¢æˆ‘æå‰è´´å‡ºçš„è§£å†³æ–¹æ³•ä¹‹ä¸€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getWindow().setBackgroundDrawable(<span class="keyword">new</span> ColorDrawable(Color.TRANSPARENT))</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç è°ƒç”¨ PhoneWindow çš„ setBackgroundDrawable æ–¹æ³•ï¼Œè¿™ä¸ªè°ƒç”¨é™¤äº†è®¾ç½® bg drawable å¤–ï¼Œè¿˜ç›´æŽ¥è®© mBackgroundsource å˜ä¸º 0ï¼Œæ‰€ä»¥åŽé¢å°±è½®ä¸åˆ°é‚£ä¸ª NinePatchDrawable äº†ã€‚</p><p>å…¶å®žï¼Œä¸Šé¢çš„è§£å†³æ–¹æ³•è¿˜æ˜¯æœ‰ç‚¹çªå…€ï¼Œå¦ä¸€ç§æ–¹æ³•æ˜¯ï¼Œåœ¨æ‰«å¡çš„åº“ä¸­è®¾ç½®ä¸€ä¸ªä¸»é¢˜ï¼Œè¿™æ ·çš„è¯ï¼Œå°±ä¸ä¼šåº”ç”¨å·´è¥¿ç‰ˆæœ¬ä¹˜å®¢ç«¯é¡¹ç›®ä¸­å£°æ˜Žçš„ä¸»é¢˜äº†ï¼Œè‡ªç„¶ä¹Ÿå°±ä¸ä¼šæŠŠé‚£ä¸ª NinePatchDrawable è®¾ç½®è¿›æ¥ã€‚</p><p>å†è¯´ç‚¹åˆ«çš„ã€‚è¿™ä¸ªæ‰«å¡çš„åº“ï¼Œè¢«é›†æˆåˆ°å¦ä¸€ä¸ªåº“ä¸­ï¼Œç„¶åŽå¦ä¸€ä¸ªåº“å†é›†æˆåˆ°å·´è¥¿ç‰ˆæœ¬ä¸­ã€‚ä¸­é—´è¿™ä¸ªåº“ï¼Œæˆ‘æ˜¯æ²¡æœ‰æ¶‰è¶³çš„ã€‚æ‰€ä»¥ä¸ºä¹ˆéªŒè¯æˆ‘æœ‰æ²¡æœ‰ä¿®å¤æˆåŠŸï¼Œæˆ‘åªèƒ½åœ¨æœ€ç»ˆçš„é¡¹ç›®ä¸­å†å¼•ç”¨ä¸€ä¸‹æˆ‘çš„åº“ç»è¿‡æ”¹åŠ¨åŽçš„ç‰ˆæœ¬ï¼Œå½“ç„¶ç‰ˆæœ¬å·ä¹Ÿè¦å¢žåŠ ä¸€ä¸‹ã€‚è¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥æ–°çš„è¦†ç›–æ—§çš„ï¼ŒæŠŠä¸­é—´é‚£ä¸ªåº“å¯¹æ‰«å¡åº“çš„å¼•ç”¨ç»™è¦†ç›–çš„ã€‚å”‰ï¼ŒçœŸæ˜¯æŠ˜è…¾ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æé«˜å¼€å‘æ•ˆçŽ‡çš„å„ç§å·¥å…·</title>
      <link href="/2018/09/26/%E6%8F%90%E9%AB%98%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87%E7%9A%84%E5%90%84%E7%A7%8D%E5%B7%A5%E5%85%B7/"/>
      <url>/2018/09/26/%E6%8F%90%E9%AB%98%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87%E7%9A%84%E5%90%84%E7%A7%8D%E5%B7%A5%E5%85%B7/</url>
      <content type="html"><![CDATA[<p>ä¿—è¯è¯´ï¼Œå·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨ã€‚å¥½ç”¨çš„å¼€å‘å·¥å…·ï¼Œè™½ç„¶ä¸ä¼šç›´æŽ¥æ”¹å–„æˆ‘ä»¬å†™çš„ä»£ç ï¼Œä½†æ˜¯å¯¹äºŽæ•ˆçŽ‡çš„æé«˜å’Œæé«˜èˆ’é€‚åº¦è¿˜æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚æœ¬æ–‡æ„åœ¨æä¾›ä¸€äº›ä¸æ˜¯éžå¸¸æ™®éä½¿ç”¨ï¼Œä½†æ˜¯å¯¹äºŽæ•ˆçŽ‡æå‡å¯èƒ½éžå¸¸æœ‰ç”¨çš„å·¥å…·ã€‚è¯ä¸å¤šè¯´ï¼Œå¼€å§‹æ­£æ–‡ï¼</p><h4 id="å‰ªè´´æ¿å·¥å…·-â€”â€”-Clipy"><a href="#å‰ªè´´æ¿å·¥å…·-â€”â€”-Clipy" class="headerlink" title="å‰ªè´´æ¿å·¥å…· â€”â€” Clipy"></a>å‰ªè´´æ¿å·¥å…· â€”â€” <a href="https://github.com/Clipy/Clipy" target="_blank" rel="noopener">Clipy</a></h4><p>å‰ªè´´æ¿å·¥å…·å®žåœ¨å¤ªå®žç”¨äº†ï¼Œä¸è¿‡ä¼¼ä¹Žå¤§éƒ¨åˆ†ç¨‹åºå‘˜éƒ½æ²¡æœ‰ç”¨ä¸Šå‰ªè´´æ¿å·¥å…·ã€‚è€Œ Clipy æ˜¯ä¸€æ¬¾å¾ˆåˆé€‚çš„å‰ªè´´æ¿å·¥å…·ï¼Œä»¥è‡³äºŽæˆ‘æƒ³èµ·å®ƒæ—¶ï¼Œç›´æŽ¥å°†å®ƒæ’åˆ°æœ€å‰é¢ï¼Œå¹¶ä¸”åºå·ç¼–ä¸º 0ã€‚Clipy æ˜¯ä¸€ä¸ªå¼€æºçš„å‰ªè´´æ¿å·¥å…·ï¼Œç®€æ´ä¸é—¹å¿ƒï¼Œå¤åˆ¶çš„å›¾ç‰‡å’Œæ–‡æœ¬éƒ½å¯ä»¥ç®¡ç†ï¼Œç”¨èµ·æ¥å¾ˆçˆ½ã€‚</p><p><img src="http://tao93.top/images/2018/09/01/1535789967.png" alt=""></p><h4 id="oh-my-zsh"><a href="#oh-my-zsh" class="headerlink" title="oh-my-zsh"></a>oh-my-zsh</h4><p>è¿™æ˜¯ä¸ªç»ˆç«¯åŠ å¼ºå·¥å…·ï¼ŒmacOS å’Œ Linux éƒ½å¯ç”¨ï¼ŒæŠŠé»˜è®¤ shell ä»Ž bash æ”¹ä¸º zshï¼Œç„¶åŽå†åŠ å¼ºä¸€ä¸‹ã€‚æˆ‘åªç”¨çš„ oh-my-zsh çš„ 3 ä¸ª featuresï¼Œä½†è¿™ 3 ä¸ªéƒ½æ˜¯å¾ˆæœ‰å¸å¼•åŠ›çš„ã€‚</p><p>ç¬¬ä¸€ã€è‡ªå¸¦è¯†åˆ« git é¡¹ç›®ç›®å½•çš„åŠŸèƒ½ï¼Œç›´æŽ¥æ˜¾ç¤ºåˆ†æ”¯åã€æœ‰æ— æœªæäº¤çš„æœ¬åœ°ä¿®æ”¹ï¼›</p><p>ç¬¬äºŒã€cd æ—¶ï¼Œç›´æŽ¥ä¸åœçš„æŒ‰ tabï¼ŒæŒ‡å¯¼é€‰ä¸­äº†ä½ æƒ³è¦çš„ç›®å½•ï¼Œç„¶åŽå›žè½¦ï¼Œå°±å¯ä»¥è¿›å…¥æƒ³è¿›å…¥çš„ç›®æ ‡ï¼Œå‡å°‘è¾“å…¥ç›®å½•åå‰å‡ ä¸ªå­—æ¯çš„åŠ³ç´¯ã€‚</p><p>ç¬¬ä¸‰ã€è¿™æ˜¯ä¸ª killer featureï¼Œåœ¨ç»ˆç«¯è¾“å…¥ä»»ä½•å‡ ä¸ªå­—ç¬¦ï¼ŒæŒ‰å‘ä¸Šçš„ç®­å¤´ï¼Œå°±å¯åˆ—å‡ºä»¥è¿™äº›å­—ç¬¦å¼€å¤´çš„æ‰€æœ‰åŽ†å²å‘½ä»¤ï¼Œè¿™æ ·å¾ˆå¤šéœ€é‡å¤ä½¿ç”¨çš„å‘½ä»¤ã€å¾ˆä¹…å¿½ç„¶æƒ³èµ·éœ€è¦å†æ¬¡ä½¿ç”¨çš„å‘½ä»¤çš„ä½¿ç”¨æ–¹ä¾¿äº†éžå¸¸å¤šï¼Œæ¯”å¦‚å¿½ç„¶æƒ³èµ· 10 å¤©å‰ï¼Œä½¿ç”¨ sed å‘½ä»¤æžäº†ä¸ªäº‹æƒ…ï¼Œä½†æ˜¯ sed å‘½ä»¤ä½ æ‡‚çš„ï¼ŒåŽ‹æ ¹è®°ä¸ä½ç”¨æ³•ï¼Œæ€Žä¹ˆåŠžï¼Ÿç›´æŽ¥ç»ˆç«¯è¾“å…¥ sed ç„¶åŽæŒ‰å‘ä¸Šç®­å¤´ï¼Œç«‹é©¬è°ƒå‡º sed å¼€å¤´çš„åŽ†å²å‘½ä»¤ã€‚</p><h4 id="local-Maven-ä»“åº“"><a href="#local-Maven-ä»“åº“" class="headerlink" title="local Maven ä»“åº“"></a>local Maven ä»“åº“</h4><p>è‡ªæ‰“è°·æ­Œä¸€æ‰‹å°† Android çš„æž„å»ºå·¥å…·åˆ‡æ¢åˆ° Gradle åŽï¼Œè¿œç¨‹ä¾èµ–å˜ä¸ºç”¨ç”± Gradle é…ç½®ä»Ž Maven ä»“åº“èŽ·å–ä¾èµ–ã€‚è€Œé™¤äº† Jcenterã€mavenCentralã€Google è¿™æ ·æœ€å¸¸è§ 3 ä¸ªå…¬å¼€ Maven ä»“åº“å¤–ï¼ŒçŽ°åœ¨å¾ˆå¤šå…¬å¸å†…éƒ¨ä¼šå¼€å‘ä¸€äº› SDK æˆ–è€…å·¥å…·åŒ…ä¹‹ç±»çš„ï¼Œç„¶åŽä½œä¸ºä¾èµ–æ”¾åœ¨å…¬å¸å†…éƒ¨çš„ç§æœ‰ Maven ä»“åº“ä¸­ï¼Œæä¾›ç»™å…¬å¸å†…éƒ¨ä½¿ç”¨ã€‚</p><p>é—®é¢˜æ¥äº†ï¼Œå¯¹äºŽæ™®é€šçš„å¼€å‘è€…æ¥è¯´ï¼Œæœ‰æ—¶å€™éœ€è¦ä¿®æ”¹æŸä¸ªä¾èµ–çš„æºä»£ç å¹¶åŠ ä»¥éªŒè¯ï¼Œä½†æ˜¯åˆä¸æƒ³æŠŠä¿®æ”¹åŽçš„ä»£ç é©¬ä¸Šå°±æž„å»ºä¸€ä¸ªæ–°ç‰ˆæœ¬çš„ä¾èµ–ä¼ è¾“åˆ°å…¬å¸çš„ Maven ä»“åº“ã€‚æ¯•ç«Ÿï¼Œå¤©æ™“å¾—è‡ªå·±è¦æ”¹å¤šå°‘æ¬¡ï¼Œå¦‚æžœä¸€ç›´å¾€å…¬å¸ Maven ä»“åº“æŽ¨ï¼Œè¢«åˆ«äººçœ‹åˆ°äº†å¥½åƒä¼šæ„Ÿè§‰è‡ªå·±å¾ˆèœçš„æ ·å­ ?ã€‚è¿™æ—¶å€™ï¼Œå¦‚æžœæœ‰ä¸€ä¸ªæœ¬åœ°çš„ Maven ä»“åº“ï¼Œé‚£å…ˆä¼ åˆ°æœ¬åœ° Maven ä»“åº“ï¼Œç„¶åŽå†ä»Žæœ¬åœ°ä»“åº“èŽ·å–ä¾èµ–ï¼Œå°±å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜äº†ï¼Œç‰¹åˆ«æ˜¯å¯¹äºŽä¸€äº›æ–‡ä»¶æ¯”è¾ƒå¤§çš„ä¾èµ–ï¼Œè¿™æ ·é€Ÿåº¦ä¹Ÿä¼šæ›´å¿«ã€‚</p><p>è¿™é‡Œè¯´çš„ local Maven ä»“åº“ï¼Œä¸æ˜¯ Gradle ä¸­ä½¿ç”¨ mavenLocal() æ¥å£°æ˜Žçš„é‚£ä¸ªä»“åº“ (é€šå¸¸ä½äºŽ ~/.m2/repository) ä¸­ï¼Œè€Œæ˜¯æŒ‡è‡ªå·±åœ¨ä¸ªäººç”µè„‘ä¸Šæ­å»ºä¸€ä¸ª Maven ä»“åº“ï¼Œå°±å’Œè¿œç¨‹ä»“åº“ä¸€æ ·ï¼Œåªä¸è¿‡åŸŸåä½¿ç”¨ localhost æ¥è®¿é—®å³å¯ã€‚</p><p>æ–¹æ³•å…¶å®žæ¯”è¾ƒç®€å•ï¼Œæ¯”å¦‚ä½¿ç”¨ Nexus OSS Maven çš„è¯ï¼Œåœ¨ macOS ç³»ç»Ÿä¸Šç®€ç›´ä¸è¦å¤ªå®¹æ˜“ï¼Œç›´æŽ¥ brew install nexusï¼Œç„¶åŽå† nexus start å°± OKäº†ï¼Œæ­¤æ—¶åœ¨æµè§ˆå™¨ä¸Šé¢æ‰“å¼€ <a href="http://localhost:8081/nexus" target="_blank" rel="noopener">http://localhost:8081/nexus</a> å°±å¯ä»¥å¼€å§‹ç™»å½•äº†ï¼Œåˆå§‹ç”¨æˆ·åå’Œå¯†ç åˆ†åˆ«æ˜¯ admin å’Œ admin123ï¼Œç™»å½•ä¹‹åŽï¼Œé‡Œé¢å·²ç»æœ‰äº†ä¸€äº› repository äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535790041.png" alt=""></p><p>æˆ‘å¸¸ç”¨çš„å°±æ˜¯ä¸Šé¢ Snapshots è¿™ä¸ª repositoryï¼Œä¸“é—¨ç”¨æ¥æ‰˜ç®¡ SNAPSHOT ç±»åž‹çš„ä¾èµ–ï¼Œå…³äºŽ SNAPSHOT ç±»åž‹çš„ä¾èµ–ï¼Œæˆ‘ä¼šå†™ä¸€ç¯‡æ›´å…¨é¢è¯¦ç»†çš„æ–‡ç« æ¥è®²æ€Žä¹ˆä½¿ç”¨ã€‚</p><p>OKï¼ŒçŽ°åœ¨å°±å¯ä»¥åœ¨å‘æœ¬åœ°çš„ Maven ä»“åº“ä¼ ä¾èµ–åŒ…å¹¶æ‹‰å–ä½¿ç”¨äº†ã€‚å…¶å®žï¼Œå±€åŸŸç½‘å†…å…¶ä»–åŒäº‹ä¹Ÿæ˜¯å¯ä»¥è®¿é—®è¿™ä¸ª Maven ä»“åº“çš„ï¼Œæ¯”å¦‚ <a href="http://localhost:8081/nexus/content/repositories/snapshots/" target="_blank" rel="noopener">http://localhost:8081/nexus/content/repositories/snapshots/</a> è¿™ä¸ªä»“åº“ï¼Œåˆ«çš„åŒäº‹è¦è®¿é—®æˆ‘è¿™ä¸ª snapshot ä»“åº“çš„è¯ï¼Œåªéœ€è¦ä»–æŠŠ localhost æ¢æˆæˆ‘çš„ç§æœ‰ IP åœ°å€å³å¯ã€‚</p><h4 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h4><p>ä¸ºä»€ä¹ˆæŠŠ Python åˆ—å‡ºæ¥å‘¢ï¼Ÿå› ä¸ºå…¶å®ž Python å…¥é—¨æ˜¯éžå¸¸ç®€å•çš„ï¼Œå†åŠ ä¸Šè¿™å¹´å¤´ï¼Œä¸äº†è§£ä¸€ä¸‹ Python éƒ½ä¸å¥½æ„æ€è¯´è‡ªå·±æ˜¯ç¨‹åºå‘˜ã€‚è€Œå…¥é—¨åŽï¼Œå¯ä»¥å¸®æˆ‘ä»¬åšç‚¹äº‹æƒ…ï¼Œæ¯”å¦‚ä¸‹å›¾ä¸­ï¼Œè¡¨è¾¾å¼è®¡ç®—ï¼Œè¿›åˆ¶è½¬æ¢:</p><p><img src="http://tao93.top/images/2018/09/01/1535790099.png" alt=""></p><p>å…¶å®ž Python å¯ä»¥åšçš„äº‹å¾ˆå¤šï¼Œé€šè¿‡å¼•å…¥ Python è‡ªå¸¦çš„åŒ…æˆ–è€…ç¬¬ä¸‰æ–¹åº“çš„åŒ…ï¼ŒPython å‡ ä¹Žæ— æ‰€ä¸èƒ½ã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒåŽ»å¹´å¾®ä¿¡è·³ä¸€è·³å°æ¸¸æˆåˆšå‡ºæ¥æ—¶ï¼Œæˆ‘çœ‹è¿™ä¸ªæ¸¸æˆéžå¸¸ç®€å•ï¼Œæˆ‘å°±æƒ³ï¼Œèƒ½ä¸èƒ½ç”¨ Python åšä¸ªè‡ªåŠ¨åŒ–è„šæœ¬æ¥è·³å‘¢ï¼Ÿå½“ç„¶å¯ä»¥ï¼å…¶å®žåŽŸç†ä¹Ÿå¾ˆç®€å•ï¼Œå¯¹äºŽæ¯ä¸€è·³ï¼Œå¯ä»¥åˆ†ä¸ºè‹¥å¹²æ­¥ï¼šæˆªå›¾ã€åˆ†æžå›¾ç‰‡å¾—å‡ºéœ€è¦è·³è·ƒçš„è·ç¦»ã€æ ¹æ®è·ç¦»æ¥æ¨¡æ‹Ÿä¸€ä¸ªé•¿æŒ‰äº‹ä»¶ã€‚è¿™æ ·çš„ä¸‰ä¸ªæ­¥éª¤å¯¹äºŽ Android è®¾å¤‡æ˜¯å¾ˆå®¹æ˜“å®žçŽ°çš„ã€‚æ‰€ä»¥æ€è·¯å°±æ˜¯ï¼Œä½¿ç”¨ Python è°ƒç”¨ adb å·¥å…·æ¥æˆªå›¾ã€pull æˆªå›¾åˆ°ç”µè„‘ä¸­ï¼›ç„¶åŽä½¿ç”¨ Python çš„ç…§ç‰‡å¤„ç†åº“æ¥åˆ†æžç…§ç‰‡çš„åƒç´ ï¼Œæ‰¾åˆ°è·³çš„é‚£ä¸ªä¸œè¥¿çš„ä½ç½®å’Œä¸‹ä¸€ä¸ªæ–¹å—çš„ä½ç½®ï¼Œè¿™æ ·å°±çŸ¥é“éœ€è¦è·³è·ƒçš„è·ç¦»äº†ï¼›è°ƒç”¨ adb æ¨¡æ‹Ÿä¸€ä¸ªé•¿æŒ‰å±å¹•çš„äº‹ä»¶ï¼Œé•¿æŒ‰çš„æ—¶é—´å’Œéœ€è¦è·³è·ƒçš„è·ç¦»æˆæ­£æ¯”ï¼Œè‡³äºŽè¿™ä¸ªæ¯”å€¼ç³»æ•°ï¼Œæ‘¸ç´¢å‡ æ¬¡æµ‹è¯•ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚è¯¦è§æˆ‘çš„åšå®¢ <a href="https://tao93.top/2018/09/01/Python%20ä¹Ÿèƒ½çŽ©è·³ä¸€è·³å°æ¸¸æˆ/">Python ä¹Ÿèƒ½çŽ©è·³ä¸€è·³å°æ¸¸æˆ</a>ã€‚</p><h4 id="æˆ‘æ”¹è¿›è¿‡çš„-JD-GUI"><a href="#æˆ‘æ”¹è¿›è¿‡çš„-JD-GUI" class="headerlink" title="æˆ‘æ”¹è¿›è¿‡çš„ JD-GUI"></a>æˆ‘æ”¹è¿›è¿‡çš„ JD-GUI</h4><p>æ¬ä¸çŸ¥è€»çš„æŽ¨èä¸€ä¸‹æˆ‘<a href="https://github.com/Tao93/jd-gui" target="_blank" rel="noopener">æ›´æ”¹è¿‡çš„ JD-GUI</a>ã€‚<a href="https://github.com/java-decompiler/jd-gui" target="_blank" rel="noopener">JD-GUI</a> æœ¬æ¥æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œä½†æ˜¯å·²ç»3å¹´æ²¡æœ‰ç»´æŠ¤äº†ã€‚ä¸¤å¹´å‰ï¼Œå½“æ—¶å› ä¸ºå·¥ä½œéœ€è¦ï¼Œæˆ‘è¦é¢‘ç¹çš„è§£åŽ‹ apkï¼ŒæŠŠ dex æ–‡ä»¶è½¬æˆ jarï¼Œç„¶åŽå†ç”¨ JD-GUI åç¼–è¯‘æŸ¥çœ‹ä»£ç æ³¨å…¥æ•ˆæžœï¼Œæ‰€ä»¥æˆ‘å°±æƒ³ï¼Œè¿™ä¹ˆä¸‰ä¸ªæ­¥éª¤èƒ½ä¸èƒ½ä¸€æ­¥æžå®šã€‚äºŽæ˜¯ç»è¿‡ä¸€ä¸ªå‘¨æœ«çš„åŠªåŠ›ï¼Œæˆ‘å°æ”¹äº†ä¸€ä¸‹ JD-GUIï¼Œä½¿å…¶æ”¯æŒç›´æŽ¥æ‹–å…¥ apk æ–‡ä»¶ï¼Œç„¶åŽè‡ªåŠ¨è§£åŽ‹ï¼Œè‡ªåŠ¨è°ƒç”¨ apktool æ¥å°† dex è½¬æˆ jar æ–‡ä»¶ï¼Œç„¶åŽå†äº¤ç»™åŽŸ JD-GUI åç¼–è¯‘ã€‚PSï¼šæˆ‘éžå¸¸è´´å¿ƒçš„æä¾›äº† macOSã€Windowsã€Linux ä¸‰ä¸ªå¹³å°çš„ binary åŒ…ã€‚</p><h4 id="the-Unarchiver-for-macOS"><a href="#the-Unarchiver-for-macOS" class="headerlink" title="the Unarchiver for macOS"></a><a href="https://itunes.apple.com/cn/app/the-unarchiver/id425424353?mt=12" target="_blank" rel="noopener">the Unarchiver</a> for macOS</h4><p>macOS è‡ªå¸¦çš„è§£åŽ‹å·¥å…·æ¯”è¾ƒå¼±é¸¡ï¼Œæ¯”å¦‚ jar æ–‡ä»¶æ— æ³•è§£åŽ‹ï¼Œä¸€äº›åˆ«çš„åŽ‹ç¼©åŒ…è§£åŽ‹æ—¶ä¹Ÿä¼šå‡ºå¹ºè›¾å­ã€‚è€Œè¿™æ¬¾ the Unarchiver for macOS ä½“ç§¯ä¸å¤§ï¼Œç®€æ´å´å¯ä»¥åº”ä»˜å‡ ä¹Žæ‰€æœ‰çš„è§£åŽ‹åœºæ™¯ï¼Œè¿˜èƒ½æä¾›é€‰æ‹© charset çš„æœºä¼šï¼Œä»Žè€Œè§£åŽ‹æŸäº›åŽ‹ç¼©åŒ…æ—¶é¿å…æ–‡ä»¶åä¹±ç ã€‚</p><h4 id="USTC-Mirror"><a href="#USTC-Mirror" class="headerlink" title="USTC Mirror"></a><a href="http://mirrors.ustc.edu.cn/" target="_blank" rel="noopener">USTC Mirror</a></h4><p>åœ¨æ­¤æŽ¨èä¸€ä¸‹ä¸­å›½ç§‘å¤§å¼€æºé•œåƒï¼Œè¿™ä»½é•œåƒå¯ä»¥ä½¿å¾—åœ¨å›½å†…è®¿é—®å¾ˆå¤šå¼€æºè½¯ä»¶çš„é€Ÿåº¦é£žèµ·æ¥ã€‚</p><p>æ¯”å¦‚<a href="http://mirrors.ustc.edu.cn/help/pypi.html" target="_blank" rel="noopener">ç»™ pip è®¾ç½®ä»£ç†</a>ï¼Œå¯ä»¥è®© pip ä¸‹è½½ Python æ‰©å±•åŒ…çš„é€Ÿåº¦å¿«å¾—é£žèµ·ã€‚</p><p>å†æ¯”å¦‚ä½¿ç”¨<a href="https://lug.ustc.edu.cn/wiki/mirrors/help/aosp" target="_blank" rel="noopener">ä¸­å›½ç§‘å¤§çš„ AOSP é•œåƒ</a>ï¼ŒèŽ·å– AOSP é¡¹ç›®çš„æºç  (å‡ å GB å¤§å°) çš„é€Ÿåº¦å°†è¦åŠ å¿«å¾ˆå¤šï¼Œå¦‚æžœä¸ä½¿ç”¨ä»£ç†ï¼Œé‚£ä¹ˆä»Ž <a href="https://source.android.com/setup/build/downloading" target="_blank" rel="noopener">Google å®˜æ–¹åŒæ­¥ AOSP ä»£ç </a>ï¼Œå…¶éš¾åº¦ä½ æ‡‚çš„ã€‚</p><p>å†å†æ¯”å¦‚ï¼Œéžå¸¸æµè¡Œçš„ <a href="https://brew.sh/" target="_blank" rel="noopener">Homebrew</a>ï¼Œæ˜¯ macOS å¹³å°ä¸Šä½¿ç”¨å‘½ä»¤è¡Œç®¡ç†è½¯ä»¶åŒ…åŠå®ƒä»¬çš„ä¾èµ–å…³ç³»çš„å·¥å…·ï¼Œå¥½æ¯”æ˜¯ Linux çš„åŒ…ç®¡ç†ç³»ç»Ÿã€‚æ­¤å¤– Homebrew ä½¿ç”¨ cask tap ç”šè‡³è¿˜å¯ä»¥å®‰è£… Sublime textï¼ŒChrome ç­‰è®¸å¤šçš„ GUI è½¯ä»¶ï¼Œå¹¶è‡ªåŠ¨å»ºç«‹è½¯é“¾æŽ¥é“¾æŽ¥åˆ° GUI çš„è½¯ä»¶çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ¯”å¦‚ Sublime textï¼Œä½¿ç”¨ Homebrew å®‰è£…åŽï¼Œå°±å¯ä»¥åœ¨å‘½ä»¤è¡Œä½¿ç”¨ subl å³å¯æ‰“å¼€ Sublime text äº†ã€‚æ‰¯è¿œäº†ï¼ŒHomebrew åŒæ ·å­˜åœ¨åœ¨å›½å†…ä¸‹è½½è½¯ä»¶é€Ÿåº¦æ…¢çš„é—®é¢˜ï¼Œè€ŒåŒæ ·ï¼Œä¸­å›½ç§‘å¤§é•œåƒæä¾›äº† <a href="http://mirrors.ustc.edu.cn/help/homebrew-bottles.html" target="_blank" rel="noopener">Homebrew é•œåƒ</a>ï¼Œèƒ½è®©ç»å¤§éƒ¨åˆ†åŒ…çš„ä¸‹è½½é€Ÿåº¦å¿«èµ·æ¥ã€‚</p><p>æœ€åŽï¼Œå…ˆå¯¹ USTC Mirror çš„ç»´æŠ¤è€…è¡¨ç¤ºæ„Ÿè°¢ã€‚ç„¶åŽï¼Œæˆ‘æƒ³è¯´è¿™ä¸ªé•œåƒçš„å†…å®¹éžå¸¸å¤šï¼Œç»å¤§éƒ¨åˆ†æˆ‘ä¹Ÿä¸äº†è§£ï¼Œä¹Ÿå°±æ˜¯è¿˜æœ‰å¾ˆå¤šå¯ä»¥æ·±å…¥æŽ¢ç´¢çš„ä¸œè¥¿ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å¸¸ç”¨çš„ Bash å‘½ä»¤æ€»ç»“</title>
      <link href="/2018/09/26/%E5%B8%B8%E7%94%A8%E7%9A%84%20Bash%20%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/"/>
      <url>/2018/09/26/%E5%B8%B8%E7%94%A8%E7%9A%84%20Bash%20%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/</url>
      <content type="html"><![CDATA[<p>è¿™ç¯‡è®°å½•æ˜¯æˆ‘çœ‹ <a href="http://linuxcommand.org/tlcl.php" target="_blank" rel="noopener">The Linux Command Line</a> åŽä¸ºäº†æ€»ç»“è€Œå†™çš„ï¼Œç›®çš„æ˜¯ä¾¿äºŽè‡ªå·±éšæ—¶æŸ¥é˜…ã€‚The Linux Command Line æ˜¯æˆ‘ç›¸å½“å–œæ¬¢çš„ä¸€æœ¬ç”µå­ä¹¦ï¼Œå®ƒæ˜¯ä¸€æœ¬å€¼å¾—ä¸€é¡µä¸€é¡µçœ‹ä¸‹åŽ»çš„ä¹¦ã€‚</p><p><strong>cp</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»…å¤åˆ¶ç›®æ ‡ç›®å½•ä¸å­˜åœ¨æˆ–è€…å­˜åœ¨ä½†æ˜¯æ›´æ—§çš„çš„é¡¹ã€‚ </span></span><br><span class="line">cp -u </span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æžœ file2 å·²ç»å­˜åœ¨, file2 çš„å†…å®¹ä¼šè¢« file1 çš„å†…å®¹é‡å†™ã€‚å¦‚æžœ file2 ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºå®ƒã€‚ </span></span><br><span class="line">cp file1 file2 </span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æžœç›®å½• dir2 ä¸å­˜åœ¨ï¼Œåˆ›å»ºç›®å½• dir2ï¼Œæ“ä½œå®ŒæˆåŽï¼Œç›®å½• dir2 ä¸­çš„å†…å®¹å’Œ dir1 ä¸­çš„ä¸€æ ·ã€‚å¦‚æžœç›®å½• dir2 å­˜åœ¨ï¼Œåˆ™ç›®å½• dir1 å’Œå…¶ä¸­çš„å†…å®¹å°†ä¼šè¢«å¤åˆ¶åˆ° dir2 ä¸­ã€‚ </span></span><br><span class="line">cp -r dir1 dir2</span><br></pre></td></tr></table></figure><p><strong>mv</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»…ç§»åŠ¨ç›®æ ‡ç›®å½•ä¸å­˜åœ¨æˆ–è€…å­˜åœ¨ä½†æ˜¯æ›´æ—§çš„çš„é¡¹ã€‚ </span></span><br><span class="line">mv -u </span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æžœç›®å½• dir2 ä¸å­˜åœ¨ï¼Œåˆ›å»ºç›®å½• dir2ï¼Œå¹¶ä¸”ç§»åŠ¨ç›®å½• dir1 çš„å†…å®¹åˆ°ç›®å½• dir2 ä¸­ï¼ŒåŒæ—¶åˆ é™¤ç›®å½• dir1ã€‚å¦‚æžœç›®å½• dir2 å­˜åœ¨ï¼Œç§»åŠ¨ç›®å½• dir1( å®ƒçš„å†…å®¹)åˆ°ç›®å½• dir2 ä¸­ã€‚ </span></span><br><span class="line">mv dir1 dir2</span><br></pre></td></tr></table></figure><p><strong>rm</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è­¦æƒ•ä¸å°å¿ƒå†™å‡º rm * .html è¿™æ ·çš„å‘½ä»¤ï¼Œè¿™ä¼šåˆ é™¤å½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶ã€‚</span></span><br></pre></td></tr></table></figure><p><strong>å‘½ä»¤çš„4ä¸­å½¢å¼</strong></p><ol><li>executable file, å¯ä»¥æ˜¯äºŒè¿›åˆ¶çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯æ–‡æœ¬å½¢å¼çš„è„šæœ¬ï¼›</li><li>builtins, å³ /bin ä¸‹é¢çš„ [, echo, kill, pwd, test å’Œ /usr/bin ä¸‹é¢çš„ alias, bg, cd, command, false, fc, fg, getopts, hash, jobs, printf, read, true, type, ulimit, umask, unalias, wait, whichï¼›</li><li>shell å‡½æ•°</li><li>alias å®šä¹‰çš„åˆ«å</li></ol><p><strong>type</strong></p><p>typeæ˜¯ä¸€ä¸ªæžå…¶æœ‰ç”¨çš„å‘½ä»¤ï¼Œèƒ½ç«‹é©¬æ‰¾åˆ°å½“å‰çŽ¯å¢ƒèƒ½ç”¨çš„å‘½ä»¤æ˜¯æºè‡ªå“ªé‡Œï¼Œæ˜¯ä»€ä¹ˆç±»åž‹çš„ã€‚ç¤ºä¾‹ï¼š</p><blockquote><p>âžœ  ~ type Python3<br>Python3 is /Users/didi/.bin/Python3<br>âžœ  ~ ls -l /Users/didi/.bin/Python3<br>lrwxr-xr-x  1 didi  staff  22  4 25 10:06 /Users/didi/.bin/Python3 -&gt; /usr/local/bin/python3<br>âžœ  ~ type [<br>[ is a shell builtin<br>âžœ  ~ type ls<br>ls is an alias for ls -G</p></blockquote><p><strong>where</strong></p><p>whereå‘½ä»¤çš„æœ‰ç”¨ä¹‹å¤„æ˜¯å®ƒå¯ä»¥åˆ—å‡ºæ‰€æœ‰å‡ºçŽ°çš„åœ°æ–¹ï¼Œæ¯”å¦‚ç”µè„‘é‡Œé¢æœ‰ä¸¤ä¸ª git å¯æ‰§è¡Œæ–‡ä»¶ï¼Œé‚£ä¹ˆ where git å¯ä»¥æŠŠå®ƒä»¬ç»Ÿç»Ÿåˆ—å‡ºæ¥ã€‚</p><p><strong>man æ‰‹å†Œçš„ç« èŠ‚å«ä¹‰</strong></p><ol><li>ç”¨æˆ·å‘½ä»¤</li><li>ç¨‹åºæŽ¥å£å†…æ ¸ç³»ç»Ÿè°ƒç”¨</li><li>åº“å‡½æ•°ç¨‹åºæŽ¥å£</li><li>ç‰¹æ®Šæ–‡ä»¶ï¼Œæ¯”å¦‚è¯´è®¾å¤‡ç»“ç‚¹å’Œé©±åŠ¨ç¨‹åº</li><li>æ–‡ä»¶æ ¼å¼</li><li>æ¸¸æˆå¨±ä¹ï¼Œå¦‚å±å¹•ä¿æŠ¤ç¨‹åº</li><li>å…¶ä»–æ–¹é¢</li><li>ç³»ç»Ÿç®¡ç†å‘˜å‘½ä»¤</li></ol><p><strong>&gt; file_name</strong></p><p>å·§å¦™çš„ä½¿ç”¨é‡å®šå‘ï¼Œå¯ä»¥å°†æ–‡æœ¬æ–‡ä»¶çš„å†…å®¹æ¸…ç©ºï¼Œä¹Ÿå¯ä»¥æ–°å»ºä¸€ä¸ªç©ºæ–‡ä»¶ã€‚</p><p><strong>é‡å®šå‘çš„å¸¸è§ç”¨æ³•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¦†ç›–åž‹é‡å®šå‘ stdoutï¼Œå¯ä»¥çœç•¥é‚£ä¸ª 1 </span></span><br><span class="line">ls ~ 1&gt; out.txt </span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿½åŠ æ€§é‡å®šå‘ stdoutï¼Œå¯ä»¥çœç•¥é‚£ä¸ª 1 </span></span><br><span class="line">ls ~ 1&gt;&gt; out.txt </span><br><span class="line"></span><br><span class="line"><span class="comment"># è¦†ç›–åž‹é‡å®šå‘ stderr </span></span><br><span class="line">ls ~ 2&gt; out.txt </span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿½åŠ æ€§é‡å®šå‘ stdout </span></span><br><span class="line">ls ~ 2&gt;&gt; out.txt</span><br></pre></td></tr></table></figure><p><strong>/dev/null</strong></p><p>éšæ„æ”¾ä¸œè¥¿è¿›åŽ»çš„åžƒåœ¾ç®±</p><p><strong>èŠ±æ‹¬å·å±•å¼€</strong></p><p>echo Front-{A..D}â€“Back å°†ä¼šè¾“å‡ºå››é¡¹å†…å®¹ï¼Œå³ {A..D} è¡¨ç¤ºä»Ž A åˆ° D ä¸€å…±å››ä¸ªæƒ…å†µã€‚</p><p><strong>å°†å‘½ä»¤æ‰§è¡Œç»“æžœå±•å¼€</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åªéœ€è¦æŠŠå‘½ä»¤æ”¾åœ¨ $() é‡Œé¢å³å¯ï¼Œæ—§ç‰ˆ shell ä¹Ÿä½¿ç”¨æŠŠå‘½ä»¤æ”¾åœ¨ `` ä¸­é—´çš„æ–¹å¼ </span></span><br><span class="line"><span class="built_in">echo</span> $(ls)</span><br></pre></td></tr></table></figure><p><strong>å¼•å·</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŒå¼•å·ä¸­ï¼Œå‚æ•°å±•å¼€ï¼Œç®—æœ¯è¡¨è¾¾å¼å±•å¼€ï¼Œå’Œå‘½ä»¤æ›¿æ¢ä»ç„¶æœ‰æ•ˆï¼Œæ¯”å¦‚ </span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$USER</span> <span class="variable">$((2+2)</span>) <span class="variable">$(cal)</span>"</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># å•å¼•å·ä¸­ï¼Œæ‰€æœ‰å±•å¼€éƒ½æ— æ•ˆ</span></span><br></pre></td></tr></table></figure><p><strong>å‘½ä»¤è¡Œç§»åŠ¨å…‰æ ‡</strong></p><blockquote><p>ctrl a # ç§»åŠ¨åˆ°è¡Œé¦–</p><p>ctrl e # ç§»åŠ¨åˆ°è¡Œæœ«</p><p>alt &lt;- # å·¦ç§»ä¸€ä¸ª word</p><p>alt -&gt; # å³ç§»ä¸€ä¸ª word</p><p>ctrl u # å‰ªåˆ‡æ•´è¡Œå†…å®¹</p><p>ctrl k # å‰ªåˆ‡å…‰æ ‡åŽé¢çš„å†…å®¹</p><p>ctrl y # ç²˜è´´</p></blockquote><p><strong>ç®¡ç†è¿›ç¨‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºç»ˆç«¯ç›¸å…³è¿›ç¨‹</span></span><br><span class="line">ps </span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰è¿›ç¨‹</span></span><br><span class="line">ps x </span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">ps aux </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºä»Žç»ˆç«¯å¯åŠ¨çš„åŽå°è¿›ç¨‹</span></span><br><span class="line"><span class="built_in">jobs</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># è®©æŒ‡å®šåºå·çš„ä»Žç»ˆç«¯å¯åŠ¨çš„è¿›ç¨‹è¿”å›žåˆ°å‰å°</span></span><br><span class="line"><span class="built_in">fg</span> %JOB_SPEC </span><br><span class="line"></span><br><span class="line"><span class="comment"># è®©æŒ‡å®šåºå·çš„ä»Žç»ˆç«¯å¯åŠ¨çš„è¿›ç¨‹è¿”å›žåˆ°åŽå°</span></span><br><span class="line"><span class="built_in">bg</span> %JOB_SPEC </span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»™è¿›ç¨‹å‘é€ä¿¡å·ï¼Œæœ€å¸¸è§çš„ä¿¡å·æ˜¯ï¼š</span></span><br><span class="line"><span class="built_in">kill</span> -SIG_NUM PID </span><br><span class="line">    1  HUP  æŒ‚èµ·</span><br><span class="line">    2  INT  ä¸­æ–­ï¼Œå’Œ ctrl c çš„ä½œç”¨ä¸€æ ·</span><br><span class="line">    9  KILL æ€æ­»ï¼Œè¿™ä¸ªä¿¡å·å¹¶ä¸ä¼šå‘ç»™è¿›ç¨‹å·æ˜¯ PID çš„è¿›ç¨‹ï¼Œè€Œæ˜¯ç«‹å³å¼ºåˆ¶åœæ­¢æ­¤è¿›ç¨‹ï¼Œè¢«æ€è¿›ç¨‹å°±æ²¡æœ‰æœºä¼šä¿å­˜æ•°æ®</span><br><span class="line">    15 TERM <span class="built_in">kill</span> å‘½ä»¤çš„é»˜è®¤ä¿¡å·ï¼Œç»ˆæ­¢è¿›ç¨‹ï¼Œè¢«ä¸­æ­¢çš„è¿›ç¨‹æœ‰æœºä¼šä¿å­˜æ•°æ®</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Bash </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>åšå®¢ç³»ç»Ÿè¿ç§»è®°å½•</title>
      <link href="/2018/09/26/%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB%E8%AE%B0%E5%BD%95/"/>
      <url>/2018/09/26/%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB%E8%AE%B0%E5%BD%95/</url>
      <content type="html"><![CDATA[<p>æ­¤å‰æˆ‘ç”¨çš„æ˜¯ <a href="http://www.zblogcn.com/" target="_blank" rel="noopener">Z-blog ç³»ç»Ÿ</a>ï¼Œè¿™ä¸ªç³»ç»Ÿä¸Šæ‰‹ç®€å•ï¼Œä¸è¿‡ä»…æ”¯æŒåœ¨ç½‘é¡µåœ¨çº¿ç¼–å†™æ–‡ç« ã€‚è¿™ç§æ–¹å¼å¼Šç«¯æ˜¯æ¯”è¾ƒæ­»æ¿ï¼Œå¦‚æžœå°†æ¥éœ€è¦æŠŠæ–‡ç« ç§»åŠ¨åˆ°åˆ«çš„åœ°æ–¹ä¼šå¾ˆéº»çƒ¦ï¼Œè€Œå¦‚æžœæ˜¯ç”¨ MarkDown æ¥å†™æ–‡ç« å°±ä¸ä¼šæœ‰è¿™ä¸ªéº»çƒ¦äº†ã€‚æœ¬æ–‡å°±è¯¦ç»†è®°å½•è¿™æ¬¡åšå®¢ç³»ç»Ÿè¿ç§»çš„ç»†èŠ‚ï¼ŒåŒ…å« Linux ç³»ç»Ÿé…ç½®ã€Nginx çš„é…ç½®ã€<a href="https://hexo.io/" target="_blank" rel="noopener">hexo</a> çš„é…ç½®å’Œ deploy è„šæœ¬ç­‰å†…å®¹ã€‚</p><p>é¦–å…ˆæ˜¯ï¼Œè¿™æ¬¡åˆæŠŠ VPS çš„ Server ç¡¬ç›˜é‡ç½®äº†ï¼Œæ¯æ¬¡é‡ç½®åŽéƒ½éœ€è¦é‡æ–°è®¾ç½®é…ç½®ä¸€é Linux ç³»ç»Ÿï¼ˆæˆ‘çš„ VPS æ˜¯ Ubuntu 16.04ï¼‰ï¼Œæ‰€ä»¥è¿™æ¬¡è®°å½•ä¸€ä¸‹é…ç½®çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯å„ç§é…ç½®å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">adduser liutao <span class="comment"># add user, with root user</span></span><br><span class="line">usermod -aG sudo liutao <span class="comment"># add sudo permission, with root user</span></span><br><span class="line">su - liutao <span class="comment"># switch to user liutao</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># update repository info</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get upgrade</span><br><span class="line"></span><br><span class="line"><span class="comment"># configure shadowsocks</span></span><br><span class="line">sudo apt install python-pip</span><br><span class="line">sudo pip install shadowsocks</span><br><span class="line">sudo mkdir /etc/shadowsocks</span><br><span class="line"></span><br><span class="line"><span class="comment"># create config file</span></span><br><span class="line">sudo vim /etc/shadowsocks/ss.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"server"</span>:<span class="string">"0.0.0.0"</span>,</span><br><span class="line">    <span class="string">"server_port"</span>:22222,</span><br><span class="line">    <span class="string">"local_port"</span>:1080,</span><br><span class="line">    <span class="string">"password"</span>:<span class="string">"your pass word"</span>,</span><br><span class="line">    <span class="string">"timeout"</span>:1000,</span><br><span class="line">    <span class="string">"method"</span>:<span class="string">"aes-256-cfb"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># add service configuration info,.</span></span><br><span class="line">sudo vim /etc/systemd/system/shadowsocks.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Shadowsocks Server</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/bin/ssserver -c /etc/shadowsocks/ss.json</span><br><span class="line">Restart=on-abort</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"><span class="comment"># start shadowsocks service</span></span><br><span class="line">sudo systemctl start shadowsocks</span><br><span class="line"></span><br><span class="line"><span class="comment"># start shadowsocks on startup</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> shadowsocks</span><br><span class="line"></span><br><span class="line"><span class="comment"># install linuxbrew</span></span><br><span class="line">sh -c <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/Linuxbrew/install/master/install.sh)</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># install zsh</span></span><br><span class="line">sudo apt-get install zsh</span><br><span class="line"></span><br><span class="line"><span class="comment"># install oh my zsh, this dependends on zsh</span></span><br><span class="line">sh -c <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)</span>"</span></span><br><span class="line">vim .zshrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># install Nginx, MySQL, Php</span></span><br><span class="line">wget http://soft.vpser.net/lnmp/lnmp1.5-full.tar.gz</span><br><span class="line">gunzip lnmp1.5-full.tar.gz</span><br><span class="line">tar xf lnmp1.5-full.tar</span><br><span class="line"><span class="built_in">cd</span> lnmp1.5-full</span><br><span class="line">sudo ./install.sh lnmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># install word-press</span></span><br><span class="line">wget https://wordpress.org/latest.zip</span><br><span class="line">unzip latest.zip -d wordpress</span><br><span class="line"></span><br><span class="line"><span class="comment"># set root to be/home/liutao/wordpress</span></span><br><span class="line">sudo vim /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br><span class="line">sudo nginx -s reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶åŽæœ¬åœ°æµè§ˆå™¨æ‰“å¼€ https://tao93.top/ å¼€å§‹è®¾ç½® WordPress</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># create database named wordpress</span></span><br><span class="line">mysql -u root -p</span><br><span class="line">&gt; create database wordpress</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶åŽåœ¨æµè§ˆå™¨ä¸­å¡«å…¥åˆšåˆšçš„ database åå­—ï¼ŒåŠå…¶ä»–ä¿¡æ¯</span></span><br><span class="line"><span class="comment"># åœ¨ server ä¸­çš„ WordPress æ ¹ç›®å½•ä¸­åˆ›å»º wp-config.php å¹¶å¡«å…¥æµè§ˆå™¨é¡µé¢æ˜¾ç¤ºçš„å†…å®¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¾åˆ° nginx ä½¿ç”¨çš„ config æ–‡ä»¶</span></span><br><span class="line">sudo nginx -t</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºäº†è§£å†³ä¸€äº›æƒé™é—®é¢˜ï¼Œwww æ˜¯ nginx é…ç½®æ–‡ä»¶ä¸­å£°æ˜Žçš„ web server çš„ user name</span></span><br><span class="line"><span class="comment"># è¿™æ ·å°±æŠŠ group æ”¹ä¸ºäº† wwwï¼Œå¹¶ä¸” group ç”¨æˆ·éƒ½æœ‰ write çš„æƒé™</span></span><br><span class="line">sudo chgrp -R www &lt;root_dir_of_wordpress&gt;</span><br><span class="line">sudo chmod -R g+w &lt;root_dir_of_wordpress&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦å¤–è¿˜åœ¨ &lt;root_dir_of_wordpress&gt; ä¸­çš„ wp-config.php æ–‡ä»¶ä¸­æ’å…¥äº† define('FS_METHOD','direct'); è¿™æ ·ä¸€è¡Œï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯å¿…è¦çš„</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå°±æ˜¯æœ€ç»ˆé…ç½®åˆ° WordPress çš„è¿‡ç¨‹ã€‚ä¹‹æ‰€ä»¥é…ç½® WordPressï¼Œæ˜¯å› ä¸ºæˆ‘æŸ¥åˆ° WordPress å¯ä»¥ä½¿ç”¨ Markdownï¼Œå¦å¤– WordPress è‡ªå¸¦è¯„è®ºåŠŸèƒ½ï¼Œæ’ä»¶å’Œä¸»é¢˜ä¹Ÿéžå¸¸ä¸°å¯Œï¼Œæ‰€ä»¥å°±å…ˆä½¿ç”¨ WordPressã€‚ç»“æžœå‘çŽ° WordPress çš„ Markdown è¿˜éœ€è¦å®‰è£…æ’ä»¶æ‰èƒ½æ”¯æŒï¼Œå¦å¤–æ”¯æŒä¹Ÿä¸æ˜¯å¾ˆå¥½ï¼Œæ¯”å¦‚ä»£ç å—ä¼šæŠŠæ¯”è¾ƒé•¿çš„è¡Œè½¬è¡Œæ˜¾ç¤ºï¼ˆå³ä¸æ˜¯å¯ä»¥å·¦å³æ»‘åŠ¨ï¼‰ï¼Œä»£ç è¡Œå·ä¸Žé«˜äº®éƒ½æ²¡è¦ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘è¿˜æ˜¯ç—›ä¸‹å†³å¿ƒï¼Œæ¢å›žåˆ° hexoã€‚hexo æ¯”è¾ƒç®€å•ï¼Œæœ¬åœ°å®‰è£… hexo åŽï¼Œåœ¨ç©ºç›®å½•ä¸­æ‰§è¡Œ hexo init å³å¯ç”Ÿæˆä¸€å †ç›¸å…³æ–‡ä»¶ï¼Œå…¶ä¸­çš„ public ç”¨æ¥å­˜æ”¾ä»Žå½“å‰ theme å’Œ markdown æ–‡ä»¶ç”Ÿæˆçš„ static web æ–‡ä»¶ï¼›è€Œ source ç›®å½•ç”¨æ¥å­˜æ”¾ markdown æ–‡ä»¶ã€‚ç®€å•ä½¿ç”¨æ­¥éª¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in hexo root directory</span></span><br><span class="line">hexo g <span class="comment"># generate static web files</span></span><br><span class="line"></span><br><span class="line">hexo server <span class="comment"># start local web server, then browse http://localhost:4000 to preview web pages</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># copy files in public to server's directory, therefore updated pages can be browsed at https://tao93.top/</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå°±æ˜¯ç®€å•çš„ç”¨æ³•ï¼Œä¸è¿‡å®žé™…ä¸Šæˆ‘åšäº†ä¸€äº›é¢å¤–å·¥ä½œã€‚ä¾‹å¦‚ä¸ºäº†é¿å… markdown æ–‡ä»¶æ„å¤–ä¸¢å¤±ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒä»¬å¤‡ä»½åˆ° server ä¸Šï¼Œserver å’Œ local åŒæ—¶ä¸¢å¤±çš„å¯èƒ½æ€§æžå°ã€‚å¦å¤–ï¼Œmarkdown ä¸­æ’å…¥å›¾ç‰‡æ—¶ï¼Œå¯ä»¥å…ˆæŠŠå›¾ç‰‡æ”¾åœ¨æœ¬åœ°ï¼Œç„¶åŽ markdown ä¸­æŒ‡å‘å›¾ç‰‡çš„æœ¬åœ°è·¯å¾„ï¼Œè¿™æ ·ç”Ÿæˆçš„ web æ–‡ä»¶ä¼šæŠŠå›¾ç‰‡æ‹·è´åˆ° public ç›®å½•ä¸­æŸå¤„ï¼Œç„¶åŽ html æ–‡ä»¶å¼•ç”¨ public ç›®å½•ä¸­çš„ imageï¼Œè¿™æ—¶çš„å¼•ç”¨å…¶å®žå°±æ˜¯ä¸€ä¸ª url äº†ã€‚ä½†æ˜¯æˆ‘ä¸æ˜¯è¿™æ ·åšçš„ï¼Œæˆ‘æ˜¯å…ˆæŠŠè¦æ’å…¥çš„å›¾ç‰‡æ‹·è´åˆ° Server çš„ public ç›®å½•æŸå¤„ï¼Œè¿™æ ·å°±ä¼šå¾—åˆ°ä¸€ä¸ªæŒ‡å‘æ¬¡å›¾ç‰‡çš„ urlï¼Œç„¶åŽå† markdown ä¸­ç›´æŽ¥ä½¿ç”¨è¿™ä¸ª urlã€‚è¿™æ ·çš„è¯ï¼Œåªè¦ server çš„å›¾ç‰‡åº“ä¿æŒç¨³å®šï¼Œmarkdown æ–‡ä»¶å°±ä¸ç”¨å’Œæœ¬åœ°å›¾ç‰‡åº“ç»‘å®šåœ¨ä¸€èµ·ã€‚åŒæ ·çš„ï¼Œserver çš„å›¾ç‰‡åº“ä¹Ÿéœ€è¦å¤‡ä»½åˆ° localï¼Œä»¥ç¡®ä¿å®‰å…¨ã€‚ä¸‹é¢å°±å¼€å§‹ä»‹ç»ä»¥ä¸Šä¸¤ç‚¹ã€‚</p><p>é¦–å…ˆæ˜¯æœ¬åœ° source ç›®å½•éœ€è¦å¤‡ä»½åˆ° server ä¸Šï¼Œæˆ‘çš„æ–¹å¼æ˜¯æœ¬åœ° source ç›®å½•ä½¿ç”¨ git æ¥è¿½è¸ªï¼Œç„¶åŽ server ä¸Šç®€åŽ†ä¸€ä¸ª bare repository source.gitï¼Œè¿™æ ·æœ¬åœ°çš„æ¯æ¬¡ commit éƒ½ push åˆ° server ä¸Šçš„ source.gitï¼Œå°±å¯ä»¥ä½œä¸ºå¤‡ä»½äº†ã€‚ç›¸åº”çš„æœ¬åœ°çš„ public ç›®å½•ä¹Ÿè¦ push åˆ° server ä¸Šçš„ public.git è¿™æ ·ä¸€ä¸ª bare repositoryï¼Œç„¶åŽåœ¨ server ä¸Šçš„ public ä¸­ï¼Œä»Ž public.git è¿™ä¸ª remote git pull ä¸€ä¸‹ï¼Œè¿™æ · server ä¸­çš„ public å°±æœ‰äº†æœ€æ–°çš„ web æ–‡ä»¶ã€‚</p><p>æŽ¥ä¸‹æ¥æ˜¯å›¾ç‰‡ä¸Šä¼ åˆ° server ä¸­ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘å†™äº†ä¸€ä¸ª Python è„šæœ¬ï¼Œç”¨æ¥æŠŠæœ¬åœ°å›¾ç‰‡ä¸Šä¼ åˆ° serverï¼Œæˆ–è€…æŠŠå‰ªè´´æ¿çš„å›¾ç‰‡ (ä¾¿äºŽå¤åˆ¶å›¾ç‰‡çš„æƒ…æ™¯) ä¸Šä¼ åˆ° serverï¼Œç„¶åŽå°†å¯¹åº”çš„ url ç²˜è´´åˆ°å‰ªè´´æ¿ï¼Œè¿™æ ·çš„è¯ï¼Œåªéœ€è¦æ‰§è¡Œè¿™ä¸ª Python è„šæœ¬ï¼Œå°±å¯ä»¥ä¸Šä¼ æœ¬åœ°å›¾ç‰‡æˆ–è€…å‰ªè´´æ¿ä¸Šçš„å›¾ç‰‡ï¼Œå¹¶æŠŠå¾—åˆ°çš„ url å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œç„¶åŽå°±å¯ä»¥ç›´æŽ¥ç²˜è´´åˆ° markdown ä¸­ã€‚ä»¥ä¸‹æ˜¯è¿™ä¸ª upload_pic.py è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> ImageGrab, Image</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">now = datetime.datetime.now()</span><br><span class="line"></span><br><span class="line"><span class="comment"># store image files in date format directory path in server</span></span><br><span class="line">date_path = now.strftime(<span class="string">'%Y/%m/%d'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># use timestamp as image file name in server</span></span><br><span class="line">f_name = str(int(now.timestamp()))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(sys.argv) == <span class="number">1</span>:</span><br><span class="line">    <span class="comment"># get picture in clipboard</span></span><br><span class="line">    im = ImageGrab.grabclipboard()</span><br><span class="line">    <span class="comment"># check whether it's a picture</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(im, Image.Image):</span><br><span class="line">    </span><br><span class="line">        <span class="comment"># file name in server</span></span><br><span class="line">        f_name = str(int(datetime.datetime.now().timestamp())) + <span class="string">'.png'</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># save in local</span></span><br><span class="line">        im.save(f_name)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># the url of the image</span></span><br><span class="line">        url = <span class="string">'http://tao93.top/images/'</span> + date_path + <span class="string">'/'</span> + f_name</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># copy the url to clipboard</span></span><br><span class="line">        os.system(<span class="string">"echo '%s' | pbcopy"</span> % url)</span><br><span class="line">        print(<span class="string">'url has been copied'</span>)</span><br><span class="line">        print(<span class="string">'copying...'</span>)</span><br><span class="line">        dest_path = <span class="string">'/home/liutao/hexo_blog/public/images/'</span> + date_path</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># mkdir in server and copy the image</span></span><br><span class="line">        os.system(<span class="string">"ssh liutao@tao93.top 'mkdir -p "</span> + dest_path + <span class="string">"'"</span>)</span><br><span class="line">        os.system(<span class="string">'scp '</span> + f_name + <span class="string">' liutao@tao93.top:'</span> + dest_path)</span><br><span class="line">        print(<span class="string">'copy finished'</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># remove local image file</span></span><br><span class="line">        os.remove(f_name)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">'clipboard content is not a image!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> len(sys.argv) == <span class="number">2</span>:</span><br><span class="line">    <span class="keyword">if</span> os.path.isfile(sys.argv[<span class="number">1</span>]):</span><br><span class="line">        <span class="comment"># file name in server</span></span><br><span class="line">        f_name = str(int(datetime.datetime.now().timestamp()))</span><br><span class="line">        dot_loc = sys.argv[<span class="number">1</span>].rfind(<span class="string">'.'</span>)</span><br><span class="line">        <span class="keyword">if</span> dot_loc &gt;= <span class="number">0</span>:</span><br><span class="line">            f_name += sys.argv[<span class="number">1</span>][dot_loc:] <span class="comment"># append the file extension</span></span><br><span class="line">        </span><br><span class="line">        url = <span class="string">'http://tao93.top/images/'</span> + date_path + <span class="string">'/'</span> + f_name</span><br><span class="line">        os.system(<span class="string">"echo '%s' | pbcopy"</span> % url)</span><br><span class="line">        print(<span class="string">'url has been copied'</span>)</span><br><span class="line">        print(<span class="string">'copying...'</span>)</span><br><span class="line">        dest_path = <span class="string">'/home/liutao/hexo_blog/public/images/'</span> + date_path</span><br><span class="line">        os.system(<span class="string">"ssh liutao@tao93.top 'mkdir -p "</span> + dest_path + <span class="string">"'"</span>)</span><br><span class="line">        os.system(<span class="string">'scp '</span> + sys.argv[<span class="number">1</span>] + <span class="string">' liutao@tao93.top:'</span> + dest_path + <span class="string">'/'</span> + f_name)</span><br><span class="line">        print(<span class="string">'copy finished'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(sys.argv[<span class="number">1</span>] + <span class="string">' is not a file!'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'too much arguments'</span>)</span><br></pre></td></tr></table></figure><p>ä¸ºäº†ç®€åŒ–æ­¥éª¤ï¼Œæˆ‘å†™äº†ä¸€ä¸ª deploy.sh è„šæœ¬æ”¾åœ¨æœ¬åœ° hexo blog æ ¹ç›®å½•ä¸­ï¼Œè¿™æ ·åªéœ€è¦åœ¨ source ç›®å½•ä¸­ç¼–è¾‘ markdown æ–‡ä»¶ï¼Œç„¶åŽ commitï¼Œå†è°ƒç”¨ deploy.sh è„šæœ¬å³å¯ã€‚æ­¤è„šæœ¬æŠŠå…¶ä»–è¦åšçš„äº‹æƒ…éƒ½åšäº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># into source </span></span><br><span class="line"><span class="built_in">cd</span> <span class="built_in">source</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># make sure it's commited in source directory</span></span><br><span class="line">status=$(git status -s)</span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$status</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="comment"># git push in source</span></span><br><span class="line">    git push</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">'not commited in source directory!'</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># back into parent directory</span></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># generate static web files</span></span><br><span class="line">hexo g</span><br><span class="line"></span><br><span class="line"><span class="comment"># git push in local public directory</span></span><br><span class="line"><span class="built_in">cd</span> public</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">'update web files'</span></span><br><span class="line">git push</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># git pull in server's public directory</span></span><br><span class="line">ssh liutao@tao93.top <span class="string">'cd /home/liutao/hexo_blog/public; git pull'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># git commit in server's images directory</span></span><br><span class="line">ssh liutao@tao93.top <span class="string">'cd /home/liutao/hexo_blog/public/images; git add .; git commit -m "add images"'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># git pull in local's images directory</span></span><br><span class="line"><span class="built_in">cd</span> images</span><br><span class="line">git pull</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'========='</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'Finished!'</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'========='</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸Šé¢çš„è„šæœ¬å°±æŠŠç”Ÿæˆ web æ–‡ä»¶ï¼Œæ‹·è´ public ä¸­çš„ web æ–‡ä»¶æ‹·è´åˆ° serverï¼ŒæŠŠ server ä¸­çš„ image ç›®å½•ä¸­çš„ä¿¡æ¯æ›´æ–°åˆ° local çš„ images ç›®å½•è¿™æ ·å‡ ä¸ªäº‹æƒ…ã€‚</p><p>é™„ï¼š</p><p>å¦‚æžœè¦æœ¬åœ° git repo æ²¡æœ‰ commitï¼Œremote repo æœ‰ commitï¼ŒçŽ°åœ¨éœ€è¦æœ¬åœ°çš„ master åˆ†æ”¯ track remote çš„ master åˆ†æ”¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…ˆæ·»åŠ  originï¼Œè®¾ç½®å¥½ url</span></span><br><span class="line">git remote add origin liutao@tao93.top:/home/liutao/hexo_blog/public/images/.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶åŽ fetch ä¸€ä¸‹ è¿œç¨‹çš„çŠ¶æ€</span></span><br><span class="line">git fetch</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶å¦‚æžœ git pull --set-upstream-to æ˜¯ä¸è¡Œçš„ï¼Œä¼šè¯´æœ¬åœ° master åˆ†æ”¯ä¸å­˜åœ¨ï¼Œè€Œéœ€è¦ä¸‹é¢è¿™æ ·æ‰è¡Œ</span></span><br><span class="line">git checkout master</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Other </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä¿®è½¦å°èƒ½æ‰‹ä¸Šçº¿</title>
      <link href="/2018/09/26/%E4%BF%AE%E8%BD%A6%E5%B0%8F%E8%83%BD%E6%89%8B%E4%B8%8A%E7%BA%BF/"/>
      <url>/2018/09/26/%E4%BF%AE%E8%BD%A6%E5%B0%8F%E8%83%BD%E6%89%8B%E4%B8%8A%E7%BA%BF/</url>
      <content type="html"><![CDATA[<p>ä¿®è½¦æŠ€æœ¯ä¹Ÿæ˜¯æŠ€æœ¯ï¼Œæ‰€ä»¥å…³äºŽä¿®è½¦çš„åšå®¢ä¹Ÿæ˜¯æŠ€æœ¯åšå®¢å•¦ ðŸ˜</p><p>äº‹æƒ…è¦ä»Žä¸¤ä¸ªæœˆå‰è¯´èµ·ï¼Œå½“æ—¶åœ¨äº¬ä¸œä¹°äº†ä¸€è¾†ç²‰è‰²çš„æ¯”å¾·æ–‡ç”µåŠ¨è½¦ç»™å¥³æœ‹å‹ä¸Šä¸‹ç­ç”¨ã€‚è¿™è¾†ç”µåŠ¨è½¦æ¯”è¾ƒä¾¿å®œï¼Œå½“æ—¶æˆ‘ä»¬ä¹Ÿä¸æ€Žä¹ˆæ³¨æ„é¢„é˜²ç”µåŠ¨è½¦è¢«é›¨æ·‹ï¼Œå› ä¸ºæ½œæ„è¯†è§‰å¾—ç»å¸¸çœ‹åˆ°åˆ«äººçš„ç”µåŠ¨è½¦è¢«é›¨æ·‹ï¼Œæ‰€ä»¥åº”è¯¥æ²¡äº‹ã€‚äº‹æƒ…åå°±ååœ¨è¿™è¾†ç”µåŠ¨è½¦é˜²æ°´æ€§çœŸä¸å¥½ï¼Œæ‰€ä»¥å‡ åœºå¤§é›¨ä¹‹åŽï¼Œè¿˜æ²¡åˆ°ä¸€ä¸ªæœˆï¼Œç”µåŠ¨è½¦å°±åäº†ï¼Œæ‹§è½¦æŠŠä¸Šçš„æ—‹é’®è½¦å­æ²¡ååº”ï¼Œä¹Ÿå°±æ˜¯ç”µæœºä¸è½¬äº†ã€‚</p><p>æœ¬ç€åº”è¯¥æœ‰ä¸“ä¸šäººå‘˜ (åŽé¢äº‹å®žè¯æ˜Žä¿®è½¦çš„çœŸä¸æ˜¯ä¸ªå¥½ä¸œè¥¿) ä¿®ç†çš„æ€åº¦ï¼Œå¤§çƒ­å¤©æˆ‘è´¹å°½åŠ›æ°”æŠŠç”µåŠ¨è½¦æŽ¨åˆ°äº†ä¿®è½¦é“ºã€‚ç­‰äº†åŠå¤©ä¿®è½¦çš„æ‰å§—å§—æ¥è¿Ÿçš„è¿‡æ¥äº†ã€‚ç„¶åŽä¿®è½¦çš„æ‰“å¼€ç”µåŠ¨è½¦åŽç›–çž§äº†çž§ï¼Œè¯´æ˜¯æŽ§åˆ¶å™¨åäº†ï¼Œéœ€è¦æ›´æ¢ï¼Œä»–åº—é‡Œçš„æŽ§åˆ¶å™¨ 80 å—é’±ä¸€ä¸ªã€‚è¿™æ—¶å€™æˆ‘å’Œå¥³æœ‹å‹å°±å’ŒåŽ‚å®¶è”ç³»ï¼ŒåŽ‚å®¶ç§°è¦ä¹ˆç»™æˆ‘ä»¬50å—é’±ï¼Œè¦ä¹ˆæˆ‘ä»¬æŠŠæ—§æŽ§åˆ¶å™¨å¯„å›žåŽ»ç„¶åŽä»–ä»¬å¯„ä¸€ä¸ªæ–°çš„å›žæ¥ã€‚æˆ‘ä»¬å¿ƒæƒ³ï¼Œå¿«é€’å¯„æŽ§åˆ¶å™¨ä¸€æ¥ä¸€å›žè¦å¥½å¤šå¤©ï¼Œè¿™äº›å¤©æˆ‘ä»¬çš„è½¦å­å°±è¦è¿™ä¹ˆæ™¾åœ¨ç¦»å®¶å‡ å…¬é‡Œçš„åœ°æ–¹ï¼Œè¿™æ€Žä¹ˆèƒ½å¿ï¼æ‰€ä»¥æˆ‘ä»¬å’ŒåŽ‚å®¶æ’•é€¼ï¼Œæœ€ç»ˆåŽ‚å®¶ç­”åº”ç»™æˆ‘ä»¬ 80 å—ï¼ŒäºŽæ˜¯æˆ‘ä»¬å°±åœ¨åº—é‡Œæ¢äº†ä¸ªæŽ§åˆ¶å™¨ã€‚å‘çˆ¹çš„ä¿®è½¦çš„ï¼Œå¸®æˆ‘ä»¬æ¢æŽ§åˆ¶å™¨æ—¶æ…¢æ…¢è…¾è…¾ï¼Œä¸­é€”è¿˜åœä¸‹æ¥å¸®ä¸¤ä¸ªå¥³çš„é…é’¥åŒ™ï¼å½“æ—¶çœŸçš„æ˜¯å¾ˆæ°”æ„¤ï¼Œæ¢ä¸ªæŽ§åˆ¶å™¨æ¢äº†æŽ¥è¿‘ä¸¤å°æ—¶ï¼ŒæœŸé—´ä¿®è½¦çš„è¿˜ä¸åœç”¨ä¸€ç§å‚²æ…¢çš„æ€åº¦æ•°è½æˆ‘ä»¬ä¸åº”è¯¥å†ç½‘ä¸Šå›¾ä¾¿å®œä¹°äº†ä¸ªè´¨é‡å·®çš„ç”µåŠ¨è½¦ï¼Œä»–åº—é‡Œå–çš„è½¦æ€Žä¹ˆæ€Žä¹ˆå¥½æ€Žä¹ˆæ€Žä¹ˆåœ°ã€‚è€Œå½“å¥³æœ‹å‹å¯¹ä¿®è½¦çš„è¯´ï¼šâ€ä½ çš„æ„æ€æ˜¯è¿™ä¸ªç”µåŠ¨è½¦å„æ–¹é¢è´¨é‡å¾ˆå·®å—ï¼Ÿâ€ ä¿®è½¦çš„åˆå¼€å§‹å«ç³Šå…¶è¾žã€‚</p><p><img src="http://tao93.top/images/2018/09/01/1535789639.png" alt=""></p><p>æ¢å®Œä¹‹åŽï¼Œæœ¬æ¥æƒ³è¿™äº‹å°±ç®—ç»“æŸäº†ï¼Œè¯¥åŽ»æ‰¾åŽ‚å®¶è¦ 80 å—é’±äº†ã€‚è°çŸ¥é“ï¼Œäº‹æƒ…æ‰åˆšåˆšå¼€å§‹ã€‚å½“å¤©ï¼Œå¥³æœ‹å‹å°±è¯´è½¦å­æœ‰é—®é¢˜ï¼Œå¥¹æŠŠè½¦å­ä»Žåœ°ä¸‹è½¦åº“æŽ¨å‡ºæ¥æ—¶ï¼Œä¸Šä¸€ä¸ªå¾ˆé™¡çš„å¡æ—¶ï¼Œè½¦å­åŠ¨åŠ›ä¸è¶³ä¸Šä¸åŽ»ï¼Œä¸Šåˆ°ä¸€èˆ¬å°±çŒ›åœ°å¾€å›žé€€ï¼æœ€åŽè¿˜æ˜¯ä¸€ä¸ªç”·ç”Ÿå¥½å¿ƒæŠŠå¥¹æŽ¨ä¸Šæ¥äº†ã€‚ç„¶åŽéš”äº†ä¸¤å¤©ï¼Œå¥³æœ‹å‹åˆåŽ»ä¿®è½¦é“ºé‚£é‡Œï¼Œè¯¢é—®ä¸ºä»€ä¹ˆåŠ¨åŠ›ä¸è¡Œäº†ã€‚ä¿®è½¦çš„éª‘ç€ç”µåŠ¨è½¦èµ°äº†ä¸€åœˆï¼Œç»™äº†è¿™ä¹ˆå¥è¯ã€Œç”µæœºåäº†ã€ã€‚æœ¬æ¥æˆ‘å¯¹ä¿®è½¦çš„å°±æ²¡å¥½å°è±¡ï¼Œæ‰€ä»¥å¬åˆ°è¿™é‡Œæˆ‘æ˜¯ä¸ä¿¡çš„ï¼ŒæŽ§åˆ¶å™¨åäº†æˆ‘ä¿¡ï¼Œç”µæœºä¹ŸåŒæ—¶åè¿™ä¹Ÿå¤ªæ‰¯æ·¡äº†ã€‚æ‰€ä»¥æˆ‘æŽ¨æ–­æ˜¯æŽ§åˆ¶å™¨çš„é€‚é…æ€§ (æˆ–è€…è¯´å’Œç”µåŠ¨è½¦çš„å…¼å®¹æ€§) æ¯”è¾ƒå·®ï¼Œæ‰€ä»¥æ‰ä¼šåŠ¨åŠ›ä¸è¶³ã€‚ä¸å°±æˆ‘è¿˜å‘çŽ°åˆ«çš„é—®é¢˜ï¼Œå½“æ‹§ç€è½¦æŠŠæ—‹é’®å†æåˆ¹è½¦é—¸æ—¶ï¼Œç”µæœºå±…ç„¶è¿˜åœ¨å‘åŠ›ï¼Œè¿™ä¸ªæœ€åŸºæœ¬çš„å®‰å…¨æœºåˆ¶éƒ½æ²¡äº†ã€‚æ­¤å¤–ï¼Œæ™ºèƒ½æŽ§åˆ¶å™¨åœ¨å¯åŠ¨æ—¶å™ªéŸ³æ¯”è¾ƒå¤§ã€‚</p><p>æŠ±ç€å¯¹æŽ§åˆ¶å™¨é€‚é…æ€§çš„è´¨ç–‘ï¼Œæˆ‘æ‰¾åˆ°äº†æ­å·žä¸€å®¶æ¯”å¾·æ–‡è½¦åº—ï¼Œä»Žè½¦åº—é‚£é‡Œæˆ‘ç®—æžæ¸…æ¥šäº†ç¼˜ç”±ã€‚åŽŸæ¥ï¼Œä¿®è½¦çš„ç»™æˆ‘æ¢çš„æ˜¯æ‰€è°“æ™ºèƒ½æŽ§åˆ¶å™¨ï¼Œä¹Ÿå°±æ˜¯åŸºæœ¬å•¥ç”µåŠ¨è½¦éƒ½èƒ½ç”¨ï¼Œä½†æ˜¯å¹¶ä¸èƒ½å¯¹æ¯ç§ç”µåŠ¨è½¦éƒ½æœ‰æœ€å¥½çš„é€‚é…æ€§ï¼Œè‡ªç„¶ä¹Ÿè¿œä¸å¦‚åŽŸè£…æŽ§åˆ¶å™¨ã€‚è€ŒåŽŸè£…æŽ§åˆ¶å™¨åªèƒ½åŽ‚å®¶å¯„è¿‡æ¥ï¼Œè¿™ä¸ªæ¯”å¾·æ–‡è½¦åº—ä¹Ÿæ²¡æœ‰ã€‚å¦å¤–ï¼Œä»ŽåŽ‚å®¶æ‹¿åˆ°åŽŸè£…æŽ§åˆ¶å™¨åŽï¼Œæ¥è¿™ä¸ªåº—é‡Œå®‰è£…çš„è¯ï¼Œä»–ä»¬éœ€è¦æ”¶ ä¸‰å››åå—é’±ã€‚</p><p>ä¹‹åŽæˆ‘å°±åƒåŽ‚å®¶è”ç³»ï¼Œè¡¨ç¤ºä¸è¦ 80 å—é’±äº†ï¼Œæˆ‘æŠŠåäº†çš„åŽŸè£…æŽ§åˆ¶å™¨å¯„å›žåŽ»ï¼ŒåŽ‚å®¶ç»™æˆ‘å¯„ä¸€ä¸ªæ–°çš„æŽ§åˆ¶å™¨ã€‚ä¸å¾—ä¸åæ§½ï¼ŒåŽ‚å®¶åŠ¨ä½œéžå¸¸æ…¢ï¼Œæ€»å…±ä¸¤ä¸‰ä¸ªæ˜ŸæœŸæˆ‘æ‰æ‹¿åˆ°æ–°çš„åŽŸè£…æŽ§åˆ¶å™¨ã€‚æˆ‘æ‰ä¸åƒè·‘åˆ°æ¯”å¾·æ–‡è½¦åº—å‡ºå‡ åå—é’±è®©ä»–ä»¬å¸®æˆ‘å®‰è£…ï¼Œæ‰€ä»¥æŽ¥ä¸‹æ¥ï¼Œæˆ‘ç›´æŽ¥è‡ªå·±åŠ¨æ‰‹å®‰è£…ï¼Œå…¶å®žå®‰è£…å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠé‚£äº›å€Ÿå£å¯¹åº”æ’ä¸Šå°±å¥½äº†ã€‚å®‰è£…å¥½åŽï¼Œæˆ‘è¯•ç€éª‘äº†éª‘ï¼Œæ²¡äº†å™ªéŸ³ï¼Œå¯åŠ¨æ›´å¿«ï¼ŒåŽé¢ä¸¤å¤©å¥³æœ‹å‹ä¹Ÿè¡¨ç¤ºä¸Šå¡æ—¶ä¸ä¼šåŠ¨åŠ›ä¸è¶³äº†ã€‚</p><p>åˆ°æ­¤å¥½åƒå·²ç»ç»“æŸäº†ã€‚ä¸è¿‡å¦‚æžœå°±è¿™æ ·ç»“æŸäº†ï¼Œæˆ‘è¿˜èƒ½ç§°ä½œä¿®è½¦å°èƒ½æ‰‹ä¹ˆï¼</p><p>æ‰ä¸¤ä¸‰å¤©ï¼Œå°±å‡ºçŽ°æ‹§æ—‹é’®åŽè½¦è½® (ç”µæœº) ä¸è½¬çš„é—®é¢˜ï¼Œä½†æ˜¯åˆä¼šå¿½ç„¶å¥½äº†ã€‚åˆä¸€æ¬¡å¥³æœ‹å‹åŽ»ä¸Šç­éª‘åˆ°åŠè·¯ï¼Œå¿½ç„¶è½¦è½®ä¸è½¬äº†ï¼ŒæŠŠå¥¹å“ä¸€è·³ï¼ŒåŽé¢çš„æ—¥å­å¥¹å°±å†ä¹Ÿä¸æ•¢éª‘äº†ï¼Œå¥¹è¯´è¿˜æ˜¯è¦åŽ»ä¿®è½¦åº—ä¿®ä¸€ä¸‹æ‰è¡Œã€‚è¿™æ ·è¿‡äº†ä¸€ä¸ªå¤šæ˜ŸæœŸï¼Œåˆ°äº†ä»Šå¤©è¿™ä¸ªå‘¨å…­ã€‚æˆ‘ç»ˆäºŽæœ‰æ—¶é—´åŽ»å¤„ç†ä¸€ä¸‹è¿™ä»¶äº‹äº†ã€‚</p><p>æˆ‘æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œä¸€ä¸ªæ˜¯å¼„åˆ°ä¿®è½¦åº—åŽ»ï¼Œå¦ä¸€ä¸ªæ˜¯è‡ªå·±åŠ¨æ‰‹ï¼Œæˆ‘é€‰æ‹©äº†åŽè€…ï¼ŒåŽŸå› æ˜¯é—´æ­‡æ€§çš„å‡ºé—®é¢˜ï¼Œè¯´æ˜Žæ— æ³•ç¨³å®šå¤çŽ°ï¼Œå†‰ä¹‰å¼„åˆ°ä¿®è½¦åº—ï¼Œä¿®è½¦çš„æžåŠå¤©è¯´æ²¡æ¯›ç—…ï¼Œé‚£ä¸å°±å°´å°¬äº†å˜›ã€‚ä»Šå¤©æˆ‘è¿˜ç‰¹æ„éª‘ç€ç”µåŠ¨è½¦ç»•å°åŒºä¸€åœˆï¼Œé—®é¢˜ä¾ç„¶æ²¡å¤çŽ°ï¼Œè¿™å°±å¾ˆéº»çƒ¦äº†ã€‚ä¸è¿‡ï¼Œæˆ‘æ—©å°±æ€€ç–‘ï¼Œè¿™ç§é—´æ­‡æ€§çš„ç”µæœºä¸è½¬åº”è¯¥æ˜¯æŽ¥è§¦ä¸è‰¯çš„é—®é¢˜ã€‚æ‰€ä»¥ä»Šå¤©æˆ‘æ‰“ç®—è¯•è¯•ç”¨æŽ’é™¤æ³•æ¥çœ‹èƒ½å¦éªŒè¯æˆ‘çš„çŒœæµ‹ã€‚æˆ‘æ‰“å¼€åŽç›–ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535789679.png" alt=""></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œé“¶ç™½è‰²é“ç›’å­å°±æ˜¯æ–°çš„åŽŸè£…æŽ§åˆ¶å™¨ï¼Œç®­å¤´æ‰€æŒ‡çš„å°±æ˜¯å®ƒè¿žæŽ¥åˆ°ç”µåŠ¨è½¦çš„ä¸€äº›æŽ¥å£ã€‚éƒ½æ˜¯é‚£ç§å¸¦å€’é’©ã€ç›´æŽ¥æ’ä¸Šå°±å¯ä»¥çš„æŽ¥å£ã€‚</p><p>ä¿®è½¦ä¹Ÿè¦è®²å®‰å…¨ï¼Œæ¯•ç«Ÿç”µæ± çš„ç”µåŽ‹æœ‰å‡ åä¼ï¼Œå¯èƒ½ä¼šè§¦ç”µï¼Œæ‰€ä»¥æˆ‘æ˜¯è¿™æ ·æ¥åˆ¤æ–­æŽ¥å£æ˜¯å¦æœ‰é—®é¢˜çš„ï¼šæ–­å¼€ç”µæ± å’Œç”µåŠ¨è½¦çš„è¿žæŽ¥ï¼Œæ‹”å¼€ä¸€ä¸ªæŽ¥å£ï¼Œè¿žæŽ¥ä¸Šç”µæ± ï¼Œæœ€åŽè½¬åŠ¨æ—‹é’®çœ‹ç”µæœºæ˜¯å¦æ—‹è½¬ï¼Œæ˜¯çš„è¯è¯´æ˜Žè¿™ä¸ªæŽ¥å£åŽ‹æ ¹ä¸å½±å“ç”µæœºæ˜¯å¦è½¬åŠ¨ï¼Œå¦çš„è¯è¯´æ˜Žè¿™ä¸ªæŽ¥å£å…³é”®æŽ¥å£ä¹‹ä¸€ï¼Œä¼šå½±å“ç”µæœºçš„æ—‹è½¬ã€‚</p><p>ç”¨ä¸Šé¢çš„æ–¹æ³•æŒ¨ä¸ªæŽ¥å£å°è¯•ï¼Œæˆ‘æ‰¾åˆ°3ä¸ªå…³é”®æŽ¥å£ã€‚å¦‚æžœé—®é¢˜çœŸçš„æ˜¯æŽ¥è§¦ä¸è‰¯çš„è¯ï¼Œå¾ˆå¯èƒ½å°±æ˜¯è¿™ 3 ä¸ªæŽ¥å£ä¹‹ä¸€æŽ¥è§¦ä¸è‰¯ï¼Œæ‰€ä»¥æŽ¥ä¸‹æ¥æˆ‘æŠŠè¿™ 3 ä¸ªæŽ¥å£è¿›è¡Œä¸‹ä¸€è½®æµ‹è¯•ã€‚æµ‹è¯•æ–¹æ³•æ˜¯ï¼ŒæŠŠæŽ¥å£å¾€å¤–æ‹”ä¸€ç‚¹ (ä½†æ˜¯ä¾ç„¶åœ¨å€’é’©é”å®šèŒƒå›´å†…)ï¼Œè¿™æ ·å°±å¯ä»¥æ¨¡æ‹ŸçŽ°å®žä¸­æŽ¥å£æ¾åŠ¨çš„æƒ…å†µäº†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¦è¾¹æ˜¯æŽ¥å£æ’å¾ˆç´§ï¼Œå›¾ä¸­ç®­å¤´æŒ‡çš„å°±æ˜¯å€’é’©ï¼›å³è¾¹æ˜¯æŽ¥å£å¾€å¤–æ‹”ä¸€ç‚¹ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°å€’é’©å’Œä¸€ä¸ªå‡¸èµ·ç‰©ä¹‹é—´å·²ç»æ²¡æœ‰é—´éš™äº†ã€‚</p><p><img src="http://tao93.top/images/2018/09/01/1535789719.png" alt=""></p><p>é€šè¿‡æ¨¡æ‹ŸæŽ¥å£æ¾åŠ¨çš„æƒ…å†µï¼Œç„¶åŽæµ‹è¯•æ˜¯å¦ä¼šå¯¼è‡´ç”µæœºä¸è½¬ï¼Œå¾ˆå¿«æˆ‘å°±æ‰¾åˆ°äº†ä¸€ä¸ªæŽ¥å£ï¼Œè¿™ä¸ªæŽ¥å£å¾€å¤–æ‹”ä¸€ç‚¹ç‚¹ï¼Œç”µæœºå°±æ— æ³•è½¬ï¼Œå¾€é‡Œæ’ç´§ä¸€ç‚¹ï¼Œç”µæœºå°±èƒ½è½¬åŠ¨äº†ã€‚</p><p>å‘çŽ°äº†é—®é¢˜æ‰€åœ¨ï¼ŒæŽ¥ä¸‹æ¥å°±å¾ˆå¥½åŠžäº†ï¼Œç”¨ä¸œè¥¿æŠŠè¿™ä¸ªæŽ¥å£å›ºå®šç´§å°±å¥½äº†ï¼Œè®©å®ƒä¸€ç›´ä¿æŒæ’ç´§çš„çŠ¶æ€ã€‚æœ€å¥½çš„ææ–™åº”è¯¥ç»†é“ä¸ï¼Œç”¨ç»†é“ä¸æ‰Žç´§ç„¶åŽç”¨é’³å­æ‹§ç´§å°±å¥½ã€‚å¯æ˜¯æˆ‘æ˜Žç™½ç»†é“ä¸ï¼Œæ‰€ä»¥æˆ‘ç”¨ç»³å­æŠŠå®ƒç»‘ç´§æ¥ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢å›¾ä¸­è¿™æ ·ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535789742.png" alt=""></p><p>ä¸ºä»€ä¹ˆæˆ‘å‰é¢è¯´ç»†é“ä¸æ›´å¥½å‘¢ï¼Œå› ä¸ºç»†é“ä¸æ‹§ç´§åŽä¸ä¼šé€†è½¬å˜æ¾ï¼Œä½†æ˜¯ç»³å­æ˜¯ä¼šçš„ã€‚ç”¨ç»³å­å¸®ç¡¬çš„ä¸œè¥¿ï¼Œæ€»æ˜¯ä¼šæœ‰é‚£ä¹ˆå†™æ¾åŠ¨ï¼Œæ— æ³•å½»åº•ç»‘ç´§ã€‚æ‰€ä»¥åœ¨ç»‘å®ŒåŽï¼Œæˆ‘è¿˜ç”¨ä¸€æ ¹ç‰™ç­¾æŒ‘è¿‡ç»³å­ï¼Œç„¶åŽè½¬ä¸¤åœˆï¼Œè¿™æ ·ç»³å­å°±ä¼šè¢«ç»·å¾—å¾ˆç´§äº†ï¼Œå°±æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535789781.png" alt=""></p><p>ä¸Šå›¾ä¸­ç‰™ç­¾é¡ºæ—¶é’ˆæ—‹è½¬è¶Šå¤šï¼Œç»³å­å°±ç»·å¾—è¶Šç´§ã€‚</p><p>OKï¼Œå¤§åŠŸå‘Šæˆï¼</p>]]></content>
      
      
        <tags>
            
            <tag> Other </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä»Žé˜¿é‡Œäº‘æœåŠ¡å™¨åˆ°ä¸ªäººåšå®¢</title>
      <link href="/2018/09/26/%E4%BB%8E%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%88%B0%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
      <url>/2018/09/26/%E4%BB%8E%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%88%B0%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</url>
      <content type="html"><![CDATA[<h3 id="å‰è¨€ï¼š"><a href="#å‰è¨€ï¼š" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h3><p>(å‹æƒ…æç¤ºï¼Œæƒ³çœ‹æ­¥éª¤çš„è¯ï¼Œä¸‹é¢çš„å‰è¨€å¯ä»¥è·³è¿‡ä¸çœ‹)</p><p>ä¸ºä»€ä¹ˆæˆ‘çŽ°åœ¨è¦ä¹°é˜¿é‡Œäº‘çš„ VPS (Virtual Private Server) æžåšå®¢ç³»ç»Ÿå‘¢ï¼Ÿæˆ‘ä¹Ÿè¯´ä¸ä¸Šä¸ºä»€ä¹ˆï¼Œä¸è¿‡å¯ä»¥è®²ä¸€ä¸‹äº‹æƒ…çš„ç»è¿‡ã€‚</p><p>2016å¹´åˆšå¼€å§‹å·¥ä½œé‚£ä¼šå„¿ï¼Œä»Ž<a href="http://ewind.us/" target="_blank" rel="noopener">çŽ‹è¯‘é”‹</a>é‚£é‡ŒçŸ¥é“äº†ç§Ÿ VPSã€æ­å»ºæŸ socksã€nginx é©±åŠ¨ hexo åšå®¢è¿™æ ·ä¸€å¥—ä¸œè¥¿ã€‚å½“æ—¶è§‰å¾—å¾ˆæ–°é²œï¼Œç«‹é©¬ä¹Ÿä¹°äº†æ¬ç“¦å·¥çš„ VPSï¼Œç„¶åŽä¸€åŒçžŽæžï¼Œç®—æ˜¯æžæˆäº†ä¸€ä¸ª hexo é™æ€åšå®¢ç³»ç»Ÿäº†ï¼Œä¸è¿‡æœ‰ç‚¹å°´å°¬çš„å°æ’æ›²ï¼Œæˆ‘æŠŠ hexo å®‰è£…åœ¨äº† VPS ä¸Šé¢ ï¼Œç„¶åŽæŠŠ Markdown æ–‡ä»¶æŽ¨åˆ° VPS ä¸Šé¢ï¼Œç„¶åŽå† VPS å†ç”¨ hexo ç”Ÿæˆé™æ€é¡µé¢çš„æ–‡ä»¶ã€‚ã€‚ã€‚ å®žé™…ä¸Šæ›´åˆé€‚çš„æ˜¯æŠŠ hexo å®‰è£…åœ¨æœ¬åœ°ï¼Œç„¶åŽæœ¬åœ°ç”Ÿæˆçš„é¡µé¢æ–‡ä»¶æŽ¨åˆ° nginx çš„ web root ç›®å½•ä¸­åŽ»ã€‚</p><p>åŽæ¥å˜›ï¼Œæ¬ç“¦å·¥ï¼ŒVultrï¼ŒLinode é˜¿é‡Œäº‘æˆ‘éƒ½è¯•äº†ä¸ªéï¼Œå‘çŽ°é™¤äº†é˜¿é‡Œäº‘æ„å¤–ï¼Œè™½ç„¶éƒ½ä¸è´µï¼Œä½†æ˜¯ç½‘é€Ÿç¨³å®šæ€§çœŸçš„å¾ˆæ‰æ€¥ï¼Œæœ‰æ—¶å€™åœ¨ç»ˆç«¯ ssh åˆ°æœåŠ¡å™¨ä¸Šé¢æ—¶ï¼Œè¾“å…¥å‘½ä»¤çœŸçš„æ˜¯ä¸€å¡ä¸€å¡çš„ï¼Œè¿™æ ·çš„ç½‘é€Ÿå¸¦æ¥çš„ç§‘å­¦ä¸Šç½‘ä½“éªŒåªèƒ½ç”¨ã€Œèƒ½ç”¨ã€ä¸¤ä¸ªå­—æ¥å½¢å®¹ã€‚ç›´è§‰å‘Šè¯‰æˆ‘ï¼Œå¯èƒ½éƒ¨ç½²åœ¨é¦™æ¸¯çš„ VPS ç½‘é€Ÿä¼šæ¯”è¾ƒå¿«ï¼Œå› ä¸ºé¦™æ¸¯ç¦»å¤§é™†è¿‘ã€‚æˆ‘å°±å¼€å§‹æ‰¾é¦™æ¸¯çš„ VPS äº†ï¼Œä¸€ç•ªæ‰¾å‘€æ‰¾ï¼Œä¸­é—´ä¹Ÿäº¤äº†äº›å­¦è´¹ï¼Œæœ€åŽæ‰¾åˆ°äº†ä¸€ä¸ªå«æž«å¶ä¸»æœºçš„ï¼Œé€Ÿåº¦æŒºä¸é”™ï¼Œè½»æ¾è¾¾åˆ° 500 KB/Sï¼Œå°±æ˜¯è´µäº†ç‚¹ï¼Œæˆ‘å°±å’ŒæŸåŒäº‹ä¸€èµ·å¹³æ‘Šè´¹ç”¨äº†ã€‚è¿™ä¸ªæž«å¶ä¸»æœºæˆ‘ä¸€å£æ°”ä¹°äº†ä¸€å¹´çš„ï¼Œä¸è¿‡ä¸­é—´ä¾ç„¶å› ä¸ºæŸäº›åŽŸå› è€Œå‡ºçŽ°ç½‘é€Ÿä¸ç¨³å®šçš„æƒ…å†µã€‚ç­‰åˆ°æž«å¶ä¸»æœºè¿‡æœŸåŽï¼Œå› ä¸ºç©·ï¼Œæˆ‘å¿½ç„¶æƒ³è¯•è¯•è€æ—©å°±å¬åˆ«äººæŽ¨èçš„ä¸€ä¸ªå«äº‘æ¢¯çš„ VPNã€‚è¿™ä¸ªäº‘æ¢¯æˆ‘æ›¾ç»ä½¿ç”¨è¿‡ï¼Œä½†æ˜¯çš„é€Ÿåº¦ç¡®å®žè¿˜ä¸é”™ï¼Œå“ªæƒ³åˆ°æˆ‘ä¸€å£æ°”ä¹°äº†ä¸€å¹´çš„ VPN åŽï¼Œå‘çŽ°ç”¨ä¸äº†ï¼Œæ•´ä¸ªäº‘æ¢¯å›¢é˜Ÿéƒ½è·‘è·¯äº†ï¼ï¼ï¼å°±ç•™ä¸‹ä¸ªç½‘ç«™è¿˜åœ¨è¿è¡Œï¼Œä¸æ–­çš„å¸é’±ï¼ŒçœŸä»–ä»¬å‘ï¼åƒäº†å¤§äºçš„æˆ‘ï¼Œå¼€å§‹è¹­å¤§å­¦åŒå­¦çš„ VPS çš„æŸ socks æœåŠ¡ï¼ŒæŒºé•¿æ—¶é—´éƒ½æ²¡å†ä¹°è¿‡ VPSäº†ï¼ŒæœŸé—´ï¼Œæˆ‘æŠŠé™æ€åšå®¢æ”¾åˆ°äº† github.io é¡µé¢ã€‚ç„¶è€Œï¼Œè‡ªå§‹è‡³ç»ˆï¼Œæˆ‘å…¶å®žæ²¡å†™å‡ ç¯‡åšå®¢ï¼ŒçœŸä¸ºè‡ªå·±çš„æ‡’æƒ°æ„Ÿåˆ°æƒ­æ„§ã€‚</p><p>ç›´åˆ°æœ€è¿‘ï¼Œå†æ¬¡çœ‹åˆ°ç‚ç¥žå’ŒçŽ‹è¯‘é”‹çš„åšå®¢ã€æŽ˜é‡‘æžå¾—é£Žç”Ÿæ°´èµ·ï¼Œæ„Ÿå¹è‡ªå·±æ²¡æœ‰èƒ½æ‹¿çš„å‡ºæ‰‹çš„ä¸œè¥¿ï¼Œæ‰€ä»¥å°±ä¹°é˜¿é‡Œäº‘ VPS â†’ æ³¨å†ŒåŸŸå â†’ æ­åšå®¢ç³»ç»Ÿäº†ï¼ŒæœŸå¾…è‡ªå·±èƒ½å¤šå†™ä¸€äº›æœ‰ä»·å€¼çš„ä¸œè¥¿ï¼ŒåŠ æ²¹ï¼</p><h3 id="æ­£æ–‡ï¼š"><a href="#æ­£æ–‡ï¼š" class="headerlink" title="æ­£æ–‡ï¼š"></a>æ­£æ–‡ï¼š</h3><h4 id="ç§Ÿé˜¿é‡Œäº‘-VPS"><a href="#ç§Ÿé˜¿é‡Œäº‘-VPS" class="headerlink" title="ç§Ÿé˜¿é‡Œäº‘ VPS"></a>ç§Ÿé˜¿é‡Œäº‘ VPS</h4><p>åœ¨é˜¿é‡Œäº‘å®˜ç½‘ï¼Œè¿™ä¸ªå«åšã€Œäº‘æœåŠ¡å™¨ ECSã€ï¼Œè¿™ä¸ªå…¶å®žå¾ˆç®€å•äº†ï¼ŒèŠ±å‡ ç™¾å—é’±å°±èƒ½ç§Ÿä¸€å¹´ï¼Œæˆ‘æ˜¯ 290 å‡ å—é’±ç§Ÿçš„ 1GB å†…å­˜ã€1Mbps å¸¦å®½ã€40GB éž SSD çš„é¦™æ¸¯ VPSã€‚å…¶å®žï¼Œå¯¹æˆ‘ä»¬è€Œè¨€æœ€æ•æ„Ÿçš„æ€§èƒ½æŒ‡æ ‡å°±æ˜¯å†…å­˜å’Œå¸¦å®½äº†ï¼Œç¡¬ç›˜ä¸€èˆ¬æ˜¯ä¸ä¼šç”¨å…‰çš„ï¼ŒCPU æ€§èƒ½ä¹Ÿæ²¡å¤šå¤§å½±å“ã€‚è¿™é‡Œè§£é‡Šä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆé€‰é˜¿é‡Œäº‘ã€‚æœ‰é‰´äºŽå‰é¢è¯•ç”¨äº†ä¸€å¤§æ³¢ VPS æœåŠ¡ï¼Œæˆ‘å‘çŽ°åªæœ‰é˜¿é‡Œäº‘ç®—æ˜¯æœ€ç¨³å®šçš„ï¼Œè™½ç„¶å¸¦å®½åªæœ‰ 1Mbps (æŒ‡ä»Žæˆ‘ä»¬ä¸ªäººç”µè„‘è®¿é—® VPS çš„ç½‘é€Ÿï¼Œè€Œåœ¨ VPS ä¸Šé¢å®‰è½¯ä»¶æ—¶ï¼Œä¸‹è½½è½¯ä»¶åŒ…çš„é€Ÿåº¦å…¶å®žæ˜¯å¾ˆå¿«çš„ï¼Œå› ä¸ºç”¨çš„æ˜¯é˜¿é‡Œäº‘çš„é•œåƒï¼Œæ‰€ä»¥ç›¸å½“äºŽå†…ç½‘ä¼ è¾“æ•°æ®)ï¼Œä½†æ˜¯èƒœåœ¨ç¨³ï¼Œç»ˆç«¯è¾“å…¥å‘½ä»¤åŸºæœ¬ä¸ä¼šæœ‰ä»»ä½•å»¶è¿Ÿã€‚</p><p>ç§Ÿå®Œ VPSï¼Œssh è¿žæŽ¥åˆ°å®ƒï¼Œç„¶åŽå°±æ˜¯æ­å»ºæŸ socks æœåŠ¡äº†ï¼Œç½‘ä¸Šèµ„æ–™éžå¸¸å¤šã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé˜¿é‡Œäº‘æœåŠ¡å™¨éœ€è¦é…ç½®å®‰å…¨ç»„è§„åˆ™çš„ï¼Œä¸ç„¶æ— æ³•æä¾›æœåŠ¡ã€‚å‡è®¾æŸ socks ä½¿ç”¨ 23333 å·ç«¯å£æ¥æä¾›æœåŠ¡ï¼Œé‚£ä¹ˆéœ€è¦ä¸‹å›¾é‚£æ ·é…ç½®ä¸€æ¡å…¥æ–¹å‘çš„è§„åˆ™ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535789407.png" alt=""></p><p>å…¥æ–¹å‘è¡¨ç¤ºæ•°æ®æµå‘ VPS çš„ï¼Œåè®®ç±»åž‹é€‰ TCPï¼Œå¯¹ç»å¤§éƒ¨åˆ†æœåŠ¡æ¥è¯´ï¼Œéƒ½æ˜¯ TCP åè®®ï¼Œç«¯å£èŒƒå›´å°±æ˜¯ VPS ä¸Šé¢æä¾›çš„æœåŠ¡æ‰€ä½¿ç”¨çš„ç«¯å£äº†ã€‚å¦‚æžœæ²¡æœ‰è¿™ä¸ªé…ç½®ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸ªäººç”µè„‘å°†æ— æ³•å‘ 23333 å·ç«¯å£å‘èµ·è¯·æ±‚ã€‚å¦å¤–å‡ºæ–¹å‘é»˜è®¤å…¨å¼€äº†ï¼Œæ‰€ä»¥ä¸éœ€é…ç½®ã€‚</p><h4 id="æ³¨å†ŒåŸŸå"><a href="#æ³¨å†ŒåŸŸå" class="headerlink" title="æ³¨å†ŒåŸŸå"></a>æ³¨å†ŒåŸŸå</h4><p>æˆ‘æŒ‘äº†ä¸ªå¾ˆä¾¿å®œçš„ï¼Œ36å—é’± 3 å¹´ï¼ŒåŸŸåå°±æ˜¯ tao93.topï¼Œä¹Ÿç®—æ˜¯å’Œæˆ‘çš„åå­—å’Œå‡ºç”Ÿå¹´ä»½æœ‰äº›å…³è”å§ã€‚</p><h4 id="åŸŸåç»‘å®š-IP"><a href="#åŸŸåç»‘å®š-IP" class="headerlink" title="åŸŸåç»‘å®š IP"></a>åŸŸåç»‘å®š IP</h4><p>è¿™ä¸ªè¿˜æ˜¯è¦æä¸€ä¸‹çš„ã€‚åœ¨é˜¿é‡Œäº‘æ³¨å†Œçš„åŸŸåï¼Œéœ€è¦å®žåè®¤è¯ (ä¸Šä¼ å•é¢èº«ä»½è¯ç…§ç‰‡) æ‰è¡Œï¼Œä¸€å¼€å§‹æˆ‘ä¸çŸ¥é“ï¼Œå‚»ä¹Žä¹Žçš„æ€»ç­‰ï¼Œä¸€è¾¹ç­‰ï¼Œä¸€è¾¹ ping å’Œ nslook æˆ‘çš„åŸŸåï¼Œå¥½åœ¨å®žåè®¤è¯å¾ˆå¿«ï¼ŒåŸºæœ¬ä¸Šæäº¤è®¤è¯åŽï¼Œ1å°æ—¶å†…å°±æœ‰äººå¤„ç†ã€‚æˆ‘è®¤è¯æ—¶æœ‰ç‚¹æžç¬‘ï¼Œæˆ‘ä¼ äº†ä¸€å¼  jpeg åŽç¼€çš„å›¾ç‰‡ï¼Œç„¶åŽå®¡æ ¸è€…å›žå¤è¯´ï¼Œéœ€è¦ jpg æˆ– bmp åŽç¼€çš„å›¾ç‰‡ã€‚æˆ‘æœ‰ç‚¹åƒé²¸ï¼Œç„¶åŽæŠŠåŒä¸€å¼ å›¾ç‰‡åŽç¼€æ”¹æˆäº† jpgï¼Œä¸Šä¼ ï¼Œç„¶åŽè®¤è¯å°±æˆåŠŸäº†ã€‚ã€‚ã€‚è®¤è¯ç»“æŸåŽï¼Œå°±å¯ä»¥è®¾ç½®è§£æžè§„åˆ™äº†ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535789454.png" alt=""></p><p>åªéœ€è¦ä¸Šé¢çº¢æ¡†ä¸­çš„ä¸€æ¡è§„åˆ™å°±å¯ä»¥æŠŠ tao93.top è§£æžäº†ï¼Œmail çš„é‚£æ¡è§„åˆ™ï¼Œæˆ‘çŽ°åœ¨è¿˜ç”¨ä¸ä¸Šã€‚æ·»åŠ è§„åˆ™çš„æ—¶å€™ï¼Œå¦‚æžœæ‹¿ä¸å‡†ï¼Œå¯ä»¥åœ¨ä¸‹å›¾ä¸­åªåœ¨è®°å½•å€¼å¡«å…¬ç½‘ IP åœ°å€å³å¯ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535789477.png" alt=""></p><p>æˆ‘å½“æ—¶ä¹Ÿæ˜¯æœ‰ç‚¹å‚»ï¼Œè§‰å¾—é¦™æ¸¯çš„ VPS ç®—æ˜¯å¢ƒå¤–ï¼Œå°±åœ¨è§£æžçº¿è·¯é€‰äº†å¢ƒå¤–ï¼Œç„¶åŽå‚»ç­‰äº†å¥½ä¹…ï¼ŒåŽé¢æ¢æˆé»˜è®¤åŽï¼ŒåŸºæœ¬å‡ åˆ†é’Ÿå°±å¯ä»¥è§£æžäº†ã€‚</p><h4 id="æ­åšå®¢ç³»ç»Ÿ"><a href="#æ­åšå®¢ç³»ç»Ÿ" class="headerlink" title="æ­åšå®¢ç³»ç»Ÿ"></a>æ­åšå®¢ç³»ç»Ÿ</h4><p>å…ˆè¯´ä¸‹ä¸ºä»€ä¹ˆæˆ‘æ²¡ç”¨ hexo é™æ€åšå®¢ï¼Œå› ä¸ºé™æ€åšå®¢æ— æ³•è¯„è®ºï¼Œæˆ‘è§‰å¾—è¯„è®ºè¿˜æ˜¯æŒºæœ‰å¿…è¦çš„ï¼Œè™½ç„¶å¯ä»¥åµŒå…¥ç¬¬ä¸‰æ–¹è¯„è®ºæœåŠ¡ï¼Œä½†æ˜¯è¿™ç§éœ€è¦è¯„è®ºè€…ç”¨ç¤¾äº¤è´¦å·ç™»å½•ï¼Œéº»çƒ¦ï¼Œå¦å¤–è¯„è®ºçš„æ•°æ®å…¨åœ¨åˆ«äººæ‰‹é‡Œï¼Œæˆ‘è§‰å¾—ä¸å¥½ã€‚æ‰€ä»¥æˆ‘å°±è¦è‡ªå·±æ­ä¸€ä¸ªæœ‰åŽå°çš„åšå®¢äº†ã€‚ç‚ç¥žä½¿ç”¨çš„ zblog æ˜¯ä¸€ä¸ªï¼Œå›½äº§çš„ï¼Œçœ‹èµ·æ¥ä¸é‚£ä¹ˆåŽä¸½ï¼›WordPress æ˜¯å¦ä¸€ä¸ªã€‚æˆ‘ä¸¤ä¸ªéƒ½è£…äº†ï¼Œå…ˆè£…äº† zblogï¼Œè§‰å¾—æœ‰ç‚¹ç‚¹ç®€å•ç²—ç³™ï¼Œç„¶åŽå°±åˆ çš„ä¸€å¹²äºŒå‡€ï¼Œè£…äº† WordPressï¼Œç„¶åŽå‘çŽ° WordPress å¤æ‚çš„è®©æˆ‘æœ‰ç‚¹è¿·å¤±ï¼Œæˆ‘å°±æƒ³ç®€å•çš„å†™å†™ä¸œè¥¿ï¼Œä¸æƒ³è¦é‚£ä¹ˆå¤šä¸œè¥¿ã€‚ç„¶åŽæˆ‘å°±åœ¨ä¿ç•™ WordPress çš„åŸºç¡€ä¸Šï¼Œåˆè£…äº† zblogã€‚</p><p>zblog æœ‰ä¸ª php ç‰ˆæœ¬ï¼Œå’Œ WordPress çš„æŠ€æœ¯ç»„åˆä¸€æ¨¡ä¸€æ ·ï¼Œå°±æ˜¯ php + æ•°æ®åº“ + nginx ç­‰ web serverï¼Œå…¶ä¸­ zblog çš„æ•°æ®åº“è¿˜å¯ä»¥ç”¨ sqliteï¼Œè™½ç„¶æˆ‘æ²¡æˆåŠŸè¿‡ã€‚æˆ‘ç¬¬ä¸€æ¬¡è£… zblog æ—¶ï¼Œæ‰‹åŠ¨å®‰è£…äº† MySQLï¼Œphpï¼Œnginxï¼Œç„¶åŽæ‘¸ç´¢ç€å„ç§é…ç½®ï¼Œæžäº†è›®ä¹…æ‰æžå®šçš„ã€‚è€Œ WordPress çš„å®‰è£…å°±å¾ˆç®€å•äº†ï¼Œç½‘ä¸Šæœ‰ LNMP (Linux Nginx MySQL PHP) ç»„åˆåŒ…ï¼Œç­‰äºŽä¸€é”®å°±èƒ½è£…å¥½çŽ¯å¢ƒï¼Œå‰©ä¸‹çš„å°±æ˜¯æžä¸ª WordPressï¼Œå¹¶ä¸”æ›¿æ¢æŽ‰ LNMP åŽŸæœ‰çš„ web root ç›®å½•ï¼Œå°±å¥½äº†ã€‚</p><p>æ‰€ä»¥ï¼Œæ— è®º WordPress è¿˜æ˜¯ zblogï¼Œæœ€ç®€å•çš„æ–¹å¼æ˜¯ï¼Œå…ˆè£… LNMP çŽ¯å¢ƒï¼Œç„¶åŽå°±å¿«äº†ã€‚éœ€è¦è®°ä½ä¸€ç‚¹çš„æ˜¯ï¼ŒLNMP çŽ¯å¢ƒä¼šæ–°å»ºä¸€ä¸ª www:www ç”¨æˆ·(ç»„) æ¥ç”¨äºŽé©±åŠ¨ web æœåŠ¡ã€‚åŠ¡å¿…éœ€è¦è®©æ­¤ www ç”¨æˆ·å¯¹äºŽ web root æœ‰ rwx æƒé™ã€‚æ¯”å¦‚ LNMP é»˜è®¤çš„ web root æ˜¯ /home/wwwroot/defaultï¼Œé‚£ä¹ˆä¸€å¥ sudo chown -R www:www /home/wwwroot/default å³å¯ã€‚</p><h4 id="ç›´æŽ¥å®‰è£…-z-blog-çš„è¿‡ç¨‹"><a href="#ç›´æŽ¥å®‰è£…-z-blog-çš„è¿‡ç¨‹" class="headerlink" title="ç›´æŽ¥å®‰è£… z_blog çš„è¿‡ç¨‹"></a>ç›´æŽ¥å®‰è£… z_blog çš„è¿‡ç¨‹</h4><p>æ­¤è¿‡ç¨‹é…ç½®æ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥åªæ˜¯è®°å½•ä¸€ä¸‹ï¼Œä¸å»ºè®®ä½¿ç”¨æ­¤æ–¹å¼ã€‚</p><p>è£… nginxï¼Œè®¾ç½®å¼€æœºè‡ªå¯ï¼Œè¿è¡Œèµ·æ¥ï¼Œç„¶åŽåˆ«æ€¥ç€è¿›æµè§ˆå™¨éªŒè¯ï¼Œå…ˆåˆ°é˜¿é‡Œäº‘ç½‘ç«™å¢žåŠ ä¸€ä¸‹ 80 å·ç«¯å£çš„å®‰å…¨è§„åˆ™ï¼Œç„¶åŽéªŒè¯ nginx æ˜¯å¦å¯ç”¨ã€‚</p><p>å»ºè®®æ›´æ”¹ä¸€ä¸‹ nginx é…ç½®æ–‡ä»¶ä¸­çš„ rootï¼Œå³æ›´æ”¹ web root çš„ä½ç½®ï¼Œæ¯”å¦‚æ”¹ä¸ºè‡ªå·± home ä¸­çš„æŸä¸ªç›®å½•ï¼Œè¿™æ ·çš„è¯ chown web root æ—¶ä¸ä¼šæœ‰çƒ¦äººçš„è­¦å‘Šã€‚</p><p>æ³¨æ„ï¼Œnginx éœ€è¦é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œæ‰èƒ½è®©é…ç½®æ–‡ä»¶çš„ä¿®æ”¹ç”Ÿæ•ˆï¼Œæ–¹æ³•æ˜¯ sudo nginx -s reload å³å¯ã€‚</p><p>å®‰è£… Mysqlï¼Œè®°å¾—åˆ«å¿˜è®°äº† root å¯†ç ã€‚</p><p>å®‰è£… Phpï¼Œç„¶åŽå°±æ˜¯åœ¨ Php.ini é…ç½®æ–‡ä»¶ä¸­ï¼ŒæŠŠå„ç§ extension=php_mysql.dll ä¹‹ç±»çš„è¯­å¥è§£é™¤æ³¨é‡Šï¼Œæ„æ€æ˜¯ php éœ€è¦å’Œ MySQL æ•°æ®åº“è¿žæŽ¥ã€‚ä½†æ˜¯è¿™æ ·çš„é…ç½®è¿˜ä¸å¤Ÿï¼Œè¿˜éœ€è¦ sudo apt-get install php7.0-mysql</p><p>è¿™æ—¶å€™ï¼Œå¯ä»¥ä¸‹è½½ zblog çš„åŽ‹ç¼©åŒ…ï¼Œè§£åŽ‹åˆ° web root ä¸­ï¼Œç„¶åŽæµè§ˆå™¨æ‰“å¼€ <a href="https://tao93.topï¼Œå°±å¯ä»¥å¼€å§‹å®‰è£…" target="_blank" rel="noopener">https://tao93.topï¼Œå°±å¯ä»¥å¼€å§‹å®‰è£…</a> zblog äº†ï¼Œå®‰è£…å¥½åŽå°±æ˜¯å„ç§ GUI é…ç½®æ–¹å¼äº†ã€‚å†æ¬¡å¼ºè°ƒä¸€ä¸‹ï¼Œéœ€è¦ nginx å¯¹åº”çš„ Linux ç”¨æˆ·å¯¹äºŽ web root ç›®å½•é€’å½’çš„æœ‰ rwx æƒé™ã€‚æˆ‘ç¬¬ä¸€æ¬¡è£… zblog å°±æ˜¯æ²¡è®¾ç½®æƒé™ï¼Œç„¶åŽåœ¨åŽå°é¦–é¡µä¸­ï¼Œã€Œæ¸…ç©ºç¼“å­˜å¹¶é‡æ–°ç¼–è¯‘æ¨¡æ¿ã€ä¸€ç›´è½¬åœˆåœˆã€‚</p><h4 id="é…ç½®ä¸»é¢˜ï¼Œæ ·å¼è‡ªå®šä¹‰ï¼Œç„¶åŽå¼€å§‹å†™åšå®¢ã€‚"><a href="#é…ç½®ä¸»é¢˜ï¼Œæ ·å¼è‡ªå®šä¹‰ï¼Œç„¶åŽå¼€å§‹å†™åšå®¢ã€‚" class="headerlink" title="é…ç½®ä¸»é¢˜ï¼Œæ ·å¼è‡ªå®šä¹‰ï¼Œç„¶åŽå¼€å§‹å†™åšå®¢ã€‚"></a>é…ç½®ä¸»é¢˜ï¼Œæ ·å¼è‡ªå®šä¹‰ï¼Œç„¶åŽå¼€å§‹å†™åšå®¢ã€‚</h4><p>ç•¥</p>]]></content>
      
      
        <tags>
            
            <tag> VPS </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä»Ž Android ä¸­ Message çš„ obj æ— æ³•è·¨è¿›ç¨‹ä¼ é€è‡ªå®šä¹‰ Parcelable è¯´èµ·</title>
      <link href="/2018/09/26/%E4%BB%8E%20Android%20%E4%B8%AD%20Message%20%E7%9A%84%20obj%20%E6%97%A0%E6%B3%95%E8%B7%A8%E8%BF%9B%E7%A8%8B%E4%BC%A0%E9%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%20Parcelable%20%E8%AF%B4%E8%B5%B7/"/>
      <url>/2018/09/26/%E4%BB%8E%20Android%20%E4%B8%AD%20Message%20%E7%9A%84%20obj%20%E6%97%A0%E6%B3%95%E8%B7%A8%E8%BF%9B%E7%A8%8B%E4%BC%A0%E9%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%20Parcelable%20%E8%AF%B4%E8%B5%B7/</url>
      <content type="html"><![CDATA[<p>ä»Šå¤©æ¸©ä¹ ã€ŠAndroid å¼€å‘è‰ºæœ¯æŽ¢ç´¢ã€‹ä¸€ä¹¦æ—¶ï¼Œçœ‹åˆ°ç±»ä¼¼ä¸‹é¢è¿™ä¹ˆä¸€å¥è¯ï¼šã€Œä½¿ç”¨ Messenger å°† Message å¯¹è±¡è·¨è¿›ç¨‹ä¼ è¾“æ—¶ï¼Œobj å±žæ€§æ— æ³•ä¼ è¾“è‡ªå®šä¹‰çš„ Parcelableï¼Œè€Œåªèƒ½ä¼ è¾“ framework å·²æœ‰çš„ Parcelableï¼Œæ¯”å¦‚ Bitmap ç­‰ã€ã€‚ç„¶åŽä¹Ÿç¿»äº†æºç æ³¨é‡Šï¼Œæ³¨é‡Šä¹Ÿæ˜¯è¿™ä¹ˆè¯´çš„ï¼šFroyo ä¹‹åŽï¼Œæ‰èƒ½ç”¨ obj ä¼ è¾“ framework çš„ Parcelableï¼Œä¸” obj ä¸èƒ½ä¸º nullã€‚ä¸‹é¢æ˜¯æ³¨é‡Šï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * An arbitrary object to send to the recipient.  When using</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> Messenger&#125; to send the message across processes this can only</span></span><br><span class="line"><span class="comment"> * be non-null if it contains a Parcelable of a framework class (not one</span></span><br><span class="line"><span class="comment"> * implemented by the application).   For other data transfer use</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #setData&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Note that Parcelable objects here are not supported prior to</span></span><br><span class="line"><span class="comment"> * the &#123;<span class="doctag">@link</span> android.os.Build.VERSION_CODES#FROYO&#125; release.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Object obj;</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼ŒMessage è¿˜æœ‰ setData(Bundle b) æ–¹æ³•å¯ç”¨ï¼Œè€Œè¿™ä¸ªæ–¹æ³•ä¸­æ˜¯å¯ä»¥æ”¾å…¥è‡ªå®šä¹‰çš„ Parcelableï¼Œä¸è¿‡æ­¤å¤„éœ€è¦åŸ‹ä¸‹ä¼ç¬”ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬ç»§ç»­è¯´ obj ä¸ºä»€ä¹ˆä¸èƒ½ä¼ è‡ªå®šä¹‰ Parcelableã€‚ç†è®ºä¸Šè¯´ï¼Œåªæœ‰èƒ½åŠ è½½åˆ°è‡ªå®šä¹‰ç±»ï¼Œé‚£ä¹ˆå°±åº”è¯¥èƒ½ååºåˆ—åŒ–å‡ºè‡ªå®šä¹‰ç±»çš„å¯¹è±¡ã€‚å¸¦ç€è¿™ä¸ªæƒ³æ³•ï¼Œæˆ‘æµè§ˆäº† Message çš„ writeToParcel å’Œ readFromParcel ä¸¤ä¸ªæ–¹æ³•ã€‚å‘çŽ°äº†çŽ„æœºå°±æ˜¯ä¸‹é¢çš„ readFromParcel æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readFromParcel</span><span class="params">(Parcel source)</span> </span>&#123;</span><br><span class="line">    what = source.readInt();</span><br><span class="line">    arg1 = source.readInt();</span><br><span class="line">    arg2 = source.readInt();</span><br><span class="line">    <span class="keyword">if</span> (source.readInt() != <span class="number">0</span>) &#123;</span><br><span class="line">        obj = source.readParcelable(getClass().getClassLoader());</span><br><span class="line">    &#125;</span><br><span class="line">    when = source.readLong();</span><br><span class="line">    data = source.readBundle();</span><br><span class="line">    replyTo = Messenger.readMessengerOrNullFromParcel(source);</span><br><span class="line">    sendingUid = source.readInt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä½¿ç”¨ getClass().getClassLoader æ¥ååºåˆ—åŒ– obj æ‰€è¦å¼•ç”¨çš„å¯¹è±¡ï¼Œå¦‚æžœè¿™ä¸ª ClassLoader æ— æ³•æ‰¾åˆ°è‡ªå®šä¹‰ç±»ï¼Œé‚£ä¹ˆé—®é¢˜è‚¯å®šå°±æ˜¯å‡ºåœ¨è¿™é‡Œäº†ã€‚</p><p>ä¸‹é¢æˆ‘å°±å¼€å§‹ä¸€æ­¥ä¸€æ­¥éªŒè¯ã€‚é¦–å…ˆå»ºç«‹ä¸€ä¸ªé¡¹ç›®ï¼Œé¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„ Parcelable ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> <span class="keyword">implements</span> <span class="title">Parcelable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mId;</span><br><span class="line">    <span class="keyword">private</span> String mName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Book</span><span class="params">(Parcel in)</span> </span>&#123;</span><br><span class="line">        mId = in.readInt();</span><br><span class="line">        mName = in.readString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Book</span><span class="params">(<span class="keyword">int</span> id, String name)</span> </span>&#123;</span><br><span class="line">        mId = id;</span><br><span class="line">        mName = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åŽé¡¹ç›®ä¸­å¼€å¯ä¸¤ä¸ªè¿›ç¨‹ï¼Œåˆ†åˆ«ç§°ä¸º client è¿›ç¨‹å’Œ server è¿›ç¨‹å¥½äº†ã€‚ç„¶åŽ client è¿›ç¨‹çš„ activity ä¸­ç»‘å®š server è¿›ç¨‹ä¸­çš„ serverï¼Œç»‘å®šåŽï¼Œclient è¿›ç¨‹ä½¿ç”¨ Messenger å‘ server è¿›ç¨‹å‘é€ä¸€ä¸ª Message å¯¹è±¡ï¼Œæ­¤ Message å¯¹è±¡çš„ obj å¼•ç”¨ä¸€ä¸ª Book å¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> ServiceConnection mMsgConnection = <span class="keyword">new</span> ServiceConnection() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>&#123;</span><br><span class="line">        mMessenger = <span class="keyword">new</span> Messenger(service);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Book book = <span class="keyword">new</span> Book(<span class="number">1</span>, <span class="string">"name"</span>);</span><br><span class="line">            mMessenger.send(Message.obtain(<span class="keyword">null</span>, <span class="number">101</span>, book));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åŽï¼Œæˆ‘åœ¨ Message ç±»çš„ readFromParcel æ–¹æ³•ä¸­æ‰“ä¸Šæ–­ç‚¹ï¼Œå½“ä»£ç æ‰§è¡Œåˆ°æ–­ç‚¹å¤„æ—¶ï¼Œå…ˆéªŒè¯ getClass().getClassLoader() æ— æ³•åŠ è½½åˆ°è‡ªå®šä¹‰çš„ Book ç±»ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535789126.png" alt=""></p><p>ç„¶åŽéªŒè¯ä¸»çº¿ç¨‹çš„ Thread.getContextClassLoader å¯ä»¥åŠ è½½åˆ° Book ç±»ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535789156.png" alt=""></p><p>æœ€åŽéªŒè¯ä½¿ç”¨å¯ä»¥åŠ è½½åˆ° Book ç±»çš„ ClassLoader çš„è¯ï¼Œæ˜¯å¯ä»¥æˆåŠŸååºåˆ—åŒ–å¾—åˆ° Book å¯¹è±¡çš„ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535789190.png" alt=""></p><p>æ’ä¸€å¥ï¼Œè¿™ä¸ª readFromParcel ä¸æ˜¯è¿è¡Œåœ¨ä¸»çº¿ç¨‹ï¼Œè€Œæ˜¯è¿è¡Œåœ¨ server è¿›ç¨‹çš„ Binder çº¿ç¨‹æ± ä¸­çš„ã€‚çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹çš„ getContextClassLoader() ç»“æžœæ˜¯ nullã€‚</p><p>OKï¼Œä¸Šé¢çš„æµ‹è¯•å‡†ç¡®çš„éªŒè¯äº†æˆ‘çš„æƒ³æ³•ï¼ŒçŽ°åœ¨å›žåˆ°å‰é¢è¯´çš„ Message çš„ setData(Bundle b) æ–¹æ³•çš„ä¼ç¬”ã€‚æ˜¾ç„¶è¿™é‡Œçš„ Bundle å¦‚æžœè¦è·¨è¿›ç¨‹ä¼ è¾“è‡ªå®šä¹‰ Parcelableï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ç¡®å®š Bundle åœ¨ååºåˆ—åŒ–æ—¶ä¸ä¼šé‡è¹ˆ Message.obj çš„è¦†è¾™ã€‚å®žé™…ä¸Šï¼ŒBundle è‡ªå·±åšä¸åˆ°è¿™ç‚¹ï¼Œè¿˜éœ€è¦æˆ‘ä»¬å¸®å®ƒä¸€æŠŠå¿™ï¼Œé‚£å°±æ˜¯åœ¨ server è¿›ç¨‹ä¸­ï¼Œä»Ž Message æ‹¿åˆ° Bundle åŽå†ç»™ Bundle è®¾ç½®ä¸€ä¸ª ClassLoader å³å¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MessengerHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (msg.what) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">101</span>:</span><br><span class="line">                Bundle b = msg.getData();</span><br><span class="line">                b.setClassLoader(Thread.currentThread().getContextClassLoader());</span><br><span class="line">                Book book = b.getParcelable(<span class="string">"book"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œä¸Šé¢de  handleMessage æ–¹æ³•æ˜¯åœ¨ä¸»çº¿ç¨‹ï¼Œæ‰€ä»¥æˆ‘ç›´æŽ¥ä½¿ç”¨ Thread.currentThread().getContextClassLoader() å°±å¯ä»¥ã€‚</p><p>åˆ°æ­¤ï¼Œæˆ‘å¾—å‡ºä¸€ä¸ªç»“è®ºï¼Œé‚£å°±æ˜¯æˆ‘çš„å¯¹äºŽ Java çš„ ClassLoader ä¸€æ— æ‰€çŸ¥ï¼Œæƒ­æ„§æƒ­æ„§ï¼Œè¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚æ‰€ä»¥ï¼ŒåŽç»­æˆ‘ä¼šåŠ å¼ºè¿™æ–¹é¢çš„å­¦ä¹ ï¼Œç„¶åŽå¯èƒ½ä¼šç»§ç»­åŠ é•¿è¿™ç¯‡æ–‡ç« ï¼Œæ¯•ç«Ÿè¿™ç¯‡çš„æ ‡é¢˜æ˜¯ã€Œä»Ž XXX è¯´èµ·ã€ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>The Linux Command Line digest</title>
      <link href="/2018/09/26/The%20Linux%20Command%20Line%20digest/"/>
      <url>/2018/09/26/The%20Linux%20Command%20Line%20digest/</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡æ˜¯é˜…è¯» <a href="http://linuxcommand.org/tlcl.php" target="_blank" rel="noopener">The Linux Command Line</a> åŽå†™æˆçš„æ‘˜è¦ï¼Œç”¨äºŽè‡ªå·±éœ€è¦ç”¨åˆ°æ—¶å›žå¿†å’Œå‚è€ƒã€‚</p><h2 id="Learning-The-Shell"><a href="#Learning-The-Shell" class="headerlink" title="Learning The Shell"></a>Learning The Shell</h2>]]></content>
      
      
        <tags>
            
            <tag> Shell </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>targetSdkVersion æ‚è°ˆ</title>
      <link href="/2018/09/26/targetSdkVersion%20%E6%9D%82/"/>
      <url>/2018/09/26/targetSdkVersion%20%E6%9D%82/</url>
      <content type="html"><![CDATA[<p>å¾ˆä¹…æ²¡æœ‰å†™æ–°çš„åšå®¢äº†ï¼ŒåŽŸå› æ˜¯è¿™ä¸€ä¸ªå¤šæœˆä»¥æ¥éƒ½æ²¡æƒ³åˆ°ä»€ä¹ˆåˆé€‚çš„ä¸»é¢˜ï¼Œä»Šå¤©å°±æ¥æ‚è°ˆä¸€ä¸‹ targetSdkVersion ç›¸å…³çš„ä¸œè¥¿å§ã€‚</p><p>åœ¨æˆ‘å·¥ä½œçš„ç¬¬ä¸€å¹´é‡Œï¼Œå…¶å®žæˆ‘å¹¶ä¸çŸ¥é“ targetSdkVersion æœ‰ä»€ä¹ˆå«ä¹‰ï¼ŒæŸ¥èµ„æ–™ï¼Œçœ‹åˆ°çš„æ˜¯ç±»ä¼¼äºŽã€Œä»£è¡¨åº”ç”¨é’ˆå¯¹æŸä¸ª api level å®Œæˆé€‚é…äº†ã€è¿™æ ·çš„æè¿°ï¼Œè¿™æ ·çš„æè¿°å…¶å®žè®©æˆ‘æ‘¸ä¸ç€å¤´è„‘ã€‚åŽæ¥ï¼Œæˆ‘æŠŠä¸€ä¸ªå°åº”ç”¨é¡¹ç›®çš„ targetSdkVersion å‡é«˜åˆ° api 27ï¼Œè¿™ä¸ªè¿‡ç¨‹æ‰è®©æˆ‘å¯¹ targetSdkVersion ç†è§£æ¯”è¾ƒåˆ°ä½äº†ã€‚è€Œè¿™æ—¶å€™ï¼Œæˆ‘å‘çŽ° targetSdkVersion çš„çš„ç¡®ç¡®å¦‚æˆ‘å…ˆå‰æŸ¥åˆ°çš„èµ„æ–™æ‰€è¨€ï¼Œè¡¨ç¤ºé’ˆå¯¹æŸä¸ª api level å®Œæˆé€‚é…äº†ï¼Œè¿™ä¸ªä¿¡æ¯æ˜¯ä¼šä¼ é€’ç»™ android ç³»ç»Ÿçš„ï¼Œandroid ç³»ç»Ÿä¾æ®è¿™ä¸€ä¿¡æ¯æ¥å¯¹åº”ç”¨åšåŒºåˆ«å¯¹å¾…ã€‚</p><p>é¦–å…ˆï¼Œéœ€è¦æ˜Žç¡® Android ç³»ç»Ÿåœ¨å¤§ç‰ˆæœ¬æ›´æ–°æ—¶ï¼Œæ€»ä¼šåŠ å…¥ä¸€äº›æ–°çš„ featureï¼Œè€Œè¿™äº›æ–° feature å¯èƒ½ä¼šè®©è€çš„åº”ç”¨æ— æ³•å®Œç¾Žå…¼å®¹ã€‚å…¸åž‹çš„ä¾‹å­æ˜¯ api 23 æ–°å¢žçš„è¿è¡Œæ—¶åŠ¨æ€ç”³è¯·æƒé™æœºåˆ¶ã€‚åœ¨ api 23 ä»¥ä¸Šçš„ android ç³»ç»Ÿä¸­ï¼Œç³»ç»ŸæœŸå¾…ä»£ç å…ˆç”³è¯·æƒé™ (æˆ–è€…æ£€æŸ¥æƒé™æ˜¯å·²æœ‰çš„) åŽæ‰è¿è¡Œéœ€è¦æƒé™çš„ä»£ç  (ä¾‹å¦‚æ‹ç…§)ã€‚ä½†æ˜¯è€åº”ç”¨çš„ä»£ç ï¼Œåˆ™æ˜¯åªéœ€è¦åœ¨ manifest æ–‡ä»¶ä¸­ç”³è¯·æ‹ç…§æƒé™ï¼Œå°±å¯ä»¥ç›´æŽ¥æ‰§è¡Œæ‹ç…§çš„ä»£ç ã€‚æ‰€ä»¥ï¼ŒtargetSdkVersion çš„ä½œç”¨å°±æ˜¯ï¼Œå¦‚æžœ targetSdkVersion å¤§äºŽç­‰äºŽ 23ï¼Œé‚£ä¹ˆä»£ç å¿…é¡»æŒ‰æ–°æœºåˆ¶æ¥ (å³å…ˆç”³è¯·æƒé™ï¼Œç„¶åŽæ‰èƒ½æ‰§è¡Œéœ€è¦æƒé™çš„ä»£ç )ï¼Œå¦åˆ™ï¼Œandroid ç³»ç»Ÿå°±è®¤ä¸ºè¿™æ˜¯ä¸ªæ²¡æœ‰é’ˆå¯¹ api 23 è¿›è¡Œé€‚é…çš„è€åº”ç”¨ (æ¯”å¦‚å¯èƒ½æ˜¯ä¸€ä¸ª 2012 å¹´å°±åœæ­¢æ›´æ–°çš„åº”ç”¨ï¼‰ã€‚å¯¹è¿™ç§è€åº”ç”¨ï¼Œandroid ç³»ç»Ÿéœ€è¦å…¼å®¹ï¼Œå…¼å®¹çš„æ–¹å¼å°±æ˜¯ï¼Œè¿™ç§åº”ç”¨ä¸€ç»å®‰è£…ï¼Œå°±è‡ªåŠ¨èŽ·å¾—äº†æ‰€æœ‰ manifest ä¸­ç”³æ˜Žçš„æƒé™ï¼Œè¿™æ ·å®ƒå°±èƒ½åœ¨æ–°ç³»ç»Ÿä¸­æ­£å¸¸è¿è¡Œã€‚</p><p>åœ¨æ–°ç³»ç»Ÿ (api 23 åŠä»¥ä¸Š) ä¸­ï¼Œå¯¹äºŽä¸Šè¿°çš„è€åº”ç”¨ï¼Œå®‰è£…æ—¶ä¼šåˆ—å‡ºæ‰€æœ‰æƒé™ï¼Œå‘Šè¯‰ç”¨æˆ·è¿™ä¸ªåº”ç”¨ä¸€ç»å®‰è£…å°±æœ‰äº†ä¸‹é¢çš„æƒé™ (å¦‚åŒè€ç³»ç»Ÿå®‰è£…æ‰€æœ‰åº”ç”¨æ—¶ä¸€æ ·)ã€‚è¿™å°±æ˜¯ç³»ç»Ÿçš„å…¼å®¹æœºåˆ¶ã€‚æ–°ç³»ç»Ÿä¸­å®‰è£…çš„è¿™æ ·çš„è€åº”ç”¨åŽï¼Œæˆ‘ä»¬åœ¨åº”ç”¨è¯¦æƒ…ä¸­å¯ä»¥çœ‹åˆ°å®ƒè‡ªåŠ¨æœ‰äº†æ‰€æœ‰æƒé™ï¼Œå¯æ˜¯æ–°ç³»ç»Ÿæ˜¯å¯ä»¥æ‰‹åŠ¨å…³é—­æŸä¸ªåº”ç”¨çš„æƒé™çš„ï¼Œå¦‚æžœæˆ‘ä»¬å…³é—­è¿™ä¸ªè€åº”ç”¨çš„æŸä¸ªæƒé™ï¼Œä¼šæ€Žä¹ˆæ ·å‘¢ï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://tao93.top/images/2018/09/03/1535985225.png" alt=""></p><p>ç³»ç»Ÿä¼šæç¤ºç”¨æˆ·ï¼Œå…³æŽ‰æƒé™çš„è¯åº”ç”¨å¯èƒ½æ— æ³•æ­£å¸¸è¿è½¬ã€‚è¿™æ˜¯å¯¹çš„ï¼Œå› ä¸ºå‡è®¾è€åº”ç”¨ä¸­æœ‰ç›´æŽ¥æ‰§è¡Œæ‹ç…§é€»è¾‘çš„ä»£ç ï¼Œæ‹ç…§æƒé™çŽ°åœ¨è¢«ç”¨æˆ·æ‰‹åŠ¨å…³é—­ï¼Œé‚£ä¹ˆæ‰§è¡Œåˆ°è¿™æ ·çš„ä»£ç æ—¶å°±ä¼šå´©æºƒ (without permission)ï¼</p><p>é—®é¢˜æ˜¯ï¼Œè®¸å¤šåº”ç”¨æ˜Žæ˜Žä¸€ç›´åœ¨æ›´æ–°ï¼Œä½†æ˜¯ä¸ºäº†å°½é‡èŽ·å–åˆ°å„ç§æƒé™ï¼Œä¼šæ•…æ„å°† targetSdkVersion åœç•™åœ¨ 22 åŠä»¥ä¸‹ï¼Œè¿™æ ·ç”¨æˆ·ä¸€ç»å®‰è£…ï¼Œè¿™æ ·çš„åº”ç”¨å°±è‡ªåŠ¨æœ‰äº†å®ƒæƒ³è¦çš„ä»»ä½•æƒé™ï¼Œä¾‹å¦‚ Android ç‰ˆæ‰‹æœº QQ çŽ°åœ¨çš„ targetSdkVersion ä¾ç„¶æ˜¯ 17ï¼š</p><p><img src="http://tao93.top/images/2018/09/03/1535985675.png" alt=""></p><p>å¯¹äºŽè¿™æ ·çš„æ¯”è¾ƒæ— èµ–çš„åº”ç”¨ï¼Œå…¶å®žå¯ä»¥æ”¾å¿ƒæŠŠä¸æƒ³æŽˆäºˆçš„æƒé™å…³é—­æŽ‰ï¼Œå®ƒæ˜¯ä¸ä¼šå´©æºƒçš„ï¼Œå› ä¸ºå…¶ä»£ç ä¸­å…¶å®žå·²ç»åšäº†æƒé™æ£€æŸ¥ï¼Œæ¯•ç«Ÿå®ƒä¸€ç›´åœ¨æ›´æ–°å’Œç»´æŠ¤ã€‚å¦å¤–ï¼Œå¯¹äºŽè¿™ç§çŽ°è±¡ï¼ŒGoogle ä¹Ÿæœ‰æŽªæ–½ï¼Œä»Šå¹´è°·æ­Œå£°æ˜Žäº†å¯¹åœ¨ Google Play æ›´æ–°çš„åº”ç”¨å’Œä¸Šæž¶çš„æ–°åº”ç”¨éƒ½åœ¨ä»Šå¹´å¿…é¡»å°† targetSdkVersion å‡è‡³ 27 (æ­¥å­æœ‰ç‚¹å¤§)ã€‚è™½ç„¶ Google Play å¯¹å›½å†…è¿˜æœ‰ç‚¹éž­é•¿èŽ«åŠï¼Œä¸è¿‡è¿™ä¸€å€¡å¯¼åº”è¯¥è¿˜æ˜¯ä¼šè®©è®¸å¤šå¤§åŽ‚çš„åº”ç”¨æ›´å¿«çš„æé«˜ targetSdkVersionã€‚</p><p>å¦å¤–ï¼Œå‡å¦‚ç”¨æˆ·æœ¬æ¥å®‰è£…äº† targetSdkVersion ä¸º 22 çš„è€åº”ç”¨ï¼Œä¸”è€åº”ç”¨æœ‰æ‰€æœ‰æƒ³è¦çš„æƒé™ï¼Œæ­¤æ—¶å¦‚æžœæ›´æ–°åˆ° targetSdkVersion ä¸º 23 çš„æ–°ç‰ˆæœ¬åº”ç”¨ï¼Œé‚£ä¹ˆæ–°åº”ç”¨å°†ã€Œç»§æ‰¿ã€æ‰€æœ‰çš„æƒé™ã€‚åè¿‡æ¥ï¼Œæ–°ç‰ˆæœ¬çš„åº”ç”¨çš„ targetSdkVersion æ˜¯ä¸èƒ½æ¯”å·²å®‰è£…çš„è€ç‰ˆæœ¬åº”ç”¨è¿˜æ›´ä½Žçš„ï¼Œå› ä¸ºè¿™ä¸å…‰å…¼å®¹èµ·æ¥å¾ˆéº»çƒ¦ï¼Œè€Œä¸”äºŽæƒ…äºŽç†éƒ½ä¸åº”è¯¥ã€‚ </p><p>åŠ¨æ€ç”³è¯·æƒé™å¤§æ¦‚ç®—æ˜¯æœ€å…¸åž‹çš„ä¸€ä¸ªæ— æ³•å®Œç¾Žå…¼å®¹çš„ feature äº†ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ api 26 å¼•å…¥çš„ adaptive icon è¿™ä¸ª featureã€‚adaptive icon ä½¿å¾—åº”ç”¨å¯ä»¥æ ¹æ® launcher çš„åå¥½ï¼Œæ˜¾ç¤ºåœ†å½¢ã€åœ†è§’æ–¹å½¢ã€æ­£æ–¹å½¢ç­‰å„ç§å½¢çŠ¶çš„å›¾æ ‡ã€‚è®¸å¤šè€åº”ç”¨æ˜¯ç›´æŽ¥è‡ªå·±è£å‰ªä¸€ä¸ªåœ†è§’æ–¹å½¢çš„å›¾æ ‡ï¼Œè¿™æ˜¾ç„¶æ— æ³•å®Œç¾Žæ»¡è¶³ adaptive iconï¼Œæ‰€ä»¥æ˜¯ä¸å®Œç¾Žå…¼å®¹ã€‚targetSdkVersion ä¸º 26 åŠä»¥ä¸Šçš„åº”ç”¨ï¼Œåº”è¯¥ä¸”éœ€è¦å°† launcher icon åˆ†ä¸º foreground å’Œ background ä¸¤å±‚ï¼Œforeground æ˜¯å›¾æ ‡ä¸­å¿ƒçš„è‹¥å¹²å…ƒç´ ï¼Œæ¯”å¦‚<a href="https://www.coolapk.com/apk/me.piebridge.brevent" target="_blank" rel="noopener">é»‘é˜ˆ</a> çš„ launcher icon çš„ foreground æ˜¯ä¸‹é¢è¿™æ ·ä¸€å¼ å›¾ç‰‡ï¼š</p><p><img src="http://tao93.top/images/2018/09/03/1535986448.png" alt=""></p><p>è¿™ä¸ªå›¾ç‰‡ç»å¤§éƒ¨åˆ†éƒ½æ˜¯é€æ˜Žçš„ï¼Œåªæœ‰é‚£ 3 æ¡å¼§çº¿æ˜¯ç°ç™½è‰²çš„ã€‚è¿™æ ·ä¸€ä¸ª foreground ä½œä¸ºé»‘é˜ˆåº”ç”¨å›¾æ ‡çš„ä¸­å¿ƒå…ƒç´ ã€‚è€Œ background åˆ™æ˜¯ #FF353535 è¿™æ ·ä¸€ä¸ªçº¯è‰²ã€‚äº‹å®žä¸Šï¼Œé»‘é˜ˆçš„åœ¨æ–°ç³»ç»Ÿçš„å›¾æ ‡æ˜¯å¦‚ä¸‹æ‰€ç¤ºçš„ xml æ–‡ä»¶ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">adaptive-icon</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">background</span> <span class="attr">android:drawable</span>=<span class="string">"@color/ic_brevent_background"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">foreground</span> <span class="attr">android:drawable</span>=<span class="string">"@mipmap/ic_brevent_foreground"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">adaptive-icon</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€ä¸ªæ–‡ä»¶å£°æ˜Žäº† foreground å’Œ backgroundã€‚å½“æ—¶é»‘é˜ˆä¹Ÿæ˜¯å¯èƒ½åœ¨ api 25 åŠä»¥ä¸‹çš„ android ç³»ç»Ÿè¿è¡Œçš„ï¼Œè¿™æ ·çš„ç³»ç»Ÿæ²¡æœ‰ adaptive icon è¿™ä¸ª featureï¼Œæ‰€ä»¥ï¼Œå½“åº”ç”¨çš„ minSdkVersion ä¸åˆ° 26 æ—¶ï¼Œåº”ç”¨ä¸­è¿˜éœ€è¦ä¸ºè€ç³»ç»Ÿå‡†å¤‡å›¾æ ‡èµ„æºã€‚å…¶å®žåšæ³•å°±æ˜¯ä¸Šè¿° xml æ–‡ä»¶å‘½åä¸º ic_launcher.xml ä¹‹ç±»çš„åå­—ï¼Œç½®äºŽ drawable-anydpi-v26 è¿™æ ·çš„èµ„æºç›®å½•ä¸­ï¼Œè€Œå…¶ä»–ç”¨äºŽè€ç³»ç»Ÿçš„å›¾æ ‡èµ„æº ic_launcher.png æ–‡ä»¶ç½®äºŽ drawable-xdpi ç­‰èµ„æºç›®å½•ä¸­ï¼Œå³å¯ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Python ä¹Ÿèƒ½çŽ©è·³ä¸€è·³å°æ¸¸æˆ</title>
      <link href="/2018/09/26/Python%20%E4%B9%9F%E8%83%BD%E7%8E%A9%E8%B7%B3%E4%B8%80%E8%B7%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/"/>
      <url>/2018/09/26/Python%20%E4%B9%9F%E8%83%BD%E7%8E%A9%E8%B7%B3%E4%B8%80%E8%B7%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/</url>
      <content type="html"><![CDATA[<p>2017å¹´12æœˆå¾®ä¿¡å‘å¸ƒçš„è·³ä¸€è·³å°æ¸¸æˆï¼Œç®€å•å´åˆè€ƒéªŒäººï¼Œå€Ÿç€è…¾è®¯ä¸€è´¯çš„å¥½å‹æŽ’åæœºåˆ¶å¯¹ç”¨æˆ·çš„åˆºæ¿€ï¼Œå‡ ä¹Žæ˜¯çž¬é—´å°±ç«èµ·æ¥äº†ã€‚æ‰‹æ®‹çš„æˆ‘ï¼ŒçŽ©è¿™ä¸ªæ¸¸æˆæœ€å¤šä¹Ÿåªæœ‰å‡ ååˆ†ã€‚çœ‹ç€è¿™æ¬¾å°æ¸¸æˆï¼Œæžå…¶ç®€å•çš„æ“ä½œ (é•¿æŒ‰å°±å¤Ÿäº†)ã€æžå…¶ç®€å•çš„èƒŒæ™¯ (å‡ ä¹Žæ˜¯çº¯è‰²ï¼Œæ²¡æœ‰ä»»ä½•èƒŒæ™¯è£…é¥°ç‰©)ã€æžå…¶ç®€å•çš„å…ƒç´  (é•¿æ–¹ä½“ã€åœ†æŸ±ä½“ç­‰)ï¼Œè®©æˆ‘è§‰å¾—åº”è¯¥å¯ä»¥ç”¨ä¸€ä¸ªè„šæœ¬æ¥è‡ªåŠ¨åŒ–çŽ©è¿™ä¸ªæ¸¸æˆï¼Œè¯´å¹²å°±å¹²ã€‚</p><p>å¯¹äºŽ Android è®¾å¤‡ï¼Œéœ€è¦è§£å†³çš„é—®é¢˜å…¶å®žåªæœ‰ï¼šæ¨¡æ‹Ÿé•¿æŒ‰äº‹ä»¶ã€æˆªå›¾å¹¶èŽ·å–å›¾ç‰‡ã€åˆ†æžå›¾ç‰‡åƒç´ ï¼Œåˆ†æžå¾—åˆ°æ¯ä¸€æ­¥éœ€è¦è·³åŠ¨çš„è·ç¦»ã€‚ä¸‹é¢ä¸€æ ·ä¸€æ ·æ¥çœ‹ã€‚</p><p>æ¨¡æ‹Ÿé•¿æŒ‰äº‹ä»¶ï¼Œæˆ‘é¦–å…ˆæƒ³åˆ°äº† adbï¼ŒæŸ¥äº†ä¸€ä¸‹ï¼Œæ‰¾åˆ°äº† adb shell input swipe x y time è¿™æ ·ä¸€æ¡å‘½ä»¤ï¼Œswipe æœ¬æ¥æ˜¯ç”¨æ¥åšæ»‘åŠ¨æ“ä½œçš„ï¼Œä½†æ˜¯è¿™é‡Œåªéœ€è¦é•¿æŒ‰ï¼Œæ‰€ä»¥åªæä¾›äº†ä¸€å¯¹åæ ‡ï¼Œæœ€åŽä¸€ä¸ªå‚æ•° time è¡¨ç¤ºé•¿æŒ‰çš„æ—¶é—´ï¼ŒOKã€‚</p><p>æˆªå›¾å¹¶èŽ·å–å›¾ç‰‡ã€‚èŽ·å–å›¾ç‰‡å¥½åŠžï¼Œadb pull ä¸€ä¸‹å°±å¥½äº†ã€‚æˆªå›¾çš„è¯ï¼Œæˆ‘ä¹Ÿæ˜¯æƒ³åˆ°äº† adbï¼ŒæŸ¥äº†ä¸€ä¸‹ï¼Œæ‰¾åˆ°äº† adb shell /system/bin/screencap -p /sdcard/screenshot.png è¿™æ ·çš„å‘½ä»¤ï¼Œç”¨äºŽæˆªå›¾å¹¶æ”¾åˆ° sdcard ä¸­çš„æŸä¸ªä½ç½®ã€‚</p><p>åˆ†æžå›¾ç‰‡åƒç´ è¿™ä¸€æ­¥ï¼Œå°±ä»…ä»…å‰©ä¸‹ç®—æ³•çš„é—®é¢˜å•¦ï¼Œæ¯•ç«Ÿå‰é¢å·²ç»æ‹¿åˆ°äº†æˆªå›¾äº†ã€‚æˆ‘æ˜¯ç”¨ Python çš„ PIL å›¾ç‰‡å¤„ç†åº“æ¥åšçš„ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€å¼ è·³ä¸€è·³çš„æˆªå›¾ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535787465.png" alt=""></p><p>é¦–å…ˆå¯ä»¥æ˜Žç¡®ä¸€ä¸ªé—®é¢˜ï¼Œå…¶å®žæˆ‘ä»¬ä¸éœ€è¦æ±‚ä¸¤ä¸ªè½ç‚¹ä¹‹é—´çš„è·ç¦»ï¼Œè€Œåªè¦æ±‚ä¸Šå›¾ä¸­ä¸¤æ¡çº¢è‰²ç«–çº¿ä¹‹é—´çš„è·ç¦»å°±å¥½äº†ï¼ŒåŽŸå› æ˜¯ä¸ç®¡å¾€å·¦ä¸Šè·³ï¼Œè¿˜æ˜¯å¾€æœ‰ä¸Šè·³ï¼Œè¿™ä¸¤ç§è·³æ³•å·¦å³å¯¹ç§°ï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡è·³åŠ¨çš„è·ç¦»ï¼Œå…¶å®žæ­£æ¯”äºŽä¸¤ä¸ªåº•åº§çš„ä¸­å¿ƒçš„ x åæ ‡çš„è·ç¦»ï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸¤æ¡ç«–ç›´çº¢çº¿çš„è·ç¦»ã€‚</p><p>å‡è®¾ç¬¬ä¸€æ¡çº¢è‰²ç«–çº¿ä¸ºè·³ä¹‹å‰ä½ç½®ï¼Œç¬¬äºŒæ¡ç«–çº¿ä¸ºä¸‹ä¸€ä¸ªåº•åº§ä¸­å¿ƒçº¿ã€‚ç¬¬ä¸€æ¡ç«–çº¿çš„ x åæ ‡ï¼Œå¯ä»¥é€šè¿‡ä»Žä¸Šåˆ°ä¸‹ä»Žå·¦åˆ°å³æ‰«æå›¾ç‰‡æ¯ä¸€ä¸ªåƒç´ ï¼Œç›´åˆ°æ‰¾åˆ°äº†é¢œè‰²å’Œè·³åŠ¨çš„æ£‹å­é¢œè‰²ç›¸åŒçš„é¢œè‰² (ä¸€ç§æ¯”è¾ƒæ·±çš„ç´«è‰²)ã€‚ç„¶åŽå°±å¯ä»¥æ‰¾åˆ°ç¬¬ä¸€æ¡çº¢çº¿çš„ x åæ ‡äº†ã€‚ç¬¬äºŒæ¡ç«–çº¿ï¼Œå¯ä»¥åœ¨é¦–æ¬¡æ‰«æåˆ°å’ŒèƒŒæ™¯é¢œè‰²ä¸ä¸€è‡´çš„é¢œè‰²æ—¶ï¼Œæ­¤æ—¶åº”è¯¥å°±æ˜¯ä¸‹ä¸€ä¸ªåº•åº§çš„æœ€é ä¸Šçš„åƒç´ ï¼Œå¹¶ä¸”ç”±äºŽåº•åº§è¦ä¹ˆæ˜¯åœ†æŸ±å½¢è¦ä¹ˆæ˜¯é•¿æ–¹ä½“ï¼Œæ‰€ä»¥è¿™ä¸ªåƒç´ ä¹Ÿå°±æ˜¯å·¦å³æ–¹å‘ä¸Šæ˜¯å±…ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ç¬¬ 2 æ¡ç«–çº¿çš„ä½ç½®ã€‚</p><p>æœ€åŽé€šè¿‡æµ‹è¯•å’Œè°ƒæ ¡ï¼Œå¯ä»¥æ‰¾åˆ°é•¿æŒ‰çš„æ—¶é•¿å’Œä¸¤æ¡çº¢è‰²ç«–çº¿è·ç¦»çš„æ¯”å€¼ã€‚</p><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæ€è·¯éƒ½ç†æ¸…äº†ï¼ŒæŽ¥ä¸‹æ¥å°±æ˜¯å†™ä»£ç åŠ ç»†èŠ‚ä¼˜åŒ–äº†ã€‚ä»£ç ä¸­æœ€å¤–å±‚æ˜¯ä¸ªå¾ªçŽ¯ï¼Œå¾ªçŽ¯çš„æ¯ä¸€æ­¥éƒ½æ˜¯è¿™æ ·å‡ æ­¥ï¼šæˆªå›¾ã€åˆ†æžå›¾ç‰‡ç¡®å®šé•¿æŒ‰çš„æ—¶é•¿ã€æ¨¡æ‹Ÿé•¿æŒ‰ã€ç­‰å¾…å‡ ç§’ç­‰è·³è·ƒå®Œæˆä»¥å…ä¸‹ä¸€æ¬¡å¾ªçŽ¯è¿‡æ—©å¼€å§‹æˆªå–åˆ°ä¸­é—´æ€çš„å›¾ç‰‡ã€‚</p><p>ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªæŒ‰ç…§ 1080P å±å¹•å†™çš„è„šæœ¬ï¼Œè¿˜æ˜¯æˆ‘åŽ»å¹´å†™çš„ï¼Œä¹Ÿä¸çŸ¥é“æ˜¯å¦è¿˜é€‚ç”¨äºŽçŽ°åœ¨çš„è·³ä¸€è·³ï¼Œæˆ‘çŽ°åœ¨ä¹Ÿä¸æƒ³çŽ©è·³ä¸€è·³äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image</span><br><span class="line">import os</span><br><span class="line">import time</span><br><span class="line">import random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def is_ball_color(r, g, b):</span><br><span class="line">    <span class="comment"># åˆ¤æ–­æ˜¯å¦æ˜¯æ£‹å­é¡¶éƒ¨å°çƒçš„é¢œè‰²</span></span><br><span class="line">    <span class="keyword">if</span> r &lt; 50 or r &gt; 70:</span><br><span class="line">        <span class="built_in">return</span> False</span><br><span class="line">    <span class="keyword">if</span> g &lt; 50 or g &gt; 70:</span><br><span class="line">        <span class="built_in">return</span> False</span><br><span class="line">    <span class="keyword">if</span> b &lt; 50 or b &gt; 70:</span><br><span class="line">        <span class="built_in">return</span> False</span><br><span class="line">    <span class="built_in">return</span> True</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def is_base_color(r, g, b):</span><br><span class="line">    <span class="comment"># åˆ¤æ–­æ˜¯å¦æ˜¯æ£‹å­åº•åº§çš„é¢œè‰²</span></span><br><span class="line">    <span class="keyword">if</span> r &lt; 50 or r &gt; 70:</span><br><span class="line">        <span class="built_in">return</span> False</span><br><span class="line">    <span class="keyword">if</span> g &lt; 50 or g &gt; 70:</span><br><span class="line">        <span class="built_in">return</span> False</span><br><span class="line">    <span class="keyword">if</span> b &lt; 90 or b &gt; 100:</span><br><span class="line">        <span class="built_in">return</span> False</span><br><span class="line">    <span class="built_in">return</span> True</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def is_similar_color(c1, c2):</span><br><span class="line">    <span class="comment"># åˆ¤æ–­æ˜¯å¦æ˜¯ç›¸è¿‘çš„é¢œè‰²</span></span><br><span class="line">    <span class="keyword">if</span> abs(c1[0] - c2[0]) &gt; 20:</span><br><span class="line">        <span class="built_in">return</span> False</span><br><span class="line">    <span class="keyword">if</span> abs(c1[1] - c2[1]) &gt; 20:</span><br><span class="line">        <span class="built_in">return</span> False</span><br><span class="line">    <span class="keyword">if</span> abs(c1[2] - c2[2]) &gt; 20:</span><br><span class="line">        <span class="built_in">return</span> False</span><br><span class="line">    <span class="built_in">return</span> True</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">    os.system(<span class="string">'adb shell /system/bin/screencap -p /sdcard/screenshot.png'</span>)</span><br><span class="line">    os.system(<span class="string">'adb pull /sdcard/screenshot.png .'</span>)</span><br><span class="line">    img = Image.open(<span class="string">'screenshot.png'</span>)</span><br><span class="line">    w = img.size[0]</span><br><span class="line">    h = img.size[1]</span><br><span class="line">    <span class="keyword">if</span> w == 0 or h == 0:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'w, h:'</span>, w, h)</span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="comment"># print img.getpixel((310, 933))</span></span><br><span class="line">    <span class="comment">#  print img.getpixel((311, 933))</span></span><br><span class="line">    <span class="comment">#  é¦–å…ˆæ˜¯æ‰«ææ¥æ‰¾æ£‹å­</span></span><br><span class="line">    base_x = base_y = 0</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> range(400, h):</span><br><span class="line">        <span class="comment"># y åæ ‡ä»Ž 400 å¼€å§‹ï¼Œé¿å…æ‰«æåˆ°å›¾ç‰‡é¡¶éƒ¨çš„æŒ‰é’®</span></span><br><span class="line">        x = 0</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(0, w):</span><br><span class="line">            px = img.getpixel((x, y))</span><br><span class="line">            <span class="keyword">if</span> is_ball_color(px[0], px[1], px[2]):</span><br><span class="line">                px = img.getpixel((x, y + 192))</span><br><span class="line">                <span class="keyword">if</span> is_base_color(px[0], px[1], px[2]):</span><br><span class="line">                    <span class="built_in">break</span></span><br><span class="line">        <span class="keyword">if</span> x &lt; w - 1:</span><br><span class="line">            base_x = x</span><br><span class="line">            base_y = y</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">    base_y += 192</span><br><span class="line">    <span class="keyword">if</span> base_x == 0:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'base_x == 0'</span>)</span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'base:'</span>, base_x, base_y)</span><br><span class="line">    bg_px = img.getpixel((0, 400))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç„¶åŽæ˜¯æ‰«ææ¥æ‰¾ä¸‹ä¸€ä¸ªåº•åº§çš„ä½ç½®</span></span><br><span class="line">    dest_x = dest_y = 0</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> range(400, h):</span><br><span class="line">        x = 0</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(0, w):</span><br><span class="line">            <span class="keyword">if</span> x % 50 == 0 and x &gt; 0:</span><br><span class="line">                px = img.getpixel((x - 50, y))</span><br><span class="line">                <span class="keyword">if</span> is_similar_color(bg_px[0 : 3], px[0 : 3]):</span><br><span class="line">                    bg_px = px</span><br><span class="line">                px = img.getpixel((x, y))</span><br><span class="line">                <span class="keyword">if</span> abs(px[0] - bg_px[0]) &gt; 20 or abs(px[1] - bg_px[1]) &gt; 20 or abs(px[2] - bg_px[2]) &gt; 20:</span><br><span class="line">                    <span class="keyword">if</span> abs(x - base_x) &gt; 100:</span><br><span class="line">                        y += 10</span><br><span class="line">                        left = right = x</span><br><span class="line">                        <span class="keyword">while</span> not is_similar_color(bg_px[0 : 3], img.getpixel((left, y))[0 : 3]):</span><br><span class="line">                            left -= 1</span><br><span class="line">                        <span class="keyword">while</span> not is_similar_color(bg_px[0 : 3], img.getpixel((right, y))[0 : 3]):</span><br><span class="line">                            right -= 1</span><br><span class="line">                        <span class="built_in">break</span></span><br><span class="line">        <span class="keyword">if</span> x &lt; w - 1:</span><br><span class="line">            dest_x = (left + right) / 2</span><br><span class="line">            dest_y = y</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line"></span><br><span class="line">    distance = abs(dest_x - base_x)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'dest:'</span>, dest_x, dest_y)</span><br><span class="line">    x = (int)(random.random() * 200 + 600)</span><br><span class="line">    y = (int)(random.random() * 200 + 600)</span><br><span class="line">    <span class="comment"># t æ˜¯é•¿æŒ‰çš„æ—¶é—´</span></span><br><span class="line">    t = distance * 600 / 383</span><br><span class="line">    loc = <span class="string">' '</span> + str(x) + <span class="string">' '</span> + str(y) + <span class="string">' '</span></span><br><span class="line">    os.system(<span class="string">'adb shell input swipe '</span> + loc + loc + str(t))</span><br><span class="line">    os.system(<span class="string">'rm screenshot.png'</span>)</span><br><span class="line">    time.sleep(3)</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MySQL æ•°æ®åº“æ”¯æŒ emoji è¡¨æƒ…å­—ç¬¦</title>
      <link href="/2018/09/26/MySQL%20%E6%95%B0%E6%8D%AE%E5%BA%93%E6%94%AF%E6%8C%81%20emoji%20%E8%A1%A8%E6%83%85%E5%AD%97%E7%AC%A6/"/>
      <url>/2018/09/26/MySQL%20%E6%95%B0%E6%8D%AE%E5%BA%93%E6%94%AF%E6%8C%81%20emoji%20%E8%A1%A8%E6%83%85%E5%AD%97%E7%AC%A6/</url>
      <content type="html"><![CDATA[<p>å…´å†²å†²çš„æ•´ä¸ªåšå®¢ï¼Œæ­»çš®èµ–è„¸çš„å«å‡ ä¸ªåŒå­¦æ¥è¯„è®ºï¼Œç»“æžœè¯„è®ºä¸­è¾“å…¥çš„ emoji è¡¨æƒ…æœ€åŽä¼šå˜æˆé—®å·ï¼Œè¯•æƒ³åˆ«äººè¯„è®ºã€Œå†™çš„çœŸæ£’ ðŸ˜„ã€ç»“æžœå˜æˆäº†ã€Œå†™çš„çœŸæ£’ ï¼Ÿã€ï¼Œè¿™æ˜¯ä½•å…¶çš„å°´å°¬ã€‚</p><p>ç»§ç»­å›žåˆ°è¿™ä¸ªé—®é¢˜æœ¬èº«ã€‚æˆ‘ç™»å½•åˆ°æ•°æ®åº“ä¸€æŸ¥ï¼Œå‘çŽ°æ•°æ®åº“ä¸­å­˜çš„è¯„è®ºæ–‡æœ¬å°±æ˜¯ä¸ªé—®å·ï¼Œè¿™è¯´æ˜Ž emoji è¡¨æƒ…å­˜åˆ°æ•°æ®åº“çš„è¿‡ç¨‹å‡ºé—®é¢˜äº†ã€‚èµ¶ç´§ä¸€æŸ¥ï¼Œå‘çŽ°ç½‘ä¸Šè¿˜æ˜¯å¾ˆå®¹æ˜“æ‰¾åˆ°äº†è§£å†³æ–¹æ³•ã€‚é—®é¢˜çš„åŽŸå› æ˜¯ MySQL å­˜å‚¨æ–‡æœ¬æ—¶é»˜è®¤çš„ UTF-8 ä»…æ”¯æŒ 3 ä¸ªå­—èŠ‚ç¼–ç ï¼Œè€Œ emoji æ˜¯ 4 å­—èŠ‚ç¼–ç çš„ï¼Œæ‰€ä»¥å­˜å‚¨è¿‡ç¨‹å‡ºé—®é¢˜äº†ã€‚æ‰€ä»¥éœ€è¦å°† charset è®¾ç½®ä¸º UTF-8 çš„è¶…é›† UTF-8mb4ï¼Œè™½ç„¶æˆ‘ä¹Ÿä¸çŸ¥é“è¿™ä¸ª UTF-8mb4 æ˜¯ä½•æ–¹ç¥žåœ£ã€‚</p><p>é¦–å…ˆï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ my.cnf (åœ¨æˆ‘çš„æœºå™¨ä¸Šè¿™ä¸ªæ–‡ä»¶è·¯å¾„æ˜¯ /etc/my.cnf) ä¸­æ·»åŠ ä¸€ä¸‹å†…å®¹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[client]</span></span><br><span class="line"><span class="attr">default-character-set</span>=utf8mb4</span><br><span class="line"></span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">character-set-client-handshake</span> = <span class="literal">FALSE</span></span><br><span class="line"><span class="attr">character-set-server</span> = utf8mb4</span><br><span class="line"><span class="attr">collation-server</span> = utf8mb4_unicode_ci</span><br><span class="line"><span class="attr">init_connect</span>=â€™SET NAMES utf8mb4<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysql]</span></span><br><span class="line"><span class="string">default-character-set=utf8mb4</span></span><br></pre></td></tr></table></figure><p>ç„¶åŽï¼Œéœ€è¦ä¿®æ”¹å·²æœ‰åº“ã€è¡¨ã€å­—æ®µçš„ charsetã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># ä¿®æ”¹åº“çš„ </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> &lt;database_name&gt; <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> = utf8mb4 <span class="keyword">COLLATE</span> = utf8mb4_unicode_ci; </span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹è¡¨çš„ </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> &lt;table_name&gt; <span class="keyword">CONVERT</span> <span class="keyword">TO</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci; </span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹å­—æ®µçš„ </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> &lt;table_name&gt; <span class="keyword">CHANGE</span> &lt;column_name&gt; &lt;column_name&gt; &lt;original_column_type&gt; <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci;</span><br></pre></td></tr></table></figure><p>æœ€åŽé‡æ–°å¯åŠ¨ MySQL æœåŠ¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/mysql stop sudo /etc/init.d/mysql start</span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œmysqldump æ—¶ï¼Œä¹Ÿéœ€è¦è¿›è¡Œé¢å¤–æŒ‡å®š char setï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -default-character-set-utf8mb4 -u &lt;db_user_name&gt; -p --databases &lt;db_name&gt; --lock-all-tables &gt; &lt;file_name&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>macOS ç³»ç»Ÿç¼–è¯‘ Android 8.1.0 æºç å…¨è¿‡ç¨‹</title>
      <link href="/2018/09/26/macOS%20%E7%B3%BB%E7%BB%9F%E7%BC%96%E8%AF%91%20Android%208.1.0%20%E6%BA%90%E7%A0%81%E5%85%A8%E8%BF%87%E7%A8%8B/"/>
      <url>/2018/09/26/macOS%20%E7%B3%BB%E7%BB%9F%E7%BC%96%E8%AF%91%20Android%208.1.0%20%E6%BA%90%E7%A0%81%E5%85%A8%E8%BF%87%E7%A8%8B/</url>
      <content type="html"><![CDATA[<p>è¿™ç¯‡æ–‡ç« è¯¦ç»†è®°å½•æˆ‘åœ¨ macOS 10.13 ä¸Šä½¿ç”¨ AOSP ä»£ç ç¼–è¯‘æœ€æ–° Android 8.1.0 çš„ userdebug ç³»ç»Ÿï¼Œå¹¶å®‰è£…åˆ° Pixel XL æ‰‹æœºä¸Šï¼Œæœ€åŽç”¨ AOSP ä»£ç æˆåŠŸè°ƒè¯• userdebug ç³»ç»Ÿ (ä»Žè€Œå¯ä»¥å‡†ç¡®å°†ç”µè„‘ä¸Šçš„æºç å’Œè®¾å¤‡ç³»ç»Ÿä»£ç è¡Œå·å¯¹åº”) çš„å…¨è¿‡ç¨‹ã€‚å…¨æ–‡åŒ…æ‹¬ AOSP çš„èŽ·å–ã€ç¼–è¯‘ Android ç³»ç»Ÿã€ä½¿ç”¨ Intellij IDEA æ‰“å¼€éƒ¨åˆ†æºç ã€ä½¿ç”¨ Intellij IDEA è¿›è¡Œè°ƒè¯•è¿™æ ·å‡ éƒ¨åˆ†ã€‚</p><p>çŽ¯å¢ƒï¼šmacOS 10.13, 250GB SSD, 16GB RAM, XCode 9.2, JDK 1.8.0_151</p><h3 id="ä¸€ã€AOSP-ä»£ç çš„èŽ·å–"><a href="#ä¸€ã€AOSP-ä»£ç çš„èŽ·å–" class="headerlink" title="ä¸€ã€AOSP ä»£ç çš„èŽ·å–"></a>ä¸€ã€AOSP ä»£ç çš„èŽ·å–</h3><p>å›  Android çš„ç¼–è¯‘éœ€è¦ case-sensitive çš„ç£ç›˜ç³»ç»Ÿï¼Œè€Œ macOS çš„ç£ç›˜ç³»ç»Ÿä¸æ»¡è¶³æ­¤æ¡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»ºç«‹ä¸€ä¸ª case-sensitive çš„é•œåƒæ–‡ä»¶ï¼Œç„¶åŽæŒ‚è½½æ­¤é•œåƒæ–‡ä»¶ï¼Œæœ€åŽå†æŒ‚è½½çš„ç›®å½•ä¸­èŽ·å–æºç å’Œç¼–è¯‘æºç ã€‚å»ºç«‹é•œåƒæ–‡ä»¶çš„æ“ä½œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºç©ºé—´ä¸Šé™ä¸º 150GB çš„ç¨€ç–é•œåƒæ–‡ä»¶ï¼Œåˆ›å»ºåŽé•œåƒæ–‡ä»¶å…¶å®žæ˜¯ ~/android.dmg.sparseimage </span></span><br><span class="line"><span class="comment"># åˆ›å»ºåŽå¹¶æœªçœŸæ­£å æ®è¿™ä¹ˆå¤šç£ç›˜ç©ºé—´ï¼Œè€Œæ˜¯éšç€é•œåƒä¸­é˜²æ­¢çš„æ•°æ®è¶Šæ¥è¶Šå¤šï¼Œè¯¥é•œåƒæ–‡ä»¶æ‰åŽŸæ¥è¶Šå¤§ </span></span><br><span class="line">hdiutil create -<span class="built_in">type</span> SPARSE -fs <span class="string">'Case-sensitive Journaled HFS+'</span> -size 150g ~/android.dmg </span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶åŽå°±å¯ä»¥å°†é•œåƒæ–‡ä»¶æŒ‚è½½åˆ° /Volumes ä¸­ï¼Œæ¯”å¦‚æˆ‘æŒ‚è½½åˆ° /Volumes/android </span></span><br><span class="line">hdiutil attach ~/android.dmg.sparseimage -mountpoint /Volumes/android </span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£é™¤æŒ‚è½½åˆ™æ˜¯ä¸‹é¢è¿™æ · </span></span><br><span class="line">hdiutil detach /Volumes/android </span><br><span class="line"></span><br><span class="line"><span class="comment"># é•œåƒæ–‡ä»¶çš„ç©ºé—´ä¸Šé™æ˜¯å¯ä»¥æ›´æ”¹çš„ï¼Œæ¯”å¦‚ä¸‹é¢æ›´æ”¹ä¸º 160GB </span></span><br><span class="line">hdiutil resize -size 160G ~/android.dmg.sparseimage</span><br></pre></td></tr></table></figure><p>æç¤ºä¸€ä¸‹ï¼Œhdiutil å‘½ä»¤çš„æŸäº›æ“ä½œéœ€è¦ç”µè„‘æ’ç€ç”µæºï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œä¸è¿‡è¿™ä¸ªæŠ¥é”™åœ¨ Google æœç´¢ä¸€ä¸‹å°±èƒ½æ‰¾åˆ°ç­”æ¡ˆäº†ã€‚</p><p><a href="https://source.android.com/" target="_blank" rel="noopener">AOSP é¡¹ç›®</a>å› ä¸ºåŒ…å«å¤ªå¤šäº†å­é¡¹ç›®ï¼Œæ‰€ä»¥æ¯ä¸ªå­é¡¹ç›®ä½¿ç”¨ Git æ¥ç®¡ç†ï¼Œè€Œæ•´ä¸ª AOSP åˆ™ä½¿ç”¨ repo å·¥å…·æ¥ç®¡ç†ï¼Œrepo å…¶å®žå°±æ˜¯ä¸€ä¸ª shell è„šæœ¬ï¼Œå†…éƒ¨è°ƒç”¨ Gitã€‚å®˜æ–‡æä¾›çš„<a href="https://source.android.com/setup/downloading" target="_blank" rel="noopener">èŽ·å– AOSP ä»£ç </a>çš„æ–¹å¼å› ä¸ºæŸäº›åŽŸå› è€Œæ¯”è¾ƒéš¾åšåˆ°ï¼Œæ‰€ä»¥æˆ‘<a href="https://lug.ustc.edu.cn/wiki/mirrors/help/aosp" target="_blank" rel="noopener">ä»Ž USTC Mirror æ¥èŽ·å–æºç </a>ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆèŽ·å–ä¸€ä¸‹ repo å·¥å…· </span></span><br><span class="line">mkdir ~/bin <span class="built_in">export</span> PATH=~/bin:<span class="variable">$PATH</span> </span><br><span class="line">curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo </span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ˆæŒ‚è½½ï¼Œç„¶åŽè¿›å…¥æŒ‚è½½åŽçš„ç›®å½•ï¼Œåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œæˆ‘è¿™æ˜¯åˆ›å»ºäº† android-8.1.0_r20 </span></span><br><span class="line"><span class="built_in">cd</span> /Volumes/android </span><br><span class="line">mkdir android-8.1.0_r20 &amp;&amp; <span class="built_in">cd</span> android-8.1.0_r20 </span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶åŽä½¿ç”¨ repo init æ¥åˆå§‹åŒ– AOSP ç›®å½•ï¼Œå› ä¸º android-8.1.0_r20 æ˜¯å¯ä»¥å®‰è£…åœ¨ Pixel XL ä¸Šé¢çš„æœ€æ–°ç‰ˆæœ¬ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©å®ƒæ¥ä½œä¸ºåˆ†æ”¯ </span></span><br><span class="line"><span class="comment"># å‚è§ https://source.android.google.cn/setup/build-numbers?hl=zh-cn#source-code-tags-and-builds æ¥æŸ¥è¯¢å“ªäº›åˆ†æ”¯æ”¯æŒå“ªäº›è®¾å¤‡ã€‚ </span></span><br><span class="line"><span class="comment"># USTC Mirror ä½œä¸ºåŒæ­¥ä»£ç çš„é•œåƒ </span></span><br><span class="line">repo init -u git://mirrors.ustc.edu.cn/aosp/platform/manifest -b android-8.1.0_r20 </span><br><span class="line"></span><br><span class="line"><span class="comment"># æŽ¥ä¸‹æ¥æ˜¯éœ€è¦æ¼«é•¿æ—¶é—´çš„ä¸€æ­¥ï¼Œå³ä»ŽæœåŠ¡å™¨åŒæ­¥æ‰€æœ‰ä»£ç åŠæ–‡ä»¶åˆ°æœ¬åœ°ã€‚ </span></span><br><span class="line">repo sync</span><br></pre></td></tr></table></figure><p>å¦‚æžœ repo init å¤±è´¥ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹ <a href="https://lug.ustc.edu.cn/wiki/mirrors/help/aosp#%E5%88%9D%E5%A7%8B%E5%90%8C%E6%AD%A5%E6%96%B9%E6%B3%952" target="_blank" rel="noopener">USTC Mirror çš„æ–¹æ³•</a> ä¸­çš„åˆå§‹åŒ–ä»“åº“é‚£ä¸€æ­¥ã€‚åŒæ­¥è¿‡ç¨‹æ˜¯å¯èƒ½æ„å¤–ä¸­æ–­çš„ï¼Œæ­¤æ—¶å¯ä»¥ç›´æŽ¥ç»§ç»­æ‰§è¡Œ repo sync æ¥ç»§ç»­åŒæ­¥ã€‚ä¸è¿‡ï¼Œè¿™ä¸ªè¡¥åˆ€æ˜¯å¯ä»¥è‡ªåŠ¨åŒ–æ‰§è¡Œçš„ï¼Œé‚£å°±æ˜¯ä¸‹é¢çš„ shell è„šæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line">repo sync </span><br><span class="line"><span class="keyword">while</span> [ $? -e 1 ]; <span class="keyword">do</span> </span><br><span class="line">    repo sync </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> success</span><br></pre></td></tr></table></figure><p>é™¤äº†åŒæ­¥çš„æ–¹å¼ï¼Œå…¶å®žè¿˜æœ‰å¦ä¸€æ¡è·¯å¯ä»¥èµ°ï¼Œé‚£å°±æ˜¯å…ˆä»Ž USTC Mirror AOSP Monthly æˆ–è€… TUNA Mirror AOSP Monthly ä¸‹è½½ aosp-latest.tar æ–‡ä»¶ï¼Œç„¶åŽè§£åŽ‹åˆ°æ”¾ç½®æºç çš„ç›®å½•ï¼Œç„¶åŽå† repo initï¼Œç„¶åŽå† repo syncï¼Œè¿™æ ·çš„è¯ï¼Œrepo sync å°±ä¼šå¿«å¾ˆå¤šï¼Œå¯èƒ½ä¸€ä¸ªå°æ—¶å°±å¯ä»¥äº†å§ã€‚</p><h3 id="äºŒã€ç¼–è¯‘-Android-ç³»ç»Ÿ"><a href="#äºŒã€ç¼–è¯‘-Android-ç³»ç»Ÿ" class="headerlink" title="äºŒã€ç¼–è¯‘ Android ç³»ç»Ÿ"></a>äºŒã€ç¼–è¯‘ Android ç³»ç»Ÿ</h3><p>æˆåŠŸå¾—åˆ°æºç åŽï¼Œå°±å¯ä»¥ç¼–è¯‘ Android ç³»ç»Ÿé•œåƒäº†ã€‚åœ¨ macOS ä¸Šï¼Œå¦‚æžœä½ ä¸æ˜¯ macOS æˆ– iOS å¼€å‘è€…çš„è¯ï¼Œå…«æˆæˆ‘ä»¬éœ€è¦å…ˆå®‰è£… XCodeã€‚</p><p>Gentle remindï¼šåŠ å…¥ä½ ä¹Ÿæ˜¯ 250GB SSD ç”¨æˆ·ï¼Œè€ƒè™‘åˆ°ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œæºç ç›®å½•å æ®çš„ç©ºé—´ä¼šè¶Šæ¥è¶Šåºžå¤§ï¼Œé‚£ä¹ˆæˆ‘å»ºè®®æš‚æ—¶å°†æºç æ ¹ç›®å½•ä¸­çš„ .repo éšè—ç›®å½•å‰ªåˆ‡åˆ°ç§»åŠ¨ç¡¬ç›˜ã€‚ä½†æ˜¯å…‰è¿™æ ·è¿˜ä¸å¤Ÿï¼Œä½ è¿˜éœ€è¦å…ˆè§£é™¤æŒ‚è½½ï¼Œç„¶åŽå†æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æ”¶ç¼©ç¨€ç–é•œåƒæ–‡ä»¶æ‰€å æ®çš„ç©ºé—´å¤§å°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å› ä¸ºç¨€ç–é•œåƒæ–‡ä»¶åˆ é™¤å†…å®¹æ—¶ï¼Œå¹¶ä¸ä¼šå‡å°å æ®çš„ç©ºé—´å¤§å°ï¼Œæ‰€ä»¥ç¨€ç–é•œåƒæ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ï¼Œè§£å†³åŠžæ³•å°±æ˜¯ä¸‹é¢è¿™æ ·æ”¶ç¼©ä¸€ä¸‹ </span></span><br><span class="line"><span class="comment"># æ”¶ç¼©æ˜¯æŠŠç¨€ç–é•œåƒä¸­æ²¡æœ‰ä½¿ç”¨çš„ç©ºé—´åŽ»é™¤æŽ‰ï¼Œä»Žè€Œè®©å®ƒä¸é‚£ä¹ˆç¨€ç–ï¼Œå°±å¥½åƒæŠŠæµ·ç»µé‡Œçš„æ°´æŒ¤æŽ‰ä¸€æ · </span></span><br><span class="line">hdiutil compact android.dmg.sparseimage</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å¼€å§‹ç¼–è¯‘çš„ä¸€äº›æ­¥éª¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…ˆè¿›å…¥ AOSP æ ¹ç›®å½•ï¼Œç„¶åŽå°è¯•æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯æ¸…ç†ä¸Šæ¬¡æž„å»ºçš„äº§ç‰© </span></span><br><span class="line">make clobber</span><br></pre></td></tr></table></figure><p>å¦‚æžœä¸Šé¢çš„å‘½ä»¤æŠ¥é”™ï¼Œæç¤º MacOSX SDK ç¼ºå°‘ï¼Œé‚£ä¹ˆå¯ä»¥ <a href="https://github.com/phracker/MacOSX-SDKs/releases" target="_blank" rel="noopener">https://github.com/phracker/MacOSX-SDKs/releases</a> ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„åŽ‹ç¼©åŒ…ï¼Œè§£åŽ‹åˆ° /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs è¿™ä¸ªè·¯å¾„ä¸­ã€‚å¦‚æžœæç¤ºä»€ä¹ˆ rt.jar æ‰¾ä¸åˆ°ï¼Œé‚£ä¹ˆä¹…å°† ANDROID_JAVA_HOME è®¾ç½®ä¸º JDK çš„æ ¹ç›®å½•ã€‚</p><p>ç›´åˆ° make clobber ä¸æŠ¥é”™äº†ï¼Œå¼€å§‹ä¸‹é¢çš„æ­¥éª¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼•å…¥ä¸€ä¸ªçŽ¯å¢ƒè®¾ç½®çš„è„šæœ¬ </span></span><br><span class="line"><span class="built_in">source</span> build/envsetup.sh </span><br><span class="line"></span><br><span class="line"><span class="comment"># é€‰æ‹©ç¼–è¯‘ç›®æ ‡ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯ aosp_marlin-userdebugï¼Œmarlin è¡¨ç¤º Pixel XLï¼Œuserdebug çš„å«ä¹‰è¡¨ç¤ºè°ƒè¯•ç‰ˆæœ¬çš„ Android ç³»ç»Ÿ </span></span><br><span class="line">lunch </span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶åŽå°±æ˜¯å¼€å§‹ç¼–è¯‘äº†ï¼Œ-j åŽé¢è¡¨ç¤ºå¤šå°‘ä¸ªçº¿ç¨‹å¹¶è¡Œç¼–è¯‘ã€‚æ ¹æ®ç”µè„‘ CPU ç¡¬ä»¶æ¥é€‰ï¼Œä¸€èˆ¬ 4 æ ¸å¿ƒ 8 çº¿ç¨‹çš„ CPU å°±é€‰ -j8 </span></span><br><span class="line">make -j8</span><br></pre></td></tr></table></figure><p>å®Œæ•´ç¼–è¯‘ä¸€éæ˜¯éœ€è¦è€—è´¹è‹¥å¹²å°æ—¶æ—¶é—´çš„ï¼Œæ‰€ä»¥è€å¿ƒç­‰å¾…ï¼Œæˆ‘çš„ç”µè„‘æ˜¯ MacBook Pro 15 å¯¸ 2016ç‰ˆ 2.6GHz CPUï¼Œç¼–è¯‘å¤§çº¦éœ€è¦ä¸‰å››ä¸ªå°æ—¶ã€‚</p><p>å¦‚æžœä¸Šé¢ç¼–è¯‘æ—¶å‡ºçŽ°ç±»ä¼¼ä¸‹é¢çš„é”™è¯¯ï¼š</p><blockquote><p>ninja: build stopped: subcommand failed.</p><p>ninja failed with: exit status 1</p></blockquote><p>é‚£ä¹ˆå‚è€ƒ <a href="https://groups.google.com/forum/#!topic/android-building/D1-c5lZ9Oco" target="_blank" rel="noopener">https://groups.google.com/forum/#!topic/android-building/D1-c5lZ9Oco</a> ç»™å‡ºçš„æ–¹æ³•ï¼Œéœ€è¦æ›´æ”¹ external/bison è¿™ä¸ªé¡¹ç›®çš„ä»£ç äº†ã€‚æ­¤æ—¶å¦‚æžœå‰é¢æˆ‘ä»¬æŠŠ .repo éšè—ç›®å½•å‰ªè´´èµ°äº†ï¼Œé‚£ä¹ˆçŽ°åœ¨å°±éœ€è¦æŠŠå®ƒçš„ä¸€éƒ¨åˆ†æ‹·è´å›žæ¥ï¼Œå³ external/bison è¿™ä¸ªé¡¹ç›®æ‰€éœ€çš„ Git track æ–‡ä»¶ï¼Œé€šè¿‡æŸ¥çœ‹ external/bison/.git ä¸­çš„ç¬¦å·é“¾æŽ¥ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“å“ªäº›æ–‡ä»¶éœ€è¦æ‹·è´å›žæ¥ã€‚</p><p><img src="http://tao93.top/images/2018/09/01/1535786626.png" alt=""></p><p>çº¢æ¡†ä¸­å°±æ˜¯éœ€è¦æ‹·è´å›žæ¥çš„ç›®å½•ã€‚ç„¶åŽæˆ‘ä»¬æ‰§è¡Œä¸‹é¢çš„æ›´æ”¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…ˆè¿›å…¥è¿™ä¸ª bison é¡¹ç›®çš„ç›®å½• </span></span><br><span class="line"><span class="built_in">cd</span> external/bison </span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½œå‡ºæ›´æ”¹ </span></span><br><span class="line">git cherry-pick c0c852bd6fe462b148475476d9124fd740eba160 </span><br><span class="line"></span><br><span class="line"><span class="comment"># æž„å»ºä¸€ä¸‹ bison é¡¹ç›® </span></span><br><span class="line">mm </span><br><span class="line"></span><br><span class="line"><span class="comment"># å›žåˆ° AOSP æ ¹ç›®å½•ï¼Œç„¶åŽå°†åˆšåˆšæž„å»ºå¾—åˆ°çš„ bison æ›¿ä»£å¦ä¸€ä¸ªåœ°æ–¹çš„ </span></span><br><span class="line"><span class="built_in">cd</span> ../.. &amp;&amp; cp out/host/darwin-x86/bin/bison prebuilts/misc/darwin-x86/bison/ </span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶åŽç»§ç»­å†ç¼–è¯‘ </span></span><br><span class="line">make -j8</span><br></pre></td></tr></table></figure><p>å»ºè®®ï¼šå¦‚æžœä½ ä¹Ÿæ˜¯ 250 GB SSD ç”¨æˆ·ï¼Œé‚£ä¹ˆæ¯æ¬¡ç¼–è¯‘å¤±è´¥åŽï¼Œå¯ä»¥å…ˆ make clobber æ¸…é™¤æž„å»ºäº§ç‰©ï¼Œå†è§£é™¤æŒ‚è½½ï¼Œç„¶åŽ compat ä¸€ä¸‹ç¨€ç–é•œåƒæ–‡ä»¶ï¼Œè¿™æ ·å¯ä»¥å°½å¯èƒ½çš„é¿å…æœ€åŽç¼–è¯‘æ—¶ç©ºé—´ä¸å¤Ÿç”¨ã€‚</p><h3 id="ä¸‰ã€çƒ§å½•åˆ°-Pixel-XL-è®¾å¤‡ä¸­"><a href="#ä¸‰ã€çƒ§å½•åˆ°-Pixel-XL-è®¾å¤‡ä¸­" class="headerlink" title="ä¸‰ã€çƒ§å½•åˆ° Pixel XL è®¾å¤‡ä¸­"></a>ä¸‰ã€çƒ§å½•åˆ° Pixel XL è®¾å¤‡ä¸­</h3><p>å…ˆè¿›å…¥å¼€å‘è€…æ¨¡å¼ï¼Œç„¶åŽæ‰“å¼€ OEM é”ã€‚è¿žæŽ¥åˆ°ç”µè„‘ï¼Œä½¿ç”¨ adb reboot bootloader å‘½ä»¤è®©æ‰‹æœºè¿›å…¥åˆ° BootLoader æ¨¡å¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é‡‡ç”¨æŒ‰è®¾å¤‡çš„ç‰©ç†æŒ‰é”®çš„æ–¹å¼è¿›å…¥ BootLoader æ¨¡å¼ã€‚å¦‚æžœæ­¤æ—¶å±å¹•ä¸‹åƒä¸‹é¢è¿™æ ·ï¼Œå°±ä¸éœ€è¦è§£é”ï¼Œåä¹‹éœ€è¦ä½¿ç”¨ fastboot flashing unlock æ¥è§£å¼€ BootLoader é”ã€‚ç³Ÿäº†ï¼Œä»Šå¤©å‡ºé—¨æ²¡å¸¦æ‰‹æœºï¼Œæ— æ³•æˆªå›¾äº†ï¼Œåæ­£å°±æ˜¯å±å¹•ä¸‹éƒ¨å‡ºçŽ° unlocked å­—æ ·ï¼Œç„¶åŽè¿˜æœ‰ä¸€æŠŠè§£å¼€çš„å°é”çš„å›¾æ ‡ï¼Œå°±æ˜¯å·²è§£é”ï¼Œå¦åˆ™æ˜¯æœªè§£é”ã€‚åªæœ‰è§£é”åŽæ‰èƒ½åˆ·æœºã€‚å¯¹äº†ï¼Œæ¸©é¦¨æç¤ºä¸€ä¸‹ï¼Œè§£é”åŽæ¯æ¬¡å¼€æœºéƒ½ä¼šæç¤ºã€ŒYour device software canâ€™t be checked for corruption. Please lock the bootloader. PRESS POWER TO PAUSE BOOTã€ï¼Œä¸ç”¨ç†å®ƒå°±å¥½äº†ã€‚</p><p>çŽ°åœ¨æˆ‘ä»¬è¦åŽ» <a href="https://developers.google.com/android/drivers" target="_blank" rel="noopener">Driver Binaries</a> ä¸‹è½½é€‚ç”¨äºŽ Pixel XL çš„é©±åŠ¨æ–‡ä»¶ã€‚è¿™ä¸ªé¡µé¢å¾ˆé•¿ï¼Œè¦åœ¨å…¶ä¸­æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„é©±åŠ¨æ–‡ä»¶ï¼Œéœ€è¦ä¸€ä¸ªç»†åˆ†ç‰ˆæœ¬å·ï¼Œåœ¨ <a href="https://source.android.com/setup/start/build-numbers" target="_blank" rel="noopener">ä»£å·ã€æ ‡ç­¾å’Œç‰ˆæœ¬å·</a>è¿™ä¸ªé¡µé¢ï¼Œå¯ä»¥æ‰¾åˆ°æˆ‘ä¹‹å‰ä½¿ç”¨çš„ android-8.1.0_r20 åˆ†æ”¯å¯¹åº”çš„ç»†åˆ†åˆ†æ”¯æ˜¯ OPM2.171019.029ï¼Œä½¿ç”¨è¿™ä¸ªç»†åˆ†åˆ†æ”¯ï¼Œå°±å¯ä»¥åœ¨ <a href="https://developers.google.com/android/drivers" target="_blank" rel="noopener">Driver Binaries</a> ä¸‹è½½åˆ°ç”¨äºŽ Pixel XL çš„å‡†ç¡®çš„é©±åŠ¨æ–‡ä»¶äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸€å…±æ˜¯ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸‹è½½ä¹‹åŽè§£åŽ‹ï¼Œå‘çŽ°æ˜¯ä¸¤ä¸ª shell è„šæœ¬ï¼Œåå­—åˆ†åˆ«æ˜¯ extract-qcom-marlin.sh å’Œ extract-google_devices-marlin.shã€‚</p><p><img src="http://tao93.top/images/2018/09/01/1535786865.png" alt=""></p><p>çŽ°åœ¨ï¼Œå°†ä¸Šä¸€æ­¥å¾—åˆ°çš„ä¸¤ä¸ª shell è„šæœ¬éƒ½å¤åˆ¶åˆ° AOSP æºç æ ¹ç›®å½•ï¼Œç„¶åŽåˆ†åˆ«æ‰§è¡Œä»¥ä¸‹ã€‚æŽ¥ä¸‹æ¥ï¼Œéœ€è¦ä»¥ä¸‹æ­¥éª¤æ¥ç¼–è¯‘å¾—åˆ°ä¸€äº›é¢å¤–çš„æ–‡ä»¶ï¼Œå…¶å®žæˆ‘ä¹Ÿä¸çŸ¥é“æ˜¯ä»€ä¹ˆæ–‡ä»¶ã€‚æŽ¥ä¸‹æ¥çš„æ­¥éª¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> build/envsetup.sh </span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹é¢è¿™ä¸€æ­¥æˆ‘ä¾æ—§æ˜¯é€‰ marlin-userdebug </span></span><br><span class="line">lunch</span><br><span class="line">make -j8</span><br></pre></td></tr></table></figure><p>åˆ«æ‹…å¿ƒä¸Šé¢è¿™ä¸ª make å¾ˆå¿«å°±ä¼šå®Œæˆï¼Œå› ä¸ºä¹‹å‰å·²ç»å®Œæ•´ç¼–è¯‘è¿‡äº†ã€‚æŽ¥ä¸‹æ¥è¦å¼€å§‹åˆ·æœºçš„æœ€åŽæ­¥éª¤äº†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å› ä¸ºåŽé¢çš„ flashall éœ€è¦ä¸‹é¢è¿™æ ·ä¸€ä¸ªçŽ¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥å…ˆè®¾ç½®ä¸€ä¸‹ </span></span><br><span class="line"><span class="built_in">export</span> ANDROID_PRODUCT_OUT=&lt;AOSP_ROOT_DIR&gt;/out/target/product/marlin </span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥ä¸Šé¢è¿™ä¸ª marlin ç›®å½•ï¼Œæ‰‹æœºä¿æŒ BootLoader æ¨¡å¼å¹¶è¿žæŽ¥åˆ°ç”µè„‘ï¼Œç„¶åŽå¼€å§‹åˆ·æœº</span></span><br><span class="line">fastboot -w flashall</span><br></pre></td></tr></table></figure><h3 id="å››ã€è°ƒè¯•-Android-ä»£ç "><a href="#å››ã€è°ƒè¯•-Android-ä»£ç " class="headerlink" title="å››ã€è°ƒè¯• Android ä»£ç "></a>å››ã€è°ƒè¯• Android ä»£ç </h3><p>user-debug çš„ç³»ç»Ÿå®‰è£…åˆ°æ‰‹æœºä¸­åŽï¼Œå¯ä»¥å‘çŽ°å’Œå‘è¡Œç‰ˆè¿˜æ˜¯æœ‰äº›ä¸åŒçš„ï¼Œæ¯”å¦‚æ²¡æœ‰ Google æ¡†æž¶ï¼Œæ²¡æœ‰ Google Photosï¼Œç”šè‡³è¿žæ—¶é’Ÿåº”ç”¨éƒ½å’Œå‘è¡Œç‰ˆçš„åŽŸç”Ÿ Android ä¸ä¸€æ ·ã€‚å¦‚æžœéœ€è¦è°ƒè¯•ä»£ç ï¼Œæ¯”å¦‚æˆ‘ä»¬è°ƒè¯•åˆ° com.android.internal.policy.PhoneWindow è¿™ä¸ªç±»çš„ä»£ç ï¼Œé‚£ä¹ˆæ˜¾ç„¶ï¼Œéœ€è¦ä½¿ç”¨ä¸€ä¸ª IDE æ¥æ‰“å¼€æˆ‘ä¸‹è½½çš„ AOSP æºç ï¼Œå› ä¸ºè¿™ä»½æºç å†æ˜¯å®‰è£…åˆ°æ‰‹æœºä¸­çš„æºç ï¼Œè€Œä¸èƒ½ä½¿ç”¨ Android SDK ä¸­çš„ sources/android-27 ä¸­çš„æºç æ¥è°ƒè¯•ã€‚ä½¿ç”¨ Intellij IDEA (ä¸‹é¢ç”¨ IDEA ç®€ç§°) æ¥æ‰“å¼€æºç ï¼Œå°†ä¼šæ¯” Android Studio å¥½ä¸€äº›ï¼Œå› ä¸ºå‰è€…æ›´å®¹æ˜“æŽ§åˆ¶ JDK çš„å¼•å…¥ã€‚</p><p>é¦–å…ˆï¼Œå¯¹äºŽæˆ‘ä»¬çš„ä¸ªäººç”µè„‘æ¥è¯´ï¼Œç›´æŽ¥æ‰“å¼€æ•´ä¸ª AOSP é¡¹ç›®çš„æºç æ˜¾å¾—æœ‰äº›è€ƒéªŒäººï¼ŒåŒæ—¶ä¹Ÿè€ƒéªŒæœºã€‚å› ä¸º AOSP ç›®å½•å¤ªåºžå¤§äº†ï¼ŒIDEA å»ºç«‹ç´¢å¼•å°†ä¼šéœ€è¦éžå¸¸ä¹‹ä¹…ï¼Œä¸€æ—¦æ–‡ä»¶æœ‰äº†æ›´æ”¹ï¼Œé‡æ–°ç´¢å¼•åˆè¦å¾ˆä¹…ï¼Œæ­¤å¤–ï¼Œå…‰æ˜¯ç´¢å¼•æ–‡ä»¶éƒ½ä¼šå¾ˆå¤§ã€‚æ‰€ä»¥æƒå®œä¹‹è®¡æ˜¯ï¼ŒåªæŠŠæœ€å¸¸ç”¨çš„ä¸€éƒ¨åˆ† AOSP ä»£ç  (ä¹Ÿå°±æ˜¯ä¸€éƒ¨åˆ†å­é¡¹ç›®) ä½¿ç”¨ IDEA æ‰“å¼€ã€‚æˆ‘é€‰æ‹©äº† framework ç›®å½•ä¸‹çš„æ‰€æœ‰å­é¡¹ç›®å’Œ libcoreã€repo è¿™ä¸¤ä¸ªå­é¡¹ç›®ã€‚framework æ˜¯å› ä¸ºé‡Œé¢çš„ä»£ç å¸¸ç”¨åˆ°ï¼Œlibcore æ˜¯å› ä¸ºé‡Œé¢æœ‰ Java çš„åº“ä»£ç ï¼Œè€Œ repo æ˜¯å› ä¸º repo è¢«å¼•ç”¨äº†ï¼Œæ‰€ä»¥ä¹ŸåŠ è¿›æ¥äº†ã€‚</p><p>æ­¤å¤–ï¼Œå› ä¸º AOSP æºç æ”¾ç½®åœ¨ case-sensitive çš„é•œåƒæ–‡ä»¶ä¸­ï¼Œè€Œå¦‚æžœ IDEA æ‰“å¼€ä½äºŽé•œåƒæ–‡ä»¶ä¸­çš„æºç çš„è¯ï¼Œå°†éœ€è¦ä¸º IDEA é…ç½®ä¸º case-sensitiveï¼Œå¯æ˜¯ IDEA å¯èƒ½è¿˜éœ€è¦æ‰“å¼€å…¶ä»–çš„æ™®é€šé¡¹ç›®ï¼Œå³ä½äºŽ macOS çš„ case-insensitive æ–‡ä»¶ç³»ç»Ÿä¸­çš„é¡¹ç›®ã€‚è¿™æ ·ä¸¤è€…å°±ä¼šå†²çªï¼Œé¢‘ç¹æŠ¥é”™ã€‚æ‰€ä»¥æˆ‘çš„æ–¹æ³•æ˜¯ï¼ŒæŠŠä¸Šä¸€æ®µæåˆ°çš„éƒ¨åˆ†å­é¡¹ç›®æ‹·è´åˆ°å¤–é¢ï¼Œä¹Ÿå°±æ˜¯æ‹·è´åˆ° macOS æ–‡ä»¶ç³»ç»Ÿï¼Œç„¶åŽå†ç”¨ IDEA æ‰“å¼€ã€‚</p><p>æŽ¥ä¸‹æ¥æ˜¯å…·ä½“çš„æ­¥éª¤äº†ï¼Œ é¦–å…ˆéœ€è¦ç”Ÿæˆç”¨äºŽ IDEA çš„ android.imp å’Œ android.ipr æ–‡ä»¶:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ AOSP æ ¹ç›®å½•æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ </span></span><br><span class="line">make idegen &amp;&amp; development/tools/idegen/idegen.sh</span><br></pre></td></tr></table></figure><p>ç„¶åŽå°±æ˜¯æ‹·è´å­é¡¹ç›®å‡ºæ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™ä¸ª aosp_part å°±æ˜¯ç”¨æ¥ä¿å­˜éƒ¨åˆ†å­é¡¹ç›®çš„ç›®å½•äº† </span></span><br><span class="line">mkdir aosp_part &amp;&amp; <span class="built_in">cd</span> aosp_part </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹·è´ framework ç›®å½•å’Œ libcore ç›®å½•å‡ºæ¥ </span></span><br><span class="line">cp -R /Volumes/android/android-8.1.0_r20/framework . </span><br><span class="line">cp -R /Volumes/android/android-8.1.0_r20/libcore . </span><br><span class="line">cp -R /Volumes/android/android-8.1.0_r20/repo .</span><br></pre></td></tr></table></figure><p>ä¸ºé¿å…ä¸å°å¿ƒæ”¹åŠ¨ä¸Šé¢é¡¹ç›®ä¸­çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ Git æ¥è¿½è¸ªå®ƒä»¬ï¼Œè€Œæ‰€æœ‰å­é¡¹ç›®çš„ git æ–‡ä»¶å…¶å®žéƒ½åœ¨ .repo è¿™ä¸ªéšè—ç›®å½•ä¸­ã€‚æ‰€ä»¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŽ¥ä¸‹æ¥éœ€è¦æŠŠä¸Šé¢å­é¡¹ç›®å¯¹åº”çš„ .git ç›®å½•æ‹·è´è¿‡æ¥ </span></span><br><span class="line"><span class="comment"># å…ˆå»ºä¸€ä¸ª .repo ç›®å½•ï¼Œå¹¶å»ºå¥½ç›¸å…³ç›®å½• </span></span><br><span class="line">mkdir -p .repo/project-objects/platform &amp;&amp; mkdir -p .repo/projects </span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶åŽå¼€å§‹æ‹·è´ .git ç›®å½• </span></span><br><span class="line">cp -R /Volumes/android/android-8.1.0_r20/.repo/project-objects/platform/frameworks .repo/project-objects/platform </span><br><span class="line">cp -R /Volumes/android/android-8.1.0_r20/.repo/project-objects/platform/libcore.git .repo/project-objects/platform </span><br><span class="line">cp -R /Volumes/android/android-8.1.0_r20/.repo/project-objects/platform/repo.git .repo/project-objects/platform </span><br><span class="line">cp -R /Volumes/android/android-8.1.0_r20/.repo/projects/frameworks .repo/projects/ cp -R /Volumes/android/android-8.1.0_r20/.repo/projects/libcore.git .repo/projects/ </span><br><span class="line">cp -R /Volumes/android/android-8.1.0_r20/.repo/projects/repo.git .repo/projects/ </span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€åŽï¼ŒæŠŠå‰é¢ç”Ÿæˆçš„ä¸¤ä¸ªæ–‡ä»¶æ‹·è´è¿‡æ¥ </span></span><br><span class="line">cp /Volumes/android/android-8.1.0_r20/android.iml /Volumes/android/android-8.1.0_r20/android.ipr .</span><br></pre></td></tr></table></figure><p>ç„¶åŽï¼Œå°±å¯ä»¥ä½¿ç”¨ IDEA ä»¥æ‰“å¼€é¡¹ç›®çš„å½¢å¼æ‰“å¼€æ­¤ aosp_part ç›®å½•äº†ã€‚æ‰“å¼€åŽï¼Œå› ä¸º libcore ä¸­å°±å·²ç»æœ‰äº† JDK åº“ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è®© aosp_part é¡¹ç›®ä¸ä½¿ç”¨ç”µè„‘ä¸­çš„ JDKã€‚æ–¹æ³•æ˜¯åœ¨ IDEA æ‰“å¼€çš„ aosp_part é¡¹ç›®ï¼ŒFile â†’ Project Structure â†’ SDKsï¼Œç„¶åŽå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535787196.png" alt=""></p><p>ç‚¹å‡»åŠ å·ï¼Œæ–°å»ºä¸€ä¸ª JDK å¹¶å°†æ–°çš„ JDK å‘½åä¸º aosp_jdk_1.8ï¼Œæ–°å»ºçš„ JDK ä¸€å¼€å§‹ä¼šå’Œå·²æœ‰çš„é‚£ä¸ª JDK 1.8 ä¸€æ¨¡ä¸€æ ·ï¼ŒåŒ…å«äº†åº“ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠ aosp_jdk_1.8 çš„ ClassPath tab ä¸­çš„æ‰€æœ‰ .jar æ–‡ä»¶ç§»é™¤ï¼Œè¿™æ · aosp_jdk_1.8 æˆäº†ä¸€ä¸ªç©ºçš„ JDKï¼Œå°†è¢«ç”¨äºŽ aosp_part é¡¹ç›®ï¼Œè€Œå…¶ä»–çš„ IDEA é¡¹ç›®å¯ä»¥ä¾æ—§ä½¿ç”¨ JDK 1.8ï¼Œäº’ä¸å½±å“ã€‚</p><p>åœ¨ä¸Šé¢çš„çª—å£ä¸­ï¼Œåœ¨å·¦ä¾§åˆ‡æ¢åˆ° Modules tabï¼Œç„¶åŽå¦‚ä¸‹å›¾ï¼Œåˆ‡æ¢åˆ° dependencies tabï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535787229.png" alt=""></p><p>åœ¨ä¸Šé¢è¿™ä¸ªç•Œé¢ä¼šæœ‰éžå¸¸å¤šçš„ .jar ï¼ŒæŠŠå®ƒä»¬å…¨éƒ¨ç§»é™¤ï¼Œç„¶åŽå†æ·»åŠ å‰é¢é‚£ä¸ª aosp_jdk_1.8ï¼ŒçŽ°åœ¨å°±å·²ç»ç”¨ IDEA æ‰“å¼€äº†éƒ¨åˆ† android æºç äº†ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535787252.png" alt=""></p><p>æŽ¥ä¸‹æ¥æ˜¯æœ€åŽä¸€æ­¥äº†ï¼Œåœ¨ IDEA ä¸­è°ƒè¯•ä»£ç ã€‚</p><p>åœ¨ IDEA ä¸­ï¼ŒRun â†’ Edit Configuration â†’ + â†’ Remoteï¼Œç„¶åŽç¼–è¾‘ä¸€ä¸‹ nameï¼Œç„¶åŽæŠŠ Settings ä¸‹é¢çš„ port ç¼–è¾‘ä¸º 8700ï¼Œæœ€åŽä¿å­˜ã€‚</p><p>åœ¨ Android SDK æºç ç›®å½•ä¸­çš„ tools ç›®å½•ä¸­çš„ monitor å¯æ‰§è¡Œæ–‡ä»¶ã€‚å¦‚æžœè¿™ä¸ªç¨‹åºæ‰“ä¸å¼€ï¼Œåˆ«æ‹…å¿ƒï¼Œå…ˆæ£€æŸ¥ä¸€ä¸‹ JDK ç‰ˆæœ¬æ˜¯ä¸æ˜¯é«˜äºŽæˆ–ç­‰äºŽ 1.8.0_152ï¼Œå¦‚æžœæ˜¯ï¼Œé‚£ä¹ˆåªéœ€è¦å›žé€€åˆ° 1.8.0_151 å³å¯ã€‚è´´å¿ƒçš„æˆ‘æä¾›ä¸€ä»½ JDK 1.8.0_151 çš„ä¸‹è½½åœ°å€ï¼Œåœ¨è¿™é‡Œæ‰¾åˆ° 1.8.0_151 ç‰ˆæœ¬å³å¯ä»¥ã€‚</p><p>æ‰“å¼€ monitor åŽï¼Œé¼ æ ‡é€‰ä¸­éœ€è¦è°ƒè¯•çš„è¿›ç¨‹ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535787290.png" alt=""></p><p>å› ä¸ºä»Šå¤©æ²¡å¸¦æ‰‹æœºï¼Œæ‰€ä»¥ä¸Šå›¾ä¸­æ˜¯ä¸ª vivo çš„æµ‹è¯•æœºã€‚</p><p>ç„¶åŽåœ¨ IDEA ç‚¹å‡»è°ƒè¯•æŒ‰é’® (å›¾æ ‡æ˜¯ä¸€ä¸ªç»¿è‰²çš„å°è™«å­)ï¼Œæ­¤æ—¶å¦‚æžœå¼¹å‡º Debug tool window å¹¶æç¤º connected to target VMï¼Œåˆ™è¯´æ˜Žå¯ä»¥åŠ æ–­ç‚¹è°ƒè¯•äº†ã€‚</p><p><img src="http://tao93.top/images/2018/09/01/1535787316.png" alt=""></p><p>EOF</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> AOSP </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>macOS çŠ¶æ€æ æ˜¾ç¤ºç½‘é€Ÿå°å·¥å…·</title>
      <link href="/2018/09/26/macOS%20%E7%8A%B6%E6%80%81%E6%A0%8F%E6%98%BE%E7%A4%BA%E7%BD%91%E9%80%9F%E5%B0%8F%E5%B7%A5%E5%85%B7/"/>
      <url>/2018/09/26/macOS%20%E7%8A%B6%E6%80%81%E6%A0%8F%E6%98%BE%E7%A4%BA%E7%BD%91%E9%80%9F%E5%B0%8F%E5%B7%A5%E5%85%B7/</url>
      <content type="html"><![CDATA[<p>æ—©å…ˆæˆ‘æ˜¯ç”¨ç›—ç‰ˆçš„ <a href="https://bjango.com/mac/istatmenus/" target="_blank" rel="noopener">iStat Menus</a> è½¯ä»¶ä¸­çš„ã€ŒçŠ¶æ€æ æ˜¾ç¤ºç½‘é€Ÿã€åŠŸèƒ½çš„ï¼ŒåŽæ¥ä¸å†ç”¨ç›—ç‰ˆè½¯ä»¶äº†ï¼Œå¯æ˜¯å¶å°”è¿˜æ˜¯æœ‰æŸ¥çœ‹ç½‘é€Ÿçš„éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘å°±æŸ¥æ‰¾ macOS ç›‘æµ‹ç½‘é€Ÿçš„æ–¹æ³•ï¼Œæœ€åŽæ‰¾åˆ°äº† nettop è¿™ä¸ªå‘½ä»¤ã€‚</p><p>nettop å‘½ä»¤çš„å‚æ•°æˆ‘å°±ä¸è§£é‡Šäº†ï¼Œåæ­£ç”¨å®ƒå°±å¯ä»¥çœ‹åˆ°å½“å‰æ—¶åˆ»å„ä¸ªè¿›ç¨‹ download å’Œ upload çš„å­—èŠ‚æ•°ï¼Œæ‰€ä»¥å®šæ—¶æ‰§è¡Œæ­¤å‘½ä»¤ï¼Œç„¶åŽå¯å¾—æ—¶é—´åŒºé—´å†…çš„ä¸Šä¼ å’Œä¸‹è½½å­—èŠ‚æ•°ï¼Œç„¶åŽå†é™¤ä»¥æ—¶é—´é—´éš”ï¼Œå°±å¾—åˆ°äº†ç½‘é€Ÿã€‚æˆ‘å®šæ—¶æ‰§è¡Œçš„å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nettop -x -t wifi -t wired -k rx_dupe,rx_ooo,re-tx,rtt_avg,rcvsize,tx_win,tc_class,tc_mgt,cc_algo,P,C,R,W -P -l 1</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ï¼Œå°±å¯åˆ—å‡ºè‹¥å¹²è¿›ç¨‹å’Œä»–ä»¬çš„ä¸Šä¼ ä¸‹è½½å­—èŠ‚æ•°ï¼Œä¸‹é¢æ˜¯ç¤ºä¾‹ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">time</span>                                <span class="selector-tag">interface</span>         <span class="selector-tag">state</span>        <span class="selector-tag">bytes_in</span>       <span class="selector-tag">bytes_out</span></span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266151</span> <span class="selector-tag">apsd</span><span class="selector-class">.100</span>                                               7413           16246</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266164</span> <span class="selector-tag">sentineld</span><span class="selector-class">.109</span>                                          6666            6954</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266166</span> <span class="selector-tag">biometrickitd</span><span class="selector-class">.253</span>                                    113264           19802</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266169</span> <span class="selector-tag">eoshostd</span><span class="selector-class">.266</span>                                              0               0</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266171</span> <span class="selector-tag">SystemUIServer</span><span class="selector-class">.380</span>                                        0            3344</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266172</span> <span class="selector-tag">rapportd</span><span class="selector-class">.405</span>                                            393             366</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266174</span> <span class="selector-tag">Mail</span><span class="selector-class">.419</span>                                              81706           36183</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266194</span> <span class="selector-tag">SogouServices</span><span class="selector-class">.487</span>                                       329             921</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266198</span> <span class="selector-tag">mDNSResponder</span><span class="selector-class">.602</span>                                  20108134         3925987</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266200</span> <span class="selector-tag">Teams</span><span class="selector-class">.6104</span>                                            33061           19975</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266214</span> <span class="selector-tag">Microsoft</span> <span class="selector-tag">Teams</span><span class="selector-class">.6142</span>                                  23322           22085</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266220</span> <span class="selector-tag">QQ</span><span class="selector-class">.33101</span>                                             522914           82040</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266222</span> <span class="selector-tag">WeChat</span><span class="selector-class">.37612</span>                                          53670           64492</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266224</span> <span class="selector-tag">Google</span> <span class="selector-tag">Chrome</span><span class="selector-class">.37878</span>                                 1633955           42648</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266226</span> <span class="selector-tag">ss-local</span><span class="selector-class">.38600</span>                                        52499           74555</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266228</span> <span class="selector-tag">netbiosd</span><span class="selector-class">.40075</span>                                      1008522          151841</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå°±æ˜¯æœ€åŸºæœ¬çš„ä¸œè¥¿äº†ã€‚å› ä¸ºæˆ‘å¹¶ä¸æ‡‚ swift ç¼–ç¨‹ï¼Œæ‰€ä»¥æˆ‘å…ˆå†™äº†ä¸€ä¸ª python è„šæœ¬ï¼Œæ¥å®šæ—¶æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ï¼Œç„¶åŽè§£æžå‘½ä»¤çš„è¾“å‡ºå¹¶è®¡ç®—ç½‘é€Ÿï¼Œè„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_time_stamp</span><span class="params">(t)</span>:</span></span><br><span class="line">    h = int(t[<span class="number">0</span>:<span class="number">2</span>])</span><br><span class="line">    m = int(t[<span class="number">3</span>:<span class="number">5</span>])</span><br><span class="line">    s = int(t[<span class="number">6</span>:<span class="number">8</span>])</span><br><span class="line">    miu_s = int(t[<span class="number">9</span>:])</span><br><span class="line">    <span class="keyword">return</span> ((h * <span class="number">60</span> + m) * <span class="number">60</span> + s) * <span class="number">1000000</span> + miu_s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">last_result = &#123;&#125;</span><br><span class="line">cur_result = &#123;&#125;</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    print(<span class="string">'---------'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># sample, output speed</span></span><br><span class="line">    res = subprocess.run(<span class="string">'nettop -x -t wifi -t wired -k rx_dupe,rx_ooo,re-tx,rtt_avg,rcvsize,tx_win,tc_class,tc_mgt,cc_algo,P,C,R,W -P -l 1'</span>.split(), stdout=subprocess.PIPE)</span><br><span class="line">    <span class="comment"># assign sample result to last result</span></span><br><span class="line">    output = res.stdout.decode()</span><br><span class="line">    cur_result = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> output.split(<span class="string">'\n'</span>):</span><br><span class="line">        <span class="keyword">if</span> line == <span class="string">''</span> <span class="keyword">or</span> line.startswith(<span class="string">'time'</span>):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        data = line.split()</span><br><span class="line">        data_len = len(data)</span><br><span class="line"></span><br><span class="line">        t, p, i, o = data[<span class="number">0</span>], <span class="string">''</span>.join(data[<span class="number">1</span>: data_len - <span class="number">2</span>]), int(data[data_len - <span class="number">2</span>]), int(data[data_len - <span class="number">1</span>])</span><br><span class="line">        idx = p.rfind(<span class="string">'.'</span>)</span><br><span class="line">        p = p[:idx]</span><br><span class="line">        t = get_time_stamp(t)</span><br><span class="line">        cur_result[p] = (t, i, o)</span><br><span class="line">    <span class="keyword">if</span> len(last_result) &gt; <span class="number">0</span>:</span><br><span class="line">        speed = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> last_p, last_d <span class="keyword">in</span> last_result.items():</span><br><span class="line">            <span class="keyword">for</span> cur_p, cur_d <span class="keyword">in</span> cur_result.items():</span><br><span class="line">                <span class="keyword">if</span> last_p == cur_p:</span><br><span class="line">                    up_speed = cur_d[<span class="number">2</span>] - last_d[<span class="number">2</span>]</span><br><span class="line">                    down_speed = cur_d[<span class="number">1</span>] - last_d[<span class="number">1</span>]</span><br><span class="line">                    <span class="keyword">if</span> cur_p <span class="keyword">in</span> speed:</span><br><span class="line">                        speed[cur_p] = (speed[cur_p][<span class="number">0</span>], speed[cur_p][<span class="number">1</span>] + up_speed, speed[cur_p][<span class="number">2</span>] + down_speed)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        speed[cur_p] = (cur_p, up_speed, down_speed)</span><br><span class="line">        speed = list(speed.values())</span><br><span class="line">        speed.sort(key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>] + x[<span class="number">2</span>], reverse=<span class="keyword">True</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> speed:</span><br><span class="line">            print(i[<span class="number">0</span>])</span><br><span class="line">    last_result = cur_result</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>ç„¶åŽä»Šå¤©ç»ˆäºŽç£•ç£•ç»Šç»Šçš„ç”¨ XCode å†™äº†ä¸€ä¸ªæ¯”è¾ƒç®€é™‹çš„ã€ŒçŠ¶æ€æ æ˜¾ç¤ºå®žæ—¶ç½‘é€Ÿã€çš„ macOS å°å·¥å…·ï¼Œå¹¶æ”¾åœ¨äº† <a href="https://github.com/Tao93/NetTool" target="_blank" rel="noopener">github ä¸Šé¢</a>ï¼Œè¿è¡Œæ•ˆæžœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://tao93.top/images/2018/09/15/1537000487.png" alt=""></p>]]></content>
      
      
        <tags>
            
            <tag> macOS </tag>
            
            <tag> swift </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>macOS ç¼–è¯‘ Android 9 æºç </title>
      <link href="/2018/09/26/macOS%20%E4%B8%8B%E7%BC%96%E8%AF%91%20Android%209%20%E6%BA%90%E7%A0%81/"/>
      <url>/2018/09/26/macOS%20%E4%B8%8B%E7%BC%96%E8%AF%91%20Android%209%20%E6%BA%90%E7%A0%81/</url>
      <content type="html"><![CDATA[<h4 id="çŽ¯å¢ƒï¼š"><a href="#çŽ¯å¢ƒï¼š" class="headerlink" title="çŽ¯å¢ƒï¼š"></a>çŽ¯å¢ƒï¼š</h4><pre><code>macOS High Sierra 10.13.6 with 16GB RAMXCode 9.4.1Oracle JDK 1.8.0_181</code></pre><p>å¤§çº¦ 1 ä¸ªæœˆä¹‹å‰ï¼ŒGoogle æŽ¨å‡ºäº† Android Pie æ­£å¼ç‰ˆï¼Œæˆ‘ä¹Ÿç”¨ Pixel XL è®¾å¤‡ç¬¬ä¸€æ—¶é—´æ›´æ–°åˆ°äº† Pieï¼Œç»“æžœå‘çŽ°å’Œ Oreo ç›¸æ¯”å˜åŒ–ä¸å¤§ã€‚æ­¤å¤–ï¼Œæˆ‘ä¹Ÿæƒ³åˆ° Google åº”è¯¥æ—©å°±åœ¨ AOSP åˆ›å»ºäº† Android Pie çš„ä»£ç åˆ†æ”¯ï¼Œæ­£å¥½æˆ‘åˆ°åˆšåˆ° Microstrategy æ¥ä¸Šç­ï¼Œæ¢äº†æ–°çš„ MacBookï¼Œæ˜¯æ—¶å€™å†æ¬¡ç”¨ MacBook ç¼–è¯‘ä¸€æ¬¡ AOSP æºç äº†ã€‚</p><p>é¦–å…ˆæˆ‘æŸ¥çœ‹äº†æ‰‹ä¸Šçš„ 2017 æ¬¾ MacBook 15å¯¸ï¼Œå‘çŽ°è¿™å±…ç„¶æ˜¯ 500GB ç£ç›˜çš„ï¼Œè¿™ä»¤æˆ‘ååˆ†æƒŠå–œï¼Œè¿™æ„å‘³ç€è¿™å°æœºå™¨ç¼–è¯‘ Android æºç æ—¶ç£ç›˜ç©ºé—´å°†ä¼šç»°ç»°æœ‰ä½™ã€‚</p><h4 id="èŽ·å–æºä»£ç "><a href="#èŽ·å–æºä»£ç " class="headerlink" title="èŽ·å–æºä»£ç "></a>èŽ·å–æºä»£ç </h4><p>å¯ä»Žå›½å†…é•œåƒå…ˆä¸‹è½½åˆ°ä¸€ä¸ªåŽ‹ç¼©åŒ…ï¼Œ<a href="https://lug.ustc.edu.cn/wiki/mirrors/help/aosp" target="_blank" rel="noopener">USTC Mirror</a> å’Œ <a href="https://mirrors.tuna.tsinghua.edu.cn/help/AOSP/" target="_blank" rel="noopener">Tuna</a> éƒ½å¯é€‰æ‹©ï¼Œä»¥ä¸‹ä»¥ Tuna ä¸ºä¾‹ã€‚</p><p>é¦–å…ˆä»Ž <a href="https://mirrors.tuna.tsinghua.edu.cn/aosp-monthly" target="_blank" rel="noopener">è¿™é‡Œ</a> ä¸‹è½½ aosp-latest.tar æ–‡ä»¶å’Œå¯¹åº”çš„ MD5 æ–‡ä»¶ã€‚è¿™ä¸ª tar æ–‡ä»¶ä¸­æ˜¯è¿‘æœŸçš„æ•´ä¸ª AOSP é¡¹ç›®çš„åŽ‹ç¼©åŒ…ã€‚ä¸‹è½½å¯ä»¥ä½¿ç”¨ wget åŠ  -c å‘½ä»¤ï¼Œè¿™æ ·å³ä½¿ä¸‹è½½æ„å¤–å¤±è´¥ï¼Œä¹Ÿå¯ä»¥æŽ¥ä¸Šä¸­æ–­çš„åœ°æ–¹ç»§ç»­ä¸‹è½½ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># download aosp-latest.tar file, with -c option</span></span><br><span class="line">wget -c https://mirrors.tuna.tsinghua.edu.cn/aosp-monthly/aosp-latest.tar</span><br></pre></td></tr></table></figure><p>ä¸‹è½½å®ŒæˆåŽï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤èŽ·å– md5 å€¼ï¼Œæ£€æŸ¥å’Œä¸‹è½½åˆ°çš„ aosp-latest.tar.md5 æ–‡ä»¶ä¸­çš„å€¼æ˜¯å¦ä¸€è‡´ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># get it's md5 value then check the value</span></span><br><span class="line">md5 aosp-latest.tar</span><br></pre></td></tr></table></figure><p>å¦ä¸€ä¸ªä»¤äººæƒŠå–œçš„äº‹ï¼Œæœ€è¿‘çš„ aosp ä½“ç§¯å±…ç„¶å‡å°äº†ï¼Œä¹‹å‰å‡ ä¸ªæœˆ aosp ä½“ç§¯é‚£æ˜¯ä¸€è·¯è¹­è¹­è¹­å¾€ä¸Šæ¶¨ï¼Œæ¶¨åˆ°äº† 40 å¤š GBï¼š</p><p><img src="http://tao93.top/images/2018/09/06/1536224194.png" alt=""></p><p>æŽ¥ä¸‹æ¥ï¼ŒæŒ‰ç…§ä¹‹å‰æˆ‘çš„ post <a href="https://tao93.top/2018/09/01/macOS%20ç³»ç»Ÿç¼–è¯‘%20Android%208.1.0%20æºç å…¨è¿‡ç¨‹/">macOS ç³»ç»Ÿç¼–è¯‘ Android 8.1.0 æºç å…¨è¿‡ç¨‹</a> ä¸­çš„æè¿°ï¼Œå»ºç«‹ sparse image å¹¶æŒ‚è½½ï¼Œç„¶åŽå°† aosp-latest.tar è§£åŽ‹åˆ° sparse image ä¸­ã€‚æˆ‘åœ¨ sparse image ä¸­å»ºç«‹äº†ä¸€ä¸ª aosp ç›®å½•ï¼Œç„¶åŽæŠŠ aosp-latest.tar è§£åŽ‹åˆ°äº† aosp ç›®å½•ä¸­ï¼Œæ­¤æ—¶ aosp ç›®å½•ä¸­ä»…æœ‰ä¸€ä¸ª .repo ç›®å½•ã€‚æŽ¥ä¸‹æ¥æˆ‘ä»¬æ¥æŠŠæœ€æ–°çš„ Android Pie åˆ†æ”¯çš„ä»£ç  checkoutã€‚</p><p>å¦å¤–ï¼Œè¦å…ˆçŸ¥é“æˆ‘ä»¬éœ€è¦å“ªä¸ªåˆ†æ”¯ï¼Œåœ¨ <a href="https://source.android.com/setup/start/build-numbers" target="_blank" rel="noopener">è¿™é‡Œ</a> å¯ä»¥çœ‹åˆ°æ‰€æœ‰ä»£ç åˆ†æ”¯ä¸Žä»£å·ã€‚åœ¨è¿™ä¸ªç½‘é¡µå¦‚æžœæ˜¾ç¤ºä¸ºä¸­æ–‡ï¼Œå°±æ‹‰åˆ°æœ€åº•éƒ¨åœ¨å·¦ä¸‹è§’æŠŠè¯­è¨€æ¢æˆè‹±æ–‡ï¼Œå› ä¸ºè‹±æ–‡æ‰æœ‰æœ€æ–°çš„ Android Pie ç›¸å…³ä¿¡æ¯ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ ¹æ®è‡ªå·±æƒ³è¦ç”¨äºŽä»€ä¹ˆè®¾å¤‡æ¥é€‰æ‹©åˆ†æ”¯ï¼Œæ¯”å¦‚å¦‚æžœæ˜¯ Pixel 2 è®¾å¤‡é‚£ä¹ˆæœ€æ–°çš„åˆ†æ”¯å°±æ˜¯ android-9.0.0_r6ï¼Œè€Œä¸èƒ½ä½¿ android-9.0.0_r7 å’Œ android-9.0.0_r8ï¼Œæˆ‘å½“æ—¶ç”¨çš„æ˜¯ android-9.0.0_r2</p><p><img src="http://tao93.top/images/2018/09/06/1536224982.png" alt=""></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># prepare repo</span></span><br><span class="line">mkdir ~/bin</span><br><span class="line">curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;PATH&#125;</span>:<span class="variable">$&#123;HOME&#125;</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> aosp</span><br><span class="line"></span><br><span class="line"><span class="comment"># init with specific branch android-9.0.0_r2, use other branch as you want</span></span><br><span class="line">repo init repo init -u https://aosp.tuna.tsinghua.edu.cn/platform/manifest -b android-9.0.0_r2</span><br></pre></td></tr></table></figure><p>æŽ¥ä¸‹æ¥å°±å¯ä»¥ repo sync äº†ï¼Œå¯ä»¥ç›´æŽ¥æ‰§è¡Œæ­¤å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥åƒæˆ‘ä¹‹å‰ post ä¸€æ ·å†™ä¸€ä¸ª sync è„šæœ¬æ¥æ‰§è¡Œã€‚</p><p>æœ‰äºŽæˆ‘ä»¬ä¸‹è½½äº†æœ€æ–°çš„ aosp-latest.tarï¼Œæ‰€ä»¥ sync çš„è¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒå¿«çš„ï¼Œæˆ‘å½“æ—¶åº”è¯¥ 30 æ¥åˆ†é’Ÿå°± sync å®Œæˆäº†ã€‚</p><h4 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h4><p>ä»¥å¾€ç¼–è¯‘ Android æºç æ—¶ï¼Œæ€»æ˜¯ä¼šå‡ºçŽ°å„ç§å„æ ·çš„é”™è¯¯ï¼Œä½†æ˜¯è¿™æ¬¡ Android Pie çš„æºç ç¼–è¯‘å¼‚å¸¸é¡ºåˆ©ï¼Œæ²¡æœ‰ä»»ä½•é”™è¯¯ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯ Google åšäº†æ”¹è¿›å’Œä¼˜åŒ–ã€‚</p><p>é¦–å…ˆä¸‹è½½ XCode å®‰è£…ï¼Œç„¶åŽè¿›å…¥ aosp æ ¹ç›®å½•ï¼Œå°±å¯ä»¥ç¼–è¯‘äº†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># clear build generated files</span></span><br><span class="line">make clobber</span><br><span class="line"></span><br><span class="line"><span class="comment"># import a build script</span></span><br><span class="line"><span class="built_in">source</span> build/envsetup.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># select build target </span></span><br><span class="line">lunch</span><br><span class="line"></span><br><span class="line"><span class="comment"># start build</span></span><br><span class="line">make -j8</span><br></pre></td></tr></table></figure><p>éžå¸¸é¡ºåˆ©ï¼Œä¸Šæ¬¡æˆ‘é€‰æ‹© aosp_marlin-userdebug ç”¨äº† 3 ä¸ªåŠå°æ—¶å°±æˆåŠŸç¼–è¯‘äº†ï¼Œç®€ç›´ä»¤äººæ„ŸåŠ¨ã€‚ç›¸æ¯”èµ·æ¥ï¼Œä¹‹å‰çš„ Android æºç ç¼–è¯‘ä¼šå‡ºçŽ°å„ç§å„æ ·çš„é”™è¯¯ï¼Œè®©äººéžå¸¸æŠ“ç‹‚ã€‚</p><p>å› ä¸ºæˆ‘æ‰‹é‡Œçš„ Pixel XL å·²ç»å®‰è£…äº† factory Android systemï¼Œé‡Œé¢æœ‰æˆ‘å¾ˆå¤šèµ„æ–™å’Œæ•°æ®äº†ï¼Œå¦å¤– userdebug ç±»åž‹çš„ Android æ˜¯æ²¡æœ‰ Google æœåŠ¡çš„ï¼Œå¹¶ä¸”è¿ž Google Photosã€Cameraã€Gmail ç­‰åº”ç”¨å…¨éƒ½æ²¡æœ‰ï¼Œæ‰€ä»¥æˆ‘å°±æ²¡å†æŠŠç¼–è¯‘å‡ºæ¥çš„ userdebug ç±»åž‹ç³»ç»Ÿå®‰è£…åˆ°æ‰‹æœºä¸­ã€‚äºŽæ˜¯ï¼Œæˆ‘ä»Šå¤©é€‰æ‹© aosp_x86_64-eng é‡æ–°ç¼–è¯‘äº†ä¸€éï¼Œè¿™ä¸ª aosp_x86_64-eng é€‚ç”¨äºŽåœ¨ x86 ç”µè„‘ä¸Šè¿è¡Œæ¨¡æ‹Ÿå™¨ (æ²¡æœ‰æ‰‹æœºå°±åªå¥½çŽ°åœ¨ç”µè„‘ä¸Šç”¨æ¨¡æ‹Ÿå™¨è¯•è¯•äº†)ã€‚è¿™ä¸€æ¬¡ç”¨äº† 4 ä¸ªå¤šå°æ—¶å®Œæˆç¼–è¯‘ï¼ŒåŒæ ·éžå¸¸é¡ºåˆ©ï¼š</p><p><img src="http://tao93.top/images/2018/09/07/1536304013.png" alt=""></p><p>ç¼–è¯‘å®ŒæˆåŽï¼Œç›´æŽ¥è¿è¡Œ emulator å‘½ä»¤å³å¯è¿è¡Œæ¨¡æ‹Ÿå™¨ã€‚éœ€è¦æ³¨æ„ï¼Œè¿™ä¸ª emulator å‘½ä»¤æ˜¯è¿è¡Œ lunch å‘½ä»¤è€Œæ·»åŠ çš„ï¼Œä¹Ÿå°±æ˜¯å¦‚æžœé€€å‡ºäº†ç”µè„‘çš„ terminalï¼Œç„¶åŽå†è¿›å…¥ aosp æ ¹ç›®å½•ï¼Œéœ€è¦é‡æ–°è¿è¡Œ source build/envsetup.sh å’Œ lunch ç„¶åŽæ‰èƒ½è¿è¡Œ emulatorã€‚ä»¥ä¸‹æ˜¯æ¨¡æ‹Ÿå™¨è¿è¡Œçš„æˆªå›¾ï¼š</p><p><img src="http://tao93.top/images/2018/09/07/1536305206.png" alt=""></p><p>ä¸Šé¢ 3 å¼ æˆªå›¾ä¸­ï¼Œå·¦è¾¹ä¸¤å¼ æˆªå›¾å¯ä»¥çœ‹åˆ°ç³»ç»Ÿæ˜¯å¾ˆç®€é™‹çš„ï¼ŒGoogle çš„è®¸å¤šåº”ç”¨éƒ½æ²¡æœ‰ï¼Œè¿ž Google service ä¹Ÿæ²¡æœ‰ã€‚æœ€æœ‰ä¸€å¼ æˆªå›¾ï¼Œæ˜¾ç¤ºäº† Android ç‰ˆæœ¬å·æ˜¯ 9ï¼Œå¦å¤–æœ€åº•éƒ¨çš„ Build Number æ˜¾ç¤ºäº†è¿™æ˜¯ aosp_x86_64-eng ç±»åž‹çš„æž„å»ºï¼ŒPPR1.180610.010 æ˜¯ Build ä»£å·ï¼Œåœ¨ <a href="https://source.android.com/setup/start/build-numbers" target="_blank" rel="noopener">è¿™é‡Œ</a> å¯ä»¥çœ‹åˆ°ï¼Œè€Œ 20180907.105244 åˆ™æ˜¯æž„å»ºæ—¶é—´ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> macOS </tag>
            
            <tag> AOSP </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Linux æ‰§è¡Œè¿œç¨‹è„šæœ¬</title>
      <link href="/2018/09/26/Linux%20%E6%89%A7%E8%A1%8C%E8%BF%9C%E7%A8%8B%E8%84%9A%E6%9C%AC/"/>
      <url>/2018/09/26/Linux%20%E6%89%A7%E8%A1%8C%E8%BF%9C%E7%A8%8B%E8%84%9A%E6%9C%AC/</url>
      <content type="html"><![CDATA[<p>æœ€è¿‘å·¥ä½œä¸Šéœ€è¦å†™ä¸€å¥—è·¨æœåŠ¡å™¨åˆ†éš”æ•°æ®å’Œè½¬ç§»æ•°æ®çš„è„šæœ¬ã€‚ç»è¿‡å®žè·µï¼Œå‘çŽ°å•çº¯æ‰§è¡Œåœ¨æœ¬åœ°æ‰§è¡Œå‘½ä»¤æ¥æ“æŽ§è¿œç¨‹æœåŠ¡å™¨çš„æ•°æ®ä¸çŽ°å®žã€‚æ‰€ä»¥éœ€è¦æŠŠè„šæœ¬æ”¾åœ¨è¿œç¨‹æœåŠ¡å™¨ï¼Œç„¶åŽæœ¬åœ°è®©æœåŠ¡å™¨è‡ªå·±åŽ»æ‰§è¡Œè„šæœ¬ã€‚æ­¤å¤–ï¼Œéœ€è¦ä½¿ç”¨ expect å·¥å…·æ¥è‡ªåŠ¨è¾“å…¥è¿œç¨‹æœåŠ¡å™¨ç™»å½•å¯†ç ã€‚</p><p>å…ˆæä¸€äº›  expect çš„ç”¨æ³•ï¼Œå³å¯ä»¥å†™æˆ expect è„šæœ¬å½¢å¼ (å³è„šæœ¬ä»¥ #!/usr/bin/expect å¼€å¤´)ï¼Œä¹Ÿå¯ä»¥å†™æˆ expect -c â€˜&lt;several_cmd&gt;â€™ çš„å•æ¡å‘½ä»¤å½¢å¼ã€‚åŽè€…çš„ç¤ºä¾‹å½¢å¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect -c <span class="string">'spawn scp root@example:~/xx.txt .; expect "password:"; send "abc1234\\r"; interact;'</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¾‹å­ä¸­ï¼Œspawn åŽé¢è¡¨ç¤ºéœ€è¦æ‰§è¡Œçš„å‘½ä»¤ (æ­¤å¤„æ˜¯ä¸€ä¸ª scp å‘½ä»¤ï¼Œéœ€è¦è¾“å…¥å¯†ç ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦ expect çš„åŽŸå› )ï¼Œexpect åŽé¢æ˜¯è¡¨ç¤ºæ ‡å‡†è¾“å‡ºå‡ºçŽ° â€œpassword:â€ å­—æ ·æ—¶ï¼Œå°±è‡ªåŠ¨è¾“å…¥ send åŽé¢çš„ä¸œè¥¿ï¼Œä¹Ÿå°±æ˜¯å¯†ç ã€‚æœ€åŽä¸€ä¸ª interact è¡¨ç¤ºæŽ¥ä¸‹æ¥å…è®¸ç”¨æˆ·è‡ªå·±äº¤äº’ã€‚</p><p>æœ¬æ¥ç›´æŽ¥ä½¿ç”¨ shell è„šæœ¬å°±å¯ä»¥çš„ã€‚ä¸è¿‡æˆ‘è¿™è®¾è®¡åˆ°æ•°æ®çš„åˆ‡å‰²ï¼Œæ‰€ä»¥å°±ä½¿ç”¨äº† Pythonï¼Œç„¶åŽéœ€è¦ç”¨åˆ° shell å‘½ä»¤æ—¶ï¼Œæ˜¯ç”± Python è„šæœ¬å†è°ƒç”¨ shell å‘½ä»¤çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">call_remote_cmd</span><span class="params">(host, password, cmd)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    è®©è¿œç¨‹æœåŠ¡å™¨è‡ªå·±æ‰§è¡Œå‘½ä»¤ </span></span><br><span class="line"><span class="string">    :param host: è¿œç¨‹æœåŠ¡å™¨ç”¨æˆ·ååŠ åŸŸåï¼Œæ ¼å¼ç¤ºä¾‹ï¼šroot@example.com </span></span><br><span class="line"><span class="string">    :param cmd: è¦è®©è¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œçš„å‘½ä»¤ </span></span><br><span class="line"><span class="string">    :return: ä¸€äº›ç»“æžœï¼Œå…¶ä¸­å¯èƒ½æœ‰ä¸€äº›æç¤ºæ€§æ–‡æœ¬</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># ä¸¾ä¸ªä¾‹å­ï¼Œssh root@example.com ls å¯ä»¥è®©è¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œ ls å‘½ä»¤</span></span><br><span class="line">    final_cmd = <span class="string">'/usr/bin/expect -c \'spawn ssh %s %s; expect "*Password:"; send "%s\\r"; interact;\''</span> % (host, cmd, password)</span><br><span class="line">    res = os.popen(final_cmd).read()</span><br><span class="line">    print(res)</span><br><span class="line">    <span class="keyword">return</span> res </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¼ ç»™è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ Python è„šæœ¬ä½œä¸ºå‚æ•° </span></span><br><span class="line">args = &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># args éœ€è¦ç»è¿‡å¤æ‚çš„æ›¿æ¢ï¼Œæ‰èƒ½ä¿è¯å‡†ç¡®ä¼ é€’åˆ°è¿œç¨‹æœåŠ¡å™¨çš„ Python è„šæœ¬ä¸­</span></span><br><span class="line">args = str(args) </span><br><span class="line">args = args.replace(<span class="string">'\''</span>, <span class="string">'\\\"'</span>)</span><br><span class="line">args = args.replace(<span class="string">' '</span>, <span class="string">'\\ '</span>) </span><br><span class="line">args = args.replace(<span class="string">','</span>, <span class="string">'\\,'</span>) </span><br><span class="line">args = args.replace(<span class="string">'['</span>, <span class="string">'\\['</span>) </span><br><span class="line">args = args.replace(<span class="string">']'</span>, <span class="string">'\\]'</span>) </span><br><span class="line">args = args.replace(<span class="string">'&#123;'</span>, <span class="string">'\\&#123;'</span>) </span><br><span class="line">args = args.replace(<span class="string">'&#125;'</span>, <span class="string">'\\&#125;'</span>) </span><br><span class="line">args = args.replace(<span class="string">';'</span>, <span class="string">'\\;'</span>) </span><br><span class="line">args = args.replace(<span class="string">'"'</span>, <span class="string">'\\"'</span>) </span><br><span class="line"></span><br><span class="line">cmd = <span class="string">'/usr/local/bin/python3 x.py \\"%s\\"'</span> % args </span><br><span class="line">call_remote_cmd(<span class="string">'root@example.com'</span>, <span class="string">'password'</span>, cmd)</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯æˆ‘å› å·¥ä½œéœ€è¦è€Œå†™å‡ºæ¥çš„è®©è¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œå®ƒçš„ Python è„šæœ¬çš„æœ¬åœ° Python è„šæœ¬ä»£ç ã€‚ä½¿ç”¨çš„æ—¶å€™å°±ç®€å•äº†ã€‚æœåŠ¡å™¨ä¸Šé¢æ”¾ä¸€ä¸ªè¢«è°ƒç”¨çš„ Python è„šæœ¬ã€‚ç„¶åŽæ‰§è¡Œä¸Šé¢ä»£ç ï¼Œå°±å¯ä»¥äº†ã€‚</p><p>æƒ³å¿…ç›´æŽ¥å†™ shell è„šæœ¬çš„è¯ï¼Œå¯èƒ½ä¼šæ›´ç®€æ´äº›ã€‚ç­‰å•¥æ—¶å€™æœ‰ç©ºäº†è¯•è¯•çœ‹ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Shell </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Homebrew å°ç»“</title>
      <link href="/2018/09/26/Homebrew%20%E5%B0%8F%E7%BB%93/"/>
      <url>/2018/09/26/Homebrew%20%E5%B0%8F%E7%BB%93/</url>
      <content type="html"><![CDATA[<p>è¯´å®žè¯ï¼Œæˆ‘æ— æ³•é€‚åº”æš—è‰²èƒŒæ™¯çš„ç•Œé¢ï¼Œæ¯”å¦‚ jetbrains ç³»åˆ— IDE çš„ Darcula ä¸»é¢˜ (æš—è‰²çš„èƒŒæ™¯)ï¼Œå†æ¯”å¦‚ Terminal çš„ä¸€äº›æš—è‰²èƒŒæ™¯ä¸»é¢˜ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿæ— æ³•ç›´è§† <a href="https://brew.sh/" target="_blank" rel="noopener">Homebrew</a> ä¸»é¡µçš„èƒŒæ™¯è‰²ï¼Œçœ‹å¾—æˆ‘çœ¼ç›éš¾å—ã€‚ä½†æ˜¯ï¼ŒHomebrew åº”è¯¥æ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„å·¥å…·ï¼Œæ¯•ç«Ÿå®ƒå‡ ä¹Žå–ä»£äº† MacPortsã€‚</p><p>Homebrew æ˜¯ macOS ä¸Šçš„ä¸€æ¬¾åŒ…ç®¡ç†å·¥å…·ï¼Œä½œç”¨ç±»ä¼¼äºŽ Ubuntu ä¸Šé¢çš„ apt-getã€‚ä¸åŒç‚¹æ˜¯ï¼ŒHomebrew çš„æ“ä½œä¸éœ€è¦ root æƒé™ï¼ŒHomebrew ä¸æ˜¯ç³»ç»Ÿçº§åˆ«çš„å·¥å…·ã€‚Homebrew ç»´æŠ¤ä¸€äº›ç§°ä¸º tap çš„ git repositoryï¼Œæ¯ä¸ª tap é‡Œé¢æ˜¯ä¸€äº› formulaï¼Œæ‰€è°“çš„ formula å°±æ˜¯å¯¹åº”ä¸€ä¸ªè½¯ä»¶åŒ…ï¼ˆæ¯”å›¾ wget å’Œ git å°±æ˜¯ä¸¤ä¸ª formulaï¼‰ã€‚æœ€é‡è¦çš„ tap æ˜¯ homebrew/coreï¼Œè¿™ä¸ª tap ä¹Ÿæ˜¯è‡ªå¸¦çš„ï¼Œå…¶ä¸­æ˜¯å„ç§å‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒåœ¨å®‰è£…äº† Homebrew çš„ç³»ç»Ÿä¸­ä¸€èˆ¬ä½äºŽ /usr/local/Homebrew/Library/Taps/homebrew/homebrew-coreï¼Œè¿™å¯ä»¥é€šè¿‡ brew â€“repo homebrew/core å¾—çŸ¥ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">âžœ  Downloads brew --repo homebrew/core</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/Homebrew/</span>Library<span class="regexp">/Taps/</span>homebrew/homebrew-core</span><br><span class="line">âžœ  Downloads cd <span class="regexp">/usr/</span>local<span class="regexp">/Homebrew/</span>Library<span class="regexp">/Taps/</span>homebrew/homebrew-core</span><br><span class="line">âžœ  homebrew-core <span class="string">git:</span>(master)</span><br></pre></td></tr></table></figure><p>ä»Žä¸Šé¢å¯çŸ¥ homebrew/core è¿™ä¸ª tap åœ¨æœ¬åœ°æ˜¯ä¸€ä¸ª git é¡¹ç›®ï¼Œå®žé™…ä¸Šé‡Œé¢ç»´æŠ¤äº†å››åƒå¤šä¸ª formulaï¼Œä¹Ÿå°±æ˜¯å¯ä¾›ç”¨æˆ·å®‰è£… 4000 å¤šä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œæ¯ä¸ª formula éƒ½æ˜¯ç”¨ä¸€ä¸ª ruby æ–‡ä»¶æè¿°çš„ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ homebrew/science å’Œ homebrew/php ç­‰å®˜æ–¹ tapã€‚é™¤äº†å®˜æ–¹ tap å¤–ï¼Œè¿˜æœ‰è‘—åçš„ caskroom/cask è¿™ä¸ªç”¨æ¥å®‰è£… gui è½¯ä»¶(ä¾‹å¦‚ Sublime Text)çš„ tapã€‚æ’ä¸€å¥ï¼Œåœ¨ caskroom çš„ tap ä¸­ï¼Œä¸æ˜¯ç”¨ formula è¡¨ç¤ºè½¯ä»¶åŒ…ï¼Œè€Œæ˜¯ç”¨ cask æ¥è¡¨ç¤ºï¼Œæ‰€ä»¥å¤§è‡´å¯ä»¥è®¤ä¸º formula è¡¨ç¤ºå‘½ä»¤è¡Œçš„åŒ…ï¼Œè€Œ cask è¡¨ç¤º gui è½¯ä»¶ã€‚å¯¹ç”¨æˆ·æ¥è¯´ï¼ŒHomebrwe å¯ä»¥åšçš„äº‹å°±æ˜¯æœç´¢ã€å®‰è£…ã€å‡çº§ã€æŸ¥çœ‹ã€å¸è½½å„ç§è½¯ä»¶åŒ…ï¼Œæ­¤å¤–ä¹Ÿå¯ä»¥ç®¡ç†å¢žåˆ  tapã€‚</p><p>é™¤äº† homebrew/core å¤–ï¼Œæˆ‘åªæ·»åŠ äº† caskroom/cask è¿™ä¸€ä¸ª tapã€‚è¦æ·»åŠ æ­¤ tap æˆ–ç§»é™¤å®ƒï¼Œåªéœ€è¦æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ  </span></span><br><span class="line">brew tap caskroom/cask </span><br><span class="line"></span><br><span class="line"><span class="comment"># ç§»é™¤ </span></span><br><span class="line">brew untap caskroom/cask</span><br></pre></td></tr></table></figure><p>å½“é•¿æ—¶é—´æ²¡æœ‰æ›´æ–°è¿‡ tap å¯¹åº”çš„æœ¬åœ° git é¡¹ç›®ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡æ›´æ–°æ—¶ï¼Œå› ä¸ºå›½å†…çš„ç½‘ç»œçŽ¯å¢ƒï¼Œæ›´æ–°æ‰€éœ€è¦çš„æ—¶é—´å¯èƒ½è¦å¾ˆä¹…ï¼Œæ‰€ä»¥æˆ‘ä½¿ç”¨äº† USTC Mirror çš„ <a href="http://mirrors.ustc.edu.cn/help/brew.git.html" target="_blank" rel="noopener">Homebrew ä»£ç†</a>ã€‚å…·ä½“æ–¹æ³•å…¶å®žå°±æ˜¯ï¼ŒæŠŠ homebrew/core å’Œ caskroom/cask è¿™ä¸¤ä¸ª tap å¯¹åº”çš„æœ¬åœ° git é¡¹ç›®çš„ remote url åˆ†åˆ«è®¾ç½®ä¸º <a href="https://mirrors.ustc.edu.cn/homebrew-core.git" target="_blank" rel="noopener">https://mirrors.ustc.edu.cn/homebrew-core.git</a> å’Œ <a href="https://mirrors.ustc.edu.cn/homebrew-cask.gitï¼Œè¿™æ ·æ›´æ–°å°±å¾ˆå¿«äº†ã€‚å¦å¤–ï¼Œbrew" target="_blank" rel="noopener">https://mirrors.ustc.edu.cn/homebrew-cask.gitï¼Œè¿™æ ·æ›´æ–°å°±å¾ˆå¿«äº†ã€‚å¦å¤–ï¼Œbrew</a> ä¸‹è½½è½¯ä»¶æ˜¯ä»Žä¸€ä¸ªæ‰€è°“çš„ bootle åŽ»ä¸‹è½½ (è¿™ä¸ª bootle çš„ URL æ˜¯ <a href="https://homebrew.bintray.com/ï¼Œå…¶å®žå°±æ˜¯é‡Œé¢æ‰˜ç®¡äº†éžå¸¸å¤šå¸¸è§çš„è½¯ä»¶çš„åŽ‹ç¼©åŒ…" target="_blank" rel="noopener">https://homebrew.bintray.com/ï¼Œå…¶å®žå°±æ˜¯é‡Œé¢æ‰˜ç®¡äº†éžå¸¸å¤šå¸¸è§çš„è½¯ä»¶çš„åŽ‹ç¼©åŒ…</a>) æˆ–è€…ä»Žè½¯ä»¶çš„å®˜ç½‘åŽ»ä¸‹è½½ã€‚å…·ä½“åœ¨å“ªé‡Œä¸‹è½½ï¼Œåˆ™æ˜¯æ ¹æ® formula çš„ ruby æè¿°æ–‡ä»¶ä¸­çš„æè¿°æ¥å®šçš„ã€‚</p><p>é‚£æœ‰æ²¡æœ‰ä¸Šé¢è¯´çš„è¿™ä¸ª bottle çš„é•œåƒä»¥ä¾¿å¯ä»¥å¿«é€Ÿä¸‹æ¥è½¯ä»¶å‘¢ï¼Ÿå½“ç„¶æœ‰ï¼ŒåŒæ ·æ˜¯æ¥è‡ªäºŽ USTC Mirror çš„ï¼Œåšæ³•å¾ˆç®€å•ï¼Œè®¾ç½®ä¸€ä¸ªçŽ¯å¢ƒå˜é‡ HOMEBREW_BOTTLE_DOMAINï¼Œå…¶å€¼ä¸º <a href="https://mirrors.ustc.edu.cn/homebrew-bottles" target="_blank" rel="noopener">https://mirrors.ustc.edu.cn/homebrew-bottles</a> å³å¯ã€‚</p><p>ä¸‹é¢æ˜¯è¿™ä¸€é€šä¿®æ”¹å¯¹åº”çš„å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡åˆ° homebrew/core å¯¹åº”çš„ git é¡¹ç›®ç›®å½• </span></span><br><span class="line"><span class="built_in">cd</span> $(brew --repo homebrew/core) </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¢ url </span></span><br><span class="line">git remote <span class="built_in">set</span>-url origin https://mirrors.ustc.edu.cn/homebrew-core.git </span><br><span class="line"></span><br><span class="line"><span class="comment"># same as previous </span></span><br><span class="line"><span class="built_in">cd</span> $(brew --repo caskroom/cask) </span><br><span class="line"></span><br><span class="line"><span class="comment"># same as previous </span></span><br><span class="line">git remote <span class="built_in">set</span>-url origin https://mirrors.ustc.edu.cn/homebrew-cask.git </span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ‘æ˜¯ä½¿ç”¨ zshï¼Œæ‰€ä»¥è¿½åŠ åˆ° .zshrc æœ«å°¾å°±å¯ä»¥ï¼Œå¦‚æžœæ˜¯ä½¿ç”¨ bashï¼Œåˆ™ä¸èƒ½è¿™æ · </span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles'</span> &gt;&gt; ~/.zshrc</span><br><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å¼€å§‹æ˜¯ brew çš„ä¸€äº›å¸¸ç”¨å‘½ä»¤å°ç»“ã€‚</p><p><strong>brew search \&lt;formulaName>:</strong></p><p>åœ¨å·²å®‰è£… tap ä¸­æŸ¥æ‰¾åŒ…ï¼Œæœç´¢åˆ°çš„ç»“æžœç±»ä¼¼å¦‚æžœä¸æ˜¯ homebrew/core è¿™ä¸ª tap ä¸­çš„ï¼Œå°†ä¼šä»¥ tapName/formulaName çš„å½¢å¼åˆ—å‡ºã€‚ä¾‹å¦‚ brew search git çš„ç»“æžœå¤§è‡´æ˜¯:</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bagit</span></span><br><span class="line"><span class="keyword">bash-git-prompt</span></span><br><span class="line"><span class="keyword">...</span></span><br><span class="line"><span class="keyword">git</span></span><br><span class="line"><span class="keyword">...</span></span><br><span class="line"><span class="keyword">caskroom/cask/git-it</span></span><br></pre></td></tr></table></figure><p><strong>brew install \&lt;formuaName>:</strong></p><p>å®‰è£…æŒ‡å®š formula çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå®‰è£…è·¯å¾„ä¸€èˆ¬æ˜¯ /usr/local/Cellar/<formulaname>/<versionnumber> ä¸­ï¼Œæ­¤å¤–ä¼šåœ¨ /usr/local/bin ä¸­å»ºç«‹æŒ‡å‘å¯æ‰§è¡Œæ–‡ä»¶çš„ç¬¦å·é“¾æŽ¥ï¼Œä»¥ä¾¿å‘½ä»¤è¡Œç›´æŽ¥è¿è¡Œã€‚</versionnumber></formulaname></p><p><strong>brew uninstall formulaName:</strong></p><p> å¸è½½æŒ‡å®š formulaï¼Œä¸è¿‡ä¸ä¼šåˆ é™¤å®‰è£…åŒ…æ–‡ä»¶ã€‚</p><p><strong> brew upgrade formulaName:</strong></p><p>å‡çº§æŒ‡å®šçš„ formula åˆ°æœ€æ–°ç‰ˆã€‚</p><p><strong>brew cleanup:</strong></p><p>åœ¨å®‰è£…äº†æ›´æ–°ç‰ˆæœ¬è½¯ä»¶åŒ…åŽï¼Œä»Ž /usr/local/Cellar åˆ é™¤æ—§ç‰ˆæœ¬çš„è½¯ä»¶åŒ…ã€‚æ²¡é”™ï¼Œå‡çº§æ—¶å¹¶ä¸æ˜¯è¦†ç›–å¼å®‰è£…ï¼Œè€Œæ˜¯åœ¨ /usr/local/Cellar/<formulaname> ä¸­å¤šäº†ä¸€ä¸ªæ›´é«˜ç‰ˆæœ¬å·çš„ç›®å½•ï¼Œç„¶åŽç¬¦å·é“¾æŽ¥æŒ‡å‘æ›´é«˜ç‰ˆæœ¬ç›®å½•ä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚æ‰€ä»¥ï¼Œå¦‚æžœä¸æƒ³è¦è¿™ç§å†—ä½™ï¼Œå°±å¯ä»¥ç”¨ brew cleanup æ¥æ¸…é™¤æ—§ç‰ˆæœ¬çš„ç›®å½•ã€‚</formulaname></p><p><strong>brew outdated:</strong></p><p>æŸ¥çœ‹å“ªäº› formula å¯ä»¥å‡çº§ã€‚</p><p><strong>brew info formulaName:</strong></p><p>æŸ¥çœ‹ formula çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ brew info git, brew info caskroom/cask/git-it ç­‰ã€‚</p><p><strong>brew update:</strong></p><p>æ›´æ–°æ‰€æœ‰ tap ä¸­çš„åŒ…ä¿¡æ¯ï¼Œå…¶å®žä¹Ÿå°±æ˜¯æŠŠæ¯ä¸ª tap å¯¹åº”çš„æœ¬åœ° git é¡¹ç›®æ›´æ–°åˆ°æœåŠ¡å™¨æœ€æ–°æäº¤ï¼Œä»¥ä¾¿å¯ä»¥æœç´¢åˆ°æœ€æ–°æ·»åŠ çš„åŒ…ä»¥åŠå·²æœ‰åŒ…çš„æœ€æ–°å‘å¸ƒä¿¡æ¯ã€‚</p><p><strong>brew list:</strong></p><p>åˆ—å‡ºå·²å®‰è£…çš„æ‰€æœ‰åŒ…ã€‚</p><h3 id="tap-çš„ç®¡ç†ï¼š"><a href="#tap-çš„ç®¡ç†ï¼š" class="headerlink" title="tap çš„ç®¡ç†ï¼š"></a>tap çš„ç®¡ç†ï¼š</h3><p><strong>brew tap tapName:</strong></p><p>æ–°å¢žä¸€ä¸ª tapã€‚</p><p><strong>brew untap tapName:</strong></p><p>ç§»é™¤ä¸€ä¸ª tapã€‚</p><p><strong>brew tap-info tapName:</strong></p><p>åˆ—å‡ºä¸€ä¸ª tap çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><p>æ›´å¤šæ“ä½œï¼Œå¯ä»¥å‚è€ƒ<a href="https://github.com/Homebrew/brew/blob/master/docs/Manpage.md" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ï¼Œå†…å®¹å¾ˆå…¨é¢ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Homebrew </tag>
            
            <tag> macOS </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>HomeBrew Cask åŠ å¿«ä¸‹è½½çš„è„šæœ¬</title>
      <link href="/2018/09/26/HomeBrew%20Cask%20%E5%8A%A0%E5%BF%AB%E4%B8%8B%E8%BD%BD%E7%9A%84%E8%84%9A%E6%9C%AC/"/>
      <url>/2018/09/26/HomeBrew%20Cask%20%E5%8A%A0%E5%BF%AB%E4%B8%8B%E8%BD%BD%E7%9A%84%E8%84%9A%E6%9C%AC/</url>
      <content type="html"><![CDATA[<p>Homebrew æ˜¯ä¸ªå¥½å·¥å…·ï¼Œé™¤äº†ç”¨å®ƒå®‰è£…å‘½ä»¤è¡Œè½¯ä»¶å¤–ï¼Œæˆ‘ä¹Ÿä¼šç”¨å®ƒæ¥å®‰è£… GUI è½¯ä»¶ã€‚è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯ Homebrew ä¼šç›´æŽ¥å¸®æˆ‘æŽ¥è¿žé“¾æŽ¥åˆ° GUI è½¯ä»¶çš„å¯æ‰§è¡Œæ–‡ä»¶çš„ç¬¦å·é“¾æŽ¥ï¼Œè¿™æ ·ï¼Œæˆ‘åœ¨ç»ˆç«¯ä½¿ç”¨ç¬¦å·é“¾æŽ¥ï¼Œå°±å¯ä»¥æ‰“ GUI è½¯ä»¶äº†ã€‚ä¾‹å¦‚ï¼ŒSublime Text çš„ç¬¦å·é“¾æŽ¥æ˜¯ sublï¼Œé‚£ä¹ˆåœ¨ç»ˆç«¯ä»»ä½•ç›®å½•ä¸­ï¼Œä¸€è¡Œ subl â€œnew text.txtâ€ å°±å¯ä»¥ç”¨ Sublime Text æ‰“å¼€new text.txtäº†ã€‚</p><p>é—®é¢˜æ˜¯ï¼Œbrew cask install xxx çš„ä¸‹è½½é€Ÿåº¦ç»å¸¸ä¼šéžå¸¸æ…¢ï¼Œè€Œæˆ‘æŠŠä¸‹è½½è½¯ä»¶åŒ…çš„ URL ç›´æŽ¥å¤åˆ¶åˆ° Chrome ä¸­åŽ»ä¸‹è½½ï¼Œåˆ™éžå¸¸å¿«ï¼Œè¿™å°±å¾ˆå°´å°¬äº†ã€‚ç»è¿‡ç¨å¾®æ£€æŸ¥ï¼Œæˆ‘å‘çŽ°brew cask install xxx è¿‡ç¨‹ä¸­ï¼Œä¼šåœ¨ Cache/Cask ç›®å½•(å…¶å®žå°±æ˜¯ brew â€“cacheå‘½ä»¤çš„ç»“æžœ)ä¸­ç”Ÿæˆä¸€ä¸ªç±»ä¼¼äºŽxxxâ€“v1.2.3.zip.incompleteè¿™æ ·çš„æ–‡ä»¶ã€‚äºŽæ˜¯æˆ‘æŠŠè‡ªå·±ç”¨ Chrome ä¸‹è½½çš„æ–‡ä»¶ï¼Œå¤åˆ¶åˆ° Cache/Cask ä¸­æ¥ï¼Œç„¶åŽæ›´åä¸º xxxâ€“v1.2.3.zipï¼Œä¹Ÿå°±æ˜¯æŠŠ .incomplete åŽ»æŽ‰ã€‚ç„¶åŽå† brew cask install xxxä¸€ä¸‹ï¼Œå‘çŽ° Homebrew æç¤ºè½¯ä»¶åŒ…å·²ç»ä¸‹è½½å¥½äº†ï¼ŒäºŽæ˜¯ç«‹åˆ»å¼€å§‹å®‰è£…äº†ã€‚</p><p>ä¸Šé¢è¿™æ ·çš„æ–¹å¼ç¡®å®žé¿å…äº†ä¸‹è½½æ…¢çš„é—®é¢˜ï¼Œä¸è¿‡è¿™æ ·æ‰‹åŠ¨æ“ä½œï¼Œæ€»æ˜¯ä¸é‚£ä¹ˆé«˜(yÇ’u)æ•ˆ(bÄ«)çŽ‡(gÃ©)ï¼Œæ‰€ä»¥æˆ‘å°±æƒ³è¦å†™ä¸ªå°è„šæœ¬æ¥è‡ªåŠ¨åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚æˆ‘é€‰æ‹©äº†ä½¿ç”¨ shell è„šæœ¬ã€‚æ­¤å¤„è¦åæ§½ä¸€ä¸‹ shell è„šæœ¬çš„è¯­æ³•ï¼Œéš¾è®°ï¼ŒçœŸçš„æ˜¯å¾ˆéš¾è®°(æ¯”å¦‚å­—ç¬¦ä¸²æ“ä½œ)ï¼æ¯”èµ·æ¥ï¼Œå‡ ä¹Žä»»ä½•ä¸€é—¨ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•éƒ½è¦å¥½è®°å¾—å¤šã€‚</p><p>åºŸè¯è¯´äº†å¾ˆå¤šäº†ï¼Œä¸‹é¢æ˜¯è„šæœ¬å†…å®¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$#</span>"</span> -eq <span class="string">"1"</span> ]; <span class="keyword">then</span> </span><br><span class="line">    <span class="comment"># æ‰¾åˆ°æœ¬åœ°æè¿°éœ€è¦å®‰è£…çš„è½¯ä»¶åŒ…çš„ ruby æ–‡ä»¶ </span></span><br><span class="line">    tap_path=`brew --repo caskroom/cask` </span><br><span class="line">    file_path=<span class="string">"<span class="variable">$&#123;tap_path&#125;</span>/Casks/<span class="variable">$&#123;1&#125;</span>.rb"</span> </span><br><span class="line">    <span class="keyword">if</span> [ -f <span class="string">"<span class="variable">$file_path</span>"</span> ]; <span class="keyword">then</span> </span><br><span class="line">        <span class="comment"># ä»Žé‡Œé¢è¯»å–ç‰ˆæœ¬ä¿¡æ¯ï¼Œä¸‹è½½çš„ URL </span></span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">read</span> key value; <span class="keyword">do</span> </span><br><span class="line">            <span class="keyword">if</span> [[ <span class="variable">$key</span> == <span class="string">"version"</span> ]]; <span class="keyword">then</span> </span><br><span class="line">                len=$((<span class="variable">$&#123;#value&#125;</span>-2)) </span><br><span class="line">                version=<span class="variable">$&#123;value:1:$&#123;len&#125;</span>&#125; </span><br><span class="line">            <span class="keyword">elif</span> [[ <span class="variable">$key</span> == <span class="string">"url"</span> ]]; <span class="keyword">then</span> </span><br><span class="line">                len=$((<span class="variable">$&#123;#value&#125;</span>-2)) </span><br><span class="line">                url=<span class="variable">$&#123;value:1:$&#123;len&#125;</span>&#125; </span><br><span class="line">                url=<span class="variable">$&#123;url/\#\&#123;version\&#125;</span>/<span class="variable">$version</span>&#125; </span><br><span class="line">                <span class="comment"># ä½¿ç”¨ Chrome æ¥ä¸‹è½½ </span></span><br><span class="line">                /Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome <span class="variable">$url</span> </span><br><span class="line">            <span class="keyword">fi</span> </span><br><span class="line">        <span class="keyword">done</span> &lt; <span class="variable">$file_path</span> </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Cask '<span class="variable">$1</span>' is unavailable: No Cask with this name exists."</span> </span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    cache_dir=`brew --cache`</span><br><span class="line">    downloaded_name=<span class="variable">$&#123;url##*/&#125;</span></span><br><span class="line">    target_name=<span class="variable">$1</span>--<span class="variable">$&#123;version&#125;</span>.<span class="variable">$&#123;downloaded_name##*.&#125;</span> </span><br><span class="line">    <span class="comment"># æ¯ä¸ªä¸‰ç§’é’Ÿæ£€æŸ¥ä¸€ä¸‹ä¸‹è½½å¥½äº†æ²¡ï¼Œå¥½äº†å°±æŠŠä¸‹è½½å¥½çš„æ–‡ä»¶ç§»åŠ¨åˆ° </span></span><br><span class="line">    <span class="comment"># Cache/Cask ä¸­ï¼Œå¹¶ä¸”æ”¹åä¸º Homebrew æƒ³è¦çš„æ–¹å¼ã€‚ </span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span> </span><br><span class="line">        <span class="keyword">if</span> [ -e ~/Downloads/<span class="variable">$downloaded_name</span> ]; <span class="keyword">then</span> </span><br><span class="line">            mv ~/Downloads/<span class="variable">$downloaded_name</span> <span class="variable">$cache_dir</span>/Cask/<span class="variable">$target_name</span> </span><br><span class="line">            <span class="comment"># å®‰è£… </span></span><br><span class="line">            brew cask install <span class="variable">$1</span> </span><br><span class="line">            <span class="built_in">break</span> </span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            sleep 3 </span><br><span class="line">        <span class="keyword">fi</span> </span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"usage: cask-install Cask-Name"</span> </span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Homebrew </tag>
            
            <tag> Shell </tag>
            
            <tag> macOS </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Android Touch äº‹ä»¶çš„ä¼ é€’ä¸Žå¤„ç†</title>
      <link href="/2018/09/26/Android%20Touch%20%E4%BA%8B%E4%BB%B6%E7%9A%84%E4%BC%A0%E9%80%92%E4%B8%8E%E5%A4%84%E7%90%86/"/>
      <url>/2018/09/26/Android%20Touch%20%E4%BA%8B%E4%BB%B6%E7%9A%84%E4%BC%A0%E9%80%92%E4%B8%8E%E5%A4%84%E7%90%86/</url>
      <content type="html"><![CDATA[<p>ä¸€ã€MotionEvent</p><p>MotionEvent æ˜¯ Android ç³»ç»Ÿä¸­æŠ¥å‘ŠåŠ¨ä½œè¾“å…¥ï¼ˆå¦‚è§¦æ‘¸å±å¹•ï¼Œæ»šåŠ¨çƒï¼Œé¼ æ ‡ï¼‰ç­‰äº‹ä»¶çš„ç±»ã€‚å…¶ä¸­æœ‰æ•´å½¢æ•°çš„ Action å’Œæè¿°äº‹ä»¶çš„å„ç§æµ®ç‚¹åž‹åæ ‡ã€‚MotionEvent çš„ action çš„æœ€ä½Žä¸€ä¸ªå­—èŠ‚ï¼Œå…¶å–å€¼æˆ‘ä»¬å¸¸è§çš„ ACTION_DOWN, MOVE, POINTER_DOWN, POINTER_UP, UP, CANCEL (åŽé¢å¯èƒ½ç®€ç§°ä¸º DOWN ç­‰ç­‰) è¿™äº›äº†ã€‚è™½ç„¶æˆ‘ä»¬å¯èƒ½ä¼šç²—æš´çš„ä½¿ç”¨ä¸‹é¢è¿™æ ·çš„æ–¹å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (event.getAction()) &#123;</span><br><span class="line">    <span class="keyword">case</span> MotionEvent.ActionDown:</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    ... </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å…¶å®žä¸Šé¢è¿™æ ·ä»…é€‚ç”¨äºŽå•ç‚¹è§¦æŽ§åœºæ™¯ï¼ŒåŽŸå› æ˜¯ getAction() æ–¹æ³•è¿”å›žçš„ç»“æžœä¸­ï¼Œæœ€ä½Žçš„1ä¸ªå­—èŠ‚æ‰å¯¹åº”ä¸Šé¢è¯´çš„ ACTION_DOWNï¼Œè€Œæ¬¡æœ€ä½Žä¸€ä¸ªå­—èŠ‚åˆ™è¡¨ç¤º PointerIndex (è¿™ä¸ªæ¦‚å¿µåŽé¢ä¼šæåˆ°)ï¼Œå¯¹äºŽå•ç‚¹è§¦æŽ§åœºæ™¯ï¼ŒPointerIndex å§‹ç»ˆä¸º0ï¼Œæ‰€ä»¥ä¸Šé¢çš„ä»£ç æ‰èƒ½è·‘é€šã€‚æ›´å¥½çš„æ–¹å¼ï¼Œå…¶å®žæ˜¯ä½¿ç”¨ getActionMasked() æ–¹æ³•ï¼Œæ­¤å¤„æŸ¥çœ‹æºç å³å¯éžå¸¸æ¸…æ™°ã€‚</p><p>å¯¹äºŽä¸€ä¸²è§¦æ‘¸äº‹ä»¶ï¼ˆæŒ‡æ‰‹æŽ¥è§¦åˆ°å±å¹•åˆ°æ‰‹å®Œå…¨ç¦»å¼€å±å¹•ï¼‰ï¼Œç”¨æˆ·ç¬¬ä¸€ä¸ªæ‰‹æŒ‡æŽ¥è§¦åˆ°å±å¹•æ—¶ï¼Œè§¦å‘ DOWN, æ‰‹æŒ‡åœ¨å±å¹•ä¸Šç§»åŠ¨æ—¶ï¼ŒæŒç»­è§¦å‘å‡ºå¾ˆå¤š MOVEï¼Œç¬¬äºŒä¸ªä»¥ä¸Šçš„æ‰‹æŒ‡è§¦æ‘¸åˆ°å±å¹•æ˜¯ï¼Œè§¦å‘ POINTER_DOWNï¼Œéžæœ€åŽä¸€ä¸ªç¦»å¼€å±å¹•çš„æ‰‹æŒ‡ç¦»å¼€å±å¹•æ—¶è§¦å‘ POINTER_UP, æœ€åŽä¸€ä¸ªæ‰‹æŒ‡ç¦»å¼€å±å¹•æ—¶ï¼Œè§¦å‘ UPã€‚</p><p>åœ¨ä¸€ä¸²è§¦æ‘¸äº‹ä»¶è¿‡ç¨‹ä¸­ï¼Œè§†å›¾ä»Ž window detach çš„è¯ï¼Œæˆ–è€… View çš„ PFLAG_CANCEL_NEXT_UP_EVENT æ ‡è®°ä½è®¾ç½®äº†æ—¶ï¼Œæˆ–è€… View æœ¬æ¥å¤„ç†äº†ä¸€ä¸ª Down äº‹ä»¶ä½†æ˜¯æŽ¥ä¸‹æ¥çš„ MOVE ç­‰äº‹ä»¶è¢« ViewGroup æ‹¦æˆªäº†ï¼Œå°†ä¼šè§¦å‘ CANCELã€‚å½“ç„¶ï¼Œåº”è¯¥è¿˜æœ‰åˆ«çš„è§¦å‘ CANCEL äº‹ä»¶çš„åœºæ™¯ã€‚ä¸‹å›¾æ˜¯ä¸€ä¸² Touch äº‹ä»¶çš„ä¾‹å­ï¼š</p><pre><code>Down â†’ Move â†’...â†’ Move â†’ PointerDown â†’ Move â†’...â†’ PointerUp â†’ Move â†’...â†’ Move â†’ Up</code></pre><p>MotionEvent ä¸­æœ‰ä¸ª Pointer çš„æ¦‚å¿µï¼ŒPointer å¤§è‡´è¡¨ç¤ºè§¦æ‘¸åˆ°å±å¹•çš„å„ä¸ªæ‰‹æŒ‡ã€‚getPointerCount() å³ä¸ºå¤šç‚¹è§¦æŽ§çš„ç‚¹æ•°ã€‚æ¯ä¸ª pointer éƒ½æœ‰ä¸€ä¸ª index (å–å€¼æ˜¯0åˆ°getPointerCount()-1)å’Œ idï¼ˆæœ€å¤§æ˜¯31ï¼Œæ„å‘³ç€ä¸€ä¸²è§¦æ‘¸äº‹ä»¶ä¸­ï¼Œæœ€å¤šå…è®¸æ‰‹æŒ‡æŽ¥è§¦å±å¹•32æ¬¡ï¼‰ï¼Œå‰è€…åœ¨ä¸€ä¸² Touch äº‹ä»¶ä¸­å¯èƒ½ä¼šå˜åŒ–ï¼Œè€ŒåŽè€…ä¿æŒä¸å˜ï¼Œä¾‹å¦‚å¤šç‚¹è§¦æŽ§æ—¶ï¼Œå¤§æ‹‡æŒ‡å¯¹åº”çš„ index æœ¬æ¥æ˜¯0ï¼ŒåŽé¢å¯èƒ½å˜æˆäº†1äº†. getPointerId(int pointerIndex)å’ŒfindPointerIndex(int pointerId)è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯ index å’Œ id é—´çš„ä¸€ä¸€æ˜ å°„ã€‚ é‚£ä¸ºä»€ä¹ˆè¦æœ‰ index å’Œ id ä¸¤ä¸ªä¸œè¥¿å‘¢ï¼Ÿ</p><p>index å’Œ id çš„åŒºåˆ«ã€‚ä¸¾ä¸ªä¾‹å­å°±æ¸…æ¥šäº†ã€‚å‡è®¾èµ·å§‹æ—¶ï¼Œå³æ‰‹çš„é£ŸæŒ‡ï¼Œä¸­æŒ‡ï¼Œæ— åæŒ‡ä¾æ¬¡å…ˆåŽè½åœ¨å±å¹•ä¸Šï¼Œé‚£ä¹ˆä¸‰ä¸ªæŒ‡å¤´çš„ index å’Œ id åˆ†åˆ«éƒ½æ˜¯ 0, 1, 2ã€‚æ­¤æ—¶æŠ¬èµ·ä¸­æŒ‡ï¼Œé‚£ä¹ˆé£ŸæŒ‡çš„ index å’Œ id ä¸å˜ï¼Œè€Œæ— åæŒ‡çš„ index å˜æˆ1ï¼Œid ä¾ç„¶æ˜¯2ã€‚å³ index æ€»æ˜¯ 0, 1, 2,â€¦, getPointerCount() - 1. è€Œ id åˆ™å¯èƒ½å¤§äºŽ getPointerCount(), å¦ä¸€é¢åˆ™æ˜¯ï¼Œpointer çš„ id åœ¨æ•´ä¸ªä¸€ä¸²è§¦æ‘¸äº‹ä»¶ä¸­ä¿æŒä¸å˜ã€‚</p><p>MotionEvent çš„ getX() ä¸Ž getX(int pointerIndex), å‰è€…ç­‰ä»·äºŽåŽè€…çš„ getX(0), getY ç±»ä¼¼. getPointerIdBits() è¿”å›žä¸€ä¸ªç±»ä¼¼äºŽæ ‡å¿—æ•°çš„ä¸œè¥¿ï¼Œå…¶äºŒè¿›åˆ¶ä»Žå³å‘å·¦æ•°ï¼Œç¬¬ i ä½ä¸º1è¡¨ç¤ºå­˜åœ¨ id æ˜¯ i çš„ pointerï¼Œæ­¤å¤„åº”çœ‹æºç ã€‚å¯ä»¥æƒ³è§æ­¤ç»“æžœçš„äºŒè¿›åˆ¶å½¢å¼ä¸­1çš„ä¸ªæ•°å³ä¸ºå¤šç‚¹è§¦æŽ§çš„ç‚¹æ•°ã€‚</p><p><img src="http://tao93.top/images/2018/09/01/1535807958.png" alt="pointer_id_bits"></p><p>äºŒã€Touch äº‹ä»¶çš„ç”Ÿæˆ</p><p>Touch äº‹ä»¶çš„æ ¹æºæ˜¯ä»Žç¡¬ä»¶è€Œæ¥ï¼Œè€Œ ViewRootImpl$ViewPostImeInputStage#processPointerEvent æ–¹æ³•æ˜¯ä¸€ä¸ªæ¯”è¾ƒåˆé€‚çš„å¼€å§‹è¿½è¸ª Touch äº‹ä»¶çš„èµ·ç‚¹ï¼Œæ­¤å¤„åº”çœ‹æºç ã€‚äº‹ä»¶å¦‚æžœæ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œæœ€ç»ˆå¯èƒ½å°†åœ¨ ViewRootImpl #finishInputEvent ä¸­å›žæ”¶æŽ‰(è¿™ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹)ã€‚Touch äº‹ä»¶çš„ä¼ é€’å †æ ˆ (æŒ‰è°ƒç”¨çš„é¡ºåºæŽ’åˆ—)ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">ViewRootImpl$</span><span class="bash">ViewPostImeInputStage<span class="comment">#processPointerEvent</span></span></span><br><span class="line"><span class="meta">View#</span><span class="bash">dispatchPointerEvent</span></span><br><span class="line"><span class="meta">DecorView#</span><span class="bash">dispatchTouchEvent</span></span><br><span class="line"><span class="meta">Activity#</span><span class="bash">dispatchTouchEvent</span></span><br><span class="line"><span class="meta">PhoneWindow#</span><span class="bash">superDispatchTouchEvent</span></span><br><span class="line"><span class="meta">DecorView#</span><span class="bash">superDispatchTouchEvent</span></span><br><span class="line"><span class="meta">ViewGroup#</span><span class="bash">dispatchTouchEvent</span></span><br></pre></td></tr></table></figure><p>Touch äº‹ä»¶ä¼ é€’åˆ°äº† ViewGroup çš„ dispatchTouchEvent æ–¹æ³•åŽï¼Œå°±å¼€å§‹æ˜¯æœ¬æ–‡è¦å…³æ³¨çš„ç„¦ç‚¹äº†ï¼Œå³ä¸€ä¸² Touch äº‹ä»¶åœ¨ View æ ‘ä¸Šæ˜¯å¦‚ä½•ä¼ é€’å’Œæ¶ˆè´¹çš„ã€‚</p><p>ä¸‰ã€ä¼ é€’å’Œå¤„ç† Touch äº‹ä»¶</p><p>ä¸‹é¢æ˜¯äº‹ä»¶ä¼ é€’å’Œå¤„ç†ä¸­æœ€é‡è¦çš„ 4 ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">View#</span><span class="bash">dispatchTouchEventï¼Œéž ViewGroup çš„ View æŽ¥å— Touch äº‹ä»¶çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸é‡è½½å®ƒã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="meta">View#</span><span class="bash">onTouchEventï¼ŒView(å« ViewGroup)è‡ªå·±å°è¯•åŽ»æ¶ˆè´¹ Touch äº‹ä»¶ï¼Œç»å¸¸ä¼šè¢«é‡è½½ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="meta">ViewGroup#</span><span class="bash">dispatchTouchEventï¼Œé‡è½½äº† View çš„åŒåæ–¹æ³•ï¼Œä½œä¸º ViewGroup æŽ¥å— Touch äº‹ä»¶ï¼Œæ­¤æ–¹æ³•ä¸­åŒ…å«ã€Œä¼ é€’ Touch äº‹ä»¶ç»™ childã€å’Œã€Œå°è¯•è‡ªå·±æ¶ˆè´¹ Touch äº‹ä»¶ã€è¿™æ ·ä¸¤ä¸ªåˆ†æ”¯é€»è¾‘ï¼Œä¸€èˆ¬ä¸é‡è½½å®ƒã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="meta">ViewGroup#</span><span class="bash">onInterceptTouchEventï¼ŒViewGroup åˆ¤æ–­è‡ªå·±è¦ä¸è¦æ‹¦æˆª Touch äº‹ä»¶çš„æ–¹æ³•ï¼Œæ‹¦æˆªæ„å‘³ç€è‡ªå·±å°è¯•æ¶ˆè´¹æ­¤äº‹ä»¶ï¼Œæœ‰æ—¶å€™è¢«é‡è½½ã€‚</span></span><br></pre></td></tr></table></figure><p><strong>ä¼ é€’:</strong></p><p>åœ¨ View æ ‘ä¸­ï¼ŒTouch äº‹ä»¶æ˜¯ç”± parent view ä¼ é€’ç»™ child View (child view ä¹Ÿå¯èƒ½æ˜¯ ViewGroup)çš„ã€‚åœ¨ä¸€ä¸² touch äº‹ä»¶ä¸­æ‰“å¤´çš„æ€»æ˜¯ DOWN äº‹ä»¶ï¼Œparent view é€šè¿‡è°ƒç”¨ child view çš„ dispatchTouchEventæ–¹æ³•æŠŠ DOWN äº‹ä»¶ä¼ é€’ç»™ child viewï¼Œè¿™å°±ç»™äº† child ä¸€ä¸ªæ¶ˆè´¹æ­¤äº‹ä»¶çš„æœºä¼šã€‚child çš„ dispatchTouchEvent æ–¹æ³•è¿”å›ž true çš„è¯ï¼Œå°±è¡¨ç¤º child æ¶ˆè´¹äº† DOWN äº‹ä»¶ï¼Œè¿”å›ž false å°±è¡¨ç¤ºä¸æ¶ˆè´¹ã€‚å¦‚æžœ child æ¶ˆè´¹äº† Down äº‹ä»¶ï¼Œé‚£ä¹ˆæœ€ç®€å•çš„æƒ…å†µå°±æ˜¯åŽç»­çš„ move ç­‰äº‹ä»¶éƒ½ä¼šé€šè¿‡è°ƒç”¨ child çš„ dispatchTouchEvent æ–¹æ³•ç›´æŽ¥äº¤ç»™æ­¤ childï¼Œä¸ç®¡å®ƒçš„ dispatchTouchEvent æ–¹æ³•è¿”å›žä»€ä¹ˆï¼›å¦‚æžœ child æ²¡æœ‰æ¶ˆè´¹ DOWN äº‹ä»¶ï¼Œé‚£ä¹ˆå•ç‚¹è§¦æŽ§æƒ…å½¢ä¸‹ï¼ŒåŽç»­çš„ move ç­‰äº‹ä»¶ä¸Žæ­¤ child å†ä¹Ÿæ— ç¼˜äº†ã€‚</p><p><strong>æ¶ˆè´¹ï¼š</strong></p><p>View(åŒ…æ‹¬ ViewGroup) æ¶ˆè´¹ Touch äº‹ä»¶ï¼Œåœ¨ä»£ç ä¸Šç­‰ä»·äºŽè°ƒç”¨å½“å‰ç±»çš„ onTouchEvent æ–¹æ³•ã€‚ç„¶åŽ ouTouchEvent çš„è¿”å›žç»“æžœä½œä¸ºæ˜¯å¦æ¶ˆè´¹äº†æ­¤äº‹ä»¶çš„ä¾æ®ã€‚</p><p><strong>æ‹¦æˆªï¼š</strong></p><p>æ‹¦æˆªæ˜¯æŒ‡ ViewGroup æœ‰æœºä¼šåœ¨æŠŠ touch äº‹ä»¶ dispatch ç»™ child å‰ï¼Œé€šè¿‡è°ƒç”¨è‡ªå·±çš„ onInterceptTouchEvent æ¥åˆ¤æ–­è¦ä¸è¦æŠŠ touch äº‹ä»¶æˆªä¸‹æ¥ç»™è‡ªå·±å°è¯•æ¶ˆè´¹ã€‚å¯¹äºŽ DOWN äº‹ä»¶ï¼ŒonInterceptTouchEvent æ€»æ˜¯ä¼šè¢«è°ƒç”¨ï¼›å¯¹äºŽå…¶ä»–äº‹ä»¶ï¼Œchild æœ‰æœºä¼šåœ¨ parent çš„onInterceptTouchEvent è¢«è°ƒç”¨ä¹‹å‰ï¼Œè¯·æ±‚ parent ä¸è¦æ‹¦æˆªï¼Œè¿™ä¸ªè¯·æ±‚å°±æ˜¯é€šè¿‡ child è°ƒç”¨ parent çš„ requestDisallowInterceptTouchEvent æ–¹æ³•æ¥å®žçŽ°çš„ã€‚</p><p><strong>DOWN äº‹ä»¶ï¼š</strong></p><p>DOWN äº‹ä»¶æ˜¯ä¸€ä¸² touch äº‹ä»¶çš„ç¬¬ä¸€ä¸ªäº‹ä»¶ï¼Œåœ¨ ViewGroup çš„ dispatchTouchEvent æ–¹æ³•ä¸­ï¼ŒæŽ¥åˆ°æ­¤äº‹ä»¶æ—¶ï¼Œé¦–å…ˆä¼šåšä¸€äº›æ¸…é™¤å·¥ä½œï¼Œç„¶åŽæ£€æŸ¥è‡ªå·±è¦ä¸è¦æ‹¦æˆªæ­¤äº‹ä»¶å’Œæ˜¯ä¸æ˜¯è¦è½¬ä¸º CANCEL äº‹ä»¶ã€‚å¦‚æžœä¸æ‹¦æˆªä¸”ä¸è½¬ä¸º CANCELï¼Œé‚£ä¹ˆæŒ¨ä¸ªæ£€æŸ¥ childï¼Œåœ¨æ°å½“çš„æ—¶å€™è°ƒç”¨ child çš„ dispatchTouchEvent æ¥çœ‹æœ‰æ²¡æœ‰ child ä¼šæ¶ˆè´¹æ­¤äº‹ä»¶ã€‚</p><p>ä¸Šé¢ 4 æ®µè¯ï¼Œç”¨ä¼ªä»£ç æ¥è¡¨ç¤ºï¼Œå¤§æ¦‚å°±æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewGroup</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> intercepted; <span class="comment">// æ‹¦æˆªå³ä¸æŠŠäº‹ä»¶ä¼ ç»™ child </span></span><br><span class="line">        <span class="keyword">boolean</span> handled = <span class="keyword">false</span>; <span class="comment">// View group æ˜¯å¦æ¶ˆè´¹äº†äº‹ä»¶ </span></span><br><span class="line">        <span class="keyword">if</span> (is DOWN || child ever comsumed previous event) &#123; </span><br><span class="line">            <span class="keyword">if</span> (! disallowIntercept) &#123; <span class="comment">// PS: å¯¹äºŽ DOWN å…¶å®ž disallowIntercept ä¸€å®šæ˜¯ false </span></span><br><span class="line">                intercepted = onInterceptTouchEvent(event); </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">                intercepted = <span class="keyword">false</span>; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">            intercepted = <span class="keyword">true</span>; </span><br><span class="line">        &#125; <span class="keyword">if</span> (! canceled &amp;&amp; !intercepted) &#123;</span><br><span class="line">            <span class="keyword">for</span> (View child : all children) &#123;</span><br><span class="line">                <span class="keyword">if</span> (! child able to consume event) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>; </span><br><span class="line">                &#125; <span class="keyword">if</span> (dispatchTransformedTouchEvent(event, child)) &#123; </span><br><span class="line">                    <span class="comment">// åšä¸€äº›è®°å½•å·¥ä½œï¼Œç„¶åŽ break </span></span><br><span class="line">                    <span class="keyword">break</span>; </span><br><span class="line">                &#125;</span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">// previous event æŒ‡è¿™ä¸€ä¸² touch äº‹ä»¶ä¸­åœ¨ event å‰é¢çš„é‚£äº› </span></span><br><span class="line">        <span class="keyword">if</span> (no child ever consumed previous event) &#123;</span><br><span class="line">            handled = <span class="keyword">super</span>.dispatchTransformedTouchEvent(event); </span><br><span class="line">            <span class="comment">// å°è¯•è‡ªè¡Œæ¶ˆè´¹ event </span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="comment">// å…¶å®žéž down äº‹ä»¶æ‰èƒ½èµ°åˆ°è¿™ä¸ª else åˆ†æ”¯ </span></span><br><span class="line">            <span class="keyword">for</span> (child : children who has consumed previous event) &#123;</span><br><span class="line">                <span class="keyword">if</span> (child.dispatchTouchEvent(event) </span><br><span class="line">                    handled = <span class="keyword">true</span>; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> handled; </span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> result = <span class="keyword">false</span>; </span><br><span class="line">        <span class="keyword">if</span> (mOnTouchListener != <span class="keyword">null</span> &amp;&amp; isEnabled &amp;&amp; mOnTouchListener.onTouch(<span class="keyword">this</span>, event)) &#123; </span><br><span class="line">            result = <span class="keyword">true</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">// onTouch ä¼˜äºŽ onTouchEvent æ¥ä»£è¡¨ View å°è¯•æ¶ˆè´¹ event </span></span><br><span class="line">        <span class="keyword">if</span> (! result &amp;&amp; onTouchEvent(event)) &#123; </span><br><span class="line">            result = <span class="keyword">true</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> result; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isEnabled()) &#123;</span><br><span class="line">            <span class="keyword">return</span> isClickable() || isLongClickable(); </span><br><span class="line">        &#125; <span class="keyword">if</span> (isClickable || isLongClickable) &#123; </span><br><span class="line">            ...</span><br><span class="line">            retrun <span class="keyword">true</span>; </span><br><span class="line">        &#125; retrun <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å„ä¸ªç±»å’Œæ–¹æ³•çš„è§’è‰²æè¿°å¦‚ä¸‹ï¼š</p><blockquote><p>ViewGroup#dispatchTouchEventï¼Œä»£è¡¨ ViewGroup æŽ¥å—äº‹ä»¶ï¼Œå¤„ç†æ‹¦æˆªé€»è¾‘ï¼Œå°è¯•åˆ†å‘äº‹ä»¶ç»™ childï¼Œè°ƒç”¨ View#dispatchTouchEventæ¥å°è¯•è‡ªè¡Œæ¶ˆè´¹ Touch äº‹ä»¶ã€‚è¿”å›žå€¼è¡¨ç¤ºè‡ªå·±è¿™é¢—å­æ ‘æœ‰æ²¡æœ‰æ¶ˆè´¹äº‹ä»¶ã€‚</p><p>View#dispatchTouchEvent ä»£è¡¨éž ViewGroup çš„ View æŽ¥å—äº‹ä»¶ï¼Œè°ƒç”¨çœŸæ­£å°è¯•æ¶ˆè´¹äº‹ä»¶çš„ä»£ç ï¼ˆonTouchEvent æˆ–è€… onTouch ä¹‹ç±»çš„æ–¹æ³•ï¼‰ã€‚è¿”å›žå€¼è¡¨ç¤ºè‡ªå·±æœ‰æ²¡æœ‰æ¶ˆè´¹äº‹ä»¶ã€‚</p><p>ViewGroup#onInterceptTouchEventï¼Œè¿”å›žå€¼è¡¨ç¤º ViewGroup è¦ä¸è¦æ‹¦æˆªäº‹ä»¶ã€‚</p><p>ViewGroup#requestDisallowInterceptï¼Œè¢« child æ¥è°ƒç”¨ï¼Œè¡¨ç¤ºè¯·æ±‚ parent ä¸è¦æ‹¦æˆªï¼Œè¿™ä¸ªè¯·æ±‚ä»…åœ¨éž DOWN äº‹ä»¶æœ‰æ•ˆï¼Œä¸”ä¼šé€’å½’å‘ä¸Šè°ƒç”¨æ‰€æœ‰ parent çš„åŒåæ–¹æ³•ã€‚</p><p>TouchTarget ç±»ï¼Œæ­¤ç±»åŒ…å«æ¶ˆè´¹è¿‡ Touch äº‹ä»¶çš„ child å’Œå®ƒæ¶ˆè´¹è¿‡å“ªäº› pointer çš„äº‹ä»¶è¿™äº›ä¿¡æ¯ï¼ŒTouchTarget å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚åœ¨ ViewGroup ä¸­ï¼Œå­˜æœ‰ä¸€ä¸ª TouchTarget é“¾è¡¨ï¼ŒéåŽ†æ­¤é“¾è¡¨ï¼Œå³å¯çŸ¥é“ä¸€ä¸ª pointer æ˜¯å¦å·²æœ‰äº‹ä»¶è¢«æŸä¸ª child å¤„ç†è¿‡ã€‚</p></blockquote><p>ä»¥ä¸Šçš„ä»‹ç»ï¼Œå…¶å®žæ˜¯çœç•¥äº†ä¸å°‘ä¿¡æ¯ï¼ŒçœŸæ­£çš„äº‹ä»¶åˆ†å‘è¿‡ç¨‹ï¼Œè¦æ›´å¤æ‚ä¸å°‘ï¼Œä¸‹é¢æ˜¯æˆ‘å°è¯•ç”»çš„ä¸€å¼ æµç¨‹å›¾ (æŠŠå›¾å’Œæºç å¯¹ç…§ç€ç†è§£å¯èƒ½ä¼šæœ‰äº›å¸®åŠ©)ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535809116.png" alt=""></p><p>å¯¹äºŽä¸Šå›¾ï¼Œæœ‰ä¸€äº›éœ€è¦è§£é‡Šçš„åœ°æ–¹ï¼š</p><ol><li><p>TouchTarget æŒæœ‰ä¸€ä¸ª child Viewï¼Œå’Œæ­¤ child View æ›¾æ¶ˆè´¹è¿‡ Down æˆ–è€… pointerDown äº‹ä»¶çš„é‚£äº› Pointer çš„ idï¼Œè¿™äº› pointer id æ˜¯ä»¥ id bits çš„å½¢å¼å­˜å‚¨ä¸ºä¸€ä¸ªæ•´æ•°çš„ã€‚</p></li><li><p>TouchTarget é“¾è¡¨çš„å¤´ç»“ç‚¹æ˜¯ç”± mFirstTouchTarget å¼•ç”¨çš„ã€‚åœ¨ä¸€ä¸²äº‹ä»¶ç»“æŸ(å¤„ç†å®Œ UP)åŽï¼Œæ­£å¸¸æƒ…å†µé“¾è¡¨åº”è¯¥æ¸…ç©ºï¼Œåœ¨ä¸€ä¸² Touch äº‹ä»¶åˆ°æ¥å‰(å¤„ç† Down å‰)ä¹Ÿä¼šæ¸…ç©ºï¼Œç®—æ˜¯è¡¥åˆ€ã€‚</p></li><li><p>é“¾è¡¨çš„æ„ä¹‰æ˜¯ï¼Œå­˜å‚¨ child æ›¾ç»æ¶ˆè´¹è¿‡æŸäº› pointer çš„ Down æˆ–è€… PointerDown äº‹ä»¶è¿™ç§ä¿¡æ¯ã€‚å½“ä¸€ä¸ª Pointer ç»“æŸäº†ï¼ˆæ‰‹æŒ‡å¤´ç¦»å¼€å±å¹•ï¼‰ï¼Œé‚£ä¹ˆæ‰€æœ‰æ¶ˆè´¹è¿‡å®ƒçš„ Down æˆ–è€… PointerDown äº‹ä»¶çš„ TouchTarget éƒ½éœ€è¦ç§»é™¤æŽ‰å®ƒçš„ idï¼Œäº‹å®žä¸Šï¼Œè¿™ä¸€ä¸² touch äº‹ä»¶ä¸­å†ä¹Ÿä¸ä¼šæœ‰è¿™ä¸ª id äº†ï¼›å¦‚æžœä¸€ä¸ª TouchTarget çš„ pointer idç§»é™¤å…‰äº†ï¼Œé‚£ä¹ˆæ„å‘³ç€æ­¤ TouchTarget æŒæœ‰çš„ child æ²¡æœ‰æ¶ˆè´¹è¿‡ä»»æ„(çŽ°å­˜)çš„ pointer çš„ Down æˆ–è€… PointerDownï¼ŒäºŽæ˜¯å¯ä»¥æŠŠæ­¤ TouchTarget ä»Žé“¾è¡¨ç§»é™¤äº†ã€‚</p></li><li><p>æ¯æ¬¡ä¸€ä¸ª Down æˆ–è€… PointerDown äº‹ä»¶ ev åˆ°æ¥æ—¶ï¼Œå¯¹äºŽ ViewGroup çš„æ¯ä¸ª child xï¼Œè‹¥ ev çš„åæ ‡è½åœ¨ x çš„èŒƒå›´å†…(å¦åˆ™å°± continueï¼Œè€ƒè™‘ä¸‹ä¸€ä¸ª child)ï¼Œè¿›ä¸€æ­¥ã€Œå¦‚æžœ x åœ¨é“¾è¡¨ä¸­(è¯´æ˜Ž x æ¶ˆè´¹è¿‡ Down æˆ–è€… pointerDown äº‹ä»¶)ï¼Œé‚£ä¹ˆ x å°±æ˜¯è¦è¢«åˆ†å‘çš„ childï¼›å¦åˆ™å¦‚æžœ x.dispatchTouchEvent(ev) è¿”å›ž true äº†ï¼Œé‚£ä¹ˆ x åŒæ ·æ˜¯è¦è¢«åˆ†å‘çš„ childï¼Œè™½ç„¶æ­¤æ—¶åˆ†å‘å·²ç»ç»“æŸäº†ã€ã€‚</p></li><li><p>æ¯ä¸ª move äº‹ä»¶ ev åˆ°æ¥æ—¶ï¼Œé“¾è¡¨ä¸ºç©ºçš„è¯ï¼Œæ˜¾ç„¶æ²¡æœ‰ child æ¶ˆè´¹è¿‡ down æˆ–è€… pointerDownï¼Œé‚£ä¹ˆç›´æŽ¥è®© viewGroup å¤„ç† ev å°±å¥½äº†ã€‚é“¾è¡¨ä¸ä¸ºç©ºçš„è¯ï¼Œå¯¹äºŽé“¾è¡¨çš„æ¯ä¸ª TouchTarget t æŒæœ‰çš„ child xï¼šå¦‚æžœè½¬æˆäº† cancel äº‹ä»¶ï¼Œé‚£ä¹ˆå‘ x åˆ†å‘ä¸€ä¸ª cancel äº‹ä»¶ï¼Œå¦å¤–æŠŠ t ä»Žé“¾è¡¨ç§»é™¤(ç§»é™¤çš„åŽŸå› æ˜¯ï¼Œä¾‹å¦‚ x æ­£åœ¨ detachingï¼Œæ‰€ä»¥æ‰å¼•å‘ cancelï¼Œé‚£ä¹ˆå½“ç„¶éœ€è¦æŠŠæŒæœ‰ x çš„ t ç§»é™¤)ï¼Œç„¶åŽ overï¼Œå³ move äº‹ä»¶ä¸¢å¤±äº†ï¼›æ²¡è½¬æˆ cancelï¼Œé‚£å°±æ£€æŸ¥ t çš„ idBits ä¸­æœ‰æ²¡æœ‰ ev çš„ä»»æ„ä¸€ä¸ª pointer çš„ idï¼Œæœ‰åˆ™æŠŠ ev äº¤ç»™ xï¼Œæ²¡æœ‰åˆ™ continueã€‚</p></li></ol><p>å››ã€æºç åˆ†æž</p><p>ä¸‹é¢ç²˜è´´ä¸€å¤§æ®µåŠ ä¸Šäº†æˆ‘çš„ç†è§£ä½œä¸ºæ³¨é‡Šçš„æºç ï¼Œä»£ç çœŸçš„å¾ˆé•¿å¾ˆé•¿ï¼Œè¿™è¿˜ä»…ä»…æ˜¯ ViewGroup#dispatchTouchEvent è¿™ä¸€ä¸ªæ–¹æ³•çš„ä»£ç ã€‚å…³äºŽå¤šç‚¹è§¦æŽ§çš„å¤„ç†é€»è¾‘ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰å½»åº•æ˜Žç™½ï¼Œsighã€‚ã€‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> handled = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">// è‹¥å½“å‰ç±»ä¸Šé¢è¦†ç›–äº†å…¶ä»–window, ä¸” ev çš„flagå·²æ ‡è®°è¿‡æ»¤ã€Œè¦†ç›–ã€æƒ…å†µä¸‹çš„äº‹ä»¶ï¼Œåˆ™ç›´æŽ¥è·³è¿‡</span></span><br><span class="line">    <span class="keyword">if</span> (onFilterTouchEventForSecurity(ev)) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> action = ev.getAction();</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> actionMasked = action &amp; MotionEvent.ACTION_MASK;</span><br><span class="line">        <span class="comment">// Handle an initial down.</span></span><br><span class="line">        <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">            <span class="comment">// Throw away all previous state when starting a new touch gesture.</span></span><br><span class="line">            <span class="comment">// The framework may have dropped the up or cancel event for the previous gesture</span></span><br><span class="line">            <span class="comment">// due to an app switch, ANR, or some other state change.</span></span><br><span class="line">            cancelAndClearTouchTargets(ev); <span class="comment">//å¦‚é“¾è¡¨éžç©º, å‘å…¶ä¸­æ‰€æœ‰ touchTarget æŒæœ‰çš„ child å‘ cancel äº‹ä»¶, å¹¶æ¸…ç©ºé“¾è¡¨</span></span><br><span class="line">            resetTouchState(); <span class="comment">// reset æ­¤ ViewGroup çš„ CANCEL_NEXT_UP å’Œ DISALLOW_INTERCEPT</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Check for interception.</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> intercepted;</span><br><span class="line">        <span class="comment">// down äº‹ä»¶, æˆ–è€…é“¾è¡¨ä¸ç©º(æ„æ€æ˜¯æ›¾æœ‰ down äº‹ä»¶è¢«æŸä¸ª child æ¶ˆè´¹è¿‡)æ—¶, è€ƒè™‘æ‹¦æˆª</span></span><br><span class="line">        <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN</span><br><span class="line">                || mFirstTouchTarget != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// å‰é¢çš„ resetTouchState() ä½¿å¾— disallowIntercept å¿…å®šæ˜¯ false</span></span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">boolean</span> disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (!disallowIntercept) &#123;</span><br><span class="line">                intercepted = onInterceptTouchEvent(ev);</span><br><span class="line">                ev.setAction(action); <span class="comment">// restore action in case it was changed</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                intercepted = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// å…¶ä»–æƒ…å†µ, ä¸ç”¨æŠŠäº‹ä»¶äº¤ç»™ä»»ä½• child, æ‰€ä»¥ç›´æŽ¥èµ‹å€¼ intercepted = true</span></span><br><span class="line">            <span class="comment">// There are no touch targets and this action is not an initial down</span></span><br><span class="line">            <span class="comment">// so this view group continues to intercept touches.</span></span><br><span class="line">            intercepted = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Check for cancelation.</span></span><br><span class="line">        <span class="comment">// æ­¤ ViewGroup æœ‰ cancel_next_up æ ‡å¿—, é‚£ä¹ˆå°±è½¬æˆ cancel äº‹ä»¶</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> canceled = resetCancelNextUpFlag(<span class="keyword">this</span>)</span><br><span class="line">                || actionMasked == MotionEvent.ACTION_CANCEL;</span><br><span class="line">        <span class="comment">// Update list of touch targets for pointer down, if needed.</span></span><br><span class="line">        <span class="comment">// API 11 ä»¥ä¸Š, split å¿…ä¸º true</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> split = (mGroupFlags &amp; FLAG_SPLIT_MOTION_EVENTS) != <span class="number">0</span>;</span><br><span class="line">        TouchTarget newTouchTarget = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">// æ ‡è®° down/pointerDown è¢«æŸä¸ª child æ¶ˆè´¹</span></span><br><span class="line">        <span class="keyword">boolean</span> alreadyDispatchedToNewTouchTarget = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (!canceled &amp;&amp; !intercepted) &#123;</span><br><span class="line">            <span class="comment">// down/pointerDown æ‰å¯»æ±‚ child æ¥æŽ¥ç›˜, å…¶ä½™ç±»åž‹çš„äº‹ä»¶éƒ½æ˜¯è°æ¶ˆè´¹äº† down/pointerDown å°±äº¤ç»™è°</span></span><br><span class="line">            <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN</span><br><span class="line">                    || (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_DOWN)</span><br><span class="line">                    || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123;</span><br><span class="line">                <span class="comment">// å¾—åˆ° ev å½“å‰ action æ‰€æ‰€å±žçš„ pointer çš„ index</span></span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> actionIndex = ev.getActionIndex(); <span class="comment">// always 0 for down</span></span><br><span class="line">                <span class="comment">// idBitsToAssign åŒ…å«ä¸€ä¸ª id, å³ ev æ‰€å±ž pointer çš„ id</span></span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> idBitsToAssign = split ? <span class="number">1</span> &lt;&lt; ev.getPointerId(actionIndex)</span><br><span class="line">                        : TouchTarget.ALL_POINTER_IDS;</span><br><span class="line">                <span class="comment">// Clean up earlier touch targets for this pointer id in case they</span></span><br><span class="line">                <span class="comment">// have become out of sync.</span></span><br><span class="line">                <span class="comment">// down/pointerDown æ„å‘³ç€æ–°çš„ pointer, æ¸…é™¤ä¸€ä¸‹é“¾è¡¨ä¸­å’Œæ–° pointer çš„ id ä¹‹é—´çš„ç“œè‘›</span></span><br><span class="line">                removePointersFromTouchTargets(idBitsToAssign);</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> childrenCount = mChildrenCount;</span><br><span class="line">                <span class="keyword">if</span> (newTouchTarget == <span class="keyword">null</span> &amp;&amp; childrenCount != <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">float</span> x = ev.getX(actionIndex);</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">float</span> y = ev.getY(actionIndex);</span><br><span class="line">                    <span class="comment">// Find a child that can receive the event.</span></span><br><span class="line">                    <span class="comment">// Scan children from front to back.</span></span><br><span class="line">                    <span class="keyword">final</span> ArrayList&lt;View&gt; preorderedList = buildTouchDispatchChildList();</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">boolean</span> customOrder = preorderedList == <span class="keyword">null</span></span><br><span class="line">                            &amp;&amp; isChildrenDrawingOrderEnabled();</span><br><span class="line">                    <span class="keyword">final</span> View[] children = mChildren;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = childrenCount - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">                        <span class="keyword">final</span> <span class="keyword">int</span> childIndex = getAndVerifyPreorderedIndex(</span><br><span class="line">                                childrenCount, i, customOrder);</span><br><span class="line">                        <span class="keyword">final</span> View child = getAndVerifyPreorderedView(</span><br><span class="line">                                preorderedList, children, childIndex);</span><br><span class="line">                        </span><br><span class="line">                        <span class="comment">// ä¸èƒ½æŽ¥å—æˆ–è€…æ˜¯ ev åæ ‡ä¸åœ¨ child å†…éƒ¨åˆ™ continue</span></span><br><span class="line">                        <span class="keyword">if</span> (!canViewReceivePointerEvents(child)</span><br><span class="line">                                || !isTransformedTouchPointInView(x, y, child, <span class="keyword">null</span>)) &#123;</span><br><span class="line">                            ev.setTargetAccessibilityFocus(<span class="keyword">false</span>);</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        newTouchTarget = getTouchTarget(child);</span><br><span class="line">                        <span class="keyword">if</span> (newTouchTarget != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            <span class="comment">// è¯´æ˜Ž ev è½åœ¨ child å†…éƒ¨ä¸” child ä»¥å‰å“åº”è¿‡ down/pointerDown, é‚£ä¹ˆç”± child æ¥æŽ¥ç›˜, æ•… break</span></span><br><span class="line">                            <span class="comment">// å¦‚æžœ ev æ˜¯ Down äº‹ä»¶, åˆ—è¡¨å°šç©º, åˆ™èµ°ä¸åˆ°è¿™é‡Œæ¥</span></span><br><span class="line">                            <span class="comment">// Child is already receiving touch within its bounds.</span></span><br><span class="line">                            <span class="comment">// Give it the new pointer in addition to the ones it is handling.</span></span><br><span class="line">                            <span class="comment">// child æ‰€å±ž TouchTarget å¯èƒ½å¢žåŠ ä¸€ä¸ª pointer id</span></span><br><span class="line">                            newTouchTarget.pointerIdBits |= idBitsToAssign;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        resetCancelNextUpFlag(child);</span><br><span class="line">                        <span class="comment">// å°è¯•è®© child æ¶ˆè´¹ ev</span></span><br><span class="line">                        <span class="keyword">if</span> (dispatchTransformedTouchEvent(ev, <span class="keyword">false</span>, child, idBitsToAssign)) &#123;</span><br><span class="line">                            <span class="comment">// Child wants to receive touch within its bounds.</span></span><br><span class="line">                            mLastTouchDownTime = ev.getDownTime();</span><br><span class="line">                            <span class="keyword">if</span> (preorderedList != <span class="keyword">null</span>) &#123;</span><br><span class="line">                                <span class="comment">// childIndex points into presorted list, find original index</span></span><br><span class="line">                                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; childrenCount; j++) &#123;</span><br><span class="line">                                    <span class="keyword">if</span> (children[childIndex] == mChildren[j]) &#123;</span><br><span class="line">                                        mLastTouchDownIndex = j;</span><br><span class="line">                                        <span class="keyword">break</span>;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                mLastTouchDownIndex = childIndex;</span><br><span class="line">                            &#125;</span><br><span class="line">                            mLastTouchDownX = ev.getX();</span><br><span class="line">                            mLastTouchDownY = ev.getY();</span><br><span class="line">                            <span class="comment">// æ¶ˆè´¹æˆåŠŸçš„è¯, ç”¨ child æ–°å»º TouchTarget, æ’åˆ°é“¾è¡¨å¤´éƒ¨,</span></span><br><span class="line">                            newTouchTarget = addTouchTarget(child, idBitsToAssign);</span><br><span class="line">                            alreadyDispatchedToNewTouchTarget = <span class="keyword">true</span>;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// The accessibility focus didn't handle the event, so clear</span></span><br><span class="line">                        <span class="comment">// the flag and do a normal dispatch to all children.</span></span><br><span class="line">                        ev.setTargetAccessibilityFocus(<span class="keyword">false</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (preorderedList != <span class="keyword">null</span>) preorderedList.clear();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (newTouchTarget == <span class="keyword">null</span> &amp;&amp; mFirstTouchTarget != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// æ²¡æ‰¾åˆ°æŽ¥ç›˜çš„, ä¸”é“¾è¡¨ä¸ç©º(æ„æ€æ˜¯æœ‰ Down/pointerDown è¢« child View æ¶ˆè´¹è¿‡)</span></span><br><span class="line">                    <span class="comment">// Did not find a child to receive the event.</span></span><br><span class="line">                    <span class="comment">// Assign the pointer to the least recently added target.</span></span><br><span class="line">                    <span class="comment">// å¼ºè¡Œè®©é“¾è¡¨æœ«å°¾èŠ‚ç‚¹æŒæœ‰çš„ child æ¥æŽ¥ç›˜</span></span><br><span class="line">                    newTouchTarget = mFirstTouchTarget;</span><br><span class="line">                    <span class="keyword">while</span> (newTouchTarget.next != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        newTouchTarget = newTouchTarget.next;</span><br><span class="line">                    &#125;</span><br><span class="line">                    newTouchTarget.pointerIdBits |= idBitsToAssign;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Dispatch to touch targets.</span></span><br><span class="line">        <span class="keyword">if</span> (mFirstTouchTarget == <span class="keyword">null</span>) &#123; <span class="comment">// child view åŽ‹æ ¹æ²¡æœ‰æ¶ˆè´¹è¿‡äº‹ä»¶</span></span><br><span class="line">            <span class="comment">// No touch targets so treat this as an ordinary view.</span></span><br><span class="line">            <span class="comment">// view group å°è¯•è‡ªè¡Œæ¶ˆè´¹</span></span><br><span class="line">            handled = dispatchTransformedTouchEvent(ev, canceled, <span class="keyword">null</span>,</span><br><span class="line">                    TouchTarget.ALL_POINTER_IDS);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Dispatch to touch targets, excluding the new touch target if we already</span></span><br><span class="line">            <span class="comment">// dispatched to it.  Cancel touch targets if necessary.</span></span><br><span class="line">            TouchTarget predecessor = <span class="keyword">null</span>;</span><br><span class="line">            TouchTarget target = mFirstTouchTarget;</span><br><span class="line">            <span class="comment">// éåŽ†é“¾è¡¨</span></span><br><span class="line">            <span class="keyword">while</span> (target != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">final</span> TouchTarget next = target.next;</span><br><span class="line">                <span class="keyword">if</span> (alreadyDispatchedToNewTouchTarget &amp;&amp; target == newTouchTarget) &#123;</span><br><span class="line">                    <span class="comment">// ev æ˜¯ Down æˆ–è€… pointer Down ä¸”å®ƒè¢« target æŒæœ‰çš„ child æ¶ˆè´¹äº†</span></span><br><span class="line">                    handled = <span class="keyword">true</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123; <span class="comment">// å¯¹äºŽå…¶ä»–çš„ Touch target</span></span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">boolean</span> cancelChild = resetCancelNextUpFlag(target.child)</span><br><span class="line">                            || intercepted;</span><br><span class="line">                    <span class="comment">// å‘é€ cancel æˆ–è€… ev ç»™ child, æˆ–è€…å•¥ä¹Ÿä¸åš(target çš„ idBits æ²¡æœ‰ ev ä¸­ä»»æ„çš„ pointer çš„ id)</span></span><br><span class="line">                    <span class="keyword">if</span> (dispatchTransformedTouchEvent(ev, cancelChild,</span><br><span class="line">                            target.child, target.pointerIdBits)) &#123;</span><br><span class="line">                        handled = <span class="keyword">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (cancelChild) &#123; <span class="comment">// æ”¶åˆ° cancel åŽ,child å°±ä¸è¯¥å†æ”¶åˆ°äº‹ä»¶äº†, å¯¹åº”çš„ TouchTarget ä¹Ÿè¦ç§»é™¤</span></span><br><span class="line">                        <span class="keyword">if</span> (predecessor == <span class="keyword">null</span>) &#123;</span><br><span class="line">                            mFirstTouchTarget = next;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            predecessor.next = next;</span><br><span class="line">                        &#125;</span><br><span class="line">                        target.recycle();</span><br><span class="line">                        target = next;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                predecessor = target;</span><br><span class="line">                target = next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Update list of touch targets for pointer up or cancel, if needed.</span></span><br><span class="line">        <span class="keyword">if</span> (canceled</span><br><span class="line">                || actionMasked == MotionEvent.ACTION_UP</span><br><span class="line">                || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123;</span><br><span class="line">            resetTouchState(); <span class="comment">// up äº‹ä»¶åŽ,è¿™ä¸€ä¸² Touch äº‹ä»¶å°±ç»“æŸäº†, æ¸…ç†é“¾è¡¨ç­‰</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_UP) &#123;</span><br><span class="line">            <span class="comment">// æŸä¸ª pointer æ²¡äº†, é‚£ä¹ˆæ¸…ç©ºé“¾è¡¨ä¸­å’Œè¿™ä¸ª pointer çš„ç“œè‘›</span></span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> actionIndex = ev.getActionIndex();</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> idBitsToRemove = <span class="number">1</span> &lt;&lt; ev.getPointerId(actionIndex);</span><br><span class="line">            removePointersFromTouchTargets(idBitsToRemove);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!handled &amp;&amp; mInputEventConsistencyVerifier != <span class="keyword">null</span>) &#123;</span><br><span class="line">        mInputEventConsistencyVerifier.onUnhandledEvent(ev, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> handled;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº”ã€æ»‘åŠ¨å†²çªåˆ†æžç¤ºä¾‹</p><p>åœ¨ã€Šå®‰å“å¼€å‘è‰ºæœ¯æŽ¢ç´¢ã€‹ä¸€ä¹¦ä¸­è®² touch äº‹ä»¶çš„æœ€åŽï¼Œè®²äº†æ»‘åŠ¨å†²çªçš„è§£å†³æ–¹æ³•ã€‚æ‰€è°“æ»‘åŠ¨å†²çªæœ€ç®€å•çš„æƒ…å½¢å°±æ˜¯ä¸€ä¸ªæ°´å¹³æ»‘åŠ¨çš„ ScrollView é‡Œé¢æ”¾ä¸€ä¸ªç«–ç›´æ»‘åŠ¨çš„ listViewï¼Œä¸¤è€…æ»‘åŠ¨æ–¹å‘ä¸åŒï¼Œå³ä¸ºæ»‘åŠ¨å†²çªã€‚å¯¹äºŽè¿™ä¸ªæƒ…å½¢ï¼Œè§£å†³æ»‘åŠ¨å†²çªï¼Œå…¶å®žå°±æ˜¯åœ¨æ‰‹æŒ‡ä¸Šä¸‹æ»‘æ—¶å§ move äº‹ä»¶ç»™ childï¼ˆlistViewï¼‰å¤„ç†ï¼Œè€Œæ‰‹æŒ‡å·¦å³æ»‘åŠ¨æ—¶ç»™ parent å¤„ç†ï¼ˆScrollViewï¼‰å³å¯ã€‚ä¸‹é¢æ˜¯ä¹¦ä¸­çš„ä¸€ç§è§£å†³æ–¹å¼ï¼Œä½¿ç”¨ä¸Šé¢è®²çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬å¯ä»¥é€å½»çš„åˆ†æžè¿™ç§è§£å†³æ–¹å¼ã€‚</p><p>ä¸‹é¢æ˜¯ã€Šå®‰å“å¼€å‘è‰ºæœ¯æŽ¢ç´¢ã€‹ä¸­æä¾›çš„å…¶ä¸­ä¸€ç§è§£å†³æ–¹æ³•ï¼Œæˆ‘åŠ å…¥äº†æ¯”è¾ƒè¯¦ç»†çš„æ³¨é‡Šä½œä¸ºè§£é‡Šï¼Œåœ¨å‰é¢çš„åŸºç¡€ä¸Šï¼Œè¿™ç§è§£å†³æ–¹æ³•çš„é€»è¾‘å°±å¾ˆæ˜Žç¡®äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChildView</span> <span class="keyword">extends</span> <span class="title">android</span>.<span class="title">view</span>.<span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        ViewParent parent = getParent();</span><br><span class="line">        <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">switch</span> (event.getActionMasked()) &#123;</span><br><span class="line">                <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                    <span class="comment">// æ­¤æ¬¡è¯·æ±‚å…¶å®žåœ¨ Down äº‹ä»¶åŽçš„é¦–ä¸ª Move ä¼ è‡³ parent ä¸­æ—¶ç”Ÿæ•ˆ</span></span><br><span class="line">                    <span class="comment">// è‹¥ä¸è¯·æ±‚ï¼Œåˆ™å°†ä¼šå‘ç”Ÿæ‹¦æˆªï¼ŒåŽç»­äº‹ä»¶éƒ½å’Œ child æ— ç¼˜ï¼Œæ‰€ä»¥å¿…é¡»è¯·æ±‚åˆ«æ‹¦æˆª</span></span><br><span class="line">                    parent.requestDisallowInterceptTouchEvent(<span class="keyword">true</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">                    <span class="comment">// å¦‚æžœæœŸæœ› parent æ¥å¤„ç†ï¼Œé‚£ä¹ˆè§£é™¤è¯·æ±‚ï¼Œåˆ™ä¸‹ä¸€æ¬¡ Move äº‹ä»¶æ—¶å¿…å®šæ‹¦æˆªï¼ŒåŽç»­äº‹ä»¶å°±å…¨éƒ¨äº¤ç»™ parent äº†ã€‚</span></span><br><span class="line">                    <span class="comment">// å¦åˆ™ï¼Œä»€ä¹ˆä¹Ÿä¸åšï¼Œå³äº‹ä»¶ä¼šç»§ç»­æºæºä¸æ–­çš„äº¤ç»™ child</span></span><br><span class="line">                    <span class="keyword">if</span> (parent should handle event)&#123;</span><br><span class="line">                        parent.requestDisallowInterceptTouchEvent(<span class="keyword">false</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParentView</span> <span class="keyword">extends</span> <span class="title">ViewGroup</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Down æ—¶ï¼Œå¿…ç„¶è°ƒæ­¤æ–¹æ³•ï¼Œæ­¤æ—¶ä¸åº”æ‹¦æˆªï¼Œå¦åˆ™ child æ°¸è¿œæ— æ³•å¤„ç† move äº‹ä»¶</span></span><br><span class="line">        <span class="comment">// å…¶ä»–äº‹ä»¶æ—¶ï¼Œè‹¥ child è¯·æ±‚ä¸æ‹¦æˆªï¼Œé‚£ä¹ˆåŽé¢çš„äº‹ä»¶éƒ½äº¤ç»™ child äº†ï¼›å¦åˆ™ï¼Œå°±ä¼š</span></span><br><span class="line">        <span class="comment">// è°ƒç”¨æ­¤æ–¹æ³•ï¼Œæ­¤æ–¹æ³•è¿™æ—¶è¿”å›ž True å³è¡¨ç¤ºæ‹¦æˆªï¼Œé‚£ä¹ˆä¼šå‘ä¸€ä¸ª cancel ç»™ childï¼ŒåŽç»­çš„äº‹ä»¶å°±å’Œ child æ— ç¼˜äº†</span></span><br><span class="line">        <span class="keyword">return</span> ev.getActionMasked() != MotionEvent.ACTION_DOWN;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°æ­¤ï¼Œè¿™ç¯‡é•¿é•¿çš„ã€å¹¶ä¸å®Œç¾Žçš„åˆ†æžä¹Ÿå°±ç»“æŸäº†ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Android ImageView ScaleType</title>
      <link href="/2018/09/26/Android%20ImageView%20ScaleType/"/>
      <url>/2018/09/26/Android%20ImageView%20ScaleType/</url>
      <content type="html"><![CDATA[<p>æˆ‘ç»å¸¸è®°ä¸ä½ Android ä¸­ ImageView çš„å„ç§ ScaleType çš„å«ä¹‰ï¼Œçœ‹æ–‡æ¡£ä¸€æ—¶ä¹Ÿç¡®å®šä¸äº†ï¼Œæ‰€ä»¥å¹²è„†æŠŠæ‰€æœ‰ ScaleType æŒ¨ä¸ªå°è¯•äº†ä¸€éï¼Œç„¶åŽæ¸…æ¥šçš„è®°å½•ä¸‹æ¥ï¼Œä»¥å¤‡ä»ŠåŽæŸ¥é˜…ã€‚</p><p><strong>CEMTER</strong></p><p>å›¾ç‰‡å¤§å°ä¸åšä»»ä½•ç¼©æ”¾ï¼Œä»…ä»…æŠŠå›¾ç‰‡ä¸­å¿ƒå’Œè§†å›¾ä¸­å¿ƒé‡åˆã€‚å¯èƒ½å›¾ç‰‡å°äºŽè§†å›¾æ¡†ï¼Œä¹Ÿå¯èƒ½åè¿‡æ¥ã€‚</p><p><strong>CENTER_CROP</strong></p><p>å°†å›¾ç‰‡æ”¾å¤§æˆ–è€…ç¼©å°ï¼Œç›´åˆ°è§†å›¾æ¡†è¢«å¸ƒæ»¡ï¼Œä¸”å›¾ç‰‡çš„ä¸¤ä¸ªè¾¹ç¼˜æˆ–è€…æ‰€æœ‰è¾¹ç¼˜å’Œè§†å›¾æ¡†çš„å¯¹åº”è¾¹ç¼˜é‡åˆã€‚</p><p><strong>CENTER_INSIDE</strong></p><p>å¯èƒ½å°†å›¾ç‰‡ç¼©å°ï¼Œä½†æ˜¯ä¸ä¼šæ”¾å¤§ï¼Œç›®æ ‡æ˜¯æŠŠå›¾ç‰‡æ”¾ç½®åœ¨è§†å›¾æ¡†ä¹‹å†…ï¼Œä¸èƒ½æœ‰éœ²åœ¨å¤–é¢çš„ï¼Œå›¾ç‰‡ä¸­å¿ƒå’Œè§†å›¾æ¡†ä¸­å¿ƒé‡åˆã€‚</p><p><strong>FIT_CENTER</strong></p><p>å›¾ç‰‡å¯èƒ½æ”¾å¤§ä¹Ÿå¯èƒ½ç¼©å°ï¼Œç›®æ ‡æ˜¯è®©å›¾ç‰‡åœ¨æ˜¯å›¾æ¡†å†…éƒ¨ï¼Œä¸”å›¾ç‰‡å æ®æœ€å¤§çš„å¯ç”¨ç©ºé—´ï¼Œå›¾ç‰‡ä¸­å¿ƒå’Œè§†å›¾æ¡†ä¸­å¿ƒé‡åˆã€‚</p><p><strong>FIT_START</strong></p><p>ç±»ä¼¼äºŽ fit_center åªä¸è¿‡å›¾ç‰‡ä¸­å¿ƒå¯èƒ½å’Œè§†å›¾æ¡†ä¸­å¿ƒä¸é‡åˆï¼Œè€Œæ˜¯å›¾ç‰‡å¤„åœ¨è§†å›¾æ¡†çš„ä¸Šä¾§æˆ–è€…å·¦ä¾§ã€‚</p><p><strong>FIT_END</strong></p><p>ç±»ä¼¼äºŽ fit_center åªä¸è¿‡å›¾ç‰‡ä¸­å¿ƒå¯èƒ½å’Œè§†å›¾æ¡†ä¸­å¿ƒä¸é‡åˆï¼Œè€Œæ˜¯å›¾ç‰‡å¤„åœ¨è§†å›¾æ¡†çš„ä¸‹ä¾§æˆ–è€…å³ä¾§ã€‚</p><p><strong>FIT_XY</strong></p><p>å›¾ç‰‡å¯èƒ½ä¼šè¢«æ‹‰ä¼¸ï¼Œæ•ˆæžœæ˜¯å›¾ç‰‡çš„å››ä¸ªè¾¹ç¼˜å’Œè§†å›¾æ¡†çš„å››ä¸ªè¾¹ç¼˜æ— æ¡ä»¶é‡åˆã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
