<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>Don&#39;t let Your App Drain your Users&#39; Battery</title>
      <link href="/2018/10/10/Don&#39;t%20let%20Your%20App%20Drain%20your%20Users&#39;%20Battery/"/>
      <url>/2018/10/10/Don&#39;t%20let%20Your%20App%20Drain%20your%20Users&#39;%20Battery/</url>
      <content type="html"><![CDATA[<h3 id="What-drives-battery-Life"><a href="#What-drives-battery-Life" class="headerlink" title="What drives battery Life?"></a>What drives battery Life?</h3><ol><li>Hardware (Screen etc.)</li><li>Operating System</li><li>Apps &amp; Services</li><li>User Interaction</li></ol><h3 id="Efforts-to-improve-battery"><a href="#Efforts-to-improve-battery" class="headerlink" title="Efforts to improve battery"></a>Efforts to improve battery</h3><ol><li><a href="https://developer.android.google.cn/reference/android/app/job/JobScheduler" target="_blank" rel="noopener">Job Scheduler</a> (Since API 21)</li><li>Doze &amp; App Standby(Since API 23)</li><li>Doze on-the-go (Since API 24)</li><li>Background Limits (Since API 26)</li><li>Adaptive Battery, Background Restrictions etc. (Since API 28)</li></ol><p>Among the above <strong>only Job Scheduler</strong> could be directly leveraged by app developers in the code.</p><h4 id="Job-Scheduler-Since-API-21"><a href="#Job-Scheduler-Since-API-21" class="headerlink" title="Job Scheduler (Since API 21)"></a>Job Scheduler (Since API 21)</h4><p>Job Scheduler is suitable when we want to do something in a specified circumstance, such as:</p><blockquote><p>Batterry is not Low</p><p>With specified Netwoek Status</p><p>Is Charging</p><p>Storage is not Low</p><p>Device is Idle</p></blockquote><p>Without Job Scheduler, we may need to keep a service running to monitor specified system broadcast and then do what we want, which is not optimized for battery comparing to Job Scheduler. </p><p>Here is a simple example of Job Scheduler:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyJobService</span> <span class="keyword">extends</span> <span class="title">JobService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onStartJob</span><span class="params">(<span class="keyword">final</span> JobParameters params)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> AsyncTask&lt;Void, Void, Void&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> Void <span class="title">doInBackground</span><span class="params">(Void... voids)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// stuffs that consumes a lot of time like making a backup to the cloud</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPostExecute</span><span class="params">(Void aVoid)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// tell scheduler our job is done</span></span><br><span class="line">                jobFinished(params, <span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.execute();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// return true to tell scheduler our job is not finished.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onStopJob</span><span class="params">(JobParameters params)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> sJobId = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> JobScheduler mJobScheduler;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        mJobScheduler = (JobScheduler)getSystemService(Context.JOB_SCHEDULER_SERVICE);</span><br><span class="line"></span><br><span class="line">        findViewById(R.id.schedule_btn).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                scheduleAJob();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scheduleAJob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (JobInfo info : mJobScheduler.getAllPendingJobs()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (info.getId() == sJobId) &#123;</span><br><span class="line">                <span class="comment">// the last scheduled job is not finished yet</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// build the jobInfo that requires charging, idle and network that won't charge.</span></span><br><span class="line">        JobInfo jobInfo = <span class="keyword">new</span> JobInfo.Builder(++ sJobId, <span class="keyword">new</span> ComponentName(<span class="keyword">this</span>, MyJobService.class))</span><br><span class="line">                .setRequiresCharging(<span class="keyword">true</span>)</span><br><span class="line">                .setRequiresDeviceIdle(<span class="keyword">true</span>)</span><br><span class="line">                .setRequiredNetworkType(JobInfo.NETWORK_TYPE_UNMETERED)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        mJobScheduler.schedule(jobInfo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Doze-Since-API-23"><a href="#Doze-Since-API-23" class="headerlink" title="Doze (Since API 23)"></a>Doze (Since API 23)</h4><p>Unplugged and stationary for a period of time, a device would be in doze mode, which restricts all apps regardless whether they targets api 23. However, the OS periodically exits Doze for a brief time to let apps complete their deferred jobs. The bried time slot is called Maintenance window. Below is a figure showing the mode changing:</p><p><img src="http://tao93.top/images/2018/10/10/1539151703.png" alt=""></p><p>In doze mode, the following are restricted:</p><ol><li>Network access is suspended</li><li>WakeLock is ignored</li><li>Standard AlarmManager alarms (setExact() and setWindow()) are deferred to the next maintenance window</li><li>No Wi-Fi scaning</li><li>No <a href="https://developer.android.com/reference/android/content/AbstractThreadedSyncAdapter.html" target="_blank" rel="noopener">Sync Adapters</a></li><li>No JobScheduler jobs</li></ol><p>Stuffs not restricted by Doze:</p><ol><li>FCM high priority msg</li><li>Alarms set with setAndAllowWhileIdle() and setExactAndAllowWhileIdle()</li></ol><p>Testing Doze:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># if your device is connected with a cable, use the following to disable charging</span></span><br><span class="line">adb shell dumpsys battery unplug</span><br><span class="line"></span><br><span class="line"><span class="comment"># Force the system into Doze mode</span></span><br><span class="line">adb shell dumpsys deviceidle force-idle</span><br><span class="line"></span><br><span class="line"><span class="comment"># exit idle mode &amp; reactivate the device</span></span><br><span class="line">adb shell dumpsys deviceidle unforce</span><br><span class="line">adb shell dumpsys battery reset <span class="comment"># this also recovers charging</span></span><br></pre></td></tr></table></figure><h4 id="App-Standby-Since-API-23"><a href="#App-Standby-Since-API-23" class="headerlink" title="App Standby (Since API 23)"></a>App Standby (Since API 23)</h4><p>An app is idle if the followings are satisfies:</p><ol><li>No user touching for a certain period of time</li><li>No processes in the foreground (either as an activity or foreground service)</li><li>No notifications showing on the lock screen or in the notification center.</li><li>Not charging</li></ol><p>Testing App Standby:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># if your device is connected with a cable, use the following to disable charging</span></span><br><span class="line">adb shell dumpsys battery unplug</span><br><span class="line"></span><br><span class="line"><span class="comment"># check whether your app is in standby mode. A 'Idle=false' output means not in standby mode</span></span><br><span class="line">adb shell am get-inactive &lt;packageName&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Force the app into App Standby mode</span></span><br><span class="line">adb shell am <span class="built_in">set</span>-inactive &lt;packageName&gt; <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># exit Standby mode for your app</span></span><br><span class="line">adb shell am <span class="built_in">set</span>-inactive &lt;packageName&gt; <span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="Doze-on-the-go-Since-API-24"><a href="#Doze-on-the-go-Since-API-24" class="headerlink" title="Doze on-the-go (Since API 24)"></a>Doze on-the-go (Since API 24)</h3><p>A lighter Doze mode which activates when the phone is moving in our pockets or hands. Doze on-the-go allows WakeLock, Wifi Scaning and GPS etc, thatâ€™s why itâ€™s lighter than former Doze mode introduced in API 23.</p><p>Ignore Doze configuration:</p><p><img src="http://tao93.top/images/2018/10/10/1539154768.png" alt=""></p><h4 id="Background-Limits-Since-API-26"><a href="#Background-Limits-Since-API-26" class="headerlink" title="Background Limits (Since API 26)"></a>Background Limits (Since API 26)</h4><p>Background Limits affects apps that targets API 26 or higher and includes Background Service Limitations and Broadcast Limitations.</p><h5 id="Background-Service-Limitations"><a href="#Background-Service-Limitations" class="headerlink" title="Background Service Limitations"></a>Background Service Limitations</h5><p>For an app that targets API 26 or higher, itâ€™s in background if:</p><ol><li>No visible Activity</li><li>No foreground Service</li><li>Not InputMethod Service, Wallpaper service etc.</li></ol><p>After several minutes of being in background, background services are stopped by the OS. Replacing background services with Scheduler Jobs is fine in many cases.</p><h5 id="Broadcast-Limitations-Introduced-in-API-25-and-strengthened-in-API-26"><a href="#Broadcast-Limitations-Introduced-in-API-25-and-strengthened-in-API-26" class="headerlink" title="Broadcast Limitations (Introduced in API 25 and strengthened in API 26)"></a>Broadcast Limitations (Introduced in API 25 and strengthened in API 26)</h5><p>For an app that targets API 26 or higher, it:</p><ol><li>canâ€™t register receivers for implicit broadcasts in Manifest file</li><li>can register receivers for explicit broadcasts in Manifest file</li><li>can register receivers for any broadcasts runtimely</li></ol><p>Broadcasts that require a <a href="https://developer.android.com/guide/topics/manifest/permission-element.html#plevel" target="_blank" rel="noopener">signature permission</a> are exempted from this restriction.</p><p>In some cases, registering system broadcasts could be replaced by Scheduler Jobs, such as if we want to do something when the device is charging.</p><h3 id="Adaptive-Battery-Since-API-29"><a href="#Adaptive-Battery-Since-API-29" class="headerlink" title="Adaptive Battery (Since API 29)"></a>Adaptive Battery (Since API 29)</h3><p>A new feature based on Machine Learning.</p><ol><li>Limit battery for apps that are not used often.</li><li>Apps should be able to run quickly when they are needed.</li><li>Donâ€™t bother users to manage manually.</li></ol><p>Apps are arranged into 4 standby buckets: <code>Active</code>, <code>Working set</code>, <code>Frequent</code> and <code>Rare</code>. Limits are increased from <code>Active</code> to <code>Rare</code>:</p><p><img src="http://tao93.top/images/2018/10/10/1539157914.png" alt=""></p><p>An app is in <code>Active</code> if it:</p><ol><li>has launched an activity</li><li>is running a foreground service</li><li>has a sync adapter associated with a content provider used by a foreground app</li><li>has a notification clicked by the user</li></ol><p>An app is in <code>Working set</code> if it runs often but isnâ€™t active.</p><p>An app is in <code>Frequent</code> if it is used regularly, but not necessarily every day.</p><p>An app is in <code>Rare</code> if it is not often used.</p><p>Find out what bucket the app is currently in programmatically:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UsageStatsManager.getAppStandbyBucket()</span><br></pre></td></tr></table></figure><p>Test Standby Buckets:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># assgin your app into a specified bucket</span></span><br><span class="line">adb shell am <span class="built_in">set</span>-standby-bucket &lt;packagename&gt; active|working_set|frequent|rare</span><br><span class="line"></span><br><span class="line"><span class="comment"># check bucket assignments for one app or all apps</span></span><br><span class="line"><span class="comment"># the output '10 20 30 40' mean Active, Working set, Frequent, Rare respectively</span></span><br><span class="line">adb shell am get-standby-bucket [&lt;packagename&gt;]</span><br></pre></td></tr></table></figure><h3 id="Battery-Saver"><a href="#Battery-Saver" class="headerlink" title="Battery Saver"></a>Battery Saver</h3><p>New battery saver in API 29:</p><ol><li>No red status bar and has animation</li><li>Location service is off when screen is off</li><li>Battery level threshold is adjustable</li></ol><p>Apps are encouraged to switch to dark theme when battery saver is on.</p><p>Check whether battery saver is on programmatically:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((PowerManager)getSystemService(Context.POWER_SERVICE)).isPowerSaveMode()</span><br></pre></td></tr></table></figure><p>Test battery saver:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pretend to be in low battery status</span></span><br><span class="line">adb shell settings put global low_power 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># reset all configurations</span></span><br><span class="line">adb shell dumpsys battery reset</span><br></pre></td></tr></table></figure><h3 id="Background-Restrictions-Since-API-29"><a href="#Background-Restrictions-Since-API-29" class="headerlink" title="Background Restrictions (Since API 29)"></a>Background Restrictions (Since API 29)</h3><p>Two criterias:</p><ol><li>Apps targeting pre-Oreo and using background services</li><li>Excessive WakeLocks (&gt; 1hr in background)</li></ol><p>Background restrictions are decided by the users:</p><p><img src="http://tao93.top/images/2018/10/10/1539156945.png" alt=""></p><p>When Background Restrictions is enabled for an app, fllowings are restricted:</p><ol><li>Background jobs, alarms, services and network accessing</li><li>Location related updates </li><li>Foreground services</li></ol><p>Except GUI operation, Background restrictions could alse be finished via adb:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># enable background restrictions</span></span><br><span class="line">adb shell appops <span class="built_in">set</span> &lt;package_name&gt; RUN_ANY_IN_BACKGROUND ignore</span><br><span class="line"></span><br><span class="line"><span class="comment"># disable background restrictions</span></span><br><span class="line">adb shell appops <span class="built_in">set</span> &lt;package_name&gt; RUN_ANY_IN_BACKGROUND allow</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>é€šè¿‡ wifi è¿æ¥ adb</title>
      <link href="/2018/09/26/%E9%80%9A%E8%BF%87%20wifi%20%E8%BF%9E%E6%8E%A5%20adb/"/>
      <url>/2018/09/26/%E9%80%9A%E8%BF%87%20wifi%20%E8%BF%9E%E6%8E%A5%20adb/</url>
      <content type="html"><![CDATA[<p>Android è°ƒè¯•æœ‰ä¸ªè®©äººä¸å¼€å¿ƒçš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯å¦‚æœç”¨çœŸæœºè°ƒè¯•ï¼Œéœ€è¦ç”¨æ•°æ®çº¿è¿æ¥åˆ° Android è®¾å¤‡ï¼Œè€Œå¯¹äº type C æ¥å£çš„ MacBookï¼Œå¦‚æœæ²¡æœ‰åŒç«¯ type C æ•°æ®çº¿ï¼Œé‚£ä¹ˆè¿˜å¾—ç”¨è½¬æ¥å™¨æ‰è¡Œã€‚ç›¸æ¯”è¾ƒçœŸæœºè°ƒè¯•ï¼Œå…¶å®è¿˜å¯ä»¥ç”¨æ¨¡æ‹Ÿå™¨ï¼Œä¸è¿‡æ¨¡æ‹Ÿå™¨åªèƒ½æ”¯æŒ x86 ç±»å‹çš„ native åº“ï¼Œå¹¶ä¸”ä¹Ÿè¿˜ä¼šæœ‰ä¸€äº›å…¶ä»–å±€é™æ€§ã€‚</p><p>å…¶å®ï¼ŒçœŸæœºä¹Ÿæ˜¯å¯ä»¥ç”¨å±€åŸŸç½‘æ— çº¿è¿æ¥çš„ï¼Œåªéœ€è¦ç”µè„‘å’Œ Android è®¾å¤‡åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…ã€‚å¤§è‡´æ­¥éª¤å°±æ˜¯ä¸‹é¢å‡ æ¡å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…ˆç”¨æ•°æ®çº¿è¿æ¥ï¼Œç¡®ä¿ adb devices å¯ä»¥çœ‹åˆ°è®¾å¤‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®© adb server é‡æ–°ä»¥ tcp æ¨¡å¼å¯åŠ¨ï¼Œç«¯å£æŒ‡å®šä¸º 5555</span></span><br><span class="line">adb tcpip 5555</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”µè„‘å’Œæ‰‹æœºä¹‹é—´å»ºç«‹æ— çº¿è¿æ¥</span></span><br><span class="line">adb connect &lt;IP address of your Computer&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹”æ‰æ•°æ®çº¿ï¼Œæ­¤æ—¶å†æ£€æŸ¥ä¸€éæ˜¯å¦æ— çº¿è¿æ¥æˆåŠŸ</span></span><br><span class="line">adb devices</span><br></pre></td></tr></table></figure><p>æ¯æ¬¡éƒ½æƒ³ä¸Šé¢è¿™æ ·æ‰§è¡Œä¸¤ä¸‰æ¡å‘½ä»¤æ˜¾ç„¶å¤ªç¹æ‚ï¼Œå°¤å…¶æ˜¯å…¶ä¸­è¿˜æœ‰ä¸€æ­¥è¦æ›¿æ¢ä¸ºç”µè„‘çš„å½“å‰å†…ç½‘ IPï¼Œæ‰€ä»¥åº”è¯¥å†™ä¸€ä¸ªè„šæœ¬æ¥æŠŠä¸Šé¢çš„ä¸œè¥¿ä¸€é”®æå®šï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ˆæ–­å¼€ä¸€ä¸‹</span></span><br><span class="line">adb disconnect</span><br><span class="line"></span><br><span class="line">adb tcpip 5555</span><br><span class="line"></span><br><span class="line"><span class="comment"># sleep ä¸¤ç§’ï¼Œä¸ç„¶çš„è¯å› ä¸ºåˆšæ‰§è¡Œ adb tcpip 5555 é‚£ä¹ˆåç»­çš„å‘½ä»¤ä¼šæ‰¾ä¸åˆ° devices</span></span><br><span class="line">sleep 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥æ˜¯å¦å®‰è£…äº†é»‘åŸŸ</span></span><br><span class="line">adb shell pm list packages | grep <span class="string">'me\.piebridge\.brevent'</span></span><br><span class="line">has_brevent=$?</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$has_brevent</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="comment"># é‡æ–°å¯åŠ¨é»‘é˜ˆ</span></span><br><span class="line">    adb -d shell sh /data/data/me.piebridge.brevent/brevent.sh</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å– android è®¾å¤‡çš„ IP åœ°å€</span></span><br><span class="line">android_ip=`adb shell <span class="string">"ifconfig"</span> | grep <span class="string">'inet.*cast'</span> | awk <span class="string">'&#123;print $2&#125;'</span> | awk -F<span class="string">':'</span> <span class="string">'&#123;print $2&#125;'</span>`</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'Android device IP: '</span> <span class="variable">$android_ip</span></span><br><span class="line">adb connect <span class="variable">$android_ip</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„è„šæœ¬ä¸­ï¼Œä¼šæ£€æŸ¥æ˜¯å¦å®‰è£…äº†<a href="https://play.google.com/store/apps/details?id=me.piebridge.brevent&amp;hl=zh" target="_blank" rel="noopener">é»‘é˜ˆ</a>ï¼Œå¦‚æœå®‰è£…äº†ï¼Œå°±ä¼šé‡æ–°å¯åŠ¨é»‘é˜ˆã€‚é»‘é˜ˆæ˜¯ä¸€æ¬¾ç®¡ç† Android åº”ç”¨è¿è¡ŒçŠ¶æ€çš„åº”ç”¨ï¼Œç”¨æ¥é™åˆ¶åº”ç”¨å”¤é†’å’Œå¸¸é©»åå°ã€‚Android 8.0 ä»¥ä¸Šçš„ç³»ç»Ÿï¼Œåªè¦ USB è°ƒè¯•é€‰é¡¹å‘ç”Ÿå˜æ›´ï¼Œé»‘é˜ˆå°±ä¼šåœæ­¢èµ·ä½œç”¨ï¼Œæ‰€ä»¥æ­¤å¤„éœ€è¦é‡æ–°è®©å®ƒè¿è¡Œèµ·æ¥ã€‚å¦å¤–ä¸Šé¢çš„è„šæœ¬ä¸­è¿˜é€šè¿‡ ifconfig å‘½ä»¤æ¥è·å–åˆ°ç”µè„‘çš„å†…ç½‘ IPï¼Œç”¨äºæ‰§è¡Œ adb connect å‘½ä»¤ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> adb </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>è®°ä¸€æ¬¡æ··æ·†é—®é¢˜å¯¼è‡´çš„ bug</title>
      <link href="/2018/09/26/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B7%E6%B7%86%E9%97%AE%E9%A2%98%E5%AF%BC%E8%87%B4%E7%9A%84%20bug/"/>
      <url>/2018/09/26/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B7%E6%B7%86%E9%97%AE%E9%A2%98%E5%AF%BC%E8%87%B4%E7%9A%84%20bug/</url>
      <content type="html"><![CDATA[<p>æœ€è¿‘æŠŠ <a href="https://github.com/card-io/card.io-Android-SDK" target="_blank" rel="noopener">Card.IO</a> æ”¹é€ æˆä¸€ä¸ª aar ä¾èµ–æä¾›ç»™å…¬å¸çš„é¡¹ç›®ä½¿ç”¨ã€‚è¿™ä¸ª aar ä¸­ä½¿ç”¨äº†å‡ ä¸ª so åº“ã€‚åªä¸è¿‡æ²¡æœ‰æä¾› armeabi ç±»å‹çš„ so åº“ï¼Œè€Œåªæœ‰ armeabi-v7a å’Œ armeabi-v8a ä¹‹ç±»çš„ so åº“ã€‚æ‰€ä»¥åˆæ¬¡æä¾›ç»™å…¬å¸é¡¹ç›®ä½¿ç”¨æ—¶ï¼Œå‡ºç°äº†æ‰¾ä¸åˆ° so çš„é”™è¯¯ï¼Œä¹Ÿå°±æ˜¯ UnsatisfiedLinkError é”™è¯¯ã€‚ä¹Ÿå°±æ˜¯ä¸‹é¢è¿™æ ·çš„æç¤ºï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535807292.png" alt=""></p><p>åé¢æˆ‘æƒ³å°½åŠæ³•æä¾›äº† armeabi ç±»å‹çš„ so åº“ï¼Œè¿™ä¸ªé—®é¢˜å°±ç®—å‘Šä¸€æ®µè½äº†ï¼Œç„¶åè¿™è¿˜ä¸æ˜¯ç»“æŸã€‚ä»Šå¤©ï¼Œæµ‹è¯•åˆå‘äº†ä¸€æ®µå´©æºƒæ—¥å¿—ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢è¿™æ ·çš„æ—¥å¿—ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535807316.png" alt=""></p><p>å› ä¸ºä¹‹å‰å‡ºç°è¿‡æ‰¾ä¸åˆ° so åº“çš„é—®é¢˜ï¼Œæ‰€ä»¥ä¹ä¸€çœ‹ä¸Šé¢çš„æ—¥å¿—ï¼Œæˆ‘ä»¬éƒ½ä»¥ä¸ºåˆæ˜¯æ‰¾ä¸åˆ° so åº“ (ä¸ºæˆ‘ä»¬çš„èœè¡¨ç¤ºç¾æ„§ ğŸ¤©)ã€‚ç„¶åç»è¿‡ä¸Šç½‘æŸ¥æ‰¾ï¼Œå¹¶å’Œ native çš„ä»£ç å¯¹æ¯”ï¼Œæˆ‘æ‰æ„è¯†åˆ°ï¼Œä¸Šé¢çš„æ—¥å¿—å…¶å®æ˜¯ so åº“æ˜¯æ‰¾åˆ°äº†çš„ï¼Œåªä¸è¿‡æ˜¯åŠ è½½ so åº“æ—¶ï¼Œè°ƒç”¨ JNI_onLoad è¿™ä¸ª native æ–¹æ³•æ—¶å‡ºé”™äº†ã€‚æ­¤å¤–ï¼Œå‘æµ‹è¯•è¦äº† debug åŒ…ï¼Œå‘ç°æ²¡æœ‰é—®é¢˜ï¼Œæ‰€ä»¥åˆæ­¥æ–­å®šæ˜¯æ··æ·†çš„é—®é¢˜ï¼Œç„¶åå°±æ˜¯æ’æŸ¥äº†ã€‚</p><p>æˆ‘æŠŠæµ‹è¯•æä¾›ç»™æˆ‘çš„ release åŒ…åç¼–è¯‘ï¼Œç„¶åå’Œ JNI_onLoad æ–¹æ³•ä¸­çš„ native ä»£ç å¯¹æ¯”ï¼Œç»ˆäºæ‰¾åˆ°åŸå› äº†ï¼šrelease åŒ…ä¸­ï¼Œæˆ‘æä¾›çš„åº“çš„æŸä¸ªæ–¹æ³•è¢«æ··æ·†æ‰äº†ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•æ˜¯éœ€è¦è¢« JNI_onLoad æ–¹æ³•è°ƒç”¨çš„ã€‚æ‰€ä»¥é—®é¢˜å°±æ˜¯ï¼šä¸€ä¸ªéœ€è¦è¢« so åº“è°ƒç”¨çš„ Java æ–¹æ³•è¢«æ··æ·†äº†ï¼å…¶å®ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬çš„é¡¹ç›®å¼•å…¥ä¸€äº›è‘—åçš„ç¬¬ä¸‰æ–¹åŒ… (æ¯”å¦‚ Knife ä¹‹ç±»çš„) æ—¶ï¼Œéƒ½ä¼šåœ¨æˆ‘ä»¬çš„é¡¹ç›®çš„ Proguard é…ç½®æ–‡ä»¶ä¸­å£°æ˜ä¸è¦æ··æ·†è¿™äº›ä¸‰æ–¹åŒ…çš„ä»£ç ï¼Œä¸ºçš„å°±æ˜¯é¿å…ä¸Šé¢è¿™ä¸ªé—®é¢˜ã€‚è¯´ä¸€å¥æ˜¾å¾—æœ‰ç‚¹åºŸè¯çš„è¯ï¼šç¬¬ä¸‰æ–¹åŒ…å‘å¸ƒæ··æ·†åŒ…æ—¶ï¼Œä»–ä»¬çš„ Proguard é…ç½®æ–‡ä»¶åªèƒ½åœ¨ä»–ä»¬çš„ aar åŒ…æ„å»ºæ—¶ç”Ÿæ•ˆï¼Œè€Œåœ¨ä»–ä»¬çš„ aar æ„å»ºåˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­æ—¶ï¼Œä»–ä»¬çš„ Proguard æ—©å·²é­é•¿è«åŠä¸èµ·ä½œç”¨äº†ã€‚</p><p>å›åˆ°æˆ‘é‡åˆ°çš„è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æœ¬åœ°è‡ªæµ‹æ—¶ï¼Œå¾ˆå°‘ä¼šè¿›è¡Œæ··æ·†ï¼Œæœ¬åœ°çš„ release é»˜è®¤éƒ½æ˜¯æœªæ··æ·†çš„ (minifyEnabled æ˜¯ false)ï¼Œæ‰€ä»¥è‡ªæµ‹çš„æ—¶å€™æ ¹æœ¬æ²¡æœ‰æ³¨æ„åˆ°è¿™ä¸ªé—®é¢˜ã€‚è¿™æ¬¡è¿™ä¸ª bug çš„è§£å†³åŠæ³•ä¹‹ä¸€æ˜¯ï¼Œåœ¨æœ€ç»ˆä½¿ç”¨æˆ‘çš„ aar çš„é¡¹ç›®ä¸­ï¼Œæ˜¾ç¤ºå£°æ˜ä¸è¦æ··æ·†æˆ‘è¿™ä¸ª aar ä¸­çš„æŸäº›ä»£ç ï¼Œè¿™å°±å’Œä¸Šä¸€æ®µè¯´çš„å£°æ˜ä¸æ··æ·†ç¬¬ä¸‰æ–¹åŒ…çš„ä»£ç æ˜¯ä¸€æ ·çš„ã€‚Butï¼Œè¿˜æœ‰ä¸€ç§æ›´å¥½çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯ä½¿ç”¨ com.android.support.support-annotations æ”¯æŒåº“ä¸­çš„ @Keep æ³¨è§£ï¼Œæ­¤æ³¨è§£å¯ä»¥æ ‡è®°å“ªäº›æ–¹æ³•æˆ–è€…ç±»åœ¨æœ€ç»ˆæ„å»º apk æ—¶ä¸ä¼šè¢«æ··æ·†æ‰ (å½“ç„¶åœ¨å‰é¢çš„ aar æ„å»ºç­‰è¿‡ç¨‹è‡ªç„¶ä¹Ÿä¸ä¼šæ··æ·†)ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œå½“å‰é¡¹ç›®çš„ Proguard é…ç½®æ–‡ä»¶åªèƒ½åœ¨å½“å‰é¡¹ç›®æ„å»ºè¾“å‡ºäº§ç‰©æ—¶èµ·ä½œç”¨ï¼Œè€Œæ— æ³•ç¡®ä¿è¾“å‡ºçš„äº§ç‰©äº¤ç»™å…¶ä»–é¡¹ç›®é›†æˆæ—¶ä¸è¢«æ··æ·†ã€‚è‹¥è¦ç¡®ä¿åè€…ï¼Œé‚£å°±å¯ä»¥ç”¨ support-annotations æ”¯æŒåº“ä¸­çš„æ³¨è§£äº†ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>è®°ä¸€ä¸ªç®€å•çš„é€’å½’é—®é¢˜ä¸è§£æ³•</title>
      <link href="/2018/09/26/%E8%AE%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E9%80%92%E5%BD%92%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E6%B3%95/"/>
      <url>/2018/09/26/%E8%AE%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E9%80%92%E5%BD%92%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E6%B3%95/</url>
      <content type="html"><![CDATA[<p>é€’å½’é—®é¢˜å°±åƒæ˜¯ä¿„ç½—æ–¯å¥—å¨ƒä¸€æ ·ç²¾å¦™ï¼Œå¤§çš„å¥—å°çš„ï¼Œä¸€å±‚ä¸€å±‚å¥—åœ¨ä¸€èµ·ã€‚</p><p>å‰äº›æ—¥å­ï¼Œä¸€ä¸ªæœ‹å‹è¯´çœ‹åˆ°ä¸€ä¸ªç®—æ³•é¢˜ç›®ï¼Œç„¶åé—®æˆ‘æœ‰æ€è·¯å—ï¼Ÿé—®é¢˜å°±æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535807089.png" alt=""></p><p>è¿™ä¸ªé—®é¢˜å¾ˆæ˜æ˜¾æ˜¯ä¸ªé€’å½’é—®é¢˜ã€‚æˆ‘å½“æ—¶å°±å¤¸ä¸‹æµ·å£è¯´ï¼Œ10åˆ†é’Ÿç»™ä½ å†™ä¸ª Python è„šæœ¬ã€‚è™½ç„¶å®é™…ä¸Šç”¨äº†æ¥è¿‘ 30 åˆ†é’Ÿã€‚ã€‚ã€‚</p><p>è¨€å½’æ­£ä¼ ï¼Œè¿™ä¸ªé—®é¢˜çš„é€’å½’å…³ç³»åŒ…å«ä¸¤ç§ï¼Œ<strong>åµŒå¥—å…³ç³»</strong>å’Œ<strong>å¹¶åˆ—å…³ç³»</strong>ã€‚æ¯”å¦‚ 2[a]3[c] æœ€å¤–å±‚æ˜¯å¹¶åˆ—å…³ç³»ï¼Œå³ 2[a] å’Œ 3[c] æ˜¯ä¸¤ä¸ªäº’ç›¸å¹¶åˆ—çš„å­é—®é¢˜ï¼Œä»–ä»¬çš„è§£ç­”ä¸²èµ·æ¥å°±æ˜¯ 2[a]3[c] çš„è§£ç­”ã€‚è€Œ 2[2[a]] æœ€å¤–å±‚åˆ™æ˜¯ä¸€ä¸ªåµŒå¥—å…³ç³»ï¼Œå³è¦æ±‚ 2[2[a]] çš„è§£ç­”éœ€è¦å…ˆæ±‚å­é—®é¢˜ 2[a] çš„è§£ç­” (è¿™ä¸ªè§£ç­”æ˜¾ç¤ºå°±æ˜¯ aa)ï¼Œæ‰€ä»¥é—®é¢˜åŒ–è§£ä¸º 2[aa]ã€‚</p><p>æ‰€ä»¥æ€è·¯å°±æ˜¯ï¼Œå¯¹äºä¸€ä¸ªé—®é¢˜ Xï¼Œå…ˆæŒ‰å¹¶åˆ—å…³ç³»åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå­é—®é¢˜ X1, X2, â€¦, Xnï¼›å¦‚æœ n å¤§äº 1ï¼Œé‚£ä¹ˆå„ä¸ªå­é—®é¢˜çš„ç­”æ¡ˆä¸²èµ·æ¥å°±æ˜¯ç­”æ¡ˆäº†ï¼›å¦‚æœ n ç­‰äº 1ï¼Œé‚£ä¹ˆè¯´æ˜ X æœ€å¤–å±‚å¹¶ä¸æ˜¯å¹¶åˆ—å…³ç³»è€Œæ˜¯åµŒå¥—å…³ç³»æˆ–è€…æ ¹æœ¬å°±æ˜¯å•ä¸ªå­—æ¯ï¼Œå¦‚æœ X æ˜¯å•ä¸ªå­—æ¯ï¼Œé‚£ä¹ˆç­”æ¡ˆå°±æ˜¯å®ƒæœ¬èº«ï¼Œåä¹‹ï¼Œé‚£ä¹ˆ X ä¸€å®šæ˜¯ s[Y] çš„å½¢å¼ï¼Œç­”æ¡ˆå°±æ˜¯ s ä¸ª Y çš„ç­”æ¡ˆä¸²èµ·æ¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">p_loc</span><span class="params">(input, left)</span>:</span></span><br><span class="line">    count = <span class="number">1</span></span><br><span class="line">    i = left</span><br><span class="line">    <span class="keyword">while</span> count &gt; <span class="number">0</span>:</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> input[i] == <span class="string">']'</span>:</span><br><span class="line">            count -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> input[i] == <span class="string">'['</span>:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do</span><span class="params">(input)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'['</span> <span class="keyword">not</span> <span class="keyword">in</span> input:</span><br><span class="line">        <span class="keyword">return</span> input</span><br><span class="line">    first = input.find(<span class="string">'['</span>)</span><br><span class="line">    i = p_loc(input, first)</span><br><span class="line">    <span class="keyword">if</span> i &lt; len(input) <span class="number">-1</span>:</span><br><span class="line">        parts = []</span><br><span class="line">        <span class="keyword">while</span> i &lt; len(input) <span class="number">-1</span>:</span><br><span class="line">            parts.append(input[:i+<span class="number">1</span>])</span><br><span class="line">            input = input[i+<span class="number">1</span>:]</span><br><span class="line">            first = input.find(<span class="string">'['</span>)</span><br><span class="line">            i = p_loc(input, first)</span><br><span class="line">        parts.append(input[:i+<span class="number">1</span>])</span><br><span class="line">        res = <span class="string">''</span></span><br><span class="line">        <span class="keyword">for</span> part <span class="keyword">in</span> parts:</span><br><span class="line">            res += do(part)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        right = p_loc(input, first)</span><br><span class="line">        sub_res = do(input[first+<span class="number">1</span>:right])</span><br><span class="line">        <span class="keyword">return</span> int(input[:first]) * sub_res</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">print(do(<span class="string">'2[a]3[c]'</span>))</span><br><span class="line">print(do(<span class="string">'2[2[a]]'</span>))</span><br><span class="line">print(do(<span class="string">'2[2[a]]3[c]'</span>))</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Algorithm </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æ—¥å¸¸ä¿® Bug</title>
      <link href="/2018/09/26/%E6%97%A5%E5%B8%B8%E4%BF%AE%20Bug/"/>
      <url>/2018/09/26/%E6%97%A5%E5%B8%B8%E4%BF%AE%20Bug/</url>
      <content type="html"><![CDATA[<p>å‰å‡ å¤©æœ‰äººæŠ¥å‘Šå·´è¥¿ç‰ˆæœ¬ä¹˜å®¢ç«¯æ‰«æé“¶è¡Œå¡çš„ç•Œé¢æœ‰ bugï¼Œå³å±å¹•å³ä¾§æœ‰ä¸€æ¡ç™½çº¿ï¼Œä¹Ÿå°±æ˜¯ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="http://tao93.top/images/2018/09/01/1535790364.png" alt=""></p><p>é‰´äºæŠ¥å‘Šäººæ²¡æå…·ä½“çš„ç‰ˆæœ¬å·ï¼Œä¹Ÿæ²¡ææ€ä¹ˆå‡ºç°çš„ï¼Œä¹Ÿæ²¡ææ˜¯ä»€ä¹ˆæœºå‹å‡ºç°çš„ï¼Œæˆ‘å°±å’ŒæŠ¥å‘Šäººè¯´æ²Ÿé€šäº†ä¸€ç•ªã€‚æŠ¥å‘Šäººè¯´åº”è¯¥æ˜¯å°ç±³ 6 å‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘é‚å€Ÿäº†ä¸€éƒ¨å°ç±³ 6ï¼Œç„¶åè¿è¡Œ demo å¹¶æ²¡æœ‰å¤ç°ã€‚ç°åœ¨å°±æœ‰ä¸¤ç§å¯èƒ½ï¼Œç¬¬ä¸€æ˜¯åªæœ‰æŠ¥å‘Šäººé‚£å°å°ç±³ 6 æœ‰é—®é¢˜ï¼Œç¬¬äºŒæ˜¯ demo æ²¡é—®é¢˜ä½†æ˜¯é›†æˆåˆ°å·´è¥¿ç‰ˆæœ¬åå°±æœ‰é—®é¢˜äº†ã€‚ç»è¿‡è‰°è‹¦äº¤æ¶‰ï¼Œç»ˆäºä»å¯¹æ–¹é‚£é‡Œè¦åˆ°äº†ä¸€ä¸ªå®‰è£…åŒ…åï¼Œæˆ‘æ‰‹é‡Œæ‰‹æœºå¤ç°äº†æ­¤é—®é¢˜ï¼Œäº‹å®å¾ˆå¿«å°±æ¸…æ¥šäº†ï¼šdemo æ²¡é—®é¢˜ä½†æ˜¯é›†æˆåæœ‰é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯å’Œæœºå‹å‹æ ¹æ²¡å…³ç³»ã€‚</p><p>å…ˆç›´æ¥ç»™å‡ºæœ€åä¿®å¤çš„æ–¹æ³•ï¼Œä¿®å¤æ–¹æ³•æ˜¯åœ¨æˆ‘çš„æ‰«å¡åº“çš„ activity ä¸­ï¼Œè°ƒç”¨ä»¥ä¸‹ä¸€è¡Œå°± OK äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»™ PhoneWindow è®¾ç½®ä¸€ä¸ªèƒŒæ™¯ </span></span><br><span class="line">getWindow().setBackgroundDrawable(<span class="keyword">new</span> ColorDrawable(Color.TRANSPARENT));</span><br></pre></td></tr></table></figure><p>å—¯ï¼Œä¿®å¤æ–¹æ³•å¾ˆç®€å•ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¿™æ ·åšå°± work äº†å‘¢ï¼Ÿæ¥ä¸‹æ¥å°±æ˜¯è°ƒè¯•çš„è¿‡ç¨‹äº†.</p><p>é¦–å…ˆè·å–ä¸€ä¸‹è¿™ä¸ªç•Œé¢çš„ layout ä¿¡æ¯ï¼Œå°è¯•çœ‹çœ‹å³ä¾§ç™½è‰²ç»†çº¿æ˜¯ä¸æ˜¯é¢å¤–å¡è¿›å»çš„è§†å›¾ï¼Œç»“æœå¹¶ä¸æ˜¯ã€‚ç„¶åæˆ‘å†çœ‹æ˜¯å¦æ˜¯è®¾ç½®äº†ä»€ä¹ˆ padding å¯¼è‡´äº†è¿™ä¸ªé—®é¢˜ã€‚äº‹å®ä¸Šï¼Œæ­£å¼è¿™æ ·çš„ï¼Œå¯æƒœæˆ‘å¯èƒ½æ˜¯çäº†çœ¼ï¼Œå±…ç„¶æ²¡æœ‰çœ‹åˆ°ä¸‹é¢çš„çº¿ç´¢ï¼Œå³ DecorView çš„å³ä¾§ padding æ˜¯ 2ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535790424.png" alt=""></p><p>æˆ‘åªçœ‹åˆ°äº†ä¸‹é¢çš„ LinearLayout çš„å®½åº¦æ˜¯1438ï¼Œæ¯”æˆ‘çš„æ‰‹æœºå±å¹•å®½åº¦1440å°‘äº†2ä¸ªåƒç´ ï¼Œæ˜¾ç„¶å°±æ˜¯å³ä¾§çš„ç™½çº¿äº†ã€‚</p><p><img src="http://tao93.top/images/2018/09/01/1535790483.png" alt=""></p><p>æ‰€ä»¥æˆ‘æ€ä¹ˆåŠå‘¢ï¼Œæˆ‘å¼€å§‹è°ƒè¯• measure å’Œ layout çš„è¿‡ç¨‹ã€‚å› ä¸º DecorView çš„å®½åº¦æ˜¯ 1440 æ²¡é”™ï¼Œå¯æ˜¯å®ƒçš„ Child LinearLayout å®½åº¦åªæœ‰ 1438ï¼Œæ‰€ä»¥æˆ‘å…ˆæ¡ä»¶æ–­ç‚¹åœ¨ LinearLayout ç±»ä¸­çš„ onMeasure æ–¹æ³•ã€‚æ–­ç‚¹çš„æ¡ä»¶æˆ‘æœ¬æ¥æƒ³å†™ getParent() instance DecorViewï¼Œç»“æœå‘ç°æ— æ³•åº”ç”¨ DecorViewï¼Œäºæ˜¯æˆ‘å°±æ”¹æˆäº† getParent() != null &amp;&amp; getParent().getParent() == nullï¼Œå…¶å®è¿™æ˜¯ä¸å¯¹çš„ï¼ŒDecorView åŒæ ·æœ‰ Parentï¼Œä¹Ÿå°±æ˜¯ ViewRootImpl å¯¹è±¡ï¼Œæˆ‘æŠŠè¿™ä¸ªç»™å¿˜äº†ã€‚æ‰€ä»¥æ–­ç‚¹æ¡ä»¶å°±æˆäº†ä¸‹é¢è¿™æ ·è‡ƒè‚¿çš„äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getParent() != <span class="keyword">null</span> &amp;&amp; getParent().getParent() != <span class="keyword">null</span> &amp;&amp; getParent().getParent().getParent() == <span class="keyword">null</span> </span><br><span class="line"><span class="comment">// å½“ç„¶å…¶å®è¿˜æœ‰æ›´ç®€æ´çš„æ–¹å¼ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ · </span></span><br><span class="line">getClass().getName.endswith(<span class="string">"DecorView"</span>)</span><br></pre></td></tr></table></figure><p>ç„¶åå‘ç°ä¸ç®¡æ˜¯ measure è¿˜æ˜¯ layout çš„è¿‡ç¨‹ï¼ŒLinearLayout å®½åº¦å§‹ç»ˆå°±æ˜¯ 1438ï¼ŒDecorView å°±åªç»™å®ƒç•™äº†è¿™ä¸ªå¤§ç©ºé—´ã€‚ç„¶åæˆ‘å¼€å§‹è°ƒè¯•åˆ° DecorView çš„æµ‹é‡è¿‡ç¨‹ä¸­ï¼Œæœ€åå‘ç°åœ¨ ViewGroup (è¿™é‡Œä»…ä»…æ˜¯ç”±äº DecorView æ˜¯ç»§æ‰¿è‡ª ViewGroup çš„) çš„ measureChildWithMargins æ–¹æ³•ä¸­ï¼Œæ‰¾åˆ°äº†å…³é”®çº¿ç´¢ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535790538.png" alt=""></p><p>ä¹Ÿå°±æ˜¯ä¸Šé¢çš„ mPaddingRight çš„å€¼å±…ç„¶æ˜¯ 2 è€Œä¸æ˜¯ 0ï¼Œè¿™æ„å‘³ç€ DecorView çš„å³ä¾§ padding æ˜¯2ï¼Œè¿™æ ·å°±èƒ½è§£é‡Šé€šä¸ºå•¥ DecorView çš„ child å®½åº¦å°äº† 2 äº†ã€‚è¿™æ˜¯æˆ‘èµ¶ç´§å›å»çœ‹ layout ä¿¡æ¯ï¼Œç„¶åå°±å‘ç°äº†æˆ‘æœ¬æ¥æ—©å°±è¯¥å‘ç°çš„çº¿ç´¢äº†ã€‚</p><p>OKï¼Œæ¥ä¸‹æ¥æ˜¯è¦çŸ¥é“ï¼Œè°æŠŠ DecorView çš„å³ä¾§ padding åŠ äº† 2 çš„ã€‚æˆ‘å¯¹ View ç±»çš„ mPaddingRight å±æ€§åŠ äº†ä¸‹å›¾æ‰€ç¤ºçš„æ–­ç‚¹ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535790585.png" alt=""></p><p>æœç„¶ï¼Œä¸ä¸€ä¼šå„¿ï¼Œæˆ‘å°±æœ‰äº†æ”¶è·ï¼Œå¾—åˆ°äº†ä¸‹é¢çš„å †æ ˆï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535790614.png" alt=""></p><p>ä¸Šé¢å †æ ˆæ¸…æ™°äº†å±•ç¤ºäº†å³ä¾§ padding æ˜¯æ€ä¹ˆè¢«è®¾ç½®ä¸º 2 çš„ï¼Œæ¦‚æ‹¬æ¥è¯´ï¼Œå°±æ˜¯ PhoneWindow åœ¨å‡†å¤‡ DecorView æ—¶ï¼Œæ£€æŸ¥åˆ°æœ‰ä¸€ä¸ª Drawableï¼Œç„¶ååœ¨è®¾ç½®è¿™ä¸ª Drawable æ—¶ï¼Œå»è®¾ç½®äº† paddingã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè®¾ç½® Drawable éœ€è¦è®¾ç½® padding å‘¢ï¼Ÿçœ‹ä¸‹å›¾å°±æ˜ç™½äº†ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535790640.png" alt=""></p><p>åŸæ¥ï¼Œè¿™æ˜¯ä¸ªè‡ªå¸¦ padding çš„ NinePatchDrawableã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°±æŸ¥æ‰¾äº†ä¸€ä¸‹ï¼Œå‘ç°è¿™ä¸ª drawable å°±æ˜¯ PhoneWindow ä¸­çš„ mBackgroundsource å±æ€§è§£æè€Œæ¥ã€‚è¿™ä¸ªå±æ€§æ˜¯ä»åº”ç”¨ä¸»é¢˜ä¸­æŒ‡å®šçš„ã€‚ç°åœ¨å›åˆ°å‰é¢æˆ‘æå‰è´´å‡ºçš„è§£å†³æ–¹æ³•ä¹‹ä¸€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getWindow().setBackgroundDrawable(<span class="keyword">new</span> ColorDrawable(Color.TRANSPARENT))</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç è°ƒç”¨ PhoneWindow çš„ setBackgroundDrawable æ–¹æ³•ï¼Œè¿™ä¸ªè°ƒç”¨é™¤äº†è®¾ç½® bg drawable å¤–ï¼Œè¿˜ç›´æ¥è®© mBackgroundsource å˜ä¸º 0ï¼Œæ‰€ä»¥åé¢å°±è½®ä¸åˆ°é‚£ä¸ª NinePatchDrawable äº†ã€‚</p><p>å…¶å®ï¼Œä¸Šé¢çš„è§£å†³æ–¹æ³•è¿˜æ˜¯æœ‰ç‚¹çªå…€ï¼Œå¦ä¸€ç§æ–¹æ³•æ˜¯ï¼Œåœ¨æ‰«å¡çš„åº“ä¸­è®¾ç½®ä¸€ä¸ªä¸»é¢˜ï¼Œè¿™æ ·çš„è¯ï¼Œå°±ä¸ä¼šåº”ç”¨å·´è¥¿ç‰ˆæœ¬ä¹˜å®¢ç«¯é¡¹ç›®ä¸­å£°æ˜çš„ä¸»é¢˜äº†ï¼Œè‡ªç„¶ä¹Ÿå°±ä¸ä¼šæŠŠé‚£ä¸ª NinePatchDrawable è®¾ç½®è¿›æ¥ã€‚</p><p>å†è¯´ç‚¹åˆ«çš„ã€‚è¿™ä¸ªæ‰«å¡çš„åº“ï¼Œè¢«é›†æˆåˆ°å¦ä¸€ä¸ªåº“ä¸­ï¼Œç„¶åå¦ä¸€ä¸ªåº“å†é›†æˆåˆ°å·´è¥¿ç‰ˆæœ¬ä¸­ã€‚ä¸­é—´è¿™ä¸ªåº“ï¼Œæˆ‘æ˜¯æ²¡æœ‰æ¶‰è¶³çš„ã€‚æ‰€ä»¥ä¸ºä¹ˆéªŒè¯æˆ‘æœ‰æ²¡æœ‰ä¿®å¤æˆåŠŸï¼Œæˆ‘åªèƒ½åœ¨æœ€ç»ˆçš„é¡¹ç›®ä¸­å†å¼•ç”¨ä¸€ä¸‹æˆ‘çš„åº“ç»è¿‡æ”¹åŠ¨åçš„ç‰ˆæœ¬ï¼Œå½“ç„¶ç‰ˆæœ¬å·ä¹Ÿè¦å¢åŠ ä¸€ä¸‹ã€‚è¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥æ–°çš„è¦†ç›–æ—§çš„ï¼ŒæŠŠä¸­é—´é‚£ä¸ªåº“å¯¹æ‰«å¡åº“çš„å¼•ç”¨ç»™è¦†ç›–çš„ã€‚å”‰ï¼ŒçœŸæ˜¯æŠ˜è…¾ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æé«˜å¼€å‘æ•ˆç‡çš„å„ç§å·¥å…·</title>
      <link href="/2018/09/26/%E6%8F%90%E9%AB%98%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87%E7%9A%84%E5%90%84%E7%A7%8D%E5%B7%A5%E5%85%B7/"/>
      <url>/2018/09/26/%E6%8F%90%E9%AB%98%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87%E7%9A%84%E5%90%84%E7%A7%8D%E5%B7%A5%E5%85%B7/</url>
      <content type="html"><![CDATA[<p>ä¿—è¯è¯´ï¼Œå·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨ã€‚å¥½ç”¨çš„å¼€å‘å·¥å…·ï¼Œè™½ç„¶ä¸ä¼šç›´æ¥æ”¹å–„æˆ‘ä»¬å†™çš„ä»£ç ï¼Œä½†æ˜¯å¯¹äºæ•ˆç‡çš„æé«˜å’Œæé«˜èˆ’é€‚åº¦è¿˜æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚æœ¬æ–‡æ„åœ¨æä¾›ä¸€äº›ä¸æ˜¯éå¸¸æ™®éä½¿ç”¨ï¼Œä½†æ˜¯å¯¹äºæ•ˆç‡æå‡å¯èƒ½éå¸¸æœ‰ç”¨çš„å·¥å…·ã€‚è¯ä¸å¤šè¯´ï¼Œå¼€å§‹æ­£æ–‡ï¼</p><h4 id="å‰ªè´´æ¿å·¥å…·-â€”-Clipy"><a href="#å‰ªè´´æ¿å·¥å…·-â€”-Clipy" class="headerlink" title="å‰ªè´´æ¿å·¥å…· â€”- Clipy"></a>å‰ªè´´æ¿å·¥å…· â€”- <a href="https://github.com/Clipy/Clipy" target="_blank" rel="noopener">Clipy</a></h4><p>å‰ªè´´æ¿å·¥å…·å®åœ¨å¤ªå®ç”¨äº†ï¼Œä¸è¿‡ä¼¼ä¹å¤§éƒ¨åˆ†ç¨‹åºå‘˜éƒ½æ²¡æœ‰ç”¨ä¸Šå‰ªè´´æ¿å·¥å…·ã€‚è€Œ Clipy æ˜¯ä¸€æ¬¾å¾ˆåˆé€‚çš„å‰ªè´´æ¿å·¥å…·ï¼Œä»¥è‡³äºæˆ‘æƒ³èµ·å®ƒæ—¶ï¼Œç›´æ¥å°†å®ƒæ’åˆ°æœ€å‰é¢ï¼Œå¹¶ä¸”åºå·ç¼–ä¸º 0ã€‚Clipy æ˜¯ä¸€ä¸ªå¼€æºçš„å‰ªè´´æ¿å·¥å…·ï¼Œç®€æ´ä¸é—¹å¿ƒï¼Œå¤åˆ¶çš„å›¾ç‰‡å’Œæ–‡æœ¬éƒ½å¯ä»¥ç®¡ç†ï¼Œç”¨èµ·æ¥å¾ˆçˆ½ã€‚</p><p><img src="http://tao93.top/images/2018/09/01/1535789967.png" alt=""></p><h4 id="oh-my-zsh"><a href="#oh-my-zsh" class="headerlink" title="oh-my-zsh"></a>oh-my-zsh</h4><p>è¿™æ˜¯ä¸ªç»ˆç«¯åŠ å¼ºå·¥å…·ï¼ŒmacOS å’Œ Linux éƒ½å¯ç”¨ï¼ŒæŠŠé»˜è®¤ shell ä» bash æ”¹ä¸º zshï¼Œç„¶åå†åŠ å¼ºä¸€ä¸‹ã€‚æˆ‘åªç”¨çš„ oh-my-zsh çš„ 3 ä¸ª featuresï¼Œä½†è¿™ 3 ä¸ªéƒ½æ˜¯å¾ˆæœ‰å¸å¼•åŠ›çš„ã€‚</p><p>ç¬¬ä¸€ã€è‡ªå¸¦è¯†åˆ« git é¡¹ç›®ç›®å½•çš„åŠŸèƒ½ï¼Œç›´æ¥æ˜¾ç¤ºåˆ†æ”¯åã€æœ‰æ— æœªæäº¤çš„æœ¬åœ°ä¿®æ”¹ï¼›</p><p>ç¬¬äºŒã€cd æ—¶ï¼Œç›´æ¥ä¸åœçš„æŒ‰ tabï¼ŒæŒ‡å¯¼é€‰ä¸­äº†ä½ æƒ³è¦çš„ç›®å½•ï¼Œç„¶åå›è½¦ï¼Œå°±å¯ä»¥è¿›å…¥æƒ³è¿›å…¥çš„ç›®æ ‡ï¼Œå‡å°‘è¾“å…¥ç›®å½•åå‰å‡ ä¸ªå­—æ¯çš„åŠ³ç´¯ã€‚</p><p>ç¬¬ä¸‰ã€è¿™æ˜¯ä¸ª killer featureï¼Œåœ¨ç»ˆç«¯è¾“å…¥ä»»ä½•å‡ ä¸ªå­—ç¬¦ï¼ŒæŒ‰å‘ä¸Šçš„ç®­å¤´ï¼Œå°±å¯åˆ—å‡ºä»¥è¿™äº›å­—ç¬¦å¼€å¤´çš„æ‰€æœ‰å†å²å‘½ä»¤ï¼Œè¿™æ ·å¾ˆå¤šéœ€é‡å¤ä½¿ç”¨çš„å‘½ä»¤ã€å¾ˆä¹…å¿½ç„¶æƒ³èµ·éœ€è¦å†æ¬¡ä½¿ç”¨çš„å‘½ä»¤çš„ä½¿ç”¨æ–¹ä¾¿äº†éå¸¸å¤šï¼Œæ¯”å¦‚å¿½ç„¶æƒ³èµ· 10 å¤©å‰ï¼Œä½¿ç”¨ sed å‘½ä»¤æäº†ä¸ªäº‹æƒ…ï¼Œä½†æ˜¯ sed å‘½ä»¤ä½ æ‡‚çš„ï¼Œå‹æ ¹è®°ä¸ä½ç”¨æ³•ï¼Œæ€ä¹ˆåŠï¼Ÿç›´æ¥ç»ˆç«¯è¾“å…¥ sed ç„¶åæŒ‰å‘ä¸Šç®­å¤´ï¼Œç«‹é©¬è°ƒå‡º sed å¼€å¤´çš„å†å²å‘½ä»¤ã€‚</p><h4 id="local-Maven-ä»“åº“"><a href="#local-Maven-ä»“åº“" class="headerlink" title="local Maven ä»“åº“"></a>local Maven ä»“åº“</h4><p>è‡ªæ‰“è°·æ­Œä¸€æ‰‹å°† Android çš„æ„å»ºå·¥å…·åˆ‡æ¢åˆ° Gradle åï¼Œè¿œç¨‹ä¾èµ–å˜ä¸ºç”¨ç”± Gradle é…ç½®ä» Maven ä»“åº“è·å–ä¾èµ–ã€‚è€Œé™¤äº† Jcenterã€mavenCentralã€Google è¿™æ ·æœ€å¸¸è§ 3 ä¸ªå…¬å¼€ Maven ä»“åº“å¤–ï¼Œç°åœ¨å¾ˆå¤šå…¬å¸å†…éƒ¨ä¼šå¼€å‘ä¸€äº› SDK æˆ–è€…å·¥å…·åŒ…ä¹‹ç±»çš„ï¼Œç„¶åä½œä¸ºä¾èµ–æ”¾åœ¨å…¬å¸å†…éƒ¨çš„ç§æœ‰ Maven ä»“åº“ä¸­ï¼Œæä¾›ç»™å…¬å¸å†…éƒ¨ä½¿ç”¨ã€‚</p><p>é—®é¢˜æ¥äº†ï¼Œå¯¹äºæ™®é€šçš„å¼€å‘è€…æ¥è¯´ï¼Œæœ‰æ—¶å€™éœ€è¦ä¿®æ”¹æŸä¸ªä¾èµ–çš„æºä»£ç å¹¶åŠ ä»¥éªŒè¯ï¼Œä½†æ˜¯åˆä¸æƒ³æŠŠä¿®æ”¹åçš„ä»£ç é©¬ä¸Šå°±æ„å»ºä¸€ä¸ªæ–°ç‰ˆæœ¬çš„ä¾èµ–ä¼ è¾“åˆ°å…¬å¸çš„ Maven ä»“åº“ã€‚æ¯•ç«Ÿï¼Œå¤©æ™“å¾—è‡ªå·±è¦æ”¹å¤šå°‘æ¬¡ï¼Œå¦‚æœä¸€ç›´å¾€å…¬å¸ Maven ä»“åº“æ¨ï¼Œè¢«åˆ«äººçœ‹åˆ°äº†å¥½åƒä¼šæ„Ÿè§‰è‡ªå·±å¾ˆèœçš„æ ·å­ ?ã€‚è¿™æ—¶å€™ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæœ¬åœ°çš„ Maven ä»“åº“ï¼Œé‚£å…ˆä¼ åˆ°æœ¬åœ° Maven ä»“åº“ï¼Œç„¶åå†ä»æœ¬åœ°ä»“åº“è·å–ä¾èµ–ï¼Œå°±å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜äº†ï¼Œç‰¹åˆ«æ˜¯å¯¹äºä¸€äº›æ–‡ä»¶æ¯”è¾ƒå¤§çš„ä¾èµ–ï¼Œè¿™æ ·é€Ÿåº¦ä¹Ÿä¼šæ›´å¿«ã€‚</p><p>è¿™é‡Œè¯´çš„ local Maven ä»“åº“ï¼Œä¸æ˜¯ Gradle ä¸­ä½¿ç”¨ mavenLocal() æ¥å£°æ˜çš„é‚£ä¸ªä»“åº“ (é€šå¸¸ä½äº ~/.m2/repository) ä¸­ï¼Œè€Œæ˜¯æŒ‡è‡ªå·±åœ¨ä¸ªäººç”µè„‘ä¸Šæ­å»ºä¸€ä¸ª Maven ä»“åº“ï¼Œå°±å’Œè¿œç¨‹ä»“åº“ä¸€æ ·ï¼Œåªä¸è¿‡åŸŸåä½¿ç”¨ localhost æ¥è®¿é—®å³å¯ã€‚</p><p>æ–¹æ³•å…¶å®æ¯”è¾ƒç®€å•ï¼Œæ¯”å¦‚ä½¿ç”¨ Nexus OSS Maven çš„è¯ï¼Œåœ¨ macOS ç³»ç»Ÿä¸Šç®€ç›´ä¸è¦å¤ªå®¹æ˜“ï¼Œç›´æ¥ brew install nexusï¼Œç„¶åå† nexus start å°± OKäº†ï¼Œæ­¤æ—¶åœ¨æµè§ˆå™¨ä¸Šé¢æ‰“å¼€ <a href="http://localhost:8081/nexus" target="_blank" rel="noopener">http://localhost:8081/nexus</a> å°±å¯ä»¥å¼€å§‹ç™»å½•äº†ï¼Œåˆå§‹ç”¨æˆ·åå’Œå¯†ç åˆ†åˆ«æ˜¯ admin å’Œ admin123ï¼Œç™»å½•ä¹‹åï¼Œé‡Œé¢å·²ç»æœ‰äº†ä¸€äº› repository äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535790041.png" alt=""></p><p>æˆ‘å¸¸ç”¨çš„å°±æ˜¯ä¸Šé¢ Snapshots è¿™ä¸ª repositoryï¼Œä¸“é—¨ç”¨æ¥æ‰˜ç®¡ SNAPSHOT ç±»å‹çš„ä¾èµ–ï¼Œå…³äº SNAPSHOT ç±»å‹çš„ä¾èµ–ï¼Œæˆ‘ä¼šå†™ä¸€ç¯‡æ›´å…¨é¢è¯¦ç»†çš„æ–‡ç« æ¥è®²æ€ä¹ˆä½¿ç”¨ã€‚</p><p>OKï¼Œç°åœ¨å°±å¯ä»¥åœ¨å‘æœ¬åœ°çš„ Maven ä»“åº“ä¼ ä¾èµ–åŒ…å¹¶æ‹‰å–ä½¿ç”¨äº†ã€‚å…¶å®ï¼Œå±€åŸŸç½‘å†…å…¶ä»–åŒäº‹ä¹Ÿæ˜¯å¯ä»¥è®¿é—®è¿™ä¸ª Maven ä»“åº“çš„ï¼Œæ¯”å¦‚ <a href="http://localhost:8081/nexus/content/repositories/snapshots/" target="_blank" rel="noopener">http://localhost:8081/nexus/content/repositories/snapshots/</a> è¿™ä¸ªä»“åº“ï¼Œåˆ«çš„åŒäº‹è¦è®¿é—®æˆ‘è¿™ä¸ª snapshot ä»“åº“çš„è¯ï¼Œåªéœ€è¦ä»–æŠŠ localhost æ¢æˆæˆ‘çš„ç§æœ‰ IP åœ°å€å³å¯ã€‚</p><h4 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h4><p>ä¸ºä»€ä¹ˆæŠŠ Python åˆ—å‡ºæ¥å‘¢ï¼Ÿå› ä¸ºå…¶å® Python å…¥é—¨æ˜¯éå¸¸ç®€å•çš„ï¼Œå†åŠ ä¸Šè¿™å¹´å¤´ï¼Œä¸äº†è§£ä¸€ä¸‹ Python éƒ½ä¸å¥½æ„æ€è¯´è‡ªå·±æ˜¯ç¨‹åºå‘˜ã€‚è€Œå…¥é—¨åï¼Œå¯ä»¥å¸®æˆ‘ä»¬åšç‚¹äº‹æƒ…ï¼Œæ¯”å¦‚ä¸‹å›¾ä¸­ï¼Œè¡¨è¾¾å¼è®¡ç®—ï¼Œè¿›åˆ¶è½¬æ¢:</p><p><img src="http://tao93.top/images/2018/09/01/1535790099.png" alt=""></p><p>å…¶å® Python å¯ä»¥åšçš„äº‹å¾ˆå¤šï¼Œé€šè¿‡å¼•å…¥ Python è‡ªå¸¦çš„åŒ…æˆ–è€…ç¬¬ä¸‰æ–¹åº“çš„åŒ…ï¼ŒPython å‡ ä¹æ— æ‰€ä¸èƒ½ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå»å¹´å¾®ä¿¡è·³ä¸€è·³å°æ¸¸æˆåˆšå‡ºæ¥æ—¶ï¼Œæˆ‘çœ‹è¿™ä¸ªæ¸¸æˆéå¸¸ç®€å•ï¼Œæˆ‘å°±æƒ³ï¼Œèƒ½ä¸èƒ½ç”¨ Python åšä¸ªè‡ªåŠ¨åŒ–è„šæœ¬æ¥è·³å‘¢ï¼Ÿå½“ç„¶å¯ä»¥ï¼å…¶å®åŸç†ä¹Ÿå¾ˆç®€å•ï¼Œå¯¹äºæ¯ä¸€è·³ï¼Œå¯ä»¥åˆ†ä¸ºè‹¥å¹²æ­¥ï¼šæˆªå›¾ã€åˆ†æå›¾ç‰‡å¾—å‡ºéœ€è¦è·³è·ƒçš„è·ç¦»ã€æ ¹æ®è·ç¦»æ¥æ¨¡æ‹Ÿä¸€ä¸ªé•¿æŒ‰äº‹ä»¶ã€‚è¿™æ ·çš„ä¸‰ä¸ªæ­¥éª¤å¯¹äº Android è®¾å¤‡æ˜¯å¾ˆå®¹æ˜“å®ç°çš„ã€‚æ‰€ä»¥æ€è·¯å°±æ˜¯ï¼Œä½¿ç”¨ Python è°ƒç”¨ adb å·¥å…·æ¥æˆªå›¾ã€pull æˆªå›¾åˆ°ç”µè„‘ä¸­ï¼›ç„¶åä½¿ç”¨ Python çš„ç…§ç‰‡å¤„ç†åº“æ¥åˆ†æç…§ç‰‡çš„åƒç´ ï¼Œæ‰¾åˆ°è·³çš„é‚£ä¸ªä¸œè¥¿çš„ä½ç½®å’Œä¸‹ä¸€ä¸ªæ–¹å—çš„ä½ç½®ï¼Œè¿™æ ·å°±çŸ¥é“éœ€è¦è·³è·ƒçš„è·ç¦»äº†ï¼›è°ƒç”¨ adb æ¨¡æ‹Ÿä¸€ä¸ªé•¿æŒ‰å±å¹•çš„äº‹ä»¶ï¼Œé•¿æŒ‰çš„æ—¶é—´å’Œéœ€è¦è·³è·ƒçš„è·ç¦»æˆæ­£æ¯”ï¼Œè‡³äºè¿™ä¸ªæ¯”å€¼ç³»æ•°ï¼Œæ‘¸ç´¢å‡ æ¬¡æµ‹è¯•ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚è¯¦è§æˆ‘çš„åšå®¢ <a href="http://tao93.top/2018/09/01/Python%20ä¹Ÿèƒ½ç©è·³ä¸€è·³å°æ¸¸æˆ/">Python ä¹Ÿèƒ½ç©è·³ä¸€è·³å°æ¸¸æˆ</a>ã€‚</p><h4 id="æˆ‘æ”¹è¿›è¿‡çš„-JD-GUI"><a href="#æˆ‘æ”¹è¿›è¿‡çš„-JD-GUI" class="headerlink" title="æˆ‘æ”¹è¿›è¿‡çš„ JD-GUI"></a>æˆ‘æ”¹è¿›è¿‡çš„ JD-GUI</h4><p>æ¬ä¸çŸ¥è€»çš„æ¨èä¸€ä¸‹æˆ‘<a href="https://github.com/Tao93/jd-gui" target="_blank" rel="noopener">æ›´æ”¹è¿‡çš„ JD-GUI</a>ã€‚<a href="https://github.com/java-decompiler/jd-gui" target="_blank" rel="noopener">JD-GUI</a> æœ¬æ¥æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œä½†æ˜¯å·²ç»3å¹´æ²¡æœ‰ç»´æŠ¤äº†ã€‚ä¸¤å¹´å‰ï¼Œå½“æ—¶å› ä¸ºå·¥ä½œéœ€è¦ï¼Œæˆ‘è¦é¢‘ç¹çš„è§£å‹ apkï¼ŒæŠŠ dex æ–‡ä»¶è½¬æˆ jarï¼Œç„¶åå†ç”¨ JD-GUI åç¼–è¯‘æŸ¥çœ‹ä»£ç æ³¨å…¥æ•ˆæœï¼Œæ‰€ä»¥æˆ‘å°±æƒ³ï¼Œè¿™ä¹ˆä¸‰ä¸ªæ­¥éª¤èƒ½ä¸èƒ½ä¸€æ­¥æå®šã€‚äºæ˜¯ç»è¿‡ä¸€ä¸ªå‘¨æœ«çš„åŠªåŠ›ï¼Œæˆ‘å°æ”¹äº†ä¸€ä¸‹ JD-GUIï¼Œä½¿å…¶æ”¯æŒç›´æ¥æ‹–å…¥ apk æ–‡ä»¶ï¼Œç„¶åè‡ªåŠ¨è§£å‹ï¼Œè‡ªåŠ¨è°ƒç”¨ apktool æ¥å°† dex è½¬æˆ jar æ–‡ä»¶ï¼Œç„¶åå†äº¤ç»™åŸ JD-GUI åç¼–è¯‘ã€‚PSï¼šæˆ‘éå¸¸è´´å¿ƒçš„æä¾›äº† macOSã€Windowsã€Linux ä¸‰ä¸ªå¹³å°çš„ binary åŒ…ã€‚</p><h4 id="the-Unarchiver-for-macOS"><a href="#the-Unarchiver-for-macOS" class="headerlink" title="the Unarchiver for macOS"></a><a href="https://itunes.apple.com/cn/app/the-unarchiver/id425424353?mt=12" target="_blank" rel="noopener">the Unarchiver</a> for macOS</h4><p>macOS è‡ªå¸¦çš„è§£å‹å·¥å…·æ¯”è¾ƒå¼±é¸¡ï¼Œæ¯”å¦‚ jar æ–‡ä»¶æ— æ³•è§£å‹ï¼Œä¸€äº›åˆ«çš„å‹ç¼©åŒ…è§£å‹æ—¶ä¹Ÿä¼šå‡ºå¹ºè›¾å­ã€‚è€Œè¿™æ¬¾ the Unarchiver for macOS ä½“ç§¯ä¸å¤§ï¼Œç®€æ´å´å¯ä»¥åº”ä»˜å‡ ä¹æ‰€æœ‰çš„è§£å‹åœºæ™¯ï¼Œè¿˜èƒ½æä¾›é€‰æ‹© charset çš„æœºä¼šï¼Œä»è€Œè§£å‹æŸäº›å‹ç¼©åŒ…æ—¶é¿å…æ–‡ä»¶åä¹±ç ã€‚</p><h4 id="USTC-Mirror"><a href="#USTC-Mirror" class="headerlink" title="USTC Mirror"></a><a href="http://mirrors.ustc.edu.cn/" target="_blank" rel="noopener">USTC Mirror</a></h4><p>åœ¨æ­¤æ¨èä¸€ä¸‹ä¸­å›½ç§‘å¤§å¼€æºé•œåƒï¼Œè¿™ä»½é•œåƒå¯ä»¥ä½¿å¾—åœ¨å›½å†…è®¿é—®å¾ˆå¤šå¼€æºè½¯ä»¶çš„é€Ÿåº¦é£èµ·æ¥ã€‚</p><p>æ¯”å¦‚<a href="http://mirrors.ustc.edu.cn/help/pypi.html" target="_blank" rel="noopener">ç»™ pip è®¾ç½®ä»£ç†</a>ï¼Œå¯ä»¥è®© pip ä¸‹è½½ Python æ‰©å±•åŒ…çš„é€Ÿåº¦å¿«å¾—é£èµ·ã€‚</p><p>å†æ¯”å¦‚ä½¿ç”¨<a href="https://lug.ustc.edu.cn/wiki/mirrors/help/aosp" target="_blank" rel="noopener">ä¸­å›½ç§‘å¤§çš„ AOSP é•œåƒ</a>ï¼Œè·å– AOSP é¡¹ç›®çš„æºç  (å‡ å GB å¤§å°) çš„é€Ÿåº¦å°†è¦åŠ å¿«å¾ˆå¤šï¼Œå¦‚æœä¸ä½¿ç”¨ä»£ç†ï¼Œé‚£ä¹ˆä» <a href="https://source.android.com/setup/build/downloading" target="_blank" rel="noopener">Google å®˜æ–¹åŒæ­¥ AOSP ä»£ç </a>ï¼Œå…¶éš¾åº¦ä½ æ‡‚çš„ã€‚</p><p>å†å†æ¯”å¦‚ï¼Œéå¸¸æµè¡Œçš„ <a href="https://brew.sh/" target="_blank" rel="noopener">Homebrew</a>ï¼Œæ˜¯ macOS å¹³å°ä¸Šä½¿ç”¨å‘½ä»¤è¡Œç®¡ç†è½¯ä»¶åŒ…åŠå®ƒä»¬çš„ä¾èµ–å…³ç³»çš„å·¥å…·ï¼Œå¥½æ¯”æ˜¯ Linux çš„åŒ…ç®¡ç†ç³»ç»Ÿã€‚æ­¤å¤– Homebrew ä½¿ç”¨ cask tap ç”šè‡³è¿˜å¯ä»¥å®‰è£… Sublime textï¼ŒChrome ç­‰è®¸å¤šçš„ GUI è½¯ä»¶ï¼Œå¹¶è‡ªåŠ¨å»ºç«‹è½¯é“¾æ¥é“¾æ¥åˆ° GUI çš„è½¯ä»¶çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ¯”å¦‚ Sublime textï¼Œä½¿ç”¨ Homebrew å®‰è£…åï¼Œå°±å¯ä»¥åœ¨å‘½ä»¤è¡Œä½¿ç”¨ subl å³å¯æ‰“å¼€ Sublime text äº†ã€‚æ‰¯è¿œäº†ï¼ŒHomebrew åŒæ ·å­˜åœ¨åœ¨å›½å†…ä¸‹è½½è½¯ä»¶é€Ÿåº¦æ…¢çš„é—®é¢˜ï¼Œè€ŒåŒæ ·ï¼Œä¸­å›½ç§‘å¤§é•œåƒæä¾›äº† <a href="http://mirrors.ustc.edu.cn/help/homebrew-bottles.html" target="_blank" rel="noopener">Homebrew é•œåƒ</a>ï¼Œèƒ½è®©ç»å¤§éƒ¨åˆ†åŒ…çš„ä¸‹è½½é€Ÿåº¦å¿«èµ·æ¥ã€‚</p><p>æœ€åï¼Œå…ˆå¯¹ USTC Mirror çš„ç»´æŠ¤è€…è¡¨ç¤ºæ„Ÿè°¢ã€‚ç„¶åï¼Œæˆ‘æƒ³è¯´è¿™ä¸ªé•œåƒçš„å†…å®¹éå¸¸å¤šï¼Œç»å¤§éƒ¨åˆ†æˆ‘ä¹Ÿä¸äº†è§£ï¼Œä¹Ÿå°±æ˜¯è¿˜æœ‰å¾ˆå¤šå¯ä»¥æ·±å…¥æ¢ç´¢çš„ä¸œè¥¿ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å¸¸ç”¨çš„ Bash å‘½ä»¤æ€»ç»“</title>
      <link href="/2018/09/26/%E5%B8%B8%E7%94%A8%E7%9A%84%20Bash%20%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/"/>
      <url>/2018/09/26/%E5%B8%B8%E7%94%A8%E7%9A%84%20Bash%20%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/</url>
      <content type="html"><![CDATA[<p>è¿™ç¯‡è®°å½•æ˜¯æˆ‘çœ‹ <a href="http://linuxcommand.org/tlcl.php" target="_blank" rel="noopener">The Linux Command Line</a> åä¸ºäº†æ€»ç»“è€Œå†™çš„ï¼Œç›®çš„æ˜¯ä¾¿äºè‡ªå·±éšæ—¶æŸ¥é˜…ã€‚The Linux Command Line æ˜¯æˆ‘ç›¸å½“å–œæ¬¢çš„ä¸€æœ¬ç”µå­ä¹¦ï¼Œå®ƒæ˜¯ä¸€æœ¬å€¼å¾—ä¸€é¡µä¸€é¡µçœ‹ä¸‹å»çš„ä¹¦ã€‚</p><p><strong>cp</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»…å¤åˆ¶ç›®æ ‡ç›®å½•ä¸å­˜åœ¨æˆ–è€…å­˜åœ¨ä½†æ˜¯æ›´æ—§çš„çš„é¡¹ã€‚ </span></span><br><span class="line">cp -u </span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœ file2 å·²ç»å­˜åœ¨, file2 çš„å†…å®¹ä¼šè¢« file1 çš„å†…å®¹é‡å†™ã€‚å¦‚æœ file2 ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºå®ƒã€‚ </span></span><br><span class="line">cp file1 file2 </span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœç›®å½• dir2 ä¸å­˜åœ¨ï¼Œåˆ›å»ºç›®å½• dir2ï¼Œæ“ä½œå®Œæˆåï¼Œç›®å½• dir2 ä¸­çš„å†…å®¹å’Œ dir1 ä¸­çš„ä¸€æ ·ã€‚å¦‚æœç›®å½• dir2 å­˜åœ¨ï¼Œåˆ™ç›®å½• dir1 å’Œå…¶ä¸­çš„å†…å®¹å°†ä¼šè¢«å¤åˆ¶åˆ° dir2 ä¸­ã€‚ </span></span><br><span class="line">cp -r dir1 dir2</span><br></pre></td></tr></table></figure><p><strong>mv</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»…ç§»åŠ¨ç›®æ ‡ç›®å½•ä¸å­˜åœ¨æˆ–è€…å­˜åœ¨ä½†æ˜¯æ›´æ—§çš„çš„é¡¹ã€‚ </span></span><br><span class="line">mv -u </span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœç›®å½• dir2 ä¸å­˜åœ¨ï¼Œåˆ›å»ºç›®å½• dir2ï¼Œå¹¶ä¸”ç§»åŠ¨ç›®å½• dir1 çš„å†…å®¹åˆ°ç›®å½• dir2 ä¸­ï¼ŒåŒæ—¶åˆ é™¤ç›®å½• dir1ã€‚å¦‚æœç›®å½• dir2 å­˜åœ¨ï¼Œç§»åŠ¨ç›®å½• dir1( å®ƒçš„å†…å®¹)åˆ°ç›®å½• dir2 ä¸­ã€‚ </span></span><br><span class="line">mv dir1 dir2</span><br></pre></td></tr></table></figure><p><strong>rm</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è­¦æƒ•ä¸å°å¿ƒå†™å‡º rm * .html è¿™æ ·çš„å‘½ä»¤ï¼Œè¿™ä¼šåˆ é™¤å½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶ã€‚</span></span><br></pre></td></tr></table></figure><p><strong>å‘½ä»¤çš„4ä¸­å½¢å¼</strong></p><ol><li>executable file, å¯ä»¥æ˜¯äºŒè¿›åˆ¶çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯æ–‡æœ¬å½¢å¼çš„è„šæœ¬ï¼›</li><li>builtins, å³ /bin ä¸‹é¢çš„ [, echo, kill, pwd, test å’Œ /usr/bin ä¸‹é¢çš„ alias, bg, cd, command, false, fc, fg, getopts, hash, jobs, printf, read, true, type, ulimit, umask, unalias, wait, whichï¼›</li><li>shell å‡½æ•°</li><li>alias å®šä¹‰çš„åˆ«å</li></ol><p><strong>type</strong></p><p>typeæ˜¯ä¸€ä¸ªæå…¶æœ‰ç”¨çš„å‘½ä»¤ï¼Œèƒ½ç«‹é©¬æ‰¾åˆ°å½“å‰ç¯å¢ƒèƒ½ç”¨çš„å‘½ä»¤æ˜¯æºè‡ªå“ªé‡Œï¼Œæ˜¯ä»€ä¹ˆç±»å‹çš„ã€‚ç¤ºä¾‹ï¼š</p><blockquote><p>âœ  ~ type Python3<br>Python3 is /Users/didi/.bin/Python3<br>âœ  ~ ls -l /Users/didi/.bin/Python3<br>lrwxr-xr-x  1 didi  staff  22  4 25 10:06 /Users/didi/.bin/Python3 -&gt; /usr/local/bin/python3<br>âœ  ~ type [<br>[ is a shell builtin<br>âœ  ~ type ls<br>ls is an alias for ls -G</p></blockquote><p><strong>where</strong></p><p>whereå‘½ä»¤çš„æœ‰ç”¨ä¹‹å¤„æ˜¯å®ƒå¯ä»¥åˆ—å‡ºæ‰€æœ‰å‡ºç°çš„åœ°æ–¹ï¼Œæ¯”å¦‚ç”µè„‘é‡Œé¢æœ‰ä¸¤ä¸ª git å¯æ‰§è¡Œæ–‡ä»¶ï¼Œé‚£ä¹ˆ where git å¯ä»¥æŠŠå®ƒä»¬ç»Ÿç»Ÿåˆ—å‡ºæ¥ã€‚</p><p><strong>man æ‰‹å†Œçš„ç« èŠ‚å«ä¹‰</strong></p><ol><li>ç”¨æˆ·å‘½ä»¤</li><li>ç¨‹åºæ¥å£å†…æ ¸ç³»ç»Ÿè°ƒç”¨</li><li>åº“å‡½æ•°ç¨‹åºæ¥å£</li><li>ç‰¹æ®Šæ–‡ä»¶ï¼Œæ¯”å¦‚è¯´è®¾å¤‡ç»“ç‚¹å’Œé©±åŠ¨ç¨‹åº</li><li>æ–‡ä»¶æ ¼å¼</li><li>æ¸¸æˆå¨±ä¹ï¼Œå¦‚å±å¹•ä¿æŠ¤ç¨‹åº</li><li>å…¶ä»–æ–¹é¢</li><li>ç³»ç»Ÿç®¡ç†å‘˜å‘½ä»¤</li></ol><p><strong>&gt; file_name</strong></p><p>å·§å¦™çš„ä½¿ç”¨é‡å®šå‘ï¼Œå¯ä»¥å°†æ–‡æœ¬æ–‡ä»¶çš„å†…å®¹æ¸…ç©ºï¼Œä¹Ÿå¯ä»¥æ–°å»ºä¸€ä¸ªç©ºæ–‡ä»¶ã€‚</p><p><strong>é‡å®šå‘çš„å¸¸è§ç”¨æ³•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¦†ç›–å‹é‡å®šå‘ stdoutï¼Œå¯ä»¥çœç•¥é‚£ä¸ª 1 </span></span><br><span class="line">ls ~ 1&gt; out.txt </span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿½åŠ æ€§é‡å®šå‘ stdoutï¼Œå¯ä»¥çœç•¥é‚£ä¸ª 1 </span></span><br><span class="line">ls ~ 1&gt;&gt; out.txt </span><br><span class="line"></span><br><span class="line"><span class="comment"># è¦†ç›–å‹é‡å®šå‘ stderr </span></span><br><span class="line">ls ~ 2&gt; out.txt </span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿½åŠ æ€§é‡å®šå‘ stdout </span></span><br><span class="line">ls ~ 2&gt;&gt; out.txt</span><br></pre></td></tr></table></figure><p><strong>/dev/null</strong></p><p>éšæ„æ”¾ä¸œè¥¿è¿›å»çš„åƒåœ¾ç®±</p><p><strong>èŠ±æ‹¬å·å±•å¼€</strong></p><p>echo Front-{A..D}â€“Back å°†ä¼šè¾“å‡ºå››é¡¹å†…å®¹ï¼Œå³ {A..D} è¡¨ç¤ºä» A åˆ° D ä¸€å…±å››ä¸ªæƒ…å†µã€‚</p><p><strong>å°†å‘½ä»¤æ‰§è¡Œç»“æœå±•å¼€</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åªéœ€è¦æŠŠå‘½ä»¤æ”¾åœ¨ $() é‡Œé¢å³å¯ï¼Œæ—§ç‰ˆ shell ä¹Ÿä½¿ç”¨æŠŠå‘½ä»¤æ”¾åœ¨ `` ä¸­é—´çš„æ–¹å¼ </span></span><br><span class="line"><span class="built_in">echo</span> $(ls)</span><br></pre></td></tr></table></figure><p><strong>å¼•å·</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŒå¼•å·ä¸­ï¼Œå‚æ•°å±•å¼€ï¼Œç®—æœ¯è¡¨è¾¾å¼å±•å¼€ï¼Œå’Œå‘½ä»¤æ›¿æ¢ä»ç„¶æœ‰æ•ˆï¼Œæ¯”å¦‚ </span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$USER</span> <span class="variable">$((2+2)</span>) <span class="variable">$(cal)</span>"</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># å•å¼•å·ä¸­ï¼Œæ‰€æœ‰å±•å¼€éƒ½æ— æ•ˆ</span></span><br></pre></td></tr></table></figure><p><strong>å‘½ä»¤è¡Œç§»åŠ¨å…‰æ ‡</strong></p><blockquote><p>ctrl a # ç§»åŠ¨åˆ°è¡Œé¦–</p><p>ctrl e # ç§»åŠ¨åˆ°è¡Œæœ«</p><p>alt &lt;- # å·¦ç§»ä¸€ä¸ª word</p><p>alt -&gt; # å³ç§»ä¸€ä¸ª word</p><p>ctrl u # å‰ªåˆ‡æ•´è¡Œå†…å®¹</p><p>ctrl k # å‰ªåˆ‡å…‰æ ‡åé¢çš„å†…å®¹</p><p>ctrl y # ç²˜è´´</p></blockquote><p><strong>ç®¡ç†è¿›ç¨‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºç»ˆç«¯ç›¸å…³è¿›ç¨‹</span></span><br><span class="line">ps </span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰è¿›ç¨‹</span></span><br><span class="line">ps x </span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">ps aux </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºä»ç»ˆç«¯å¯åŠ¨çš„åå°è¿›ç¨‹</span></span><br><span class="line"><span class="built_in">jobs</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># è®©æŒ‡å®šåºå·çš„ä»ç»ˆç«¯å¯åŠ¨çš„è¿›ç¨‹è¿”å›åˆ°å‰å°</span></span><br><span class="line"><span class="built_in">fg</span> %JOB_SPEC </span><br><span class="line"></span><br><span class="line"><span class="comment"># è®©æŒ‡å®šåºå·çš„ä»ç»ˆç«¯å¯åŠ¨çš„è¿›ç¨‹è¿”å›åˆ°åå°</span></span><br><span class="line"><span class="built_in">bg</span> %JOB_SPEC </span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»™è¿›ç¨‹å‘é€ä¿¡å·ï¼Œæœ€å¸¸è§çš„ä¿¡å·æ˜¯ï¼š</span></span><br><span class="line"><span class="built_in">kill</span> -SIG_NUM PID </span><br><span class="line">    1  HUP  æŒ‚èµ·</span><br><span class="line">    2  INT  ä¸­æ–­ï¼Œå’Œ ctrl c çš„ä½œç”¨ä¸€æ ·</span><br><span class="line">    9  KILL æ€æ­»ï¼Œè¿™ä¸ªä¿¡å·å¹¶ä¸ä¼šå‘ç»™è¿›ç¨‹å·æ˜¯ PID çš„è¿›ç¨‹ï¼Œè€Œæ˜¯ç«‹å³å¼ºåˆ¶åœæ­¢æ­¤è¿›ç¨‹ï¼Œè¢«æ€è¿›ç¨‹å°±æ²¡æœ‰æœºä¼šä¿å­˜æ•°æ®</span><br><span class="line">    15 TERM <span class="built_in">kill</span> å‘½ä»¤çš„é»˜è®¤ä¿¡å·ï¼Œç»ˆæ­¢è¿›ç¨‹ï¼Œè¢«ä¸­æ­¢çš„è¿›ç¨‹æœ‰æœºä¼šä¿å­˜æ•°æ®</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Bash </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>åšå®¢ç³»ç»Ÿè¿ç§»è®°å½•</title>
      <link href="/2018/09/26/%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB%E8%AE%B0%E5%BD%95/"/>
      <url>/2018/09/26/%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB%E8%AE%B0%E5%BD%95/</url>
      <content type="html"><![CDATA[<p>æ­¤å‰æˆ‘ç”¨çš„æ˜¯ <a href="http://www.zblogcn.com/" target="_blank" rel="noopener">Z-blog ç³»ç»Ÿ</a>ï¼Œè¿™ä¸ªç³»ç»Ÿä¸Šæ‰‹ç®€å•ï¼Œä¸è¿‡ä»…æ”¯æŒåœ¨ç½‘é¡µåœ¨çº¿ç¼–å†™æ–‡ç« ã€‚è¿™ç§æ–¹å¼å¼Šç«¯æ˜¯æ¯”è¾ƒæ­»æ¿ï¼Œå¦‚æœå°†æ¥éœ€è¦æŠŠæ–‡ç« ç§»åŠ¨åˆ°åˆ«çš„åœ°æ–¹ä¼šå¾ˆéº»çƒ¦ï¼Œè€Œå¦‚æœæ˜¯ç”¨ MarkDown æ¥å†™æ–‡ç« å°±ä¸ä¼šæœ‰è¿™ä¸ªéº»çƒ¦äº†ã€‚æœ¬æ–‡å°±è¯¦ç»†è®°å½•è¿™æ¬¡åšå®¢ç³»ç»Ÿè¿ç§»çš„ç»†èŠ‚ï¼ŒåŒ…å« Linux ç³»ç»Ÿé…ç½®ã€Nginx çš„é…ç½®ã€<a href="https://hexo.io/" target="_blank" rel="noopener">hexo</a> çš„é…ç½®å’Œ deploy è„šæœ¬ç­‰å†…å®¹ã€‚</p><p>é¦–å…ˆæ˜¯ï¼Œè¿™æ¬¡åˆæŠŠ VPS çš„ Server ç¡¬ç›˜é‡ç½®äº†ï¼Œæ¯æ¬¡é‡ç½®åéƒ½éœ€è¦é‡æ–°è®¾ç½®é…ç½®ä¸€é Linux ç³»ç»Ÿï¼ˆæˆ‘çš„ VPS æ˜¯ Ubuntu 16.04ï¼‰ï¼Œæ‰€ä»¥è¿™æ¬¡è®°å½•ä¸€ä¸‹é…ç½®çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯å„ç§é…ç½®å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">adduser liutao <span class="comment"># add user, with root user</span></span><br><span class="line">usermod -aG sudo liutao <span class="comment"># add sudo permission, with root user</span></span><br><span class="line">su - liutao <span class="comment"># switch to user liutao</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># update repository info</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get upgrade</span><br><span class="line"></span><br><span class="line"><span class="comment"># configure shadowsocks</span></span><br><span class="line">sudo apt install python-pip</span><br><span class="line">sudo pip install shadowsocks</span><br><span class="line">sudo mkdir /etc/shadowsocks</span><br><span class="line"></span><br><span class="line"><span class="comment"># create config file</span></span><br><span class="line">sudo vim /etc/shadowsocks/ss.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"server"</span>:<span class="string">"0.0.0.0"</span>,</span><br><span class="line">    <span class="string">"server_port"</span>:22222,</span><br><span class="line">    <span class="string">"local_port"</span>:1080,</span><br><span class="line">    <span class="string">"password"</span>:<span class="string">"your pass word"</span>,</span><br><span class="line">    <span class="string">"timeout"</span>:1000,</span><br><span class="line">    <span class="string">"method"</span>:<span class="string">"aes-256-cfb"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># add service configuration info,.</span></span><br><span class="line">sudo vim /etc/systemd/system/shadowsocks.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Shadowsocks Server</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/bin/ssserver -c /etc/shadowsocks/ss.json</span><br><span class="line">Restart=on-abort</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"><span class="comment"># start shadowsocks service</span></span><br><span class="line">sudo systemctl start shadowsocks</span><br><span class="line"></span><br><span class="line"><span class="comment"># start shadowsocks on startup</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> shadowsocks</span><br><span class="line"></span><br><span class="line"><span class="comment"># install linuxbrew</span></span><br><span class="line">sh -c <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/Linuxbrew/install/master/install.sh)</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># install zsh</span></span><br><span class="line">sudo apt-get install zsh</span><br><span class="line"></span><br><span class="line"><span class="comment"># install oh my zsh, this dependends on zsh</span></span><br><span class="line">sh -c <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)</span>"</span></span><br><span class="line">vim .zshrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># install Nginx, MySQL, Php</span></span><br><span class="line">wget http://soft.vpser.net/lnmp/lnmp1.5-full.tar.gz</span><br><span class="line">gunzip lnmp1.5-full.tar.gz</span><br><span class="line">tar xf lnmp1.5-full.tar</span><br><span class="line"><span class="built_in">cd</span> lnmp1.5-full</span><br><span class="line">sudo ./install.sh lnmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># install word-press</span></span><br><span class="line">wget https://wordpress.org/latest.zip</span><br><span class="line">unzip latest.zip -d wordpress</span><br><span class="line"></span><br><span class="line"><span class="comment"># set root to be/home/liutao/wordpress</span></span><br><span class="line">sudo vim /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br><span class="line">sudo nginx -s reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶åæœ¬åœ°æµè§ˆå™¨æ‰“å¼€ http://tao93.top/ å¼€å§‹è®¾ç½® WordPress</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># create database named wordpress</span></span><br><span class="line">mysql -u root -p</span><br><span class="line">&gt; create database wordpress</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶ååœ¨æµè§ˆå™¨ä¸­å¡«å…¥åˆšåˆšçš„ database åå­—ï¼ŒåŠå…¶ä»–ä¿¡æ¯</span></span><br><span class="line"><span class="comment"># åœ¨ server ä¸­çš„ WordPress æ ¹ç›®å½•ä¸­åˆ›å»º wp-config.php å¹¶å¡«å…¥æµè§ˆå™¨é¡µé¢æ˜¾ç¤ºçš„å†…å®¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¾åˆ° nginx ä½¿ç”¨çš„ config æ–‡ä»¶</span></span><br><span class="line">sudo nginx -t</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºäº†è§£å†³ä¸€äº›æƒé™é—®é¢˜ï¼Œwww æ˜¯ nginx é…ç½®æ–‡ä»¶ä¸­å£°æ˜çš„ web server çš„ user name</span></span><br><span class="line"><span class="comment"># è¿™æ ·å°±æŠŠ group æ”¹ä¸ºäº† wwwï¼Œå¹¶ä¸” group ç”¨æˆ·éƒ½æœ‰ write çš„æƒé™</span></span><br><span class="line">sudo chgrp -R www &lt;root_dir_of_wordpress&gt;</span><br><span class="line">sudo chmod -R g+w &lt;root_dir_of_wordpress&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦å¤–è¿˜åœ¨ &lt;root_dir_of_wordpress&gt; ä¸­çš„ wp-config.php æ–‡ä»¶ä¸­æ’å…¥äº† define('FS_METHOD','direct'); è¿™æ ·ä¸€è¡Œï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯å¿…è¦çš„</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå°±æ˜¯æœ€ç»ˆé…ç½®åˆ° WordPress çš„è¿‡ç¨‹ã€‚ä¹‹æ‰€ä»¥é…ç½® WordPressï¼Œæ˜¯å› ä¸ºæˆ‘æŸ¥åˆ° WordPress å¯ä»¥ä½¿ç”¨ Markdownï¼Œå¦å¤– WordPress è‡ªå¸¦è¯„è®ºåŠŸèƒ½ï¼Œæ’ä»¶å’Œä¸»é¢˜ä¹Ÿéå¸¸ä¸°å¯Œï¼Œæ‰€ä»¥å°±å…ˆä½¿ç”¨ WordPressã€‚ç»“æœå‘ç° WordPress çš„ Markdown è¿˜éœ€è¦å®‰è£…æ’ä»¶æ‰èƒ½æ”¯æŒï¼Œå¦å¤–æ”¯æŒä¹Ÿä¸æ˜¯å¾ˆå¥½ï¼Œæ¯”å¦‚ä»£ç å—ä¼šæŠŠæ¯”è¾ƒé•¿çš„è¡Œè½¬è¡Œæ˜¾ç¤ºï¼ˆå³ä¸æ˜¯å¯ä»¥å·¦å³æ»‘åŠ¨ï¼‰ï¼Œä»£ç è¡Œå·ä¸é«˜äº®éƒ½æ²¡è¦ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘è¿˜æ˜¯ç—›ä¸‹å†³å¿ƒï¼Œæ¢å›åˆ° hexoã€‚hexo æ¯”è¾ƒç®€å•ï¼Œæœ¬åœ°å®‰è£… hexo åï¼Œåœ¨ç©ºç›®å½•ä¸­æ‰§è¡Œ hexo init å³å¯ç”Ÿæˆä¸€å †ç›¸å…³æ–‡ä»¶ï¼Œå…¶ä¸­çš„ public ç”¨æ¥å­˜æ”¾ä»å½“å‰ theme å’Œ markdown æ–‡ä»¶ç”Ÿæˆçš„ static web æ–‡ä»¶ï¼›è€Œ source ç›®å½•ç”¨æ¥å­˜æ”¾ markdown æ–‡ä»¶ã€‚ç®€å•ä½¿ç”¨æ­¥éª¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in hexo root directory</span></span><br><span class="line">hexo g <span class="comment"># generate static web files</span></span><br><span class="line"></span><br><span class="line">hexo server <span class="comment"># start local web server, then browse http://localhost:4000 to preview web pages</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># copy files in public to server's directory, therefore updated pages can be browsed at http://tao93.top/</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå°±æ˜¯ç®€å•çš„ç”¨æ³•ï¼Œä¸è¿‡å®é™…ä¸Šæˆ‘åšäº†ä¸€äº›é¢å¤–å·¥ä½œã€‚ä¾‹å¦‚ä¸ºäº†é¿å… markdown æ–‡ä»¶æ„å¤–ä¸¢å¤±ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒä»¬å¤‡ä»½åˆ° server ä¸Šï¼Œserver å’Œ local åŒæ—¶ä¸¢å¤±çš„å¯èƒ½æ€§æå°ã€‚å¦å¤–ï¼Œmarkdown ä¸­æ’å…¥å›¾ç‰‡æ—¶ï¼Œå¯ä»¥å…ˆæŠŠå›¾ç‰‡æ”¾åœ¨æœ¬åœ°ï¼Œç„¶å markdown ä¸­æŒ‡å‘å›¾ç‰‡çš„æœ¬åœ°è·¯å¾„ï¼Œè¿™æ ·ç”Ÿæˆçš„ web æ–‡ä»¶ä¼šæŠŠå›¾ç‰‡æ‹·è´åˆ° public ç›®å½•ä¸­æŸå¤„ï¼Œç„¶å html æ–‡ä»¶å¼•ç”¨ public ç›®å½•ä¸­çš„ imageï¼Œè¿™æ—¶çš„å¼•ç”¨å…¶å®å°±æ˜¯ä¸€ä¸ª url äº†ã€‚ä½†æ˜¯æˆ‘ä¸æ˜¯è¿™æ ·åšçš„ï¼Œæˆ‘æ˜¯å…ˆæŠŠè¦æ’å…¥çš„å›¾ç‰‡æ‹·è´åˆ° Server çš„ public ç›®å½•æŸå¤„ï¼Œè¿™æ ·å°±ä¼šå¾—åˆ°ä¸€ä¸ªæŒ‡å‘æ¬¡å›¾ç‰‡çš„ urlï¼Œç„¶åå† markdown ä¸­ç›´æ¥ä½¿ç”¨è¿™ä¸ª urlã€‚è¿™æ ·çš„è¯ï¼Œåªè¦ server çš„å›¾ç‰‡åº“ä¿æŒç¨³å®šï¼Œmarkdown æ–‡ä»¶å°±ä¸ç”¨å’Œæœ¬åœ°å›¾ç‰‡åº“ç»‘å®šåœ¨ä¸€èµ·ã€‚åŒæ ·çš„ï¼Œserver çš„å›¾ç‰‡åº“ä¹Ÿéœ€è¦å¤‡ä»½åˆ° localï¼Œä»¥ç¡®ä¿å®‰å…¨ã€‚ä¸‹é¢å°±å¼€å§‹ä»‹ç»ä»¥ä¸Šä¸¤ç‚¹ã€‚</p><p>é¦–å…ˆæ˜¯æœ¬åœ° source ç›®å½•éœ€è¦å¤‡ä»½åˆ° server ä¸Šï¼Œæˆ‘çš„æ–¹å¼æ˜¯æœ¬åœ° source ç›®å½•ä½¿ç”¨ git æ¥è¿½è¸ªï¼Œç„¶å server ä¸Šç®€å†ä¸€ä¸ª bare repository source.gitï¼Œè¿™æ ·æœ¬åœ°çš„æ¯æ¬¡ commit éƒ½ push åˆ° server ä¸Šçš„ source.gitï¼Œå°±å¯ä»¥ä½œä¸ºå¤‡ä»½äº†ã€‚ç›¸åº”çš„æœ¬åœ°çš„ public ç›®å½•ä¹Ÿè¦ push åˆ° server ä¸Šçš„ public.git è¿™æ ·ä¸€ä¸ª bare repositoryï¼Œç„¶ååœ¨ server ä¸Šçš„ public ä¸­ï¼Œä» public.git è¿™ä¸ª remote git pull ä¸€ä¸‹ï¼Œè¿™æ · server ä¸­çš„ public å°±æœ‰äº†æœ€æ–°çš„ web æ–‡ä»¶ã€‚</p><p>æ¥ä¸‹æ¥æ˜¯å›¾ç‰‡ä¸Šä¼ åˆ° server ä¸­ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘å†™äº†ä¸€ä¸ª Python è„šæœ¬ï¼Œç”¨æ¥æŠŠæœ¬åœ°å›¾ç‰‡ä¸Šä¼ åˆ° serverï¼Œæˆ–è€…æŠŠå‰ªè´´æ¿çš„å›¾ç‰‡ (ä¾¿äºå¤åˆ¶å›¾ç‰‡çš„æƒ…æ™¯) ä¸Šä¼ åˆ° serverï¼Œç„¶åå°†å¯¹åº”çš„ url ç²˜è´´åˆ°å‰ªè´´æ¿ï¼Œè¿™æ ·çš„è¯ï¼Œåªéœ€è¦æ‰§è¡Œè¿™ä¸ª Python è„šæœ¬ï¼Œå°±å¯ä»¥ä¸Šä¼ æœ¬åœ°å›¾ç‰‡æˆ–è€…å‰ªè´´æ¿ä¸Šçš„å›¾ç‰‡ï¼Œå¹¶æŠŠå¾—åˆ°çš„ url å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œç„¶åå°±å¯ä»¥ç›´æ¥ç²˜è´´åˆ° markdown ä¸­ã€‚ä»¥ä¸‹æ˜¯è¿™ä¸ª upload_pic.py è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> ImageGrab, Image</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">now = datetime.datetime.now()</span><br><span class="line"></span><br><span class="line"><span class="comment"># store image files in date format directory path in server</span></span><br><span class="line">date_path = now.strftime(<span class="string">'%Y/%m/%d'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># use timestamp as image file name in server</span></span><br><span class="line">f_name = str(int(now.timestamp()))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(sys.argv) == <span class="number">1</span>:</span><br><span class="line">    <span class="comment"># get picture in clipboard</span></span><br><span class="line">    im = ImageGrab.grabclipboard()</span><br><span class="line">    <span class="comment"># check whether it's a picture</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(im, Image.Image):</span><br><span class="line">    </span><br><span class="line">        <span class="comment"># file name in server</span></span><br><span class="line">        f_name = str(int(datetime.datetime.now().timestamp())) + <span class="string">'.png'</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># save in local</span></span><br><span class="line">        im.save(f_name)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># the url of the image</span></span><br><span class="line">        url = <span class="string">'http://tao93.top/images/'</span> + date_path + <span class="string">'/'</span> + f_name</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># copy the url to clipboard</span></span><br><span class="line">        os.system(<span class="string">"echo '%s' | pbcopy"</span> % url)</span><br><span class="line">        print(<span class="string">'url has been copied'</span>)</span><br><span class="line">        print(<span class="string">'copying...'</span>)</span><br><span class="line">        dest_path = <span class="string">'/home/liutao/hexo_blog/public/images/'</span> + date_path</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># mkdir in server and copy the image</span></span><br><span class="line">        os.system(<span class="string">"ssh liutao@tao93.top 'mkdir -p "</span> + dest_path + <span class="string">"'"</span>)</span><br><span class="line">        os.system(<span class="string">'scp '</span> + f_name + <span class="string">' liutao@tao93.top:'</span> + dest_path)</span><br><span class="line">        print(<span class="string">'copy finished'</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># remove local image file</span></span><br><span class="line">        os.remove(f_name)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">'clipboard content is not a image!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> len(sys.argv) == <span class="number">2</span>:</span><br><span class="line">    <span class="keyword">if</span> os.path.isfile(sys.argv[<span class="number">1</span>]):</span><br><span class="line">        <span class="comment"># file name in server</span></span><br><span class="line">        f_name = str(int(datetime.datetime.now().timestamp()))</span><br><span class="line">        dot_loc = sys.argv[<span class="number">1</span>].rfind(<span class="string">'.'</span>)</span><br><span class="line">        <span class="keyword">if</span> dot_loc &gt;= <span class="number">0</span>:</span><br><span class="line">            f_name += sys.argv[<span class="number">1</span>][dot_loc:] <span class="comment"># append the file extension</span></span><br><span class="line">        </span><br><span class="line">        url = <span class="string">'http://tao93.top/images/'</span> + date_path + <span class="string">'/'</span> + f_name</span><br><span class="line">        os.system(<span class="string">"echo '%s' | pbcopy"</span> % url)</span><br><span class="line">        print(<span class="string">'url has been copied'</span>)</span><br><span class="line">        print(<span class="string">'copying...'</span>)</span><br><span class="line">        dest_path = <span class="string">'/home/liutao/hexo_blog/public/images/'</span> + date_path</span><br><span class="line">        os.system(<span class="string">"ssh liutao@tao93.top 'mkdir -p "</span> + dest_path + <span class="string">"'"</span>)</span><br><span class="line">        os.system(<span class="string">'scp '</span> + sys.argv[<span class="number">1</span>] + <span class="string">' liutao@tao93.top:'</span> + dest_path + <span class="string">'/'</span> + f_name)</span><br><span class="line">        print(<span class="string">'copy finished'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(sys.argv[<span class="number">1</span>] + <span class="string">' is not a file!'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'too much arguments'</span>)</span><br></pre></td></tr></table></figure><p>ä¸ºäº†ç®€åŒ–æ­¥éª¤ï¼Œæˆ‘å†™äº†ä¸€ä¸ª deploy.sh è„šæœ¬æ”¾åœ¨æœ¬åœ° hexo blog æ ¹ç›®å½•ä¸­ï¼Œè¿™æ ·åªéœ€è¦åœ¨ source ç›®å½•ä¸­ç¼–è¾‘ markdown æ–‡ä»¶ï¼Œç„¶å commitï¼Œå†è°ƒç”¨ deploy.sh è„šæœ¬å³å¯ã€‚æ­¤è„šæœ¬æŠŠå…¶ä»–è¦åšçš„äº‹æƒ…éƒ½åšäº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># into source </span></span><br><span class="line"><span class="built_in">cd</span> <span class="built_in">source</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># make sure it's commited in source directory</span></span><br><span class="line">status=$(git status -s)</span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$status</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="comment"># git push in source</span></span><br><span class="line">    git push</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">'not commited in source directory!'</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># back into parent directory</span></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># generate static web files</span></span><br><span class="line">hexo g</span><br><span class="line"></span><br><span class="line"><span class="comment"># git push in local public directory</span></span><br><span class="line"><span class="built_in">cd</span> public</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">'update web files'</span></span><br><span class="line">git push</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># git pull in server's public directory</span></span><br><span class="line">ssh liutao@tao93.top <span class="string">'cd /home/liutao/hexo_blog/public; git pull'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># git commit in server's images directory</span></span><br><span class="line">ssh liutao@tao93.top <span class="string">'cd /home/liutao/hexo_blog/public/images; git add .; git commit -m "add images"'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># git pull in local's images directory</span></span><br><span class="line"><span class="built_in">cd</span> images</span><br><span class="line">git pull</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'========='</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'Finished!'</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'========='</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸Šé¢çš„è„šæœ¬å°±æŠŠç”Ÿæˆ web æ–‡ä»¶ï¼Œæ‹·è´ public ä¸­çš„ web æ–‡ä»¶æ‹·è´åˆ° serverï¼ŒæŠŠ server ä¸­çš„ image ç›®å½•ä¸­çš„ä¿¡æ¯æ›´æ–°åˆ° local çš„ images ç›®å½•è¿™æ ·å‡ ä¸ªäº‹æƒ…ã€‚</p><p>é™„ï¼š</p><p>å¦‚æœè¦æœ¬åœ° git repo æ²¡æœ‰ commitï¼Œremote repo æœ‰ commitï¼Œç°åœ¨éœ€è¦æœ¬åœ°çš„ master åˆ†æ”¯ track remote çš„ master åˆ†æ”¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…ˆæ·»åŠ  originï¼Œè®¾ç½®å¥½ url</span></span><br><span class="line">git remote add origin liutao@tao93.top:/home/liutao/hexo_blog/public/images/.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶å fetch ä¸€ä¸‹ è¿œç¨‹çš„çŠ¶æ€</span></span><br><span class="line">git fetch</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶å¦‚æœ git pull --set-upstream-to æ˜¯ä¸è¡Œçš„ï¼Œä¼šè¯´æœ¬åœ° master åˆ†æ”¯ä¸å­˜åœ¨ï¼Œè€Œéœ€è¦ä¸‹é¢è¿™æ ·æ‰è¡Œ</span></span><br><span class="line">git checkout master</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Other </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä¿®è½¦å°èƒ½æ‰‹ä¸Šçº¿</title>
      <link href="/2018/09/26/%E4%BF%AE%E8%BD%A6%E5%B0%8F%E8%83%BD%E6%89%8B%E4%B8%8A%E7%BA%BF/"/>
      <url>/2018/09/26/%E4%BF%AE%E8%BD%A6%E5%B0%8F%E8%83%BD%E6%89%8B%E4%B8%8A%E7%BA%BF/</url>
      <content type="html"><![CDATA[<p>ä¿®è½¦æŠ€æœ¯ä¹Ÿæ˜¯æŠ€æœ¯ï¼Œæ‰€ä»¥å…³äºä¿®è½¦çš„åšå®¢ä¹Ÿæ˜¯æŠ€æœ¯åšå®¢å•¦ ğŸ˜</p><p>äº‹æƒ…è¦ä»ä¸¤ä¸ªæœˆå‰è¯´èµ·ï¼Œå½“æ—¶åœ¨äº¬ä¸œä¹°äº†ä¸€è¾†ç²‰è‰²çš„æ¯”å¾·æ–‡ç”µåŠ¨è½¦ç»™å¥³æœ‹å‹ä¸Šä¸‹ç­ç”¨ã€‚è¿™è¾†ç”µåŠ¨è½¦æ¯”è¾ƒä¾¿å®œï¼Œå½“æ—¶æˆ‘ä»¬ä¹Ÿä¸æ€ä¹ˆæ³¨æ„é¢„é˜²ç”µåŠ¨è½¦è¢«é›¨æ·‹ï¼Œå› ä¸ºæ½œæ„è¯†è§‰å¾—ç»å¸¸çœ‹åˆ°åˆ«äººçš„ç”µåŠ¨è½¦è¢«é›¨æ·‹ï¼Œæ‰€ä»¥åº”è¯¥æ²¡äº‹ã€‚äº‹æƒ…åå°±ååœ¨è¿™è¾†ç”µåŠ¨è½¦é˜²æ°´æ€§çœŸä¸å¥½ï¼Œæ‰€ä»¥å‡ åœºå¤§é›¨ä¹‹åï¼Œè¿˜æ²¡åˆ°ä¸€ä¸ªæœˆï¼Œç”µåŠ¨è½¦å°±åäº†ï¼Œæ‹§è½¦æŠŠä¸Šçš„æ—‹é’®è½¦å­æ²¡ååº”ï¼Œä¹Ÿå°±æ˜¯ç”µæœºä¸è½¬äº†ã€‚</p><p>æœ¬ç€åº”è¯¥æœ‰ä¸“ä¸šäººå‘˜ (åé¢äº‹å®è¯æ˜ä¿®è½¦çš„çœŸä¸æ˜¯ä¸ªå¥½ä¸œè¥¿) ä¿®ç†çš„æ€åº¦ï¼Œå¤§çƒ­å¤©æˆ‘è´¹å°½åŠ›æ°”æŠŠç”µåŠ¨è½¦æ¨åˆ°äº†ä¿®è½¦é“ºã€‚ç­‰äº†åŠå¤©ä¿®è½¦çš„æ‰å§—å§—æ¥è¿Ÿçš„è¿‡æ¥äº†ã€‚ç„¶åä¿®è½¦çš„æ‰“å¼€ç”µåŠ¨è½¦åç›–ç§äº†ç§ï¼Œè¯´æ˜¯æ§åˆ¶å™¨åäº†ï¼Œéœ€è¦æ›´æ¢ï¼Œä»–åº—é‡Œçš„æ§åˆ¶å™¨ 80 å—é’±ä¸€ä¸ªã€‚è¿™æ—¶å€™æˆ‘å’Œå¥³æœ‹å‹å°±å’Œå‚å®¶è”ç³»ï¼Œå‚å®¶ç§°è¦ä¹ˆç»™æˆ‘ä»¬50å—é’±ï¼Œè¦ä¹ˆæˆ‘ä»¬æŠŠæ—§æ§åˆ¶å™¨å¯„å›å»ç„¶åä»–ä»¬å¯„ä¸€ä¸ªæ–°çš„å›æ¥ã€‚æˆ‘ä»¬å¿ƒæƒ³ï¼Œå¿«é€’å¯„æ§åˆ¶å™¨ä¸€æ¥ä¸€å›è¦å¥½å¤šå¤©ï¼Œè¿™äº›å¤©æˆ‘ä»¬çš„è½¦å­å°±è¦è¿™ä¹ˆæ™¾åœ¨ç¦»å®¶å‡ å…¬é‡Œçš„åœ°æ–¹ï¼Œè¿™æ€ä¹ˆèƒ½å¿ï¼æ‰€ä»¥æˆ‘ä»¬å’Œå‚å®¶æ’•é€¼ï¼Œæœ€ç»ˆå‚å®¶ç­”åº”ç»™æˆ‘ä»¬ 80 å—ï¼Œäºæ˜¯æˆ‘ä»¬å°±åœ¨åº—é‡Œæ¢äº†ä¸ªæ§åˆ¶å™¨ã€‚å‘çˆ¹çš„ä¿®è½¦çš„ï¼Œå¸®æˆ‘ä»¬æ¢æ§åˆ¶å™¨æ—¶æ…¢æ…¢è…¾è…¾ï¼Œä¸­é€”è¿˜åœä¸‹æ¥å¸®ä¸¤ä¸ªå¥³çš„é…é’¥åŒ™ï¼å½“æ—¶çœŸçš„æ˜¯å¾ˆæ°”æ„¤ï¼Œæ¢ä¸ªæ§åˆ¶å™¨æ¢äº†æ¥è¿‘ä¸¤å°æ—¶ï¼ŒæœŸé—´ä¿®è½¦çš„è¿˜ä¸åœç”¨ä¸€ç§å‚²æ…¢çš„æ€åº¦æ•°è½æˆ‘ä»¬ä¸åº”è¯¥å†ç½‘ä¸Šå›¾ä¾¿å®œä¹°äº†ä¸ªè´¨é‡å·®çš„ç”µåŠ¨è½¦ï¼Œä»–åº—é‡Œå–çš„è½¦æ€ä¹ˆæ€ä¹ˆå¥½æ€ä¹ˆæ€ä¹ˆåœ°ã€‚è€Œå½“å¥³æœ‹å‹å¯¹ä¿®è½¦çš„è¯´ï¼šâ€ä½ çš„æ„æ€æ˜¯è¿™ä¸ªç”µåŠ¨è½¦å„æ–¹é¢è´¨é‡å¾ˆå·®å—ï¼Ÿâ€ ä¿®è½¦çš„åˆå¼€å§‹å«ç³Šå…¶è¾ã€‚</p><p><img src="http://tao93.top/images/2018/09/01/1535789639.png" alt=""></p><p>æ¢å®Œä¹‹åï¼Œæœ¬æ¥æƒ³è¿™äº‹å°±ç®—ç»“æŸäº†ï¼Œè¯¥å»æ‰¾å‚å®¶è¦ 80 å—é’±äº†ã€‚è°çŸ¥é“ï¼Œäº‹æƒ…æ‰åˆšåˆšå¼€å§‹ã€‚å½“å¤©ï¼Œå¥³æœ‹å‹å°±è¯´è½¦å­æœ‰é—®é¢˜ï¼Œå¥¹æŠŠè½¦å­ä»åœ°ä¸‹è½¦åº“æ¨å‡ºæ¥æ—¶ï¼Œä¸Šä¸€ä¸ªå¾ˆé™¡çš„å¡æ—¶ï¼Œè½¦å­åŠ¨åŠ›ä¸è¶³ä¸Šä¸å»ï¼Œä¸Šåˆ°ä¸€èˆ¬å°±çŒ›åœ°å¾€å›é€€ï¼æœ€åè¿˜æ˜¯ä¸€ä¸ªç”·ç”Ÿå¥½å¿ƒæŠŠå¥¹æ¨ä¸Šæ¥äº†ã€‚ç„¶åéš”äº†ä¸¤å¤©ï¼Œå¥³æœ‹å‹åˆå»ä¿®è½¦é“ºé‚£é‡Œï¼Œè¯¢é—®ä¸ºä»€ä¹ˆåŠ¨åŠ›ä¸è¡Œäº†ã€‚ä¿®è½¦çš„éª‘ç€ç”µåŠ¨è½¦èµ°äº†ä¸€åœˆï¼Œç»™äº†è¿™ä¹ˆå¥è¯ã€Œç”µæœºåäº†ã€ã€‚æœ¬æ¥æˆ‘å¯¹ä¿®è½¦çš„å°±æ²¡å¥½å°è±¡ï¼Œæ‰€ä»¥å¬åˆ°è¿™é‡Œæˆ‘æ˜¯ä¸ä¿¡çš„ï¼Œæ§åˆ¶å™¨åäº†æˆ‘ä¿¡ï¼Œç”µæœºä¹ŸåŒæ—¶åè¿™ä¹Ÿå¤ªæ‰¯æ·¡äº†ã€‚æ‰€ä»¥æˆ‘æ¨æ–­æ˜¯æ§åˆ¶å™¨çš„é€‚é…æ€§ (æˆ–è€…è¯´å’Œç”µåŠ¨è½¦çš„å…¼å®¹æ€§) æ¯”è¾ƒå·®ï¼Œæ‰€ä»¥æ‰ä¼šåŠ¨åŠ›ä¸è¶³ã€‚ä¸å°±æˆ‘è¿˜å‘ç°åˆ«çš„é—®é¢˜ï¼Œå½“æ‹§ç€è½¦æŠŠæ—‹é’®å†æåˆ¹è½¦é—¸æ—¶ï¼Œç”µæœºå±…ç„¶è¿˜åœ¨å‘åŠ›ï¼Œè¿™ä¸ªæœ€åŸºæœ¬çš„å®‰å…¨æœºåˆ¶éƒ½æ²¡äº†ã€‚æ­¤å¤–ï¼Œæ™ºèƒ½æ§åˆ¶å™¨åœ¨å¯åŠ¨æ—¶å™ªéŸ³æ¯”è¾ƒå¤§ã€‚</p><p>æŠ±ç€å¯¹æ§åˆ¶å™¨é€‚é…æ€§çš„è´¨ç–‘ï¼Œæˆ‘æ‰¾åˆ°äº†æ­å·ä¸€å®¶æ¯”å¾·æ–‡è½¦åº—ï¼Œä»è½¦åº—é‚£é‡Œæˆ‘ç®—ææ¸…æ¥šäº†ç¼˜ç”±ã€‚åŸæ¥ï¼Œä¿®è½¦çš„ç»™æˆ‘æ¢çš„æ˜¯æ‰€è°“æ™ºèƒ½æ§åˆ¶å™¨ï¼Œä¹Ÿå°±æ˜¯åŸºæœ¬å•¥ç”µåŠ¨è½¦éƒ½èƒ½ç”¨ï¼Œä½†æ˜¯å¹¶ä¸èƒ½å¯¹æ¯ç§ç”µåŠ¨è½¦éƒ½æœ‰æœ€å¥½çš„é€‚é…æ€§ï¼Œè‡ªç„¶ä¹Ÿè¿œä¸å¦‚åŸè£…æ§åˆ¶å™¨ã€‚è€ŒåŸè£…æ§åˆ¶å™¨åªèƒ½å‚å®¶å¯„è¿‡æ¥ï¼Œè¿™ä¸ªæ¯”å¾·æ–‡è½¦åº—ä¹Ÿæ²¡æœ‰ã€‚å¦å¤–ï¼Œä»å‚å®¶æ‹¿åˆ°åŸè£…æ§åˆ¶å™¨åï¼Œæ¥è¿™ä¸ªåº—é‡Œå®‰è£…çš„è¯ï¼Œä»–ä»¬éœ€è¦æ”¶ ä¸‰å››åå—é’±ã€‚</p><p>ä¹‹åæˆ‘å°±åƒå‚å®¶è”ç³»ï¼Œè¡¨ç¤ºä¸è¦ 80 å—é’±äº†ï¼Œæˆ‘æŠŠåäº†çš„åŸè£…æ§åˆ¶å™¨å¯„å›å»ï¼Œå‚å®¶ç»™æˆ‘å¯„ä¸€ä¸ªæ–°çš„æ§åˆ¶å™¨ã€‚ä¸å¾—ä¸åæ§½ï¼Œå‚å®¶åŠ¨ä½œéå¸¸æ…¢ï¼Œæ€»å…±ä¸¤ä¸‰ä¸ªæ˜ŸæœŸæˆ‘æ‰æ‹¿åˆ°æ–°çš„åŸè£…æ§åˆ¶å™¨ã€‚æˆ‘æ‰ä¸åƒè·‘åˆ°æ¯”å¾·æ–‡è½¦åº—å‡ºå‡ åå—é’±è®©ä»–ä»¬å¸®æˆ‘å®‰è£…ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥ï¼Œæˆ‘ç›´æ¥è‡ªå·±åŠ¨æ‰‹å®‰è£…ï¼Œå…¶å®å®‰è£…å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠé‚£äº›å€Ÿå£å¯¹åº”æ’ä¸Šå°±å¥½äº†ã€‚å®‰è£…å¥½åï¼Œæˆ‘è¯•ç€éª‘äº†éª‘ï¼Œæ²¡äº†å™ªéŸ³ï¼Œå¯åŠ¨æ›´å¿«ï¼Œåé¢ä¸¤å¤©å¥³æœ‹å‹ä¹Ÿè¡¨ç¤ºä¸Šå¡æ—¶ä¸ä¼šåŠ¨åŠ›ä¸è¶³äº†ã€‚</p><p>åˆ°æ­¤å¥½åƒå·²ç»ç»“æŸäº†ã€‚ä¸è¿‡å¦‚æœå°±è¿™æ ·ç»“æŸäº†ï¼Œæˆ‘è¿˜èƒ½ç§°ä½œä¿®è½¦å°èƒ½æ‰‹ä¹ˆï¼</p><p>æ‰ä¸¤ä¸‰å¤©ï¼Œå°±å‡ºç°æ‹§æ—‹é’®åè½¦è½® (ç”µæœº) ä¸è½¬çš„é—®é¢˜ï¼Œä½†æ˜¯åˆä¼šå¿½ç„¶å¥½äº†ã€‚åˆä¸€æ¬¡å¥³æœ‹å‹å»ä¸Šç­éª‘åˆ°åŠè·¯ï¼Œå¿½ç„¶è½¦è½®ä¸è½¬äº†ï¼ŒæŠŠå¥¹å“ä¸€è·³ï¼Œåé¢çš„æ—¥å­å¥¹å°±å†ä¹Ÿä¸æ•¢éª‘äº†ï¼Œå¥¹è¯´è¿˜æ˜¯è¦å»ä¿®è½¦åº—ä¿®ä¸€ä¸‹æ‰è¡Œã€‚è¿™æ ·è¿‡äº†ä¸€ä¸ªå¤šæ˜ŸæœŸï¼Œåˆ°äº†ä»Šå¤©è¿™ä¸ªå‘¨å…­ã€‚æˆ‘ç»ˆäºæœ‰æ—¶é—´å»å¤„ç†ä¸€ä¸‹è¿™ä»¶äº‹äº†ã€‚</p><p>æˆ‘æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œä¸€ä¸ªæ˜¯å¼„åˆ°ä¿®è½¦åº—å»ï¼Œå¦ä¸€ä¸ªæ˜¯è‡ªå·±åŠ¨æ‰‹ï¼Œæˆ‘é€‰æ‹©äº†åè€…ï¼ŒåŸå› æ˜¯é—´æ­‡æ€§çš„å‡ºé—®é¢˜ï¼Œè¯´æ˜æ— æ³•ç¨³å®šå¤ç°ï¼Œå†‰ä¹‰å¼„åˆ°ä¿®è½¦åº—ï¼Œä¿®è½¦çš„æåŠå¤©è¯´æ²¡æ¯›ç—…ï¼Œé‚£ä¸å°±å°´å°¬äº†å˜›ã€‚ä»Šå¤©æˆ‘è¿˜ç‰¹æ„éª‘ç€ç”µåŠ¨è½¦ç»•å°åŒºä¸€åœˆï¼Œé—®é¢˜ä¾ç„¶æ²¡å¤ç°ï¼Œè¿™å°±å¾ˆéº»çƒ¦äº†ã€‚ä¸è¿‡ï¼Œæˆ‘æ—©å°±æ€€ç–‘ï¼Œè¿™ç§é—´æ­‡æ€§çš„ç”µæœºä¸è½¬åº”è¯¥æ˜¯æ¥è§¦ä¸è‰¯çš„é—®é¢˜ã€‚æ‰€ä»¥ä»Šå¤©æˆ‘æ‰“ç®—è¯•è¯•ç”¨æ’é™¤æ³•æ¥çœ‹èƒ½å¦éªŒè¯æˆ‘çš„çŒœæµ‹ã€‚æˆ‘æ‰“å¼€åç›–ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535789679.png" alt=""></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œé“¶ç™½è‰²é“ç›’å­å°±æ˜¯æ–°çš„åŸè£…æ§åˆ¶å™¨ï¼Œç®­å¤´æ‰€æŒ‡çš„å°±æ˜¯å®ƒè¿æ¥åˆ°ç”µåŠ¨è½¦çš„ä¸€äº›æ¥å£ã€‚éƒ½æ˜¯é‚£ç§å¸¦å€’é’©ã€ç›´æ¥æ’ä¸Šå°±å¯ä»¥çš„æ¥å£ã€‚</p><p>ä¿®è½¦ä¹Ÿè¦è®²å®‰å…¨ï¼Œæ¯•ç«Ÿç”µæ± çš„ç”µå‹æœ‰å‡ åä¼ï¼Œå¯èƒ½ä¼šè§¦ç”µï¼Œæ‰€ä»¥æˆ‘æ˜¯è¿™æ ·æ¥åˆ¤æ–­æ¥å£æ˜¯å¦æœ‰é—®é¢˜çš„ï¼šæ–­å¼€ç”µæ± å’Œç”µåŠ¨è½¦çš„è¿æ¥ï¼Œæ‹”å¼€ä¸€ä¸ªæ¥å£ï¼Œè¿æ¥ä¸Šç”µæ± ï¼Œæœ€åè½¬åŠ¨æ—‹é’®çœ‹ç”µæœºæ˜¯å¦æ—‹è½¬ï¼Œæ˜¯çš„è¯è¯´æ˜è¿™ä¸ªæ¥å£å‹æ ¹ä¸å½±å“ç”µæœºæ˜¯å¦è½¬åŠ¨ï¼Œå¦çš„è¯è¯´æ˜è¿™ä¸ªæ¥å£å…³é”®æ¥å£ä¹‹ä¸€ï¼Œä¼šå½±å“ç”µæœºçš„æ—‹è½¬ã€‚</p><p>ç”¨ä¸Šé¢çš„æ–¹æ³•æŒ¨ä¸ªæ¥å£å°è¯•ï¼Œæˆ‘æ‰¾åˆ°3ä¸ªå…³é”®æ¥å£ã€‚å¦‚æœé—®é¢˜çœŸçš„æ˜¯æ¥è§¦ä¸è‰¯çš„è¯ï¼Œå¾ˆå¯èƒ½å°±æ˜¯è¿™ 3 ä¸ªæ¥å£ä¹‹ä¸€æ¥è§¦ä¸è‰¯ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘æŠŠè¿™ 3 ä¸ªæ¥å£è¿›è¡Œä¸‹ä¸€è½®æµ‹è¯•ã€‚æµ‹è¯•æ–¹æ³•æ˜¯ï¼ŒæŠŠæ¥å£å¾€å¤–æ‹”ä¸€ç‚¹ (ä½†æ˜¯ä¾ç„¶åœ¨å€’é’©é”å®šèŒƒå›´å†…)ï¼Œè¿™æ ·å°±å¯ä»¥æ¨¡æ‹Ÿç°å®ä¸­æ¥å£æ¾åŠ¨çš„æƒ…å†µäº†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¦è¾¹æ˜¯æ¥å£æ’å¾ˆç´§ï¼Œå›¾ä¸­ç®­å¤´æŒ‡çš„å°±æ˜¯å€’é’©ï¼›å³è¾¹æ˜¯æ¥å£å¾€å¤–æ‹”ä¸€ç‚¹ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°å€’é’©å’Œä¸€ä¸ªå‡¸èµ·ç‰©ä¹‹é—´å·²ç»æ²¡æœ‰é—´éš™äº†ã€‚</p><p><img src="http://tao93.top/images/2018/09/01/1535789719.png" alt=""></p><p>é€šè¿‡æ¨¡æ‹Ÿæ¥å£æ¾åŠ¨çš„æƒ…å†µï¼Œç„¶åæµ‹è¯•æ˜¯å¦ä¼šå¯¼è‡´ç”µæœºä¸è½¬ï¼Œå¾ˆå¿«æˆ‘å°±æ‰¾åˆ°äº†ä¸€ä¸ªæ¥å£ï¼Œè¿™ä¸ªæ¥å£å¾€å¤–æ‹”ä¸€ç‚¹ç‚¹ï¼Œç”µæœºå°±æ— æ³•è½¬ï¼Œå¾€é‡Œæ’ç´§ä¸€ç‚¹ï¼Œç”µæœºå°±èƒ½è½¬åŠ¨äº†ã€‚</p><p>å‘ç°äº†é—®é¢˜æ‰€åœ¨ï¼Œæ¥ä¸‹æ¥å°±å¾ˆå¥½åŠäº†ï¼Œç”¨ä¸œè¥¿æŠŠè¿™ä¸ªæ¥å£å›ºå®šç´§å°±å¥½äº†ï¼Œè®©å®ƒä¸€ç›´ä¿æŒæ’ç´§çš„çŠ¶æ€ã€‚æœ€å¥½çš„ææ–™åº”è¯¥ç»†é“ä¸ï¼Œç”¨ç»†é“ä¸æ‰ç´§ç„¶åç”¨é’³å­æ‹§ç´§å°±å¥½ã€‚å¯æ˜¯æˆ‘æ˜ç™½ç»†é“ä¸ï¼Œæ‰€ä»¥æˆ‘ç”¨ç»³å­æŠŠå®ƒç»‘ç´§æ¥ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢å›¾ä¸­è¿™æ ·ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535789742.png" alt=""></p><p>ä¸ºä»€ä¹ˆæˆ‘å‰é¢è¯´ç»†é“ä¸æ›´å¥½å‘¢ï¼Œå› ä¸ºç»†é“ä¸æ‹§ç´§åä¸ä¼šé€†è½¬å˜æ¾ï¼Œä½†æ˜¯ç»³å­æ˜¯ä¼šçš„ã€‚ç”¨ç»³å­å¸®ç¡¬çš„ä¸œè¥¿ï¼Œæ€»æ˜¯ä¼šæœ‰é‚£ä¹ˆå†™æ¾åŠ¨ï¼Œæ— æ³•å½»åº•ç»‘ç´§ã€‚æ‰€ä»¥åœ¨ç»‘å®Œåï¼Œæˆ‘è¿˜ç”¨ä¸€æ ¹ç‰™ç­¾æŒ‘è¿‡ç»³å­ï¼Œç„¶åè½¬ä¸¤åœˆï¼Œè¿™æ ·ç»³å­å°±ä¼šè¢«ç»·å¾—å¾ˆç´§äº†ï¼Œå°±æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535789781.png" alt=""></p><p>ä¸Šå›¾ä¸­ç‰™ç­¾é¡ºæ—¶é’ˆæ—‹è½¬è¶Šå¤šï¼Œç»³å­å°±ç»·å¾—è¶Šç´§ã€‚</p><p>OKï¼Œå¤§åŠŸå‘Šæˆï¼</p>]]></content>
      
      
        <tags>
            
            <tag> Other </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä»é˜¿é‡Œäº‘æœåŠ¡å™¨åˆ°ä¸ªäººåšå®¢</title>
      <link href="/2018/09/26/%E4%BB%8E%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%88%B0%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
      <url>/2018/09/26/%E4%BB%8E%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%88%B0%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</url>
      <content type="html"><![CDATA[<h3 id="å‰è¨€ï¼š"><a href="#å‰è¨€ï¼š" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h3><p>(å‹æƒ…æç¤ºï¼Œæƒ³çœ‹æ­¥éª¤çš„è¯ï¼Œä¸‹é¢çš„å‰è¨€å¯ä»¥è·³è¿‡ä¸çœ‹)</p><p>ä¸ºä»€ä¹ˆæˆ‘ç°åœ¨è¦ä¹°é˜¿é‡Œäº‘çš„ VPS (Virtual Private Server) æåšå®¢ç³»ç»Ÿå‘¢ï¼Ÿæˆ‘ä¹Ÿè¯´ä¸ä¸Šä¸ºä»€ä¹ˆï¼Œä¸è¿‡å¯ä»¥è®²ä¸€ä¸‹äº‹æƒ…çš„ç»è¿‡ã€‚</p><p>2016å¹´åˆšå¼€å§‹å·¥ä½œé‚£ä¼šå„¿ï¼Œä»<a href="http://ewind.us/" target="_blank" rel="noopener">ç‹è¯‘é”‹</a>é‚£é‡ŒçŸ¥é“äº†ç§Ÿ VPSã€æ­å»ºæŸ socksã€nginx é©±åŠ¨ hexo åšå®¢è¿™æ ·ä¸€å¥—ä¸œè¥¿ã€‚å½“æ—¶è§‰å¾—å¾ˆæ–°é²œï¼Œç«‹é©¬ä¹Ÿä¹°äº†æ¬ç“¦å·¥çš„ VPSï¼Œç„¶åä¸€åŒçæï¼Œç®—æ˜¯ææˆäº†ä¸€ä¸ª hexo é™æ€åšå®¢ç³»ç»Ÿäº†ï¼Œä¸è¿‡æœ‰ç‚¹å°´å°¬çš„å°æ’æ›²ï¼Œæˆ‘æŠŠ hexo å®‰è£…åœ¨äº† VPS ä¸Šé¢ ï¼Œç„¶åæŠŠ Markdown æ–‡ä»¶æ¨åˆ° VPS ä¸Šé¢ï¼Œç„¶åå† VPS å†ç”¨ hexo ç”Ÿæˆé™æ€é¡µé¢çš„æ–‡ä»¶ã€‚ã€‚ã€‚ å®é™…ä¸Šæ›´åˆé€‚çš„æ˜¯æŠŠ hexo å®‰è£…åœ¨æœ¬åœ°ï¼Œç„¶åæœ¬åœ°ç”Ÿæˆçš„é¡µé¢æ–‡ä»¶æ¨åˆ° nginx çš„ web root ç›®å½•ä¸­å»ã€‚</p><p>åæ¥å˜›ï¼Œæ¬ç“¦å·¥ï¼ŒVultrï¼ŒLinode é˜¿é‡Œäº‘æˆ‘éƒ½è¯•äº†ä¸ªéï¼Œå‘ç°é™¤äº†é˜¿é‡Œäº‘æ„å¤–ï¼Œè™½ç„¶éƒ½ä¸è´µï¼Œä½†æ˜¯ç½‘é€Ÿç¨³å®šæ€§çœŸçš„å¾ˆæ‰æ€¥ï¼Œæœ‰æ—¶å€™åœ¨ç»ˆç«¯ ssh åˆ°æœåŠ¡å™¨ä¸Šé¢æ—¶ï¼Œè¾“å…¥å‘½ä»¤çœŸçš„æ˜¯ä¸€å¡ä¸€å¡çš„ï¼Œè¿™æ ·çš„ç½‘é€Ÿå¸¦æ¥çš„ç§‘å­¦ä¸Šç½‘ä½“éªŒåªèƒ½ç”¨ã€Œèƒ½ç”¨ã€ä¸¤ä¸ªå­—æ¥å½¢å®¹ã€‚ç›´è§‰å‘Šè¯‰æˆ‘ï¼Œå¯èƒ½éƒ¨ç½²åœ¨é¦™æ¸¯çš„ VPS ç½‘é€Ÿä¼šæ¯”è¾ƒå¿«ï¼Œå› ä¸ºé¦™æ¸¯ç¦»å¤§é™†è¿‘ã€‚æˆ‘å°±å¼€å§‹æ‰¾é¦™æ¸¯çš„ VPS äº†ï¼Œä¸€ç•ªæ‰¾å‘€æ‰¾ï¼Œä¸­é—´ä¹Ÿäº¤äº†äº›å­¦è´¹ï¼Œæœ€åæ‰¾åˆ°äº†ä¸€ä¸ªå«æ«å¶ä¸»æœºçš„ï¼Œé€Ÿåº¦æŒºä¸é”™ï¼Œè½»æ¾è¾¾åˆ° 500 KB/Sï¼Œå°±æ˜¯è´µäº†ç‚¹ï¼Œæˆ‘å°±å’ŒæŸåŒäº‹ä¸€èµ·å¹³æ‘Šè´¹ç”¨äº†ã€‚è¿™ä¸ªæ«å¶ä¸»æœºæˆ‘ä¸€å£æ°”ä¹°äº†ä¸€å¹´çš„ï¼Œä¸è¿‡ä¸­é—´ä¾ç„¶å› ä¸ºæŸäº›åŸå› è€Œå‡ºç°ç½‘é€Ÿä¸ç¨³å®šçš„æƒ…å†µã€‚ç­‰åˆ°æ«å¶ä¸»æœºè¿‡æœŸåï¼Œå› ä¸ºç©·ï¼Œæˆ‘å¿½ç„¶æƒ³è¯•è¯•è€æ—©å°±å¬åˆ«äººæ¨èçš„ä¸€ä¸ªå«äº‘æ¢¯çš„ VPNã€‚è¿™ä¸ªäº‘æ¢¯æˆ‘æ›¾ç»ä½¿ç”¨è¿‡ï¼Œä½†æ˜¯çš„é€Ÿåº¦ç¡®å®è¿˜ä¸é”™ï¼Œå“ªæƒ³åˆ°æˆ‘ä¸€å£æ°”ä¹°äº†ä¸€å¹´çš„ VPN åï¼Œå‘ç°ç”¨ä¸äº†ï¼Œæ•´ä¸ªäº‘æ¢¯å›¢é˜Ÿéƒ½è·‘è·¯äº†ï¼ï¼ï¼å°±ç•™ä¸‹ä¸ªç½‘ç«™è¿˜åœ¨è¿è¡Œï¼Œä¸æ–­çš„å¸é’±ï¼ŒçœŸä»–ä»¬å‘ï¼åƒäº†å¤§äºçš„æˆ‘ï¼Œå¼€å§‹è¹­å¤§å­¦åŒå­¦çš„ VPS çš„æŸ socks æœåŠ¡ï¼ŒæŒºé•¿æ—¶é—´éƒ½æ²¡å†ä¹°è¿‡ VPSäº†ï¼ŒæœŸé—´ï¼Œæˆ‘æŠŠé™æ€åšå®¢æ”¾åˆ°äº† github.io é¡µé¢ã€‚ç„¶è€Œï¼Œè‡ªå§‹è‡³ç»ˆï¼Œæˆ‘å…¶å®æ²¡å†™å‡ ç¯‡åšå®¢ï¼ŒçœŸä¸ºè‡ªå·±çš„æ‡’æƒ°æ„Ÿåˆ°æƒ­æ„§ã€‚</p><p>ç›´åˆ°æœ€è¿‘ï¼Œå†æ¬¡çœ‹åˆ°ç‚ç¥å’Œç‹è¯‘é”‹çš„åšå®¢ã€æ˜é‡‘æå¾—é£ç”Ÿæ°´èµ·ï¼Œæ„Ÿå¹è‡ªå·±æ²¡æœ‰èƒ½æ‹¿çš„å‡ºæ‰‹çš„ä¸œè¥¿ï¼Œæ‰€ä»¥å°±ä¹°é˜¿é‡Œäº‘ VPS â†’ æ³¨å†ŒåŸŸå â†’ æ­åšå®¢ç³»ç»Ÿäº†ï¼ŒæœŸå¾…è‡ªå·±èƒ½å¤šå†™ä¸€äº›æœ‰ä»·å€¼çš„ä¸œè¥¿ï¼ŒåŠ æ²¹ï¼</p><h3 id="æ­£æ–‡ï¼š"><a href="#æ­£æ–‡ï¼š" class="headerlink" title="æ­£æ–‡ï¼š"></a>æ­£æ–‡ï¼š</h3><h4 id="ç§Ÿé˜¿é‡Œäº‘-VPS"><a href="#ç§Ÿé˜¿é‡Œäº‘-VPS" class="headerlink" title="ç§Ÿé˜¿é‡Œäº‘ VPS"></a>ç§Ÿé˜¿é‡Œäº‘ VPS</h4><p>åœ¨é˜¿é‡Œäº‘å®˜ç½‘ï¼Œè¿™ä¸ªå«åšã€Œäº‘æœåŠ¡å™¨ ECSã€ï¼Œè¿™ä¸ªå…¶å®å¾ˆç®€å•äº†ï¼ŒèŠ±å‡ ç™¾å—é’±å°±èƒ½ç§Ÿä¸€å¹´ï¼Œæˆ‘æ˜¯ 290 å‡ å—é’±ç§Ÿçš„ 1GB å†…å­˜ã€1Mbps å¸¦å®½ã€40GB é SSD çš„é¦™æ¸¯ VPSã€‚å…¶å®ï¼Œå¯¹æˆ‘ä»¬è€Œè¨€æœ€æ•æ„Ÿçš„æ€§èƒ½æŒ‡æ ‡å°±æ˜¯å†…å­˜å’Œå¸¦å®½äº†ï¼Œç¡¬ç›˜ä¸€èˆ¬æ˜¯ä¸ä¼šç”¨å…‰çš„ï¼ŒCPU æ€§èƒ½ä¹Ÿæ²¡å¤šå¤§å½±å“ã€‚è¿™é‡Œè§£é‡Šä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆé€‰é˜¿é‡Œäº‘ã€‚æœ‰é‰´äºå‰é¢è¯•ç”¨äº†ä¸€å¤§æ³¢ VPS æœåŠ¡ï¼Œæˆ‘å‘ç°åªæœ‰é˜¿é‡Œäº‘ç®—æ˜¯æœ€ç¨³å®šçš„ï¼Œè™½ç„¶å¸¦å®½åªæœ‰ 1Mbps (æŒ‡ä»æˆ‘ä»¬ä¸ªäººç”µè„‘è®¿é—® VPS çš„ç½‘é€Ÿï¼Œè€Œåœ¨ VPS ä¸Šé¢å®‰è½¯ä»¶æ—¶ï¼Œä¸‹è½½è½¯ä»¶åŒ…çš„é€Ÿåº¦å…¶å®æ˜¯å¾ˆå¿«çš„ï¼Œå› ä¸ºç”¨çš„æ˜¯é˜¿é‡Œäº‘çš„é•œåƒï¼Œæ‰€ä»¥ç›¸å½“äºå†…ç½‘ä¼ è¾“æ•°æ®)ï¼Œä½†æ˜¯èƒœåœ¨ç¨³ï¼Œç»ˆç«¯è¾“å…¥å‘½ä»¤åŸºæœ¬ä¸ä¼šæœ‰ä»»ä½•å»¶è¿Ÿã€‚</p><p>ç§Ÿå®Œ VPSï¼Œssh è¿æ¥åˆ°å®ƒï¼Œç„¶åå°±æ˜¯æ­å»ºæŸ socks æœåŠ¡äº†ï¼Œç½‘ä¸Šèµ„æ–™éå¸¸å¤šã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé˜¿é‡Œäº‘æœåŠ¡å™¨éœ€è¦é…ç½®å®‰å…¨ç»„è§„åˆ™çš„ï¼Œä¸ç„¶æ— æ³•æä¾›æœåŠ¡ã€‚å‡è®¾æŸ socks ä½¿ç”¨ 23333 å·ç«¯å£æ¥æä¾›æœåŠ¡ï¼Œé‚£ä¹ˆéœ€è¦ä¸‹å›¾é‚£æ ·é…ç½®ä¸€æ¡å…¥æ–¹å‘çš„è§„åˆ™ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535789407.png" alt=""></p><p>å…¥æ–¹å‘è¡¨ç¤ºæ•°æ®æµå‘ VPS çš„ï¼Œåè®®ç±»å‹é€‰ TCPï¼Œå¯¹ç»å¤§éƒ¨åˆ†æœåŠ¡æ¥è¯´ï¼Œéƒ½æ˜¯ TCP åè®®ï¼Œç«¯å£èŒƒå›´å°±æ˜¯ VPS ä¸Šé¢æä¾›çš„æœåŠ¡æ‰€ä½¿ç”¨çš„ç«¯å£äº†ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªé…ç½®ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸ªäººç”µè„‘å°†æ— æ³•å‘ 23333 å·ç«¯å£å‘èµ·è¯·æ±‚ã€‚å¦å¤–å‡ºæ–¹å‘é»˜è®¤å…¨å¼€äº†ï¼Œæ‰€ä»¥ä¸éœ€é…ç½®ã€‚</p><h4 id="æ³¨å†ŒåŸŸå"><a href="#æ³¨å†ŒåŸŸå" class="headerlink" title="æ³¨å†ŒåŸŸå"></a>æ³¨å†ŒåŸŸå</h4><p>æˆ‘æŒ‘äº†ä¸ªå¾ˆä¾¿å®œçš„ï¼Œ36å—é’± 3 å¹´ï¼ŒåŸŸåå°±æ˜¯ tao93.topï¼Œä¹Ÿç®—æ˜¯å’Œæˆ‘çš„åå­—å’Œå‡ºç”Ÿå¹´ä»½æœ‰äº›å…³è”å§ã€‚</p><h4 id="åŸŸåç»‘å®š-IP"><a href="#åŸŸåç»‘å®š-IP" class="headerlink" title="åŸŸåç»‘å®š IP"></a>åŸŸåç»‘å®š IP</h4><p>è¿™ä¸ªè¿˜æ˜¯è¦æä¸€ä¸‹çš„ã€‚åœ¨é˜¿é‡Œäº‘æ³¨å†Œçš„åŸŸåï¼Œéœ€è¦å®åè®¤è¯ (ä¸Šä¼ å•é¢èº«ä»½è¯ç…§ç‰‡) æ‰è¡Œï¼Œä¸€å¼€å§‹æˆ‘ä¸çŸ¥é“ï¼Œå‚»ä¹ä¹çš„æ€»ç­‰ï¼Œä¸€è¾¹ç­‰ï¼Œä¸€è¾¹ ping å’Œ nslook æˆ‘çš„åŸŸåï¼Œå¥½åœ¨å®åè®¤è¯å¾ˆå¿«ï¼ŒåŸºæœ¬ä¸Šæäº¤è®¤è¯åï¼Œ1å°æ—¶å†…å°±æœ‰äººå¤„ç†ã€‚æˆ‘è®¤è¯æ—¶æœ‰ç‚¹æç¬‘ï¼Œæˆ‘ä¼ äº†ä¸€å¼  jpeg åç¼€çš„å›¾ç‰‡ï¼Œç„¶åå®¡æ ¸è€…å›å¤è¯´ï¼Œéœ€è¦ jpg æˆ– bmp åç¼€çš„å›¾ç‰‡ã€‚æˆ‘æœ‰ç‚¹åƒé²¸ï¼Œç„¶åæŠŠåŒä¸€å¼ å›¾ç‰‡åç¼€æ”¹æˆäº† jpgï¼Œä¸Šä¼ ï¼Œç„¶åè®¤è¯å°±æˆåŠŸäº†ã€‚ã€‚ã€‚è®¤è¯ç»“æŸåï¼Œå°±å¯ä»¥è®¾ç½®è§£æè§„åˆ™äº†ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535789454.png" alt=""></p><p>åªéœ€è¦ä¸Šé¢çº¢æ¡†ä¸­çš„ä¸€æ¡è§„åˆ™å°±å¯ä»¥æŠŠ tao93.top è§£æäº†ï¼Œmail çš„é‚£æ¡è§„åˆ™ï¼Œæˆ‘ç°åœ¨è¿˜ç”¨ä¸ä¸Šã€‚æ·»åŠ è§„åˆ™çš„æ—¶å€™ï¼Œå¦‚æœæ‹¿ä¸å‡†ï¼Œå¯ä»¥åœ¨ä¸‹å›¾ä¸­åªåœ¨è®°å½•å€¼å¡«å…¬ç½‘ IP åœ°å€å³å¯ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535789477.png" alt=""></p><p>æˆ‘å½“æ—¶ä¹Ÿæ˜¯æœ‰ç‚¹å‚»ï¼Œè§‰å¾—é¦™æ¸¯çš„ VPS ç®—æ˜¯å¢ƒå¤–ï¼Œå°±åœ¨è§£æçº¿è·¯é€‰äº†å¢ƒå¤–ï¼Œç„¶åå‚»ç­‰äº†å¥½ä¹…ï¼Œåé¢æ¢æˆé»˜è®¤åï¼ŒåŸºæœ¬å‡ åˆ†é’Ÿå°±å¯ä»¥è§£æäº†ã€‚</p><h4 id="æ­åšå®¢ç³»ç»Ÿ"><a href="#æ­åšå®¢ç³»ç»Ÿ" class="headerlink" title="æ­åšå®¢ç³»ç»Ÿ"></a>æ­åšå®¢ç³»ç»Ÿ</h4><p>å…ˆè¯´ä¸‹ä¸ºä»€ä¹ˆæˆ‘æ²¡ç”¨ hexo é™æ€åšå®¢ï¼Œå› ä¸ºé™æ€åšå®¢æ— æ³•è¯„è®ºï¼Œæˆ‘è§‰å¾—è¯„è®ºè¿˜æ˜¯æŒºæœ‰å¿…è¦çš„ï¼Œè™½ç„¶å¯ä»¥åµŒå…¥ç¬¬ä¸‰æ–¹è¯„è®ºæœåŠ¡ï¼Œä½†æ˜¯è¿™ç§éœ€è¦è¯„è®ºè€…ç”¨ç¤¾äº¤è´¦å·ç™»å½•ï¼Œéº»çƒ¦ï¼Œå¦å¤–è¯„è®ºçš„æ•°æ®å…¨åœ¨åˆ«äººæ‰‹é‡Œï¼Œæˆ‘è§‰å¾—ä¸å¥½ã€‚æ‰€ä»¥æˆ‘å°±è¦è‡ªå·±æ­ä¸€ä¸ªæœ‰åå°çš„åšå®¢äº†ã€‚ç‚ç¥ä½¿ç”¨çš„ zblog æ˜¯ä¸€ä¸ªï¼Œå›½äº§çš„ï¼Œçœ‹èµ·æ¥ä¸é‚£ä¹ˆåä¸½ï¼›WordPress æ˜¯å¦ä¸€ä¸ªã€‚æˆ‘ä¸¤ä¸ªéƒ½è£…äº†ï¼Œå…ˆè£…äº† zblogï¼Œè§‰å¾—æœ‰ç‚¹ç‚¹ç®€å•ç²—ç³™ï¼Œç„¶åå°±åˆ çš„ä¸€å¹²äºŒå‡€ï¼Œè£…äº† WordPressï¼Œç„¶åå‘ç° WordPress å¤æ‚çš„è®©æˆ‘æœ‰ç‚¹è¿·å¤±ï¼Œæˆ‘å°±æƒ³ç®€å•çš„å†™å†™ä¸œè¥¿ï¼Œä¸æƒ³è¦é‚£ä¹ˆå¤šä¸œè¥¿ã€‚ç„¶åæˆ‘å°±åœ¨ä¿ç•™ WordPress çš„åŸºç¡€ä¸Šï¼Œåˆè£…äº† zblogã€‚</p><p>zblog æœ‰ä¸ª php ç‰ˆæœ¬ï¼Œå’Œ WordPress çš„æŠ€æœ¯ç»„åˆä¸€æ¨¡ä¸€æ ·ï¼Œå°±æ˜¯ php + æ•°æ®åº“ + nginx ç­‰ web serverï¼Œå…¶ä¸­ zblog çš„æ•°æ®åº“è¿˜å¯ä»¥ç”¨ sqliteï¼Œè™½ç„¶æˆ‘æ²¡æˆåŠŸè¿‡ã€‚æˆ‘ç¬¬ä¸€æ¬¡è£… zblog æ—¶ï¼Œæ‰‹åŠ¨å®‰è£…äº† MySQLï¼Œphpï¼Œnginxï¼Œç„¶åæ‘¸ç´¢ç€å„ç§é…ç½®ï¼Œæäº†è›®ä¹…æ‰æå®šçš„ã€‚è€Œ WordPress çš„å®‰è£…å°±å¾ˆç®€å•äº†ï¼Œç½‘ä¸Šæœ‰ LNMP (Linux Nginx MySQL PHP) ç»„åˆåŒ…ï¼Œç­‰äºä¸€é”®å°±èƒ½è£…å¥½ç¯å¢ƒï¼Œå‰©ä¸‹çš„å°±æ˜¯æä¸ª WordPressï¼Œå¹¶ä¸”æ›¿æ¢æ‰ LNMP åŸæœ‰çš„ web root ç›®å½•ï¼Œå°±å¥½äº†ã€‚</p><p>æ‰€ä»¥ï¼Œæ— è®º WordPress è¿˜æ˜¯ zblogï¼Œæœ€ç®€å•çš„æ–¹å¼æ˜¯ï¼Œå…ˆè£… LNMP ç¯å¢ƒï¼Œç„¶åå°±å¿«äº†ã€‚éœ€è¦è®°ä½ä¸€ç‚¹çš„æ˜¯ï¼ŒLNMP ç¯å¢ƒä¼šæ–°å»ºä¸€ä¸ª www:www ç”¨æˆ·(ç»„) æ¥ç”¨äºé©±åŠ¨ web æœåŠ¡ã€‚åŠ¡å¿…éœ€è¦è®©æ­¤ www ç”¨æˆ·å¯¹äº web root æœ‰ rwx æƒé™ã€‚æ¯”å¦‚ LNMP é»˜è®¤çš„ web root æ˜¯ /home/wwwroot/defaultï¼Œé‚£ä¹ˆä¸€å¥ sudo chown -R www:www /home/wwwroot/default å³å¯ã€‚</p><h4 id="ç›´æ¥å®‰è£…-z-blog-çš„è¿‡ç¨‹"><a href="#ç›´æ¥å®‰è£…-z-blog-çš„è¿‡ç¨‹" class="headerlink" title="ç›´æ¥å®‰è£… z_blog çš„è¿‡ç¨‹"></a>ç›´æ¥å®‰è£… z_blog çš„è¿‡ç¨‹</h4><p>æ­¤è¿‡ç¨‹é…ç½®æ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥åªæ˜¯è®°å½•ä¸€ä¸‹ï¼Œä¸å»ºè®®ä½¿ç”¨æ­¤æ–¹å¼ã€‚</p><p>è£… nginxï¼Œè®¾ç½®å¼€æœºè‡ªå¯ï¼Œè¿è¡Œèµ·æ¥ï¼Œç„¶ååˆ«æ€¥ç€è¿›æµè§ˆå™¨éªŒè¯ï¼Œå…ˆåˆ°é˜¿é‡Œäº‘ç½‘ç«™å¢åŠ ä¸€ä¸‹ 80 å·ç«¯å£çš„å®‰å…¨è§„åˆ™ï¼Œç„¶åéªŒè¯ nginx æ˜¯å¦å¯ç”¨ã€‚</p><p>å»ºè®®æ›´æ”¹ä¸€ä¸‹ nginx é…ç½®æ–‡ä»¶ä¸­çš„ rootï¼Œå³æ›´æ”¹ web root çš„ä½ç½®ï¼Œæ¯”å¦‚æ”¹ä¸ºè‡ªå·± home ä¸­çš„æŸä¸ªç›®å½•ï¼Œè¿™æ ·çš„è¯ chown web root æ—¶ä¸ä¼šæœ‰çƒ¦äººçš„è­¦å‘Šã€‚</p><p>æ³¨æ„ï¼Œnginx éœ€è¦é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œæ‰èƒ½è®©é…ç½®æ–‡ä»¶çš„ä¿®æ”¹ç”Ÿæ•ˆï¼Œæ–¹æ³•æ˜¯ sudo nginx -s reload å³å¯ã€‚</p><p>å®‰è£… Mysqlï¼Œè®°å¾—åˆ«å¿˜è®°äº† root å¯†ç ã€‚</p><p>å®‰è£… Phpï¼Œç„¶åå°±æ˜¯åœ¨ Php.ini é…ç½®æ–‡ä»¶ä¸­ï¼ŒæŠŠå„ç§ extension=php_mysql.dll ä¹‹ç±»çš„è¯­å¥è§£é™¤æ³¨é‡Šï¼Œæ„æ€æ˜¯ php éœ€è¦å’Œ MySQL æ•°æ®åº“è¿æ¥ã€‚ä½†æ˜¯è¿™æ ·çš„é…ç½®è¿˜ä¸å¤Ÿï¼Œè¿˜éœ€è¦ sudo apt-get install php7.0-mysql</p><p>è¿™æ—¶å€™ï¼Œå¯ä»¥ä¸‹è½½ zblog çš„å‹ç¼©åŒ…ï¼Œè§£å‹åˆ° web root ä¸­ï¼Œç„¶åæµè§ˆå™¨æ‰“å¼€ <a href="http://tao93.topï¼Œå°±å¯ä»¥å¼€å§‹å®‰è£…" target="_blank" rel="noopener">http://tao93.topï¼Œå°±å¯ä»¥å¼€å§‹å®‰è£…</a> zblog äº†ï¼Œå®‰è£…å¥½åå°±æ˜¯å„ç§ GUI é…ç½®æ–¹å¼äº†ã€‚å†æ¬¡å¼ºè°ƒä¸€ä¸‹ï¼Œéœ€è¦ nginx å¯¹åº”çš„ Linux ç”¨æˆ·å¯¹äº web root ç›®å½•é€’å½’çš„æœ‰ rwx æƒé™ã€‚æˆ‘ç¬¬ä¸€æ¬¡è£… zblog å°±æ˜¯æ²¡è®¾ç½®æƒé™ï¼Œç„¶ååœ¨åå°é¦–é¡µä¸­ï¼Œã€Œæ¸…ç©ºç¼“å­˜å¹¶é‡æ–°ç¼–è¯‘æ¨¡æ¿ã€ä¸€ç›´è½¬åœˆåœˆã€‚</p><h4 id="é…ç½®ä¸»é¢˜ï¼Œæ ·å¼è‡ªå®šä¹‰ï¼Œç„¶åå¼€å§‹å†™åšå®¢ã€‚"><a href="#é…ç½®ä¸»é¢˜ï¼Œæ ·å¼è‡ªå®šä¹‰ï¼Œç„¶åå¼€å§‹å†™åšå®¢ã€‚" class="headerlink" title="é…ç½®ä¸»é¢˜ï¼Œæ ·å¼è‡ªå®šä¹‰ï¼Œç„¶åå¼€å§‹å†™åšå®¢ã€‚"></a>é…ç½®ä¸»é¢˜ï¼Œæ ·å¼è‡ªå®šä¹‰ï¼Œç„¶åå¼€å§‹å†™åšå®¢ã€‚</h4><p>ç•¥</p>]]></content>
      
      
        <tags>
            
            <tag> VPS </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä» Android ä¸­ Message çš„ obj æ— æ³•è·¨è¿›ç¨‹ä¼ é€è‡ªå®šä¹‰ Parcelable è¯´èµ·</title>
      <link href="/2018/09/26/%E4%BB%8E%20Android%20%E4%B8%AD%20Message%20%E7%9A%84%20obj%20%E6%97%A0%E6%B3%95%E8%B7%A8%E8%BF%9B%E7%A8%8B%E4%BC%A0%E9%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%20Parcelable%20%E8%AF%B4%E8%B5%B7/"/>
      <url>/2018/09/26/%E4%BB%8E%20Android%20%E4%B8%AD%20Message%20%E7%9A%84%20obj%20%E6%97%A0%E6%B3%95%E8%B7%A8%E8%BF%9B%E7%A8%8B%E4%BC%A0%E9%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%20Parcelable%20%E8%AF%B4%E8%B5%B7/</url>
      <content type="html"><![CDATA[<p>ä»Šå¤©æ¸©ä¹ ã€ŠAndroid å¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹ä¸€ä¹¦æ—¶ï¼Œçœ‹åˆ°ç±»ä¼¼ä¸‹é¢è¿™ä¹ˆä¸€å¥è¯ï¼šã€Œä½¿ç”¨ Messenger å°† Message å¯¹è±¡è·¨è¿›ç¨‹ä¼ è¾“æ—¶ï¼Œobj å±æ€§æ— æ³•ä¼ è¾“è‡ªå®šä¹‰çš„ Parcelableï¼Œè€Œåªèƒ½ä¼ è¾“ framework å·²æœ‰çš„ Parcelableï¼Œæ¯”å¦‚ Bitmap ç­‰ã€ã€‚ç„¶åä¹Ÿç¿»äº†æºç æ³¨é‡Šï¼Œæ³¨é‡Šä¹Ÿæ˜¯è¿™ä¹ˆè¯´çš„ï¼šFroyo ä¹‹åï¼Œæ‰èƒ½ç”¨ obj ä¼ è¾“ framework çš„ Parcelableï¼Œä¸” obj ä¸èƒ½ä¸º nullã€‚ä¸‹é¢æ˜¯æ³¨é‡Šï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * An arbitrary object to send to the recipient.  When using</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> Messenger&#125; to send the message across processes this can only</span></span><br><span class="line"><span class="comment"> * be non-null if it contains a Parcelable of a framework class (not one</span></span><br><span class="line"><span class="comment"> * implemented by the application).   For other data transfer use</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #setData&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Note that Parcelable objects here are not supported prior to</span></span><br><span class="line"><span class="comment"> * the &#123;<span class="doctag">@link</span> android.os.Build.VERSION_CODES#FROYO&#125; release.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Object obj;</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼ŒMessage è¿˜æœ‰ setData(Bundle b) æ–¹æ³•å¯ç”¨ï¼Œè€Œè¿™ä¸ªæ–¹æ³•ä¸­æ˜¯å¯ä»¥æ”¾å…¥è‡ªå®šä¹‰çš„ Parcelableï¼Œä¸è¿‡æ­¤å¤„éœ€è¦åŸ‹ä¸‹ä¼ç¬”ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬ç»§ç»­è¯´ obj ä¸ºä»€ä¹ˆä¸èƒ½ä¼ è‡ªå®šä¹‰ Parcelableã€‚ç†è®ºä¸Šè¯´ï¼Œåªæœ‰èƒ½åŠ è½½åˆ°è‡ªå®šä¹‰ç±»ï¼Œé‚£ä¹ˆå°±åº”è¯¥èƒ½ååºåˆ—åŒ–å‡ºè‡ªå®šä¹‰ç±»çš„å¯¹è±¡ã€‚å¸¦ç€è¿™ä¸ªæƒ³æ³•ï¼Œæˆ‘æµè§ˆäº† Message çš„ writeToParcel å’Œ readFromParcel ä¸¤ä¸ªæ–¹æ³•ã€‚å‘ç°äº†ç„æœºå°±æ˜¯ä¸‹é¢çš„ readFromParcel æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readFromParcel</span><span class="params">(Parcel source)</span> </span>&#123;</span><br><span class="line">    what = source.readInt();</span><br><span class="line">    arg1 = source.readInt();</span><br><span class="line">    arg2 = source.readInt();</span><br><span class="line">    <span class="keyword">if</span> (source.readInt() != <span class="number">0</span>) &#123;</span><br><span class="line">        obj = source.readParcelable(getClass().getClassLoader());</span><br><span class="line">    &#125;</span><br><span class="line">    when = source.readLong();</span><br><span class="line">    data = source.readBundle();</span><br><span class="line">    replyTo = Messenger.readMessengerOrNullFromParcel(source);</span><br><span class="line">    sendingUid = source.readInt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä½¿ç”¨ getClass().getClassLoader æ¥ååºåˆ—åŒ– obj æ‰€è¦å¼•ç”¨çš„å¯¹è±¡ï¼Œå¦‚æœè¿™ä¸ª ClassLoader æ— æ³•æ‰¾åˆ°è‡ªå®šä¹‰ç±»ï¼Œé‚£ä¹ˆé—®é¢˜è‚¯å®šå°±æ˜¯å‡ºåœ¨è¿™é‡Œäº†ã€‚</p><p>ä¸‹é¢æˆ‘å°±å¼€å§‹ä¸€æ­¥ä¸€æ­¥éªŒè¯ã€‚é¦–å…ˆå»ºç«‹ä¸€ä¸ªé¡¹ç›®ï¼Œé¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„ Parcelable ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> <span class="keyword">implements</span> <span class="title">Parcelable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mId;</span><br><span class="line">    <span class="keyword">private</span> String mName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Book</span><span class="params">(Parcel in)</span> </span>&#123;</span><br><span class="line">        mId = in.readInt();</span><br><span class="line">        mName = in.readString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Book</span><span class="params">(<span class="keyword">int</span> id, String name)</span> </span>&#123;</span><br><span class="line">        mId = id;</span><br><span class="line">        mName = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åé¡¹ç›®ä¸­å¼€å¯ä¸¤ä¸ªè¿›ç¨‹ï¼Œåˆ†åˆ«ç§°ä¸º client è¿›ç¨‹å’Œ server è¿›ç¨‹å¥½äº†ã€‚ç„¶å client è¿›ç¨‹çš„ activity ä¸­ç»‘å®š server è¿›ç¨‹ä¸­çš„ serverï¼Œç»‘å®šåï¼Œclient è¿›ç¨‹ä½¿ç”¨ Messenger å‘ server è¿›ç¨‹å‘é€ä¸€ä¸ª Message å¯¹è±¡ï¼Œæ­¤ Message å¯¹è±¡çš„ obj å¼•ç”¨ä¸€ä¸ª Book å¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> ServiceConnection mMsgConnection = <span class="keyword">new</span> ServiceConnection() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>&#123;</span><br><span class="line">        mMessenger = <span class="keyword">new</span> Messenger(service);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Book book = <span class="keyword">new</span> Book(<span class="number">1</span>, <span class="string">"name"</span>);</span><br><span class="line">            mMessenger.send(Message.obtain(<span class="keyword">null</span>, <span class="number">101</span>, book));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œæˆ‘åœ¨ Message ç±»çš„ readFromParcel æ–¹æ³•ä¸­æ‰“ä¸Šæ–­ç‚¹ï¼Œå½“ä»£ç æ‰§è¡Œåˆ°æ–­ç‚¹å¤„æ—¶ï¼Œå…ˆéªŒè¯ getClass().getClassLoader() æ— æ³•åŠ è½½åˆ°è‡ªå®šä¹‰çš„ Book ç±»ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535789126.png" alt=""></p><p>ç„¶åéªŒè¯ä¸»çº¿ç¨‹çš„ Thread.getContextClassLoader å¯ä»¥åŠ è½½åˆ° Book ç±»ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535789156.png" alt=""></p><p>æœ€åéªŒè¯ä½¿ç”¨å¯ä»¥åŠ è½½åˆ° Book ç±»çš„ ClassLoader çš„è¯ï¼Œæ˜¯å¯ä»¥æˆåŠŸååºåˆ—åŒ–å¾—åˆ° Book å¯¹è±¡çš„ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535789190.png" alt=""></p><p>æ’ä¸€å¥ï¼Œè¿™ä¸ª readFromParcel ä¸æ˜¯è¿è¡Œåœ¨ä¸»çº¿ç¨‹ï¼Œè€Œæ˜¯è¿è¡Œåœ¨ server è¿›ç¨‹çš„ Binder çº¿ç¨‹æ± ä¸­çš„ã€‚çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹çš„ getContextClassLoader() ç»“æœæ˜¯ nullã€‚</p><p>OKï¼Œä¸Šé¢çš„æµ‹è¯•å‡†ç¡®çš„éªŒè¯äº†æˆ‘çš„æƒ³æ³•ï¼Œç°åœ¨å›åˆ°å‰é¢è¯´çš„ Message çš„ setData(Bundle b) æ–¹æ³•çš„ä¼ç¬”ã€‚æ˜¾ç„¶è¿™é‡Œçš„ Bundle å¦‚æœè¦è·¨è¿›ç¨‹ä¼ è¾“è‡ªå®šä¹‰ Parcelableï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ç¡®å®š Bundle åœ¨ååºåˆ—åŒ–æ—¶ä¸ä¼šé‡è¹ˆ Message.obj çš„è¦†è¾™ã€‚å®é™…ä¸Šï¼ŒBundle è‡ªå·±åšä¸åˆ°è¿™ç‚¹ï¼Œè¿˜éœ€è¦æˆ‘ä»¬å¸®å®ƒä¸€æŠŠå¿™ï¼Œé‚£å°±æ˜¯åœ¨ server è¿›ç¨‹ä¸­ï¼Œä» Message æ‹¿åˆ° Bundle åå†ç»™ Bundle è®¾ç½®ä¸€ä¸ª ClassLoader å³å¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MessengerHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (msg.what) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">101</span>:</span><br><span class="line">                Bundle b = msg.getData();</span><br><span class="line">                b.setClassLoader(Thread.currentThread().getContextClassLoader());</span><br><span class="line">                Book book = b.getParcelable(<span class="string">"book"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œä¸Šé¢de  handleMessage æ–¹æ³•æ˜¯åœ¨ä¸»çº¿ç¨‹ï¼Œæ‰€ä»¥æˆ‘ç›´æ¥ä½¿ç”¨ Thread.currentThread().getContextClassLoader() å°±å¯ä»¥ã€‚</p><p>åˆ°æ­¤ï¼Œæˆ‘å¾—å‡ºä¸€ä¸ªç»“è®ºï¼Œé‚£å°±æ˜¯æˆ‘çš„å¯¹äº Java çš„ ClassLoader ä¸€æ— æ‰€çŸ¥ï¼Œæƒ­æ„§æƒ­æ„§ï¼Œè¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚æ‰€ä»¥ï¼Œåç»­æˆ‘ä¼šåŠ å¼ºè¿™æ–¹é¢çš„å­¦ä¹ ï¼Œç„¶åå¯èƒ½ä¼šç»§ç»­åŠ é•¿è¿™ç¯‡æ–‡ç« ï¼Œæ¯•ç«Ÿè¿™ç¯‡çš„æ ‡é¢˜æ˜¯ã€Œä» XXX è¯´èµ·ã€ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>The Linux Command Line digest</title>
      <link href="/2018/09/26/The%20Linux%20Command%20Line%20digest/"/>
      <url>/2018/09/26/The%20Linux%20Command%20Line%20digest/</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡æ˜¯é˜…è¯» <a href="http://linuxcommand.org/tlcl.php" target="_blank" rel="noopener">The Linux Command Line</a> åå†™æˆçš„æ‘˜è¦ï¼Œç”¨äºè‡ªå·±éœ€è¦ç”¨åˆ°æ—¶å›å¿†å’Œå‚è€ƒã€‚</p><h2 id="Learning-The-Shell"><a href="#Learning-The-Shell" class="headerlink" title="Learning The Shell"></a>Learning The Shell</h2>]]></content>
      
      
        <tags>
            
            <tag> Shell </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>targetSdkVersion æ‚è°ˆ</title>
      <link href="/2018/09/26/targetSdkVersion%20%E6%9D%82/"/>
      <url>/2018/09/26/targetSdkVersion%20%E6%9D%82/</url>
      <content type="html"><![CDATA[<p>å¾ˆä¹…æ²¡æœ‰å†™æ–°çš„åšå®¢äº†ï¼ŒåŸå› æ˜¯è¿™ä¸€ä¸ªå¤šæœˆä»¥æ¥éƒ½æ²¡æƒ³åˆ°ä»€ä¹ˆåˆé€‚çš„ä¸»é¢˜ï¼Œä»Šå¤©å°±æ¥æ‚è°ˆä¸€ä¸‹ targetSdkVersion ç›¸å…³çš„ä¸œè¥¿å§ã€‚</p><p>åœ¨æˆ‘å·¥ä½œçš„ç¬¬ä¸€å¹´é‡Œï¼Œå…¶å®æˆ‘å¹¶ä¸çŸ¥é“ targetSdkVersion æœ‰ä»€ä¹ˆå«ä¹‰ï¼ŒæŸ¥èµ„æ–™ï¼Œçœ‹åˆ°çš„æ˜¯ç±»ä¼¼äºã€Œä»£è¡¨åº”ç”¨é’ˆå¯¹æŸä¸ª api level å®Œæˆé€‚é…äº†ã€è¿™æ ·çš„æè¿°ï¼Œè¿™æ ·çš„æè¿°å…¶å®è®©æˆ‘æ‘¸ä¸ç€å¤´è„‘ã€‚åæ¥ï¼Œæˆ‘æŠŠä¸€ä¸ªå°åº”ç”¨é¡¹ç›®çš„ targetSdkVersion å‡é«˜åˆ° api 27ï¼Œè¿™ä¸ªè¿‡ç¨‹æ‰è®©æˆ‘å¯¹ targetSdkVersion ç†è§£æ¯”è¾ƒåˆ°ä½äº†ã€‚è€Œè¿™æ—¶å€™ï¼Œæˆ‘å‘ç° targetSdkVersion çš„çš„ç¡®ç¡®å¦‚æˆ‘å…ˆå‰æŸ¥åˆ°çš„èµ„æ–™æ‰€è¨€ï¼Œè¡¨ç¤ºé’ˆå¯¹æŸä¸ª api level å®Œæˆé€‚é…äº†ï¼Œè¿™ä¸ªä¿¡æ¯æ˜¯ä¼šä¼ é€’ç»™ android ç³»ç»Ÿçš„ï¼Œandroid ç³»ç»Ÿä¾æ®è¿™ä¸€ä¿¡æ¯æ¥å¯¹åº”ç”¨åšåŒºåˆ«å¯¹å¾…ã€‚</p><p>é¦–å…ˆï¼Œéœ€è¦æ˜ç¡® Android ç³»ç»Ÿåœ¨å¤§ç‰ˆæœ¬æ›´æ–°æ—¶ï¼Œæ€»ä¼šåŠ å…¥ä¸€äº›æ–°çš„ featureï¼Œè€Œè¿™äº›æ–° feature å¯èƒ½ä¼šè®©è€çš„åº”ç”¨æ— æ³•å®Œç¾å…¼å®¹ã€‚å…¸å‹çš„ä¾‹å­æ˜¯ api 23 æ–°å¢çš„è¿è¡Œæ—¶åŠ¨æ€ç”³è¯·æƒé™æœºåˆ¶ã€‚åœ¨ api 23 ä»¥ä¸Šçš„ android ç³»ç»Ÿä¸­ï¼Œç³»ç»ŸæœŸå¾…ä»£ç å…ˆç”³è¯·æƒé™ (æˆ–è€…æ£€æŸ¥æƒé™æ˜¯å·²æœ‰çš„) åæ‰è¿è¡Œéœ€è¦æƒé™çš„ä»£ç  (ä¾‹å¦‚æ‹ç…§)ã€‚ä½†æ˜¯è€åº”ç”¨çš„ä»£ç ï¼Œåˆ™æ˜¯åªéœ€è¦åœ¨ manifest æ–‡ä»¶ä¸­ç”³è¯·æ‹ç…§æƒé™ï¼Œå°±å¯ä»¥ç›´æ¥æ‰§è¡Œæ‹ç…§çš„ä»£ç ã€‚æ‰€ä»¥ï¼ŒtargetSdkVersion çš„ä½œç”¨å°±æ˜¯ï¼Œå¦‚æœ targetSdkVersion å¤§äºç­‰äº 23ï¼Œé‚£ä¹ˆä»£ç å¿…é¡»æŒ‰æ–°æœºåˆ¶æ¥ (å³å…ˆç”³è¯·æƒé™ï¼Œç„¶åæ‰èƒ½æ‰§è¡Œéœ€è¦æƒé™çš„ä»£ç )ï¼Œå¦åˆ™ï¼Œandroid ç³»ç»Ÿå°±è®¤ä¸ºè¿™æ˜¯ä¸ªæ²¡æœ‰é’ˆå¯¹ api 23 è¿›è¡Œé€‚é…çš„è€åº”ç”¨ (æ¯”å¦‚å¯èƒ½æ˜¯ä¸€ä¸ª 2012 å¹´å°±åœæ­¢æ›´æ–°çš„åº”ç”¨ï¼‰ã€‚å¯¹è¿™ç§è€åº”ç”¨ï¼Œandroid ç³»ç»Ÿéœ€è¦å…¼å®¹ï¼Œå…¼å®¹çš„æ–¹å¼å°±æ˜¯ï¼Œè¿™ç§åº”ç”¨ä¸€ç»å®‰è£…ï¼Œå°±è‡ªåŠ¨è·å¾—äº†æ‰€æœ‰ manifest ä¸­ç”³æ˜çš„æƒé™ï¼Œè¿™æ ·å®ƒå°±èƒ½åœ¨æ–°ç³»ç»Ÿä¸­æ­£å¸¸è¿è¡Œã€‚</p><p>åœ¨æ–°ç³»ç»Ÿ (api 23 åŠä»¥ä¸Š) ä¸­ï¼Œå¯¹äºä¸Šè¿°çš„è€åº”ç”¨ï¼Œå®‰è£…æ—¶ä¼šåˆ—å‡ºæ‰€æœ‰æƒé™ï¼Œå‘Šè¯‰ç”¨æˆ·è¿™ä¸ªåº”ç”¨ä¸€ç»å®‰è£…å°±æœ‰äº†ä¸‹é¢çš„æƒé™ (å¦‚åŒè€ç³»ç»Ÿå®‰è£…æ‰€æœ‰åº”ç”¨æ—¶ä¸€æ ·)ã€‚è¿™å°±æ˜¯ç³»ç»Ÿçš„å…¼å®¹æœºåˆ¶ã€‚æ–°ç³»ç»Ÿä¸­å®‰è£…çš„è¿™æ ·çš„è€åº”ç”¨åï¼Œæˆ‘ä»¬åœ¨åº”ç”¨è¯¦æƒ…ä¸­å¯ä»¥çœ‹åˆ°å®ƒè‡ªåŠ¨æœ‰äº†æ‰€æœ‰æƒé™ï¼Œå¯æ˜¯æ–°ç³»ç»Ÿæ˜¯å¯ä»¥æ‰‹åŠ¨å…³é—­æŸä¸ªåº”ç”¨çš„æƒé™çš„ï¼Œå¦‚æœæˆ‘ä»¬å…³é—­è¿™ä¸ªè€åº”ç”¨çš„æŸä¸ªæƒé™ï¼Œä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://tao93.top/images/2018/09/03/1535985225.png" alt=""></p><p>ç³»ç»Ÿä¼šæç¤ºç”¨æˆ·ï¼Œå…³æ‰æƒé™çš„è¯åº”ç”¨å¯èƒ½æ— æ³•æ­£å¸¸è¿è½¬ã€‚è¿™æ˜¯å¯¹çš„ï¼Œå› ä¸ºå‡è®¾è€åº”ç”¨ä¸­æœ‰ç›´æ¥æ‰§è¡Œæ‹ç…§é€»è¾‘çš„ä»£ç ï¼Œæ‹ç…§æƒé™ç°åœ¨è¢«ç”¨æˆ·æ‰‹åŠ¨å…³é—­ï¼Œé‚£ä¹ˆæ‰§è¡Œåˆ°è¿™æ ·çš„ä»£ç æ—¶å°±ä¼šå´©æºƒ (without permission)ï¼</p><p>é—®é¢˜æ˜¯ï¼Œè®¸å¤šåº”ç”¨æ˜æ˜ä¸€ç›´åœ¨æ›´æ–°ï¼Œä½†æ˜¯ä¸ºäº†å°½é‡è·å–åˆ°å„ç§æƒé™ï¼Œä¼šæ•…æ„å°† targetSdkVersion åœç•™åœ¨ 22 åŠä»¥ä¸‹ï¼Œè¿™æ ·ç”¨æˆ·ä¸€ç»å®‰è£…ï¼Œè¿™æ ·çš„åº”ç”¨å°±è‡ªåŠ¨æœ‰äº†å®ƒæƒ³è¦çš„ä»»ä½•æƒé™ï¼Œä¾‹å¦‚ Android ç‰ˆæ‰‹æœº QQ ç°åœ¨çš„ targetSdkVersion ä¾ç„¶æ˜¯ 17ï¼š</p><p><img src="http://tao93.top/images/2018/09/03/1535985675.png" alt=""></p><p>å¯¹äºè¿™æ ·çš„æ¯”è¾ƒæ— èµ–çš„åº”ç”¨ï¼Œå…¶å®å¯ä»¥æ”¾å¿ƒæŠŠä¸æƒ³æˆäºˆçš„æƒé™å…³é—­æ‰ï¼Œå®ƒæ˜¯ä¸ä¼šå´©æºƒçš„ï¼Œå› ä¸ºå…¶ä»£ç ä¸­å…¶å®å·²ç»åšäº†æƒé™æ£€æŸ¥ï¼Œæ¯•ç«Ÿå®ƒä¸€ç›´åœ¨æ›´æ–°å’Œç»´æŠ¤ã€‚å¦å¤–ï¼Œå¯¹äºè¿™ç§ç°è±¡ï¼ŒGoogle ä¹Ÿæœ‰æªæ–½ï¼Œä»Šå¹´è°·æ­Œå£°æ˜äº†å¯¹åœ¨ Google Play æ›´æ–°çš„åº”ç”¨å’Œä¸Šæ¶çš„æ–°åº”ç”¨éƒ½åœ¨ä»Šå¹´å¿…é¡»å°† targetSdkVersion å‡è‡³ 27 (æ­¥å­æœ‰ç‚¹å¤§)ã€‚è™½ç„¶ Google Play å¯¹å›½å†…è¿˜æœ‰ç‚¹é­é•¿è«åŠï¼Œä¸è¿‡è¿™ä¸€å€¡å¯¼åº”è¯¥è¿˜æ˜¯ä¼šè®©è®¸å¤šå¤§å‚çš„åº”ç”¨æ›´å¿«çš„æé«˜ targetSdkVersionã€‚</p><p>å¦å¤–ï¼Œå‡å¦‚ç”¨æˆ·æœ¬æ¥å®‰è£…äº† targetSdkVersion ä¸º 22 çš„è€åº”ç”¨ï¼Œä¸”è€åº”ç”¨æœ‰æ‰€æœ‰æƒ³è¦çš„æƒé™ï¼Œæ­¤æ—¶å¦‚æœæ›´æ–°åˆ° targetSdkVersion ä¸º 23 çš„æ–°ç‰ˆæœ¬åº”ç”¨ï¼Œé‚£ä¹ˆæ–°åº”ç”¨å°†ã€Œç»§æ‰¿ã€æ‰€æœ‰çš„æƒé™ã€‚åè¿‡æ¥ï¼Œæ–°ç‰ˆæœ¬çš„åº”ç”¨çš„ targetSdkVersion æ˜¯ä¸èƒ½æ¯”å·²å®‰è£…çš„è€ç‰ˆæœ¬åº”ç”¨è¿˜æ›´ä½çš„ï¼Œå› ä¸ºè¿™ä¸å…‰å…¼å®¹èµ·æ¥å¾ˆéº»çƒ¦ï¼Œè€Œä¸”äºæƒ…äºç†éƒ½ä¸åº”è¯¥ã€‚ </p><p>åŠ¨æ€ç”³è¯·æƒé™å¤§æ¦‚ç®—æ˜¯æœ€å…¸å‹çš„ä¸€ä¸ªæ— æ³•å®Œç¾å…¼å®¹çš„ feature äº†ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ api 26 å¼•å…¥çš„ adaptive icon è¿™ä¸ª featureã€‚adaptive icon ä½¿å¾—åº”ç”¨å¯ä»¥æ ¹æ® launcher çš„åå¥½ï¼Œæ˜¾ç¤ºåœ†å½¢ã€åœ†è§’æ–¹å½¢ã€æ­£æ–¹å½¢ç­‰å„ç§å½¢çŠ¶çš„å›¾æ ‡ã€‚è®¸å¤šè€åº”ç”¨æ˜¯ç›´æ¥è‡ªå·±è£å‰ªä¸€ä¸ªåœ†è§’æ–¹å½¢çš„å›¾æ ‡ï¼Œè¿™æ˜¾ç„¶æ— æ³•å®Œç¾æ»¡è¶³ adaptive iconï¼Œæ‰€ä»¥æ˜¯ä¸å®Œç¾å…¼å®¹ã€‚targetSdkVersion ä¸º 26 åŠä»¥ä¸Šçš„åº”ç”¨ï¼Œåº”è¯¥ä¸”éœ€è¦å°† launcher icon åˆ†ä¸º foreground å’Œ background ä¸¤å±‚ï¼Œforeground æ˜¯å›¾æ ‡ä¸­å¿ƒçš„è‹¥å¹²å…ƒç´ ï¼Œæ¯”å¦‚<a href="https://www.coolapk.com/apk/me.piebridge.brevent" target="_blank" rel="noopener">é»‘é˜ˆ</a> çš„ launcher icon çš„ foreground æ˜¯ä¸‹é¢è¿™æ ·ä¸€å¼ å›¾ç‰‡ï¼š</p><p><img src="http://tao93.top/images/2018/09/03/1535986448.png" alt=""></p><p>è¿™ä¸ªå›¾ç‰‡ç»å¤§éƒ¨åˆ†éƒ½æ˜¯é€æ˜çš„ï¼Œåªæœ‰é‚£ 3 æ¡å¼§çº¿æ˜¯ç°ç™½è‰²çš„ã€‚è¿™æ ·ä¸€ä¸ª foreground ä½œä¸ºé»‘é˜ˆåº”ç”¨å›¾æ ‡çš„ä¸­å¿ƒå…ƒç´ ã€‚è€Œ background åˆ™æ˜¯ #FF353535 è¿™æ ·ä¸€ä¸ªçº¯è‰²ã€‚äº‹å®ä¸Šï¼Œé»‘é˜ˆçš„åœ¨æ–°ç³»ç»Ÿçš„å›¾æ ‡æ˜¯å¦‚ä¸‹æ‰€ç¤ºçš„ xml æ–‡ä»¶ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">adaptive-icon</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">background</span> <span class="attr">android:drawable</span>=<span class="string">"@color/ic_brevent_background"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">foreground</span> <span class="attr">android:drawable</span>=<span class="string">"@mipmap/ic_brevent_foreground"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">adaptive-icon</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€ä¸ªæ–‡ä»¶å£°æ˜äº† foreground å’Œ backgroundã€‚å½“æ—¶é»‘é˜ˆä¹Ÿæ˜¯å¯èƒ½åœ¨ api 25 åŠä»¥ä¸‹çš„ android ç³»ç»Ÿè¿è¡Œçš„ï¼Œè¿™æ ·çš„ç³»ç»Ÿæ²¡æœ‰ adaptive icon è¿™ä¸ª featureï¼Œæ‰€ä»¥ï¼Œå½“åº”ç”¨çš„ minSdkVersion ä¸åˆ° 26 æ—¶ï¼Œåº”ç”¨ä¸­è¿˜éœ€è¦ä¸ºè€ç³»ç»Ÿå‡†å¤‡å›¾æ ‡èµ„æºã€‚å…¶å®åšæ³•å°±æ˜¯ä¸Šè¿° xml æ–‡ä»¶å‘½åä¸º ic_launcher.xml ä¹‹ç±»çš„åå­—ï¼Œç½®äº drawable-anydpi-v26 è¿™æ ·çš„èµ„æºç›®å½•ä¸­ï¼Œè€Œå…¶ä»–ç”¨äºè€ç³»ç»Ÿçš„å›¾æ ‡èµ„æº ic_launcher.png æ–‡ä»¶ç½®äº drawable-xdpi ç­‰èµ„æºç›®å½•ä¸­ï¼Œå³å¯ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Python ä¹Ÿèƒ½ç©è·³ä¸€è·³å°æ¸¸æˆ</title>
      <link href="/2018/09/26/Python%20%E4%B9%9F%E8%83%BD%E7%8E%A9%E8%B7%B3%E4%B8%80%E8%B7%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/"/>
      <url>/2018/09/26/Python%20%E4%B9%9F%E8%83%BD%E7%8E%A9%E8%B7%B3%E4%B8%80%E8%B7%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/</url>
      <content type="html"><![CDATA[<p>2017å¹´12æœˆå¾®ä¿¡å‘å¸ƒçš„è·³ä¸€è·³å°æ¸¸æˆï¼Œç®€å•å´åˆè€ƒéªŒäººï¼Œå€Ÿç€è…¾è®¯ä¸€è´¯çš„å¥½å‹æ’åæœºåˆ¶å¯¹ç”¨æˆ·çš„åˆºæ¿€ï¼Œå‡ ä¹æ˜¯ç¬é—´å°±ç«èµ·æ¥äº†ã€‚æ‰‹æ®‹çš„æˆ‘ï¼Œç©è¿™ä¸ªæ¸¸æˆæœ€å¤šä¹Ÿåªæœ‰å‡ ååˆ†ã€‚çœ‹ç€è¿™æ¬¾å°æ¸¸æˆï¼Œæå…¶ç®€å•çš„æ“ä½œ (é•¿æŒ‰å°±å¤Ÿäº†)ã€æå…¶ç®€å•çš„èƒŒæ™¯ (å‡ ä¹æ˜¯çº¯è‰²ï¼Œæ²¡æœ‰ä»»ä½•èƒŒæ™¯è£…é¥°ç‰©)ã€æå…¶ç®€å•çš„å…ƒç´  (é•¿æ–¹ä½“ã€åœ†æŸ±ä½“ç­‰)ï¼Œè®©æˆ‘è§‰å¾—åº”è¯¥å¯ä»¥ç”¨ä¸€ä¸ªè„šæœ¬æ¥è‡ªåŠ¨åŒ–ç©è¿™ä¸ªæ¸¸æˆï¼Œè¯´å¹²å°±å¹²ã€‚</p><p>å¯¹äº Android è®¾å¤‡ï¼Œéœ€è¦è§£å†³çš„é—®é¢˜å…¶å®åªæœ‰ï¼šæ¨¡æ‹Ÿé•¿æŒ‰äº‹ä»¶ã€æˆªå›¾å¹¶è·å–å›¾ç‰‡ã€åˆ†æå›¾ç‰‡åƒç´ ï¼Œåˆ†æå¾—åˆ°æ¯ä¸€æ­¥éœ€è¦è·³åŠ¨çš„è·ç¦»ã€‚ä¸‹é¢ä¸€æ ·ä¸€æ ·æ¥çœ‹ã€‚</p><p>æ¨¡æ‹Ÿé•¿æŒ‰äº‹ä»¶ï¼Œæˆ‘é¦–å…ˆæƒ³åˆ°äº† adbï¼ŒæŸ¥äº†ä¸€ä¸‹ï¼Œæ‰¾åˆ°äº† adb shell input swipe x y time è¿™æ ·ä¸€æ¡å‘½ä»¤ï¼Œswipe æœ¬æ¥æ˜¯ç”¨æ¥åšæ»‘åŠ¨æ“ä½œçš„ï¼Œä½†æ˜¯è¿™é‡Œåªéœ€è¦é•¿æŒ‰ï¼Œæ‰€ä»¥åªæä¾›äº†ä¸€å¯¹åæ ‡ï¼Œæœ€åä¸€ä¸ªå‚æ•° time è¡¨ç¤ºé•¿æŒ‰çš„æ—¶é—´ï¼ŒOKã€‚</p><p>æˆªå›¾å¹¶è·å–å›¾ç‰‡ã€‚è·å–å›¾ç‰‡å¥½åŠï¼Œadb pull ä¸€ä¸‹å°±å¥½äº†ã€‚æˆªå›¾çš„è¯ï¼Œæˆ‘ä¹Ÿæ˜¯æƒ³åˆ°äº† adbï¼ŒæŸ¥äº†ä¸€ä¸‹ï¼Œæ‰¾åˆ°äº† adb shell /system/bin/screencap -p /sdcard/screenshot.png è¿™æ ·çš„å‘½ä»¤ï¼Œç”¨äºæˆªå›¾å¹¶æ”¾åˆ° sdcard ä¸­çš„æŸä¸ªä½ç½®ã€‚</p><p>åˆ†æå›¾ç‰‡åƒç´ è¿™ä¸€æ­¥ï¼Œå°±ä»…ä»…å‰©ä¸‹ç®—æ³•çš„é—®é¢˜å•¦ï¼Œæ¯•ç«Ÿå‰é¢å·²ç»æ‹¿åˆ°äº†æˆªå›¾äº†ã€‚æˆ‘æ˜¯ç”¨ Python çš„ PIL å›¾ç‰‡å¤„ç†åº“æ¥åšçš„ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€å¼ è·³ä¸€è·³çš„æˆªå›¾ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535787465.png" alt=""></p><p>é¦–å…ˆå¯ä»¥æ˜ç¡®ä¸€ä¸ªé—®é¢˜ï¼Œå…¶å®æˆ‘ä»¬ä¸éœ€è¦æ±‚ä¸¤ä¸ªè½ç‚¹ä¹‹é—´çš„è·ç¦»ï¼Œè€Œåªè¦æ±‚ä¸Šå›¾ä¸­ä¸¤æ¡çº¢è‰²ç«–çº¿ä¹‹é—´çš„è·ç¦»å°±å¥½äº†ï¼ŒåŸå› æ˜¯ä¸ç®¡å¾€å·¦ä¸Šè·³ï¼Œè¿˜æ˜¯å¾€æœ‰ä¸Šè·³ï¼Œè¿™ä¸¤ç§è·³æ³•å·¦å³å¯¹ç§°ï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡è·³åŠ¨çš„è·ç¦»ï¼Œå…¶å®æ­£æ¯”äºä¸¤ä¸ªåº•åº§çš„ä¸­å¿ƒçš„ x åæ ‡çš„è·ç¦»ï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸¤æ¡ç«–ç›´çº¢çº¿çš„è·ç¦»ã€‚</p><p>å‡è®¾ç¬¬ä¸€æ¡çº¢è‰²ç«–çº¿ä¸ºè·³ä¹‹å‰ä½ç½®ï¼Œç¬¬äºŒæ¡ç«–çº¿ä¸ºä¸‹ä¸€ä¸ªåº•åº§ä¸­å¿ƒçº¿ã€‚ç¬¬ä¸€æ¡ç«–çº¿çš„ x åæ ‡ï¼Œå¯ä»¥é€šè¿‡ä»ä¸Šåˆ°ä¸‹ä»å·¦åˆ°å³æ‰«æå›¾ç‰‡æ¯ä¸€ä¸ªåƒç´ ï¼Œç›´åˆ°æ‰¾åˆ°äº†é¢œè‰²å’Œè·³åŠ¨çš„æ£‹å­é¢œè‰²ç›¸åŒçš„é¢œè‰² (ä¸€ç§æ¯”è¾ƒæ·±çš„ç´«è‰²)ã€‚ç„¶åå°±å¯ä»¥æ‰¾åˆ°ç¬¬ä¸€æ¡çº¢çº¿çš„ x åæ ‡äº†ã€‚ç¬¬äºŒæ¡ç«–çº¿ï¼Œå¯ä»¥åœ¨é¦–æ¬¡æ‰«æåˆ°å’ŒèƒŒæ™¯é¢œè‰²ä¸ä¸€è‡´çš„é¢œè‰²æ—¶ï¼Œæ­¤æ—¶åº”è¯¥å°±æ˜¯ä¸‹ä¸€ä¸ªåº•åº§çš„æœ€é ä¸Šçš„åƒç´ ï¼Œå¹¶ä¸”ç”±äºåº•åº§è¦ä¹ˆæ˜¯åœ†æŸ±å½¢è¦ä¹ˆæ˜¯é•¿æ–¹ä½“ï¼Œæ‰€ä»¥è¿™ä¸ªåƒç´ ä¹Ÿå°±æ˜¯å·¦å³æ–¹å‘ä¸Šæ˜¯å±…ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ç¬¬ 2 æ¡ç«–çº¿çš„ä½ç½®ã€‚</p><p>æœ€åé€šè¿‡æµ‹è¯•å’Œè°ƒæ ¡ï¼Œå¯ä»¥æ‰¾åˆ°é•¿æŒ‰çš„æ—¶é•¿å’Œä¸¤æ¡çº¢è‰²ç«–çº¿è·ç¦»çš„æ¯”å€¼ã€‚</p><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæ€è·¯éƒ½ç†æ¸…äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å†™ä»£ç åŠ ç»†èŠ‚ä¼˜åŒ–äº†ã€‚ä»£ç ä¸­æœ€å¤–å±‚æ˜¯ä¸ªå¾ªç¯ï¼Œå¾ªç¯çš„æ¯ä¸€æ­¥éƒ½æ˜¯è¿™æ ·å‡ æ­¥ï¼šæˆªå›¾ã€åˆ†æå›¾ç‰‡ç¡®å®šé•¿æŒ‰çš„æ—¶é•¿ã€æ¨¡æ‹Ÿé•¿æŒ‰ã€ç­‰å¾…å‡ ç§’ç­‰è·³è·ƒå®Œæˆä»¥å…ä¸‹ä¸€æ¬¡å¾ªç¯è¿‡æ—©å¼€å§‹æˆªå–åˆ°ä¸­é—´æ€çš„å›¾ç‰‡ã€‚</p><p>ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªæŒ‰ç…§ 1080P å±å¹•å†™çš„è„šæœ¬ï¼Œè¿˜æ˜¯æˆ‘å»å¹´å†™çš„ï¼Œä¹Ÿä¸çŸ¥é“æ˜¯å¦è¿˜é€‚ç”¨äºç°åœ¨çš„è·³ä¸€è·³ï¼Œæˆ‘ç°åœ¨ä¹Ÿä¸æƒ³ç©è·³ä¸€è·³äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image</span><br><span class="line">import os</span><br><span class="line">import time</span><br><span class="line">import random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def is_ball_color(r, g, b):</span><br><span class="line">    <span class="comment"># åˆ¤æ–­æ˜¯å¦æ˜¯æ£‹å­é¡¶éƒ¨å°çƒçš„é¢œè‰²</span></span><br><span class="line">    <span class="keyword">if</span> r &lt; 50 or r &gt; 70:</span><br><span class="line">        <span class="built_in">return</span> False</span><br><span class="line">    <span class="keyword">if</span> g &lt; 50 or g &gt; 70:</span><br><span class="line">        <span class="built_in">return</span> False</span><br><span class="line">    <span class="keyword">if</span> b &lt; 50 or b &gt; 70:</span><br><span class="line">        <span class="built_in">return</span> False</span><br><span class="line">    <span class="built_in">return</span> True</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def is_base_color(r, g, b):</span><br><span class="line">    <span class="comment"># åˆ¤æ–­æ˜¯å¦æ˜¯æ£‹å­åº•åº§çš„é¢œè‰²</span></span><br><span class="line">    <span class="keyword">if</span> r &lt; 50 or r &gt; 70:</span><br><span class="line">        <span class="built_in">return</span> False</span><br><span class="line">    <span class="keyword">if</span> g &lt; 50 or g &gt; 70:</span><br><span class="line">        <span class="built_in">return</span> False</span><br><span class="line">    <span class="keyword">if</span> b &lt; 90 or b &gt; 100:</span><br><span class="line">        <span class="built_in">return</span> False</span><br><span class="line">    <span class="built_in">return</span> True</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def is_similar_color(c1, c2):</span><br><span class="line">    <span class="comment"># åˆ¤æ–­æ˜¯å¦æ˜¯ç›¸è¿‘çš„é¢œè‰²</span></span><br><span class="line">    <span class="keyword">if</span> abs(c1[0] - c2[0]) &gt; 20:</span><br><span class="line">        <span class="built_in">return</span> False</span><br><span class="line">    <span class="keyword">if</span> abs(c1[1] - c2[1]) &gt; 20:</span><br><span class="line">        <span class="built_in">return</span> False</span><br><span class="line">    <span class="keyword">if</span> abs(c1[2] - c2[2]) &gt; 20:</span><br><span class="line">        <span class="built_in">return</span> False</span><br><span class="line">    <span class="built_in">return</span> True</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">    os.system(<span class="string">'adb shell /system/bin/screencap -p /sdcard/screenshot.png'</span>)</span><br><span class="line">    os.system(<span class="string">'adb pull /sdcard/screenshot.png .'</span>)</span><br><span class="line">    img = Image.open(<span class="string">'screenshot.png'</span>)</span><br><span class="line">    w = img.size[0]</span><br><span class="line">    h = img.size[1]</span><br><span class="line">    <span class="keyword">if</span> w == 0 or h == 0:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'w, h:'</span>, w, h)</span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="comment"># print img.getpixel((310, 933))</span></span><br><span class="line">    <span class="comment">#  print img.getpixel((311, 933))</span></span><br><span class="line">    <span class="comment">#  é¦–å…ˆæ˜¯æ‰«ææ¥æ‰¾æ£‹å­</span></span><br><span class="line">    base_x = base_y = 0</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> range(400, h):</span><br><span class="line">        <span class="comment"># y åæ ‡ä» 400 å¼€å§‹ï¼Œé¿å…æ‰«æåˆ°å›¾ç‰‡é¡¶éƒ¨çš„æŒ‰é’®</span></span><br><span class="line">        x = 0</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(0, w):</span><br><span class="line">            px = img.getpixel((x, y))</span><br><span class="line">            <span class="keyword">if</span> is_ball_color(px[0], px[1], px[2]):</span><br><span class="line">                px = img.getpixel((x, y + 192))</span><br><span class="line">                <span class="keyword">if</span> is_base_color(px[0], px[1], px[2]):</span><br><span class="line">                    <span class="built_in">break</span></span><br><span class="line">        <span class="keyword">if</span> x &lt; w - 1:</span><br><span class="line">            base_x = x</span><br><span class="line">            base_y = y</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">    base_y += 192</span><br><span class="line">    <span class="keyword">if</span> base_x == 0:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'base_x == 0'</span>)</span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'base:'</span>, base_x, base_y)</span><br><span class="line">    bg_px = img.getpixel((0, 400))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç„¶åæ˜¯æ‰«ææ¥æ‰¾ä¸‹ä¸€ä¸ªåº•åº§çš„ä½ç½®</span></span><br><span class="line">    dest_x = dest_y = 0</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> range(400, h):</span><br><span class="line">        x = 0</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(0, w):</span><br><span class="line">            <span class="keyword">if</span> x % 50 == 0 and x &gt; 0:</span><br><span class="line">                px = img.getpixel((x - 50, y))</span><br><span class="line">                <span class="keyword">if</span> is_similar_color(bg_px[0 : 3], px[0 : 3]):</span><br><span class="line">                    bg_px = px</span><br><span class="line">                px = img.getpixel((x, y))</span><br><span class="line">                <span class="keyword">if</span> abs(px[0] - bg_px[0]) &gt; 20 or abs(px[1] - bg_px[1]) &gt; 20 or abs(px[2] - bg_px[2]) &gt; 20:</span><br><span class="line">                    <span class="keyword">if</span> abs(x - base_x) &gt; 100:</span><br><span class="line">                        y += 10</span><br><span class="line">                        left = right = x</span><br><span class="line">                        <span class="keyword">while</span> not is_similar_color(bg_px[0 : 3], img.getpixel((left, y))[0 : 3]):</span><br><span class="line">                            left -= 1</span><br><span class="line">                        <span class="keyword">while</span> not is_similar_color(bg_px[0 : 3], img.getpixel((right, y))[0 : 3]):</span><br><span class="line">                            right -= 1</span><br><span class="line">                        <span class="built_in">break</span></span><br><span class="line">        <span class="keyword">if</span> x &lt; w - 1:</span><br><span class="line">            dest_x = (left + right) / 2</span><br><span class="line">            dest_y = y</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line"></span><br><span class="line">    distance = abs(dest_x - base_x)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'dest:'</span>, dest_x, dest_y)</span><br><span class="line">    x = (int)(random.random() * 200 + 600)</span><br><span class="line">    y = (int)(random.random() * 200 + 600)</span><br><span class="line">    <span class="comment"># t æ˜¯é•¿æŒ‰çš„æ—¶é—´</span></span><br><span class="line">    t = distance * 600 / 383</span><br><span class="line">    loc = <span class="string">' '</span> + str(x) + <span class="string">' '</span> + str(y) + <span class="string">' '</span></span><br><span class="line">    os.system(<span class="string">'adb shell input swipe '</span> + loc + loc + str(t))</span><br><span class="line">    os.system(<span class="string">'rm screenshot.png'</span>)</span><br><span class="line">    time.sleep(3)</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MySQL æ•°æ®åº“æ”¯æŒ emoji è¡¨æƒ…å­—ç¬¦</title>
      <link href="/2018/09/26/MySQL%20%E6%95%B0%E6%8D%AE%E5%BA%93%E6%94%AF%E6%8C%81%20emoji%20%E8%A1%A8%E6%83%85%E5%AD%97%E7%AC%A6/"/>
      <url>/2018/09/26/MySQL%20%E6%95%B0%E6%8D%AE%E5%BA%93%E6%94%AF%E6%8C%81%20emoji%20%E8%A1%A8%E6%83%85%E5%AD%97%E7%AC%A6/</url>
      <content type="html"><![CDATA[<p>å…´å†²å†²çš„æ•´ä¸ªåšå®¢ï¼Œæ­»çš®èµ–è„¸çš„å«å‡ ä¸ªåŒå­¦æ¥è¯„è®ºï¼Œç»“æœè¯„è®ºä¸­è¾“å…¥çš„ emoji è¡¨æƒ…æœ€åä¼šå˜æˆé—®å·ï¼Œè¯•æƒ³åˆ«äººè¯„è®ºã€Œå†™çš„çœŸæ£’ ğŸ˜„ã€ç»“æœå˜æˆäº†ã€Œå†™çš„çœŸæ£’ ï¼Ÿã€ï¼Œè¿™æ˜¯ä½•å…¶çš„å°´å°¬ã€‚</p><p>ç»§ç»­å›åˆ°è¿™ä¸ªé—®é¢˜æœ¬èº«ã€‚æˆ‘ç™»å½•åˆ°æ•°æ®åº“ä¸€æŸ¥ï¼Œå‘ç°æ•°æ®åº“ä¸­å­˜çš„è¯„è®ºæ–‡æœ¬å°±æ˜¯ä¸ªé—®å·ï¼Œè¿™è¯´æ˜ emoji è¡¨æƒ…å­˜åˆ°æ•°æ®åº“çš„è¿‡ç¨‹å‡ºé—®é¢˜äº†ã€‚èµ¶ç´§ä¸€æŸ¥ï¼Œå‘ç°ç½‘ä¸Šè¿˜æ˜¯å¾ˆå®¹æ˜“æ‰¾åˆ°äº†è§£å†³æ–¹æ³•ã€‚é—®é¢˜çš„åŸå› æ˜¯ MySQL å­˜å‚¨æ–‡æœ¬æ—¶é»˜è®¤çš„ UTF-8 ä»…æ”¯æŒ 3 ä¸ªå­—èŠ‚ç¼–ç ï¼Œè€Œ emoji æ˜¯ 4 å­—èŠ‚ç¼–ç çš„ï¼Œæ‰€ä»¥å­˜å‚¨è¿‡ç¨‹å‡ºé—®é¢˜äº†ã€‚æ‰€ä»¥éœ€è¦å°† charset è®¾ç½®ä¸º UTF-8 çš„è¶…é›† UTF-8mb4ï¼Œè™½ç„¶æˆ‘ä¹Ÿä¸çŸ¥é“è¿™ä¸ª UTF-8mb4 æ˜¯ä½•æ–¹ç¥åœ£ã€‚</p><p>é¦–å…ˆï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ my.cnf (åœ¨æˆ‘çš„æœºå™¨ä¸Šè¿™ä¸ªæ–‡ä»¶è·¯å¾„æ˜¯ /etc/my.cnf) ä¸­æ·»åŠ ä¸€ä¸‹å†…å®¹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[client]</span></span><br><span class="line"><span class="attr">default-character-set</span>=utf8mb4</span><br><span class="line"></span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">character-set-client-handshake</span> = <span class="literal">FALSE</span></span><br><span class="line"><span class="attr">character-set-server</span> = utf8mb4</span><br><span class="line"><span class="attr">collation-server</span> = utf8mb4_unicode_ci</span><br><span class="line"><span class="attr">init_connect</span>=â€™SET NAMES utf8mb4<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysql]</span></span><br><span class="line"><span class="string">default-character-set=utf8mb4</span></span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œéœ€è¦ä¿®æ”¹å·²æœ‰åº“ã€è¡¨ã€å­—æ®µçš„ charsetã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># ä¿®æ”¹åº“çš„ </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> &lt;database_name&gt; <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> = utf8mb4 <span class="keyword">COLLATE</span> = utf8mb4_unicode_ci; </span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹è¡¨çš„ </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> &lt;table_name&gt; <span class="keyword">CONVERT</span> <span class="keyword">TO</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci; </span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹å­—æ®µçš„ </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> &lt;table_name&gt; <span class="keyword">CHANGE</span> &lt;column_name&gt; &lt;column_name&gt; &lt;original_column_type&gt; <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci;</span><br></pre></td></tr></table></figure><p>æœ€åé‡æ–°å¯åŠ¨ MySQL æœåŠ¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/mysql stop sudo /etc/init.d/mysql start</span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œmysqldump æ—¶ï¼Œä¹Ÿéœ€è¦è¿›è¡Œé¢å¤–æŒ‡å®š char setï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -default-character-set-utf8mb4 -u &lt;db_user_name&gt; -p --databases &lt;db_name&gt; --lock-all-tables &gt; &lt;file_name&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>macOS ç³»ç»Ÿç¼–è¯‘ Android 8.1.0 æºç å…¨è¿‡ç¨‹</title>
      <link href="/2018/09/26/macOS%20%E7%B3%BB%E7%BB%9F%E7%BC%96%E8%AF%91%20Android%208.1.0%20%E6%BA%90%E7%A0%81%E5%85%A8%E8%BF%87%E7%A8%8B/"/>
      <url>/2018/09/26/macOS%20%E7%B3%BB%E7%BB%9F%E7%BC%96%E8%AF%91%20Android%208.1.0%20%E6%BA%90%E7%A0%81%E5%85%A8%E8%BF%87%E7%A8%8B/</url>
      <content type="html"><![CDATA[<p>è¿™ç¯‡æ–‡ç« è¯¦ç»†è®°å½•æˆ‘åœ¨ macOS 10.13 ä¸Šä½¿ç”¨ AOSP ä»£ç ç¼–è¯‘æœ€æ–° Android 8.1.0 çš„ userdebug ç³»ç»Ÿï¼Œå¹¶å®‰è£…åˆ° Pixel XL æ‰‹æœºä¸Šï¼Œæœ€åç”¨ AOSP ä»£ç æˆåŠŸè°ƒè¯• userdebug ç³»ç»Ÿ (ä»è€Œå¯ä»¥å‡†ç¡®å°†ç”µè„‘ä¸Šçš„æºç å’Œè®¾å¤‡ç³»ç»Ÿä»£ç è¡Œå·å¯¹åº”) çš„å…¨è¿‡ç¨‹ã€‚å…¨æ–‡åŒ…æ‹¬ AOSP çš„è·å–ã€ç¼–è¯‘ Android ç³»ç»Ÿã€ä½¿ç”¨ Intellij IDEA æ‰“å¼€éƒ¨åˆ†æºç ã€ä½¿ç”¨ Intellij IDEA è¿›è¡Œè°ƒè¯•è¿™æ ·å‡ éƒ¨åˆ†ã€‚</p><p>ç¯å¢ƒï¼šmacOS 10.13, 250GB SSD, 16GB RAM, XCode 9.2, JDK 1.8.0_151</p><p>###ä¸€ã€AOSP ä»£ç çš„è·å–</p><p>å›  Android çš„ç¼–è¯‘éœ€è¦ case-sensitive çš„ç£ç›˜ç³»ç»Ÿï¼Œè€Œ macOS çš„ç£ç›˜ç³»ç»Ÿä¸æ»¡è¶³æ­¤æ¡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»ºç«‹ä¸€ä¸ª case-sensitive çš„é•œåƒæ–‡ä»¶ï¼Œç„¶åæŒ‚è½½æ­¤é•œåƒæ–‡ä»¶ï¼Œæœ€åå†æŒ‚è½½çš„ç›®å½•ä¸­è·å–æºç å’Œç¼–è¯‘æºç ã€‚å»ºç«‹é•œåƒæ–‡ä»¶çš„æ“ä½œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºç©ºé—´ä¸Šé™ä¸º 150GB çš„ç¨€ç–é•œåƒæ–‡ä»¶ï¼Œåˆ›å»ºåé•œåƒæ–‡ä»¶å…¶å®æ˜¯ ~/android.dmg.sparseimage </span></span><br><span class="line"><span class="comment"># åˆ›å»ºåå¹¶æœªçœŸæ­£å æ®è¿™ä¹ˆå¤šç£ç›˜ç©ºé—´ï¼Œè€Œæ˜¯éšç€é•œåƒä¸­é˜²æ­¢çš„æ•°æ®è¶Šæ¥è¶Šå¤šï¼Œè¯¥é•œåƒæ–‡ä»¶æ‰åŸæ¥è¶Šå¤§ </span></span><br><span class="line">hdiutil create -<span class="built_in">type</span> SPARSE -fs <span class="string">'Case-sensitive Journaled HFS+'</span> -size 150g ~/android.dmg </span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶åå°±å¯ä»¥å°†é•œåƒæ–‡ä»¶æŒ‚è½½åˆ° /Volumes ä¸­ï¼Œæ¯”å¦‚æˆ‘æŒ‚è½½åˆ° /Volumes/android </span></span><br><span class="line">hdiutil attach ~/android.dmg.sparseimage -mountpoint /Volumes/android </span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£é™¤æŒ‚è½½åˆ™æ˜¯ä¸‹é¢è¿™æ · </span></span><br><span class="line">hdiutil detach /Volumes/android </span><br><span class="line"></span><br><span class="line"><span class="comment"># é•œåƒæ–‡ä»¶çš„ç©ºé—´ä¸Šé™æ˜¯å¯ä»¥æ›´æ”¹çš„ï¼Œæ¯”å¦‚ä¸‹é¢æ›´æ”¹ä¸º 160GB </span></span><br><span class="line">hdiutil resize -size 160G ~/android.dmg.sparseimage</span><br></pre></td></tr></table></figure><p>æç¤ºä¸€ä¸‹ï¼Œhdiutil å‘½ä»¤çš„æŸäº›æ“ä½œéœ€è¦ç”µè„‘æ’ç€ç”µæºï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œä¸è¿‡è¿™ä¸ªæŠ¥é”™åœ¨ Google æœç´¢ä¸€ä¸‹å°±èƒ½æ‰¾åˆ°ç­”æ¡ˆäº†ã€‚</p><p><a href="https://source.android.com/" target="_blank" rel="noopener">AOSP é¡¹ç›®</a>å› ä¸ºåŒ…å«å¤ªå¤šäº†å­é¡¹ç›®ï¼Œæ‰€ä»¥æ¯ä¸ªå­é¡¹ç›®ä½¿ç”¨ Git æ¥ç®¡ç†ï¼Œè€Œæ•´ä¸ª AOSP åˆ™ä½¿ç”¨ repo å·¥å…·æ¥ç®¡ç†ï¼Œrepo å…¶å®å°±æ˜¯ä¸€ä¸ª shell è„šæœ¬ï¼Œå†…éƒ¨è°ƒç”¨ Gitã€‚å®˜æ–‡æä¾›çš„<a href="https://source.android.com/setup/downloading" target="_blank" rel="noopener">è·å– AOSP ä»£ç </a>çš„æ–¹å¼å› ä¸ºæŸäº›åŸå› è€Œæ¯”è¾ƒéš¾åšåˆ°ï¼Œæ‰€ä»¥æˆ‘<a href="https://lug.ustc.edu.cn/wiki/mirrors/help/aosp" target="_blank" rel="noopener">ä» USTC Mirror æ¥è·å–æºç </a>ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆè·å–ä¸€ä¸‹ repo å·¥å…· </span></span><br><span class="line">mkdir ~/bin <span class="built_in">export</span> PATH=~/bin:<span class="variable">$PATH</span> </span><br><span class="line">curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo </span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ˆæŒ‚è½½ï¼Œç„¶åè¿›å…¥æŒ‚è½½åçš„ç›®å½•ï¼Œåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œæˆ‘è¿™æ˜¯åˆ›å»ºäº† android-8.1.0_r20 </span></span><br><span class="line"><span class="built_in">cd</span> /Volumes/android </span><br><span class="line">mkdir android-8.1.0_r20 &amp;&amp; <span class="built_in">cd</span> android-8.1.0_r20 </span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶åä½¿ç”¨ repo init æ¥åˆå§‹åŒ– AOSP ç›®å½•ï¼Œå› ä¸º android-8.1.0_r20 æ˜¯å¯ä»¥å®‰è£…åœ¨ Pixel XL ä¸Šé¢çš„æœ€æ–°ç‰ˆæœ¬ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©å®ƒæ¥ä½œä¸ºåˆ†æ”¯ </span></span><br><span class="line"><span class="comment"># å‚è§ https://source.android.google.cn/setup/build-numbers?hl=zh-cn#source-code-tags-and-builds æ¥æŸ¥è¯¢å“ªäº›åˆ†æ”¯æ”¯æŒå“ªäº›è®¾å¤‡ã€‚ </span></span><br><span class="line"><span class="comment"># USTC Mirror ä½œä¸ºåŒæ­¥ä»£ç çš„é•œåƒ </span></span><br><span class="line">repo init -u git://mirrors.ustc.edu.cn/aosp/platform/manifest -b android-8.1.0_r20 </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥ä¸‹æ¥æ˜¯éœ€è¦æ¼«é•¿æ—¶é—´çš„ä¸€æ­¥ï¼Œå³ä»æœåŠ¡å™¨åŒæ­¥æ‰€æœ‰ä»£ç åŠæ–‡ä»¶åˆ°æœ¬åœ°ã€‚ </span></span><br><span class="line">repo sync</span><br></pre></td></tr></table></figure><p>å¦‚æœ repo init å¤±è´¥ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹ <a href="https://lug.ustc.edu.cn/wiki/mirrors/help/aosp#%E5%88%9D%E5%A7%8B%E5%90%8C%E6%AD%A5%E6%96%B9%E6%B3%952" target="_blank" rel="noopener">USTC Mirror çš„æ–¹æ³•</a> ä¸­çš„åˆå§‹åŒ–ä»“åº“é‚£ä¸€æ­¥ã€‚åŒæ­¥è¿‡ç¨‹æ˜¯å¯èƒ½æ„å¤–ä¸­æ–­çš„ï¼Œæ­¤æ—¶å¯ä»¥ç›´æ¥ç»§ç»­æ‰§è¡Œ repo sync æ¥ç»§ç»­åŒæ­¥ã€‚ä¸è¿‡ï¼Œè¿™ä¸ªè¡¥åˆ€æ˜¯å¯ä»¥è‡ªåŠ¨åŒ–æ‰§è¡Œçš„ï¼Œé‚£å°±æ˜¯ä¸‹é¢çš„ shell è„šæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line">repo sync </span><br><span class="line"><span class="keyword">while</span> [ $? -e 1 ]; <span class="keyword">do</span> </span><br><span class="line">    repo sync </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> success</span><br></pre></td></tr></table></figure><p>é™¤äº†åŒæ­¥çš„æ–¹å¼ï¼Œå…¶å®è¿˜æœ‰å¦ä¸€æ¡è·¯å¯ä»¥èµ°ï¼Œé‚£å°±æ˜¯å…ˆä» USTC Mirror AOSP Monthly æˆ–è€… TUNA Mirror AOSP Monthly ä¸‹è½½ aosp-latest.tar æ–‡ä»¶ï¼Œç„¶åè§£å‹åˆ°æ”¾ç½®æºç çš„ç›®å½•ï¼Œç„¶åå† repo initï¼Œç„¶åå† repo syncï¼Œè¿™æ ·çš„è¯ï¼Œrepo sync å°±ä¼šå¿«å¾ˆå¤šï¼Œå¯èƒ½ä¸€ä¸ªå°æ—¶å°±å¯ä»¥äº†å§ã€‚</p><h3 id="äºŒã€ç¼–è¯‘-Android-ç³»ç»Ÿ"><a href="#äºŒã€ç¼–è¯‘-Android-ç³»ç»Ÿ" class="headerlink" title="äºŒã€ç¼–è¯‘ Android ç³»ç»Ÿ"></a>äºŒã€ç¼–è¯‘ Android ç³»ç»Ÿ</h3><p>æˆåŠŸå¾—åˆ°æºç åï¼Œå°±å¯ä»¥ç¼–è¯‘ Android ç³»ç»Ÿé•œåƒäº†ã€‚åœ¨ macOS ä¸Šï¼Œå¦‚æœä½ ä¸æ˜¯ macOS æˆ– iOS å¼€å‘è€…çš„è¯ï¼Œå…«æˆæˆ‘ä»¬éœ€è¦å…ˆå®‰è£… XCodeã€‚</p><p>Gentle remindï¼šåŠ å…¥ä½ ä¹Ÿæ˜¯ 250GB SSD ç”¨æˆ·ï¼Œè€ƒè™‘åˆ°ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œæºç ç›®å½•å æ®çš„ç©ºé—´ä¼šè¶Šæ¥è¶Šåºå¤§ï¼Œé‚£ä¹ˆæˆ‘å»ºè®®æš‚æ—¶å°†æºç æ ¹ç›®å½•ä¸­çš„ .repo éšè—ç›®å½•å‰ªåˆ‡åˆ°ç§»åŠ¨ç¡¬ç›˜ã€‚ä½†æ˜¯å…‰è¿™æ ·è¿˜ä¸å¤Ÿï¼Œä½ è¿˜éœ€è¦å…ˆè§£é™¤æŒ‚è½½ï¼Œç„¶åå†æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æ”¶ç¼©ç¨€ç–é•œåƒæ–‡ä»¶æ‰€å æ®çš„ç©ºé—´å¤§å°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å› ä¸ºç¨€ç–é•œåƒæ–‡ä»¶åˆ é™¤å†…å®¹æ—¶ï¼Œå¹¶ä¸ä¼šå‡å°å æ®çš„ç©ºé—´å¤§å°ï¼Œæ‰€ä»¥ç¨€ç–é•œåƒæ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ï¼Œè§£å†³åŠæ³•å°±æ˜¯ä¸‹é¢è¿™æ ·æ”¶ç¼©ä¸€ä¸‹ </span></span><br><span class="line"><span class="comment"># æ”¶ç¼©æ˜¯æŠŠç¨€ç–é•œåƒä¸­æ²¡æœ‰ä½¿ç”¨çš„ç©ºé—´å»é™¤æ‰ï¼Œä»è€Œè®©å®ƒä¸é‚£ä¹ˆç¨€ç–ï¼Œå°±å¥½åƒæŠŠæµ·ç»µé‡Œçš„æ°´æŒ¤æ‰ä¸€æ · </span></span><br><span class="line">hdiutil compact android.dmg.sparseimage</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å¼€å§‹ç¼–è¯‘çš„ä¸€äº›æ­¥éª¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…ˆè¿›å…¥ AOSP æ ¹ç›®å½•ï¼Œç„¶åå°è¯•æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯æ¸…ç†ä¸Šæ¬¡æ„å»ºçš„äº§ç‰© </span></span><br><span class="line">make clobber</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸Šé¢çš„å‘½ä»¤æŠ¥é”™ï¼Œæç¤º MacOSX SDK ç¼ºå°‘ï¼Œé‚£ä¹ˆå¯ä»¥ <a href="https://github.com/phracker/MacOSX-SDKs/releases" target="_blank" rel="noopener">https://github.com/phracker/MacOSX-SDKs/releases</a> ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„å‹ç¼©åŒ…ï¼Œè§£å‹åˆ° /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs è¿™ä¸ªè·¯å¾„ä¸­ã€‚å¦‚æœæç¤ºä»€ä¹ˆ rt.jar æ‰¾ä¸åˆ°ï¼Œé‚£ä¹ˆä¹…å°† ANDROID_JAVA_HOME è®¾ç½®ä¸º JDK çš„æ ¹ç›®å½•ã€‚</p><p>ç›´åˆ° make clobber ä¸æŠ¥é”™äº†ï¼Œå¼€å§‹ä¸‹é¢çš„æ­¥éª¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼•å…¥ä¸€ä¸ªç¯å¢ƒè®¾ç½®çš„è„šæœ¬ </span></span><br><span class="line"><span class="built_in">source</span> build/envsetup.sh </span><br><span class="line"></span><br><span class="line"><span class="comment"># é€‰æ‹©ç¼–è¯‘ç›®æ ‡ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯ aosp_marlin-userdebugï¼Œmarlin è¡¨ç¤º Pixel XLï¼Œuserdebug çš„å«ä¹‰è¡¨ç¤ºè°ƒè¯•ç‰ˆæœ¬çš„ Android ç³»ç»Ÿ </span></span><br><span class="line">lunch </span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶åå°±æ˜¯å¼€å§‹ç¼–è¯‘äº†ï¼Œ-j åé¢è¡¨ç¤ºå¤šå°‘ä¸ªçº¿ç¨‹å¹¶è¡Œç¼–è¯‘ã€‚æ ¹æ®ç”µè„‘ CPU ç¡¬ä»¶æ¥é€‰ï¼Œä¸€èˆ¬ 4 æ ¸å¿ƒ 8 çº¿ç¨‹çš„ CPU å°±é€‰ -j8 </span></span><br><span class="line">make -j8</span><br></pre></td></tr></table></figure><p>å®Œæ•´ç¼–è¯‘ä¸€éæ˜¯éœ€è¦è€—è´¹è‹¥å¹²å°æ—¶æ—¶é—´çš„ï¼Œæ‰€ä»¥è€å¿ƒç­‰å¾…ï¼Œæˆ‘çš„ç”µè„‘æ˜¯ MacBook Pro 15 å¯¸ 2016ç‰ˆ 2.6GHz CPUï¼Œç¼–è¯‘å¤§çº¦éœ€è¦ä¸‰å››ä¸ªå°æ—¶ã€‚</p><p>å¦‚æœä¸Šé¢ç¼–è¯‘æ—¶å‡ºç°ç±»ä¼¼ä¸‹é¢çš„é”™è¯¯ï¼š</p><blockquote><p>ninja: build stopped: subcommand failed.</p><p>ninja failed with: exit status 1</p></blockquote><p>é‚£ä¹ˆå‚è€ƒ <a href="https://groups.google.com/forum/#!topic/android-building/D1-c5lZ9Oco" target="_blank" rel="noopener">https://groups.google.com/forum/#!topic/android-building/D1-c5lZ9Oco</a> ç»™å‡ºçš„æ–¹æ³•ï¼Œéœ€è¦æ›´æ”¹ external/bison è¿™ä¸ªé¡¹ç›®çš„ä»£ç äº†ã€‚æ­¤æ—¶å¦‚æœå‰é¢æˆ‘ä»¬æŠŠ .repo éšè—ç›®å½•å‰ªè´´èµ°äº†ï¼Œé‚£ä¹ˆç°åœ¨å°±éœ€è¦æŠŠå®ƒçš„ä¸€éƒ¨åˆ†æ‹·è´å›æ¥ï¼Œå³ external/bison è¿™ä¸ªé¡¹ç›®æ‰€éœ€çš„ Git track æ–‡ä»¶ï¼Œé€šè¿‡æŸ¥çœ‹ external/bison/.git ä¸­çš„ç¬¦å·é“¾æ¥ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“å“ªäº›æ–‡ä»¶éœ€è¦æ‹·è´å›æ¥ã€‚</p><p><img src="http://tao93.top/images/2018/09/01/1535786626.png" alt=""></p><p>çº¢æ¡†ä¸­å°±æ˜¯éœ€è¦æ‹·è´å›æ¥çš„ç›®å½•ã€‚ç„¶åæˆ‘ä»¬æ‰§è¡Œä¸‹é¢çš„æ›´æ”¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…ˆè¿›å…¥è¿™ä¸ª bison é¡¹ç›®çš„ç›®å½• </span></span><br><span class="line"><span class="built_in">cd</span> external/bison </span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½œå‡ºæ›´æ”¹ </span></span><br><span class="line">git cherry-pick c0c852bd6fe462b148475476d9124fd740eba160 </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºä¸€ä¸‹ bison é¡¹ç›® </span></span><br><span class="line">mm </span><br><span class="line"></span><br><span class="line"><span class="comment"># å›åˆ° AOSP æ ¹ç›®å½•ï¼Œç„¶åå°†åˆšåˆšæ„å»ºå¾—åˆ°çš„ bison æ›¿ä»£å¦ä¸€ä¸ªåœ°æ–¹çš„ </span></span><br><span class="line"><span class="built_in">cd</span> ../.. &amp;&amp; cp out/host/darwin-x86/bin/bison prebuilts/misc/darwin-x86/bison/ </span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶åç»§ç»­å†ç¼–è¯‘ </span></span><br><span class="line">make -j8</span><br></pre></td></tr></table></figure><p>å»ºè®®ï¼šå¦‚æœä½ ä¹Ÿæ˜¯ 250 GB SSD ç”¨æˆ·ï¼Œé‚£ä¹ˆæ¯æ¬¡ç¼–è¯‘å¤±è´¥åï¼Œå¯ä»¥å…ˆ make clobber æ¸…é™¤æ„å»ºäº§ç‰©ï¼Œå†è§£é™¤æŒ‚è½½ï¼Œç„¶å compat ä¸€ä¸‹ç¨€ç–é•œåƒæ–‡ä»¶ï¼Œè¿™æ ·å¯ä»¥å°½å¯èƒ½çš„é¿å…æœ€åç¼–è¯‘æ—¶ç©ºé—´ä¸å¤Ÿç”¨ã€‚</p><h3 id="ä¸‰ã€çƒ§å½•åˆ°-Pixel-XL-è®¾å¤‡ä¸­"><a href="#ä¸‰ã€çƒ§å½•åˆ°-Pixel-XL-è®¾å¤‡ä¸­" class="headerlink" title="ä¸‰ã€çƒ§å½•åˆ° Pixel XL è®¾å¤‡ä¸­"></a>ä¸‰ã€çƒ§å½•åˆ° Pixel XL è®¾å¤‡ä¸­</h3><p>å…ˆè¿›å…¥å¼€å‘è€…æ¨¡å¼ï¼Œç„¶åæ‰“å¼€ OEM é”ã€‚è¿æ¥åˆ°ç”µè„‘ï¼Œä½¿ç”¨ adb reboot bootloader å‘½ä»¤è®©æ‰‹æœºè¿›å…¥åˆ° BootLoader æ¨¡å¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é‡‡ç”¨æŒ‰è®¾å¤‡çš„ç‰©ç†æŒ‰é”®çš„æ–¹å¼è¿›å…¥ BootLoader æ¨¡å¼ã€‚å¦‚æœæ­¤æ—¶å±å¹•ä¸‹åƒä¸‹é¢è¿™æ ·ï¼Œå°±ä¸éœ€è¦è§£é”ï¼Œåä¹‹éœ€è¦ä½¿ç”¨ fastboot flashing unlock æ¥è§£å¼€ BootLoader é”ã€‚ç³Ÿäº†ï¼Œä»Šå¤©å‡ºé—¨æ²¡å¸¦æ‰‹æœºï¼Œæ— æ³•æˆªå›¾äº†ï¼Œåæ­£å°±æ˜¯å±å¹•ä¸‹éƒ¨å‡ºç° unlocked å­—æ ·ï¼Œç„¶åè¿˜æœ‰ä¸€æŠŠè§£å¼€çš„å°é”çš„å›¾æ ‡ï¼Œå°±æ˜¯å·²è§£é”ï¼Œå¦åˆ™æ˜¯æœªè§£é”ã€‚åªæœ‰è§£é”åæ‰èƒ½åˆ·æœºã€‚å¯¹äº†ï¼Œæ¸©é¦¨æç¤ºä¸€ä¸‹ï¼Œè§£é”åæ¯æ¬¡å¼€æœºéƒ½ä¼šæç¤ºã€ŒYour device software canâ€™t be checked for corruption. Please lock the bootloader. PRESS POWER TO PAUSE BOOTã€ï¼Œä¸ç”¨ç†å®ƒå°±å¥½äº†ã€‚</p><p>ç°åœ¨æˆ‘ä»¬è¦å» <a href="https://developers.google.com/android/drivers" target="_blank" rel="noopener">Driver Binaries</a> ä¸‹è½½é€‚ç”¨äº Pixel XL çš„é©±åŠ¨æ–‡ä»¶ã€‚è¿™ä¸ªé¡µé¢å¾ˆé•¿ï¼Œè¦åœ¨å…¶ä¸­æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„é©±åŠ¨æ–‡ä»¶ï¼Œéœ€è¦ä¸€ä¸ªç»†åˆ†ç‰ˆæœ¬å·ï¼Œåœ¨ <a href="https://source.android.com/setup/start/build-numbers" target="_blank" rel="noopener">ä»£å·ã€æ ‡ç­¾å’Œç‰ˆæœ¬å·</a>è¿™ä¸ªé¡µé¢ï¼Œå¯ä»¥æ‰¾åˆ°æˆ‘ä¹‹å‰ä½¿ç”¨çš„ android-8.1.0_r20 åˆ†æ”¯å¯¹åº”çš„ç»†åˆ†åˆ†æ”¯æ˜¯ OPM2.171019.029ï¼Œä½¿ç”¨è¿™ä¸ªç»†åˆ†åˆ†æ”¯ï¼Œå°±å¯ä»¥åœ¨ <a href="https://developers.google.com/android/drivers" target="_blank" rel="noopener">Driver Binaries</a> ä¸‹è½½åˆ°ç”¨äº Pixel XL çš„å‡†ç¡®çš„é©±åŠ¨æ–‡ä»¶äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸€å…±æ˜¯ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸‹è½½ä¹‹åè§£å‹ï¼Œå‘ç°æ˜¯ä¸¤ä¸ª shell è„šæœ¬ï¼Œåå­—åˆ†åˆ«æ˜¯ extract-qcom-marlin.sh å’Œ extract-google_devices-marlin.shã€‚</p><p><img src="http://tao93.top/images/2018/09/01/1535786865.png" alt=""></p><p>ç°åœ¨ï¼Œå°†ä¸Šä¸€æ­¥å¾—åˆ°çš„ä¸¤ä¸ª shell è„šæœ¬éƒ½å¤åˆ¶åˆ° AOSP æºç æ ¹ç›®å½•ï¼Œç„¶ååˆ†åˆ«æ‰§è¡Œä»¥ä¸‹ã€‚æ¥ä¸‹æ¥ï¼Œéœ€è¦ä»¥ä¸‹æ­¥éª¤æ¥ç¼–è¯‘å¾—åˆ°ä¸€äº›é¢å¤–çš„æ–‡ä»¶ï¼Œå…¶å®æˆ‘ä¹Ÿä¸çŸ¥é“æ˜¯ä»€ä¹ˆæ–‡ä»¶ã€‚æ¥ä¸‹æ¥çš„æ­¥éª¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> build/envsetup.sh </span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹é¢è¿™ä¸€æ­¥æˆ‘ä¾æ—§æ˜¯é€‰ marlin-userdebug </span></span><br><span class="line">lunch</span><br><span class="line">make -j8</span><br></pre></td></tr></table></figure><p>åˆ«æ‹…å¿ƒä¸Šé¢è¿™ä¸ª make å¾ˆå¿«å°±ä¼šå®Œæˆï¼Œå› ä¸ºä¹‹å‰å·²ç»å®Œæ•´ç¼–è¯‘è¿‡äº†ã€‚æ¥ä¸‹æ¥è¦å¼€å§‹åˆ·æœºçš„æœ€åæ­¥éª¤äº†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å› ä¸ºåé¢çš„ flashall éœ€è¦ä¸‹é¢è¿™æ ·ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥å…ˆè®¾ç½®ä¸€ä¸‹ </span></span><br><span class="line"><span class="built_in">export</span> ANDROID_PRODUCT_OUT=&lt;AOSP_ROOT_DIR&gt;/out/target/product/marlin </span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥ä¸Šé¢è¿™ä¸ª marlin ç›®å½•ï¼Œæ‰‹æœºä¿æŒ BootLoader æ¨¡å¼å¹¶è¿æ¥åˆ°ç”µè„‘ï¼Œç„¶åå¼€å§‹åˆ·æœº</span></span><br><span class="line">fastboot -w flashall</span><br></pre></td></tr></table></figure><h3 id="å››ã€è°ƒè¯•-Android-ä»£ç "><a href="#å››ã€è°ƒè¯•-Android-ä»£ç " class="headerlink" title="å››ã€è°ƒè¯• Android ä»£ç "></a>å››ã€è°ƒè¯• Android ä»£ç </h3><p>user-debug çš„ç³»ç»Ÿå®‰è£…åˆ°æ‰‹æœºä¸­åï¼Œå¯ä»¥å‘ç°å’Œå‘è¡Œç‰ˆè¿˜æ˜¯æœ‰äº›ä¸åŒçš„ï¼Œæ¯”å¦‚æ²¡æœ‰ Google æ¡†æ¶ï¼Œæ²¡æœ‰ Google Photosï¼Œç”šè‡³è¿æ—¶é’Ÿåº”ç”¨éƒ½å’Œå‘è¡Œç‰ˆçš„åŸç”Ÿ Android ä¸ä¸€æ ·ã€‚å¦‚æœéœ€è¦è°ƒè¯•ä»£ç ï¼Œæ¯”å¦‚æˆ‘ä»¬è°ƒè¯•åˆ° com.android.internal.policy.PhoneWindow è¿™ä¸ªç±»çš„ä»£ç ï¼Œé‚£ä¹ˆæ˜¾ç„¶ï¼Œéœ€è¦ä½¿ç”¨ä¸€ä¸ª IDE æ¥æ‰“å¼€æˆ‘ä¸‹è½½çš„ AOSP æºç ï¼Œå› ä¸ºè¿™ä»½æºç å†æ˜¯å®‰è£…åˆ°æ‰‹æœºä¸­çš„æºç ï¼Œè€Œä¸èƒ½ä½¿ç”¨ Android SDK ä¸­çš„ sources/android-27 ä¸­çš„æºç æ¥è°ƒè¯•ã€‚ä½¿ç”¨ Intellij IDEA (ä¸‹é¢ç”¨ IDEA ç®€ç§°) æ¥æ‰“å¼€æºç ï¼Œå°†ä¼šæ¯” Android Studio å¥½ä¸€äº›ï¼Œå› ä¸ºå‰è€…æ›´å®¹æ˜“æ§åˆ¶ JDK çš„å¼•å…¥ã€‚</p><p>é¦–å…ˆï¼Œå¯¹äºæˆ‘ä»¬çš„ä¸ªäººç”µè„‘æ¥è¯´ï¼Œç›´æ¥æ‰“å¼€æ•´ä¸ª AOSP é¡¹ç›®çš„æºç æ˜¾å¾—æœ‰äº›è€ƒéªŒäººï¼ŒåŒæ—¶ä¹Ÿè€ƒéªŒæœºã€‚å› ä¸º AOSP ç›®å½•å¤ªåºå¤§äº†ï¼ŒIDEA å»ºç«‹ç´¢å¼•å°†ä¼šéœ€è¦éå¸¸ä¹‹ä¹…ï¼Œä¸€æ—¦æ–‡ä»¶æœ‰äº†æ›´æ”¹ï¼Œé‡æ–°ç´¢å¼•åˆè¦å¾ˆä¹…ï¼Œæ­¤å¤–ï¼Œå…‰æ˜¯ç´¢å¼•æ–‡ä»¶éƒ½ä¼šå¾ˆå¤§ã€‚æ‰€ä»¥æƒå®œä¹‹è®¡æ˜¯ï¼ŒåªæŠŠæœ€å¸¸ç”¨çš„ä¸€éƒ¨åˆ† AOSP ä»£ç  (ä¹Ÿå°±æ˜¯ä¸€éƒ¨åˆ†å­é¡¹ç›®) ä½¿ç”¨ IDEA æ‰“å¼€ã€‚æˆ‘é€‰æ‹©äº† framework ç›®å½•ä¸‹çš„æ‰€æœ‰å­é¡¹ç›®å’Œ libcoreã€repo è¿™ä¸¤ä¸ªå­é¡¹ç›®ã€‚framework æ˜¯å› ä¸ºé‡Œé¢çš„ä»£ç å¸¸ç”¨åˆ°ï¼Œlibcore æ˜¯å› ä¸ºé‡Œé¢æœ‰ Java çš„åº“ä»£ç ï¼Œè€Œ repo æ˜¯å› ä¸º repo è¢«å¼•ç”¨äº†ï¼Œæ‰€ä»¥ä¹ŸåŠ è¿›æ¥äº†ã€‚</p><p>æ­¤å¤–ï¼Œå› ä¸º AOSP æºç æ”¾ç½®åœ¨ case-sensitive çš„é•œåƒæ–‡ä»¶ä¸­ï¼Œè€Œå¦‚æœ IDEA æ‰“å¼€ä½äºé•œåƒæ–‡ä»¶ä¸­çš„æºç çš„è¯ï¼Œå°†éœ€è¦ä¸º IDEA é…ç½®ä¸º case-sensitiveï¼Œå¯æ˜¯ IDEA å¯èƒ½è¿˜éœ€è¦æ‰“å¼€å…¶ä»–çš„æ™®é€šé¡¹ç›®ï¼Œå³ä½äº macOS çš„ case-insensitive æ–‡ä»¶ç³»ç»Ÿä¸­çš„é¡¹ç›®ã€‚è¿™æ ·ä¸¤è€…å°±ä¼šå†²çªï¼Œé¢‘ç¹æŠ¥é”™ã€‚æ‰€ä»¥æˆ‘çš„æ–¹æ³•æ˜¯ï¼ŒæŠŠä¸Šä¸€æ®µæåˆ°çš„éƒ¨åˆ†å­é¡¹ç›®æ‹·è´åˆ°å¤–é¢ï¼Œä¹Ÿå°±æ˜¯æ‹·è´åˆ° macOS æ–‡ä»¶ç³»ç»Ÿï¼Œç„¶åå†ç”¨ IDEA æ‰“å¼€ã€‚</p><p>æ¥ä¸‹æ¥æ˜¯å…·ä½“çš„æ­¥éª¤äº†ï¼Œ é¦–å…ˆéœ€è¦ç”Ÿæˆç”¨äº IDEA çš„ android.imp å’Œ android.ipr æ–‡ä»¶:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ AOSP æ ¹ç›®å½•æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ </span></span><br><span class="line">make idegen &amp;&amp; development/tools/idegen/idegen.sh</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯æ‹·è´å­é¡¹ç›®å‡ºæ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™ä¸ª aosp_part å°±æ˜¯ç”¨æ¥ä¿å­˜éƒ¨åˆ†å­é¡¹ç›®çš„ç›®å½•äº† </span></span><br><span class="line">mkdir aosp_part &amp;&amp; <span class="built_in">cd</span> aosp_part </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹·è´ framework ç›®å½•å’Œ libcore ç›®å½•å‡ºæ¥ </span></span><br><span class="line">cp -R /Volumes/android/android-8.1.0_r20/framework . </span><br><span class="line">cp -R /Volumes/android/android-8.1.0_r20/libcore . </span><br><span class="line">cp -R /Volumes/android/android-8.1.0_r20/repo .</span><br></pre></td></tr></table></figure><p>ä¸ºé¿å…ä¸å°å¿ƒæ”¹åŠ¨ä¸Šé¢é¡¹ç›®ä¸­çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ Git æ¥è¿½è¸ªå®ƒä»¬ï¼Œè€Œæ‰€æœ‰å­é¡¹ç›®çš„ git æ–‡ä»¶å…¶å®éƒ½åœ¨ .repo è¿™ä¸ªéšè—ç›®å½•ä¸­ã€‚æ‰€ä»¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¥ä¸‹æ¥éœ€è¦æŠŠä¸Šé¢å­é¡¹ç›®å¯¹åº”çš„ .git ç›®å½•æ‹·è´è¿‡æ¥ </span></span><br><span class="line"><span class="comment"># å…ˆå»ºä¸€ä¸ª .repo ç›®å½•ï¼Œå¹¶å»ºå¥½ç›¸å…³ç›®å½• </span></span><br><span class="line">mkdir -p .repo/project-objects/platform &amp;&amp; mkdir -p .repo/projects </span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶åå¼€å§‹æ‹·è´ .git ç›®å½• </span></span><br><span class="line">cp -R /Volumes/android/android-8.1.0_r20/.repo/project-objects/platform/frameworks .repo/project-objects/platform </span><br><span class="line">cp -R /Volumes/android/android-8.1.0_r20/.repo/project-objects/platform/libcore.git .repo/project-objects/platform </span><br><span class="line">cp -R /Volumes/android/android-8.1.0_r20/.repo/project-objects/platform/repo.git .repo/project-objects/platform </span><br><span class="line">cp -R /Volumes/android/android-8.1.0_r20/.repo/projects/frameworks .repo/projects/ cp -R /Volumes/android/android-8.1.0_r20/.repo/projects/libcore.git .repo/projects/ </span><br><span class="line">cp -R /Volumes/android/android-8.1.0_r20/.repo/projects/repo.git .repo/projects/ </span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€åï¼ŒæŠŠå‰é¢ç”Ÿæˆçš„ä¸¤ä¸ªæ–‡ä»¶æ‹·è´è¿‡æ¥ </span></span><br><span class="line">cp /Volumes/android/android-8.1.0_r20/android.iml /Volumes/android/android-8.1.0_r20/android.ipr .</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œå°±å¯ä»¥ä½¿ç”¨ IDEA ä»¥æ‰“å¼€é¡¹ç›®çš„å½¢å¼æ‰“å¼€æ­¤ aosp_part ç›®å½•äº†ã€‚æ‰“å¼€åï¼Œå› ä¸º libcore ä¸­å°±å·²ç»æœ‰äº† JDK åº“ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è®© aosp_part é¡¹ç›®ä¸ä½¿ç”¨ç”µè„‘ä¸­çš„ JDKã€‚æ–¹æ³•æ˜¯åœ¨ IDEA æ‰“å¼€çš„ aosp_part é¡¹ç›®ï¼ŒFile â†’ Project Structure â†’ SDKsï¼Œç„¶åå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535787196.png" alt=""></p><p>ç‚¹å‡»åŠ å·ï¼Œæ–°å»ºä¸€ä¸ª JDK å¹¶å°†æ–°çš„ JDK å‘½åä¸º aosp_jdk_1.8ï¼Œæ–°å»ºçš„ JDK ä¸€å¼€å§‹ä¼šå’Œå·²æœ‰çš„é‚£ä¸ª JDK 1.8 ä¸€æ¨¡ä¸€æ ·ï¼ŒåŒ…å«äº†åº“ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠ aosp_jdk_1.8 çš„ ClassPath tab ä¸­çš„æ‰€æœ‰ .jar æ–‡ä»¶ç§»é™¤ï¼Œè¿™æ · aosp_jdk_1.8 æˆäº†ä¸€ä¸ªç©ºçš„ JDKï¼Œå°†è¢«ç”¨äº aosp_part é¡¹ç›®ï¼Œè€Œå…¶ä»–çš„ IDEA é¡¹ç›®å¯ä»¥ä¾æ—§ä½¿ç”¨ JDK 1.8ï¼Œäº’ä¸å½±å“ã€‚</p><p>åœ¨ä¸Šé¢çš„çª—å£ä¸­ï¼Œåœ¨å·¦ä¾§åˆ‡æ¢åˆ° Modules tabï¼Œç„¶åå¦‚ä¸‹å›¾ï¼Œåˆ‡æ¢åˆ° dependencies tabï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535787229.png" alt=""></p><p>åœ¨ä¸Šé¢è¿™ä¸ªç•Œé¢ä¼šæœ‰éå¸¸å¤šçš„ .jar ï¼ŒæŠŠå®ƒä»¬å…¨éƒ¨ç§»é™¤ï¼Œç„¶åå†æ·»åŠ å‰é¢é‚£ä¸ª aosp_jdk_1.8ï¼Œç°åœ¨å°±å·²ç»ç”¨ IDEA æ‰“å¼€äº†éƒ¨åˆ† android æºç äº†ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535787252.png" alt=""></p><p>æ¥ä¸‹æ¥æ˜¯æœ€åä¸€æ­¥äº†ï¼Œåœ¨ IDEA ä¸­è°ƒè¯•ä»£ç ã€‚</p><p>åœ¨ IDEA ä¸­ï¼ŒRun â†’ Edit Configuration â†’ + â†’ Remoteï¼Œç„¶åç¼–è¾‘ä¸€ä¸‹ nameï¼Œç„¶åæŠŠ Settings ä¸‹é¢çš„ port ç¼–è¾‘ä¸º 8700ï¼Œæœ€åä¿å­˜ã€‚</p><p>åœ¨ Android SDK æºç ç›®å½•ä¸­çš„ tools ç›®å½•ä¸­çš„ monitor å¯æ‰§è¡Œæ–‡ä»¶ã€‚å¦‚æœè¿™ä¸ªç¨‹åºæ‰“ä¸å¼€ï¼Œåˆ«æ‹…å¿ƒï¼Œå…ˆæ£€æŸ¥ä¸€ä¸‹ JDK ç‰ˆæœ¬æ˜¯ä¸æ˜¯é«˜äºæˆ–ç­‰äº 1.8.0_152ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆåªéœ€è¦å›é€€åˆ° 1.8.0_151 å³å¯ã€‚è´´å¿ƒçš„æˆ‘æä¾›ä¸€ä»½ JDK 1.8.0_151 çš„ä¸‹è½½åœ°å€ï¼Œåœ¨è¿™é‡Œæ‰¾åˆ° 1.8.0_151 ç‰ˆæœ¬å³å¯ä»¥ã€‚</p><p>æ‰“å¼€ monitor åï¼Œé¼ æ ‡é€‰ä¸­éœ€è¦è°ƒè¯•çš„è¿›ç¨‹ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535787290.png" alt=""></p><p>å› ä¸ºä»Šå¤©æ²¡å¸¦æ‰‹æœºï¼Œæ‰€ä»¥ä¸Šå›¾ä¸­æ˜¯ä¸ª vivo çš„æµ‹è¯•æœºã€‚</p><p>ç„¶ååœ¨ IDEA ç‚¹å‡»è°ƒè¯•æŒ‰é’® (å›¾æ ‡æ˜¯ä¸€ä¸ªç»¿è‰²çš„å°è™«å­)ï¼Œæ­¤æ—¶å¦‚æœå¼¹å‡º Debug tool window å¹¶æç¤º connected to target VMï¼Œåˆ™è¯´æ˜å¯ä»¥åŠ æ–­ç‚¹è°ƒè¯•äº†ã€‚</p><p><img src="http://tao93.top/images/2018/09/01/1535787316.png" alt=""></p><p>EOF</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> AOSP </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>macOS çŠ¶æ€æ æ˜¾ç¤ºç½‘é€Ÿå°å·¥å…·</title>
      <link href="/2018/09/26/macOS%20%E7%8A%B6%E6%80%81%E6%A0%8F%E6%98%BE%E7%A4%BA%E7%BD%91%E9%80%9F%E5%B0%8F%E5%B7%A5%E5%85%B7/"/>
      <url>/2018/09/26/macOS%20%E7%8A%B6%E6%80%81%E6%A0%8F%E6%98%BE%E7%A4%BA%E7%BD%91%E9%80%9F%E5%B0%8F%E5%B7%A5%E5%85%B7/</url>
      <content type="html"><![CDATA[<p>æ—©å…ˆæˆ‘æ˜¯ç”¨ç›—ç‰ˆçš„ <a href="https://bjango.com/mac/istatmenus/" target="_blank" rel="noopener">iStat Menus</a> è½¯ä»¶ä¸­çš„ã€ŒçŠ¶æ€æ æ˜¾ç¤ºç½‘é€Ÿã€åŠŸèƒ½çš„ï¼Œåæ¥ä¸å†ç”¨ç›—ç‰ˆè½¯ä»¶äº†ï¼Œå¯æ˜¯å¶å°”è¿˜æ˜¯æœ‰æŸ¥çœ‹ç½‘é€Ÿçš„éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘å°±æŸ¥æ‰¾ macOS ç›‘æµ‹ç½‘é€Ÿçš„æ–¹æ³•ï¼Œæœ€åæ‰¾åˆ°äº† nettop è¿™ä¸ªå‘½ä»¤ã€‚</p><p>nettop å‘½ä»¤çš„å‚æ•°æˆ‘å°±ä¸è§£é‡Šäº†ï¼Œåæ­£ç”¨å®ƒå°±å¯ä»¥çœ‹åˆ°å½“å‰æ—¶åˆ»å„ä¸ªè¿›ç¨‹ download å’Œ upload çš„å­—èŠ‚æ•°ï¼Œæ‰€ä»¥å®šæ—¶æ‰§è¡Œæ­¤å‘½ä»¤ï¼Œç„¶åå¯å¾—æ—¶é—´åŒºé—´å†…çš„ä¸Šä¼ å’Œä¸‹è½½å­—èŠ‚æ•°ï¼Œç„¶åå†é™¤ä»¥æ—¶é—´é—´éš”ï¼Œå°±å¾—åˆ°äº†ç½‘é€Ÿã€‚æˆ‘å®šæ—¶æ‰§è¡Œçš„å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nettop -x -t wifi -t wired -k rx_dupe,rx_ooo,re-tx,rtt_avg,rcvsize,tx_win,tc_class,tc_mgt,cc_algo,P,C,R,W -P -l 1</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ï¼Œå°±å¯åˆ—å‡ºè‹¥å¹²è¿›ç¨‹å’Œä»–ä»¬çš„ä¸Šä¼ ä¸‹è½½å­—èŠ‚æ•°ï¼Œä¸‹é¢æ˜¯ç¤ºä¾‹ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">time</span>                                <span class="selector-tag">interface</span>         <span class="selector-tag">state</span>        <span class="selector-tag">bytes_in</span>       <span class="selector-tag">bytes_out</span></span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266151</span> <span class="selector-tag">apsd</span><span class="selector-class">.100</span>                                               7413           16246</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266164</span> <span class="selector-tag">sentineld</span><span class="selector-class">.109</span>                                          6666            6954</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266166</span> <span class="selector-tag">biometrickitd</span><span class="selector-class">.253</span>                                    113264           19802</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266169</span> <span class="selector-tag">eoshostd</span><span class="selector-class">.266</span>                                              0               0</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266171</span> <span class="selector-tag">SystemUIServer</span><span class="selector-class">.380</span>                                        0            3344</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266172</span> <span class="selector-tag">rapportd</span><span class="selector-class">.405</span>                                            393             366</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266174</span> <span class="selector-tag">Mail</span><span class="selector-class">.419</span>                                              81706           36183</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266194</span> <span class="selector-tag">SogouServices</span><span class="selector-class">.487</span>                                       329             921</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266198</span> <span class="selector-tag">mDNSResponder</span><span class="selector-class">.602</span>                                  20108134         3925987</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266200</span> <span class="selector-tag">Teams</span><span class="selector-class">.6104</span>                                            33061           19975</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266214</span> <span class="selector-tag">Microsoft</span> <span class="selector-tag">Teams</span><span class="selector-class">.6142</span>                                  23322           22085</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266220</span> <span class="selector-tag">QQ</span><span class="selector-class">.33101</span>                                             522914           82040</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266222</span> <span class="selector-tag">WeChat</span><span class="selector-class">.37612</span>                                          53670           64492</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266224</span> <span class="selector-tag">Google</span> <span class="selector-tag">Chrome</span><span class="selector-class">.37878</span>                                 1633955           42648</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266226</span> <span class="selector-tag">ss-local</span><span class="selector-class">.38600</span>                                        52499           74555</span><br><span class="line">17<span class="selector-pseudo">:36</span><span class="selector-pseudo">:43.266228</span> <span class="selector-tag">netbiosd</span><span class="selector-class">.40075</span>                                      1008522          151841</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå°±æ˜¯æœ€åŸºæœ¬çš„ä¸œè¥¿äº†ã€‚å› ä¸ºæˆ‘å¹¶ä¸æ‡‚ swift ç¼–ç¨‹ï¼Œæ‰€ä»¥æˆ‘å…ˆå†™äº†ä¸€ä¸ª python è„šæœ¬ï¼Œæ¥å®šæ—¶æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ï¼Œç„¶åè§£æå‘½ä»¤çš„è¾“å‡ºå¹¶è®¡ç®—ç½‘é€Ÿï¼Œè„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_time_stamp</span><span class="params">(t)</span>:</span></span><br><span class="line">    h = int(t[<span class="number">0</span>:<span class="number">2</span>])</span><br><span class="line">    m = int(t[<span class="number">3</span>:<span class="number">5</span>])</span><br><span class="line">    s = int(t[<span class="number">6</span>:<span class="number">8</span>])</span><br><span class="line">    miu_s = int(t[<span class="number">9</span>:])</span><br><span class="line">    <span class="keyword">return</span> ((h * <span class="number">60</span> + m) * <span class="number">60</span> + s) * <span class="number">1000000</span> + miu_s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">last_result = &#123;&#125;</span><br><span class="line">cur_result = &#123;&#125;</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    print(<span class="string">'---------'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># sample, output speed</span></span><br><span class="line">    res = subprocess.run(<span class="string">'nettop -x -t wifi -t wired -k rx_dupe,rx_ooo,re-tx,rtt_avg,rcvsize,tx_win,tc_class,tc_mgt,cc_algo,P,C,R,W -P -l 1'</span>.split(), stdout=subprocess.PIPE)</span><br><span class="line">    <span class="comment"># assign sample result to last result</span></span><br><span class="line">    output = res.stdout.decode()</span><br><span class="line">    cur_result = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> output.split(<span class="string">'\n'</span>):</span><br><span class="line">        <span class="keyword">if</span> line == <span class="string">''</span> <span class="keyword">or</span> line.startswith(<span class="string">'time'</span>):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        data = line.split()</span><br><span class="line">        data_len = len(data)</span><br><span class="line"></span><br><span class="line">        t, p, i, o = data[<span class="number">0</span>], <span class="string">''</span>.join(data[<span class="number">1</span>: data_len - <span class="number">2</span>]), int(data[data_len - <span class="number">2</span>]), int(data[data_len - <span class="number">1</span>])</span><br><span class="line">        idx = p.rfind(<span class="string">'.'</span>)</span><br><span class="line">        p = p[:idx]</span><br><span class="line">        t = get_time_stamp(t)</span><br><span class="line">        cur_result[p] = (t, i, o)</span><br><span class="line">    <span class="keyword">if</span> len(last_result) &gt; <span class="number">0</span>:</span><br><span class="line">        speed = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> last_p, last_d <span class="keyword">in</span> last_result.items():</span><br><span class="line">            <span class="keyword">for</span> cur_p, cur_d <span class="keyword">in</span> cur_result.items():</span><br><span class="line">                <span class="keyword">if</span> last_p == cur_p:</span><br><span class="line">                    up_speed = cur_d[<span class="number">2</span>] - last_d[<span class="number">2</span>]</span><br><span class="line">                    down_speed = cur_d[<span class="number">1</span>] - last_d[<span class="number">1</span>]</span><br><span class="line">                    <span class="keyword">if</span> cur_p <span class="keyword">in</span> speed:</span><br><span class="line">                        speed[cur_p] = (speed[cur_p][<span class="number">0</span>], speed[cur_p][<span class="number">1</span>] + up_speed, speed[cur_p][<span class="number">2</span>] + down_speed)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        speed[cur_p] = (cur_p, up_speed, down_speed)</span><br><span class="line">        speed = list(speed.values())</span><br><span class="line">        speed.sort(key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>] + x[<span class="number">2</span>], reverse=<span class="keyword">True</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> speed:</span><br><span class="line">            print(i[<span class="number">0</span>])</span><br><span class="line">    last_result = cur_result</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>ç„¶åä»Šå¤©ç»ˆäºç£•ç£•ç»Šç»Šçš„ç”¨ XCode å†™äº†ä¸€ä¸ªæ¯”è¾ƒç®€é™‹çš„ã€ŒçŠ¶æ€æ æ˜¾ç¤ºå®æ—¶ç½‘é€Ÿã€çš„ macOS å°å·¥å…·ï¼Œå¹¶æ”¾åœ¨äº† <a href="https://github.com/Tao93/NetTool" target="_blank" rel="noopener">github ä¸Šé¢</a>ï¼Œè¿è¡Œæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://tao93.top/images/2018/09/15/1537000487.png" alt=""></p>]]></content>
      
      
        <tags>
            
            <tag> macOS </tag>
            
            <tag> swift </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>macOS ç¼–è¯‘ Android 9 æºç </title>
      <link href="/2018/09/26/macOS%20%E4%B8%8B%E7%BC%96%E8%AF%91%20Android%209%20%E6%BA%90%E7%A0%81/"/>
      <url>/2018/09/26/macOS%20%E4%B8%8B%E7%BC%96%E8%AF%91%20Android%209%20%E6%BA%90%E7%A0%81/</url>
      <content type="html"><![CDATA[<h4 id="ç¯å¢ƒï¼š"><a href="#ç¯å¢ƒï¼š" class="headerlink" title="ç¯å¢ƒï¼š"></a>ç¯å¢ƒï¼š</h4><pre><code>macOS High Sierra 10.13.6 with 16GB RAMXCode 9.4.1Oracle JDK 1.8.0_181</code></pre><p>å¤§çº¦ 1 ä¸ªæœˆä¹‹å‰ï¼ŒGoogle æ¨å‡ºäº† Android Pie æ­£å¼ç‰ˆï¼Œæˆ‘ä¹Ÿç”¨ Pixel XL è®¾å¤‡ç¬¬ä¸€æ—¶é—´æ›´æ–°åˆ°äº† Pieï¼Œç»“æœå‘ç°å’Œ Oreo ç›¸æ¯”å˜åŒ–ä¸å¤§ã€‚æ­¤å¤–ï¼Œæˆ‘ä¹Ÿæƒ³åˆ° Google åº”è¯¥æ—©å°±åœ¨ AOSP åˆ›å»ºäº† Android Pie çš„ä»£ç åˆ†æ”¯ï¼Œæ­£å¥½æˆ‘åˆ°åˆšåˆ° Microstrategy æ¥ä¸Šç­ï¼Œæ¢äº†æ–°çš„ MacBookï¼Œæ˜¯æ—¶å€™å†æ¬¡ç”¨ MacBook ç¼–è¯‘ä¸€æ¬¡ AOSP æºç äº†ã€‚</p><p>é¦–å…ˆæˆ‘æŸ¥çœ‹äº†æ‰‹ä¸Šçš„ 2017 æ¬¾ MacBook 15å¯¸ï¼Œå‘ç°è¿™å±…ç„¶æ˜¯ 500GB ç£ç›˜çš„ï¼Œè¿™ä»¤æˆ‘ååˆ†æƒŠå–œï¼Œè¿™æ„å‘³ç€è¿™å°æœºå™¨ç¼–è¯‘ Android æºç æ—¶ç£ç›˜ç©ºé—´å°†ä¼šç»°ç»°æœ‰ä½™ã€‚</p><h4 id="è·å–æºä»£ç "><a href="#è·å–æºä»£ç " class="headerlink" title="è·å–æºä»£ç "></a>è·å–æºä»£ç </h4><p>å¯ä»å›½å†…é•œåƒå…ˆä¸‹è½½åˆ°ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œ<a href="https://lug.ustc.edu.cn/wiki/mirrors/help/aosp" target="_blank" rel="noopener">USTC Mirror</a> å’Œ <a href="https://mirrors.tuna.tsinghua.edu.cn/help/AOSP/" target="_blank" rel="noopener">Tuna</a> éƒ½å¯é€‰æ‹©ï¼Œä»¥ä¸‹ä»¥ Tuna ä¸ºä¾‹ã€‚</p><p>é¦–å…ˆä» <a href="https://mirrors.tuna.tsinghua.edu.cn/aosp-monthly" target="_blank" rel="noopener">è¿™é‡Œ</a> ä¸‹è½½ aosp-latest.tar æ–‡ä»¶å’Œå¯¹åº”çš„ MD5 æ–‡ä»¶ã€‚è¿™ä¸ª tar æ–‡ä»¶ä¸­æ˜¯è¿‘æœŸçš„æ•´ä¸ª AOSP é¡¹ç›®çš„å‹ç¼©åŒ…ã€‚ä¸‹è½½å¯ä»¥ä½¿ç”¨ wget åŠ  -c å‘½ä»¤ï¼Œè¿™æ ·å³ä½¿ä¸‹è½½æ„å¤–å¤±è´¥ï¼Œä¹Ÿå¯ä»¥æ¥ä¸Šä¸­æ–­çš„åœ°æ–¹ç»§ç»­ä¸‹è½½ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># download aosp-latest.tar file, with -c option</span></span><br><span class="line">wget -c https://mirrors.tuna.tsinghua.edu.cn/aosp-monthly/aosp-latest.tar</span><br></pre></td></tr></table></figure><p>ä¸‹è½½å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è·å– md5 å€¼ï¼Œæ£€æŸ¥å’Œä¸‹è½½åˆ°çš„ aosp-latest.tar.md5 æ–‡ä»¶ä¸­çš„å€¼æ˜¯å¦ä¸€è‡´ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># get it's md5 value then check the value</span></span><br><span class="line">md5 aosp-latest.tar</span><br></pre></td></tr></table></figure><p>å¦ä¸€ä¸ªä»¤äººæƒŠå–œçš„äº‹ï¼Œæœ€è¿‘çš„ aosp ä½“ç§¯å±…ç„¶å‡å°äº†ï¼Œä¹‹å‰å‡ ä¸ªæœˆ aosp ä½“ç§¯é‚£æ˜¯ä¸€è·¯è¹­è¹­è¹­å¾€ä¸Šæ¶¨ï¼Œæ¶¨åˆ°äº† 40 å¤š GBï¼š</p><p><img src="http://tao93.top/images/2018/09/06/1536224194.png" alt=""></p><p>æ¥ä¸‹æ¥ï¼ŒæŒ‰ç…§ä¹‹å‰æˆ‘çš„ post <a href="http://tao93.top/2018/09/01/macOS%20ç³»ç»Ÿç¼–è¯‘%20Android%208.1.0%20æºç å…¨è¿‡ç¨‹/">macOS ç³»ç»Ÿç¼–è¯‘ Android 8.1.0 æºç å…¨è¿‡ç¨‹</a> ä¸­çš„æè¿°ï¼Œå»ºç«‹ sparse image å¹¶æŒ‚è½½ï¼Œç„¶åå°† aosp-latest.tar è§£å‹åˆ° sparse image ä¸­ã€‚æˆ‘åœ¨ sparse image ä¸­å»ºç«‹äº†ä¸€ä¸ª aosp ç›®å½•ï¼Œç„¶åæŠŠ aosp-latest.tar è§£å‹åˆ°äº† aosp ç›®å½•ä¸­ï¼Œæ­¤æ—¶ aosp ç›®å½•ä¸­ä»…æœ‰ä¸€ä¸ª .repo ç›®å½•ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥æŠŠæœ€æ–°çš„ Android Pie åˆ†æ”¯çš„ä»£ç  checkoutã€‚</p><p>å¦å¤–ï¼Œè¦å…ˆçŸ¥é“æˆ‘ä»¬éœ€è¦å“ªä¸ªåˆ†æ”¯ï¼Œåœ¨ <a href="https://source.android.com/setup/start/build-numbers" target="_blank" rel="noopener">è¿™é‡Œ</a> å¯ä»¥çœ‹åˆ°æ‰€æœ‰ä»£ç åˆ†æ”¯ä¸ä»£å·ã€‚åœ¨è¿™ä¸ªç½‘é¡µå¦‚æœæ˜¾ç¤ºä¸ºä¸­æ–‡ï¼Œå°±æ‹‰åˆ°æœ€åº•éƒ¨åœ¨å·¦ä¸‹è§’æŠŠè¯­è¨€æ¢æˆè‹±æ–‡ï¼Œå› ä¸ºè‹±æ–‡æ‰æœ‰æœ€æ–°çš„ Android Pie ç›¸å…³ä¿¡æ¯ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ ¹æ®è‡ªå·±æƒ³è¦ç”¨äºä»€ä¹ˆè®¾å¤‡æ¥é€‰æ‹©åˆ†æ”¯ï¼Œæ¯”å¦‚å¦‚æœæ˜¯ Pixel 2 è®¾å¤‡é‚£ä¹ˆæœ€æ–°çš„åˆ†æ”¯å°±æ˜¯ android-9.0.0_r6ï¼Œè€Œä¸èƒ½ä½¿ android-9.0.0_r7 å’Œ android-9.0.0_r8ï¼Œæˆ‘å½“æ—¶ç”¨çš„æ˜¯ android-9.0.0_r2</p><p><img src="http://tao93.top/images/2018/09/06/1536224982.png" alt=""></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># prepare repo</span></span><br><span class="line">mkdir ~/bin</span><br><span class="line">curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;PATH&#125;</span>:<span class="variable">$&#123;HOME&#125;</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> aosp</span><br><span class="line"></span><br><span class="line"><span class="comment"># init with specific branch android-9.0.0_r2, use other branch as you want</span></span><br><span class="line">repo init repo init -u https://aosp.tuna.tsinghua.edu.cn/platform/manifest -b android-9.0.0_r2</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±å¯ä»¥ repo sync äº†ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œæ­¤å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥åƒæˆ‘ä¹‹å‰ post ä¸€æ ·å†™ä¸€ä¸ª sync è„šæœ¬æ¥æ‰§è¡Œã€‚</p><p>æœ‰äºæˆ‘ä»¬ä¸‹è½½äº†æœ€æ–°çš„ aosp-latest.tarï¼Œæ‰€ä»¥ sync çš„è¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒå¿«çš„ï¼Œæˆ‘å½“æ—¶åº”è¯¥ 30 æ¥åˆ†é’Ÿå°± sync å®Œæˆäº†ã€‚</p><h4 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h4><p>ä»¥å¾€ç¼–è¯‘ Android æºç æ—¶ï¼Œæ€»æ˜¯ä¼šå‡ºç°å„ç§å„æ ·çš„é”™è¯¯ï¼Œä½†æ˜¯è¿™æ¬¡ Android Pie çš„æºç ç¼–è¯‘å¼‚å¸¸é¡ºåˆ©ï¼Œæ²¡æœ‰ä»»ä½•é”™è¯¯ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯ Google åšäº†æ”¹è¿›å’Œä¼˜åŒ–ã€‚</p><p>é¦–å…ˆä¸‹è½½ XCode å®‰è£…ï¼Œç„¶åè¿›å…¥ aosp æ ¹ç›®å½•ï¼Œå°±å¯ä»¥ç¼–è¯‘äº†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># clear build generated files</span></span><br><span class="line">make clobber</span><br><span class="line"></span><br><span class="line"><span class="comment"># import a build script</span></span><br><span class="line"><span class="built_in">source</span> build/envsetup.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># select build target </span></span><br><span class="line">lunch</span><br><span class="line"></span><br><span class="line"><span class="comment"># start build</span></span><br><span class="line">make -j8</span><br></pre></td></tr></table></figure><p>éå¸¸é¡ºåˆ©ï¼Œä¸Šæ¬¡æˆ‘é€‰æ‹© aosp_marlin-userdebug ç”¨äº† 3 ä¸ªåŠå°æ—¶å°±æˆåŠŸç¼–è¯‘äº†ï¼Œç®€ç›´ä»¤äººæ„ŸåŠ¨ã€‚ç›¸æ¯”èµ·æ¥ï¼Œä¹‹å‰çš„ Android æºç ç¼–è¯‘ä¼šå‡ºç°å„ç§å„æ ·çš„é”™è¯¯ï¼Œè®©äººéå¸¸æŠ“ç‹‚ã€‚</p><p>å› ä¸ºæˆ‘æ‰‹é‡Œçš„ Pixel XL å·²ç»å®‰è£…äº† factory Android systemï¼Œé‡Œé¢æœ‰æˆ‘å¾ˆå¤šèµ„æ–™å’Œæ•°æ®äº†ï¼Œå¦å¤– userdebug ç±»å‹çš„ Android æ˜¯æ²¡æœ‰ Google æœåŠ¡çš„ï¼Œå¹¶ä¸”è¿ Google Photosã€Cameraã€Gmail ç­‰åº”ç”¨å…¨éƒ½æ²¡æœ‰ï¼Œæ‰€ä»¥æˆ‘å°±æ²¡å†æŠŠç¼–è¯‘å‡ºæ¥çš„ userdebug ç±»å‹ç³»ç»Ÿå®‰è£…åˆ°æ‰‹æœºä¸­ã€‚äºæ˜¯ï¼Œæˆ‘ä»Šå¤©é€‰æ‹© aosp_x86_64-eng é‡æ–°ç¼–è¯‘äº†ä¸€éï¼Œè¿™ä¸ª aosp_x86_64-eng é€‚ç”¨äºåœ¨ x86 ç”µè„‘ä¸Šè¿è¡Œæ¨¡æ‹Ÿå™¨ (æ²¡æœ‰æ‰‹æœºå°±åªå¥½ç°åœ¨ç”µè„‘ä¸Šç”¨æ¨¡æ‹Ÿå™¨è¯•è¯•äº†)ã€‚è¿™ä¸€æ¬¡ç”¨äº† 4 ä¸ªå¤šå°æ—¶å®Œæˆç¼–è¯‘ï¼ŒåŒæ ·éå¸¸é¡ºåˆ©ï¼š</p><p><img src="http://tao93.top/images/2018/09/07/1536304013.png" alt=""></p><p>ç¼–è¯‘å®Œæˆåï¼Œç›´æ¥è¿è¡Œ emulator å‘½ä»¤å³å¯è¿è¡Œæ¨¡æ‹Ÿå™¨ã€‚éœ€è¦æ³¨æ„ï¼Œè¿™ä¸ª emulator å‘½ä»¤æ˜¯è¿è¡Œ lunch å‘½ä»¤è€Œæ·»åŠ çš„ï¼Œä¹Ÿå°±æ˜¯å¦‚æœé€€å‡ºäº†ç”µè„‘çš„ terminalï¼Œç„¶åå†è¿›å…¥ aosp æ ¹ç›®å½•ï¼Œéœ€è¦é‡æ–°è¿è¡Œ source build/envsetup.sh å’Œ lunch ç„¶åæ‰èƒ½è¿è¡Œ emulatorã€‚ä»¥ä¸‹æ˜¯æ¨¡æ‹Ÿå™¨è¿è¡Œçš„æˆªå›¾ï¼š</p><p><img src="http://tao93.top/images/2018/09/07/1536305206.png" alt=""></p><p>ä¸Šé¢ 3 å¼ æˆªå›¾ä¸­ï¼Œå·¦è¾¹ä¸¤å¼ æˆªå›¾å¯ä»¥çœ‹åˆ°ç³»ç»Ÿæ˜¯å¾ˆç®€é™‹çš„ï¼ŒGoogle çš„è®¸å¤šåº”ç”¨éƒ½æ²¡æœ‰ï¼Œè¿ Google service ä¹Ÿæ²¡æœ‰ã€‚æœ€æœ‰ä¸€å¼ æˆªå›¾ï¼Œæ˜¾ç¤ºäº† Android ç‰ˆæœ¬å·æ˜¯ 9ï¼Œå¦å¤–æœ€åº•éƒ¨çš„ Build Number æ˜¾ç¤ºäº†è¿™æ˜¯ aosp_x86_64-eng ç±»å‹çš„æ„å»ºï¼ŒPPR1.180610.010 æ˜¯ Build ä»£å·ï¼Œåœ¨ <a href="https://source.android.com/setup/start/build-numbers" target="_blank" rel="noopener">è¿™é‡Œ</a> å¯ä»¥çœ‹åˆ°ï¼Œè€Œ 20180907.105244 åˆ™æ˜¯æ„å»ºæ—¶é—´ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> macOS </tag>
            
            <tag> AOSP </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Linux æ‰§è¡Œè¿œç¨‹è„šæœ¬</title>
      <link href="/2018/09/26/Linux%20%E6%89%A7%E8%A1%8C%E8%BF%9C%E7%A8%8B%E8%84%9A%E6%9C%AC/"/>
      <url>/2018/09/26/Linux%20%E6%89%A7%E8%A1%8C%E8%BF%9C%E7%A8%8B%E8%84%9A%E6%9C%AC/</url>
      <content type="html"><![CDATA[<p>æœ€è¿‘å·¥ä½œä¸Šéœ€è¦å†™ä¸€å¥—è·¨æœåŠ¡å™¨åˆ†éš”æ•°æ®å’Œè½¬ç§»æ•°æ®çš„è„šæœ¬ã€‚ç»è¿‡å®è·µï¼Œå‘ç°å•çº¯æ‰§è¡Œåœ¨æœ¬åœ°æ‰§è¡Œå‘½ä»¤æ¥æ“æ§è¿œç¨‹æœåŠ¡å™¨çš„æ•°æ®ä¸ç°å®ã€‚æ‰€ä»¥éœ€è¦æŠŠè„šæœ¬æ”¾åœ¨è¿œç¨‹æœåŠ¡å™¨ï¼Œç„¶åæœ¬åœ°è®©æœåŠ¡å™¨è‡ªå·±å»æ‰§è¡Œè„šæœ¬ã€‚æ­¤å¤–ï¼Œéœ€è¦ä½¿ç”¨ expect å·¥å…·æ¥è‡ªåŠ¨è¾“å…¥è¿œç¨‹æœåŠ¡å™¨ç™»å½•å¯†ç ã€‚</p><p>å…ˆæä¸€äº›  expect çš„ç”¨æ³•ï¼Œå³å¯ä»¥å†™æˆ expect è„šæœ¬å½¢å¼ (å³è„šæœ¬ä»¥ #!/usr/bin/expect å¼€å¤´)ï¼Œä¹Ÿå¯ä»¥å†™æˆ expect -c â€˜&lt;several_cmd&gt;â€™ çš„å•æ¡å‘½ä»¤å½¢å¼ã€‚åè€…çš„ç¤ºä¾‹å½¢å¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect -c <span class="string">'spawn scp root@example:~/xx.txt .; expect "password:"; send "abc1234\\r"; interact;'</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¾‹å­ä¸­ï¼Œspawn åé¢è¡¨ç¤ºéœ€è¦æ‰§è¡Œçš„å‘½ä»¤ (æ­¤å¤„æ˜¯ä¸€ä¸ª scp å‘½ä»¤ï¼Œéœ€è¦è¾“å…¥å¯†ç ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦ expect çš„åŸå› )ï¼Œexpect åé¢æ˜¯è¡¨ç¤ºæ ‡å‡†è¾“å‡ºå‡ºç° â€œpassword:â€ å­—æ ·æ—¶ï¼Œå°±è‡ªåŠ¨è¾“å…¥ send åé¢çš„ä¸œè¥¿ï¼Œä¹Ÿå°±æ˜¯å¯†ç ã€‚æœ€åä¸€ä¸ª interact è¡¨ç¤ºæ¥ä¸‹æ¥å…è®¸ç”¨æˆ·è‡ªå·±äº¤äº’ã€‚</p><p>æœ¬æ¥ç›´æ¥ä½¿ç”¨ shell è„šæœ¬å°±å¯ä»¥çš„ã€‚ä¸è¿‡æˆ‘è¿™è®¾è®¡åˆ°æ•°æ®çš„åˆ‡å‰²ï¼Œæ‰€ä»¥å°±ä½¿ç”¨äº† Pythonï¼Œç„¶åéœ€è¦ç”¨åˆ° shell å‘½ä»¤æ—¶ï¼Œæ˜¯ç”± Python è„šæœ¬å†è°ƒç”¨ shell å‘½ä»¤çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">call_remote_cmd</span><span class="params">(host, password, cmd)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    è®©è¿œç¨‹æœåŠ¡å™¨è‡ªå·±æ‰§è¡Œå‘½ä»¤ </span></span><br><span class="line"><span class="string">    :param host: è¿œç¨‹æœåŠ¡å™¨ç”¨æˆ·ååŠ åŸŸåï¼Œæ ¼å¼ç¤ºä¾‹ï¼šroot@example.com </span></span><br><span class="line"><span class="string">    :param cmd: è¦è®©è¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œçš„å‘½ä»¤ </span></span><br><span class="line"><span class="string">    :return: ä¸€äº›ç»“æœï¼Œå…¶ä¸­å¯èƒ½æœ‰ä¸€äº›æç¤ºæ€§æ–‡æœ¬</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># ä¸¾ä¸ªä¾‹å­ï¼Œssh root@example.com ls å¯ä»¥è®©è¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œ ls å‘½ä»¤</span></span><br><span class="line">    final_cmd = <span class="string">'/usr/bin/expect -c \'spawn ssh %s %s; expect "*Password:"; send "%s\\r"; interact;\''</span> % (host, cmd, password)</span><br><span class="line">    res = os.popen(final_cmd).read()</span><br><span class="line">    print(res)</span><br><span class="line">    <span class="keyword">return</span> res </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¼ ç»™è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ Python è„šæœ¬ä½œä¸ºå‚æ•° </span></span><br><span class="line">args = &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># args éœ€è¦ç»è¿‡å¤æ‚çš„æ›¿æ¢ï¼Œæ‰èƒ½ä¿è¯å‡†ç¡®ä¼ é€’åˆ°è¿œç¨‹æœåŠ¡å™¨çš„ Python è„šæœ¬ä¸­</span></span><br><span class="line">args = str(args) </span><br><span class="line">args = args.replace(<span class="string">'\''</span>, <span class="string">'\\\"'</span>)</span><br><span class="line">args = args.replace(<span class="string">' '</span>, <span class="string">'\\ '</span>) </span><br><span class="line">args = args.replace(<span class="string">','</span>, <span class="string">'\\,'</span>) </span><br><span class="line">args = args.replace(<span class="string">'['</span>, <span class="string">'\\['</span>) </span><br><span class="line">args = args.replace(<span class="string">']'</span>, <span class="string">'\\]'</span>) </span><br><span class="line">args = args.replace(<span class="string">'&#123;'</span>, <span class="string">'\\&#123;'</span>) </span><br><span class="line">args = args.replace(<span class="string">'&#125;'</span>, <span class="string">'\\&#125;'</span>) </span><br><span class="line">args = args.replace(<span class="string">';'</span>, <span class="string">'\\;'</span>) </span><br><span class="line">args = args.replace(<span class="string">'"'</span>, <span class="string">'\\"'</span>) </span><br><span class="line"></span><br><span class="line">cmd = <span class="string">'/usr/local/bin/python3 x.py \\"%s\\"'</span> % args </span><br><span class="line">call_remote_cmd(<span class="string">'root@example.com'</span>, <span class="string">'password'</span>, cmd)</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯æˆ‘å› å·¥ä½œéœ€è¦è€Œå†™å‡ºæ¥çš„è®©è¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œå®ƒçš„ Python è„šæœ¬çš„æœ¬åœ° Python è„šæœ¬ä»£ç ã€‚ä½¿ç”¨çš„æ—¶å€™å°±ç®€å•äº†ã€‚æœåŠ¡å™¨ä¸Šé¢æ”¾ä¸€ä¸ªè¢«è°ƒç”¨çš„ Python è„šæœ¬ã€‚ç„¶åæ‰§è¡Œä¸Šé¢ä»£ç ï¼Œå°±å¯ä»¥äº†ã€‚</p><p>æƒ³å¿…ç›´æ¥å†™ shell è„šæœ¬çš„è¯ï¼Œå¯èƒ½ä¼šæ›´ç®€æ´äº›ã€‚ç­‰å•¥æ—¶å€™æœ‰ç©ºäº†è¯•è¯•çœ‹ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Shell </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Homebrew å°ç»“</title>
      <link href="/2018/09/26/Homebrew%20%E5%B0%8F%E7%BB%93/"/>
      <url>/2018/09/26/Homebrew%20%E5%B0%8F%E7%BB%93/</url>
      <content type="html"><![CDATA[<p>è¯´å®è¯ï¼Œæˆ‘æ— æ³•é€‚åº”æš—è‰²èƒŒæ™¯çš„ç•Œé¢ï¼Œæ¯”å¦‚ jetbrains ç³»åˆ— IDE çš„ Darcula ä¸»é¢˜ (æš—è‰²çš„èƒŒæ™¯)ï¼Œå†æ¯”å¦‚ Terminal çš„ä¸€äº›æš—è‰²èƒŒæ™¯ä¸»é¢˜ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿæ— æ³•ç›´è§† <a href="https://brew.sh/" target="_blank" rel="noopener">Homebrew</a> ä¸»é¡µçš„èƒŒæ™¯è‰²ï¼Œçœ‹å¾—æˆ‘çœ¼ç›éš¾å—ã€‚ä½†æ˜¯ï¼ŒHomebrew åº”è¯¥æ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„å·¥å…·ï¼Œæ¯•ç«Ÿå®ƒå‡ ä¹å–ä»£äº† MacPortsã€‚</p><p>Homebrew æ˜¯ macOS ä¸Šçš„ä¸€æ¬¾åŒ…ç®¡ç†å·¥å…·ï¼Œä½œç”¨ç±»ä¼¼äº Ubuntu ä¸Šé¢çš„ apt-getã€‚ä¸åŒç‚¹æ˜¯ï¼ŒHomebrew çš„æ“ä½œä¸éœ€è¦ root æƒé™ï¼ŒHomebrew ä¸æ˜¯ç³»ç»Ÿçº§åˆ«çš„å·¥å…·ã€‚Homebrew ç»´æŠ¤ä¸€äº›ç§°ä¸º tap çš„ git repositoryï¼Œæ¯ä¸ª tap é‡Œé¢æ˜¯ä¸€äº› formulaï¼Œæ‰€è°“çš„ formula å°±æ˜¯å¯¹åº”ä¸€ä¸ªè½¯ä»¶åŒ…ï¼ˆæ¯”å›¾ wget å’Œ git å°±æ˜¯ä¸¤ä¸ª formulaï¼‰ã€‚æœ€é‡è¦çš„ tap æ˜¯ homebrew/coreï¼Œè¿™ä¸ª tap ä¹Ÿæ˜¯è‡ªå¸¦çš„ï¼Œå…¶ä¸­æ˜¯å„ç§å‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒåœ¨å®‰è£…äº† Homebrew çš„ç³»ç»Ÿä¸­ä¸€èˆ¬ä½äº /usr/local/Homebrew/Library/Taps/homebrew/homebrew-coreï¼Œè¿™å¯ä»¥é€šè¿‡ brew â€“repo homebrew/core å¾—çŸ¥ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">âœ  Downloads brew --repo homebrew/core</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/Homebrew/</span>Library<span class="regexp">/Taps/</span>homebrew/homebrew-core</span><br><span class="line">âœ  Downloads cd <span class="regexp">/usr/</span>local<span class="regexp">/Homebrew/</span>Library<span class="regexp">/Taps/</span>homebrew/homebrew-core</span><br><span class="line">âœ  homebrew-core <span class="string">git:</span>(master)</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢å¯çŸ¥ homebrew/core è¿™ä¸ª tap åœ¨æœ¬åœ°æ˜¯ä¸€ä¸ª git é¡¹ç›®ï¼Œå®é™…ä¸Šé‡Œé¢ç»´æŠ¤äº†å››åƒå¤šä¸ª formulaï¼Œä¹Ÿå°±æ˜¯å¯ä¾›ç”¨æˆ·å®‰è£… 4000 å¤šä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œæ¯ä¸ª formula éƒ½æ˜¯ç”¨ä¸€ä¸ª ruby æ–‡ä»¶æè¿°çš„ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ homebrew/science å’Œ homebrew/php ç­‰å®˜æ–¹ tapã€‚é™¤äº†å®˜æ–¹ tap å¤–ï¼Œè¿˜æœ‰è‘—åçš„ caskroom/cask è¿™ä¸ªç”¨æ¥å®‰è£… gui è½¯ä»¶(ä¾‹å¦‚ Sublime Text)çš„ tapã€‚æ’ä¸€å¥ï¼Œåœ¨ caskroom çš„ tap ä¸­ï¼Œä¸æ˜¯ç”¨ formula è¡¨ç¤ºè½¯ä»¶åŒ…ï¼Œè€Œæ˜¯ç”¨ cask æ¥è¡¨ç¤ºï¼Œæ‰€ä»¥å¤§è‡´å¯ä»¥è®¤ä¸º formula è¡¨ç¤ºå‘½ä»¤è¡Œçš„åŒ…ï¼Œè€Œ cask è¡¨ç¤º gui è½¯ä»¶ã€‚å¯¹ç”¨æˆ·æ¥è¯´ï¼ŒHomebrwe å¯ä»¥åšçš„äº‹å°±æ˜¯æœç´¢ã€å®‰è£…ã€å‡çº§ã€æŸ¥çœ‹ã€å¸è½½å„ç§è½¯ä»¶åŒ…ï¼Œæ­¤å¤–ä¹Ÿå¯ä»¥ç®¡ç†å¢åˆ  tapã€‚</p><p>é™¤äº† homebrew/core å¤–ï¼Œæˆ‘åªæ·»åŠ äº† caskroom/cask è¿™ä¸€ä¸ª tapã€‚è¦æ·»åŠ æ­¤ tap æˆ–ç§»é™¤å®ƒï¼Œåªéœ€è¦æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ  </span></span><br><span class="line">brew tap caskroom/cask </span><br><span class="line"></span><br><span class="line"><span class="comment"># ç§»é™¤ </span></span><br><span class="line">brew untap caskroom/cask</span><br></pre></td></tr></table></figure><p>å½“é•¿æ—¶é—´æ²¡æœ‰æ›´æ–°è¿‡ tap å¯¹åº”çš„æœ¬åœ° git é¡¹ç›®ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡æ›´æ–°æ—¶ï¼Œå› ä¸ºå›½å†…çš„ç½‘ç»œç¯å¢ƒï¼Œæ›´æ–°æ‰€éœ€è¦çš„æ—¶é—´å¯èƒ½è¦å¾ˆä¹…ï¼Œæ‰€ä»¥æˆ‘ä½¿ç”¨äº† USTC Mirror çš„ <a href="http://mirrors.ustc.edu.cn/help/brew.git.html" target="_blank" rel="noopener">Homebrew ä»£ç†</a>ã€‚å…·ä½“æ–¹æ³•å…¶å®å°±æ˜¯ï¼ŒæŠŠ homebrew/core å’Œ caskroom/cask è¿™ä¸¤ä¸ª tap å¯¹åº”çš„æœ¬åœ° git é¡¹ç›®çš„ remote url åˆ†åˆ«è®¾ç½®ä¸º <a href="https://mirrors.ustc.edu.cn/homebrew-core.git" target="_blank" rel="noopener">https://mirrors.ustc.edu.cn/homebrew-core.git</a> å’Œ <a href="https://mirrors.ustc.edu.cn/homebrew-cask.gitï¼Œè¿™æ ·æ›´æ–°å°±å¾ˆå¿«äº†ã€‚å¦å¤–ï¼Œbrew" target="_blank" rel="noopener">https://mirrors.ustc.edu.cn/homebrew-cask.gitï¼Œè¿™æ ·æ›´æ–°å°±å¾ˆå¿«äº†ã€‚å¦å¤–ï¼Œbrew</a> ä¸‹è½½è½¯ä»¶æ˜¯ä»ä¸€ä¸ªæ‰€è°“çš„ bootle å»ä¸‹è½½ (è¿™ä¸ª bootle çš„ URL æ˜¯ <a href="https://homebrew.bintray.com/ï¼Œå…¶å®å°±æ˜¯é‡Œé¢æ‰˜ç®¡äº†éå¸¸å¤šå¸¸è§çš„è½¯ä»¶çš„å‹ç¼©åŒ…" target="_blank" rel="noopener">https://homebrew.bintray.com/ï¼Œå…¶å®å°±æ˜¯é‡Œé¢æ‰˜ç®¡äº†éå¸¸å¤šå¸¸è§çš„è½¯ä»¶çš„å‹ç¼©åŒ…</a>) æˆ–è€…ä»è½¯ä»¶çš„å®˜ç½‘å»ä¸‹è½½ã€‚å…·ä½“åœ¨å“ªé‡Œä¸‹è½½ï¼Œåˆ™æ˜¯æ ¹æ® formula çš„ ruby æè¿°æ–‡ä»¶ä¸­çš„æè¿°æ¥å®šçš„ã€‚</p><p>é‚£æœ‰æ²¡æœ‰ä¸Šé¢è¯´çš„è¿™ä¸ª bottle çš„é•œåƒä»¥ä¾¿å¯ä»¥å¿«é€Ÿä¸‹æ¥è½¯ä»¶å‘¢ï¼Ÿå½“ç„¶æœ‰ï¼ŒåŒæ ·æ˜¯æ¥è‡ªäº USTC Mirror çš„ï¼Œåšæ³•å¾ˆç®€å•ï¼Œè®¾ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡ HOMEBREW_BOTTLE_DOMAINï¼Œå…¶å€¼ä¸º <a href="https://mirrors.ustc.edu.cn/homebrew-bottles" target="_blank" rel="noopener">https://mirrors.ustc.edu.cn/homebrew-bottles</a> å³å¯ã€‚</p><p>ä¸‹é¢æ˜¯è¿™ä¸€é€šä¿®æ”¹å¯¹åº”çš„å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡åˆ° homebrew/core å¯¹åº”çš„ git é¡¹ç›®ç›®å½• </span></span><br><span class="line"><span class="built_in">cd</span> $(brew --repo homebrew/core) </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¢ url </span></span><br><span class="line">git remote <span class="built_in">set</span>-url origin https://mirrors.ustc.edu.cn/homebrew-core.git </span><br><span class="line"></span><br><span class="line"><span class="comment"># same as previous </span></span><br><span class="line"><span class="built_in">cd</span> $(brew --repo caskroom/cask) </span><br><span class="line"></span><br><span class="line"><span class="comment"># same as previous </span></span><br><span class="line">git remote <span class="built_in">set</span>-url origin https://mirrors.ustc.edu.cn/homebrew-cask.git </span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ‘æ˜¯ä½¿ç”¨ zshï¼Œæ‰€ä»¥è¿½åŠ åˆ° .zshrc æœ«å°¾å°±å¯ä»¥ï¼Œå¦‚æœæ˜¯ä½¿ç”¨ bashï¼Œåˆ™ä¸èƒ½è¿™æ · </span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles'</span> &gt;&gt; ~/.zshrc</span><br><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å¼€å§‹æ˜¯ brew çš„ä¸€äº›å¸¸ç”¨å‘½ä»¤å°ç»“ã€‚</p><p><strong>brew search \&lt;formulaName>:</strong></p><p>åœ¨å·²å®‰è£… tap ä¸­æŸ¥æ‰¾åŒ…ï¼Œæœç´¢åˆ°çš„ç»“æœç±»ä¼¼å¦‚æœä¸æ˜¯ homebrew/core è¿™ä¸ª tap ä¸­çš„ï¼Œå°†ä¼šä»¥ tapName/formulaName çš„å½¢å¼åˆ—å‡ºã€‚ä¾‹å¦‚ brew search git çš„ç»“æœå¤§è‡´æ˜¯:</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bagit</span></span><br><span class="line"><span class="keyword">bash-git-prompt</span></span><br><span class="line"><span class="keyword">...</span></span><br><span class="line"><span class="keyword">git</span></span><br><span class="line"><span class="keyword">...</span></span><br><span class="line"><span class="keyword">caskroom/cask/git-it</span></span><br></pre></td></tr></table></figure><p><strong>brew install \&lt;formuaName>:</strong></p><p>å®‰è£…æŒ‡å®š formula çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå®‰è£…è·¯å¾„ä¸€èˆ¬æ˜¯ /usr/local/Cellar/<formulaname>/<versionnumber> ä¸­ï¼Œæ­¤å¤–ä¼šåœ¨ /usr/local/bin ä¸­å»ºç«‹æŒ‡å‘å¯æ‰§è¡Œæ–‡ä»¶çš„ç¬¦å·é“¾æ¥ï¼Œä»¥ä¾¿å‘½ä»¤è¡Œç›´æ¥è¿è¡Œã€‚</versionnumber></formulaname></p><p><strong>brew uninstall formulaName:</strong></p><p> å¸è½½æŒ‡å®š formulaï¼Œä¸è¿‡ä¸ä¼šåˆ é™¤å®‰è£…åŒ…æ–‡ä»¶ã€‚</p><p><strong> brew upgrade formulaName:</strong></p><p>å‡çº§æŒ‡å®šçš„ formula åˆ°æœ€æ–°ç‰ˆã€‚</p><p><strong>brew cleanup:</strong></p><p>åœ¨å®‰è£…äº†æ›´æ–°ç‰ˆæœ¬è½¯ä»¶åŒ…åï¼Œä» /usr/local/Cellar åˆ é™¤æ—§ç‰ˆæœ¬çš„è½¯ä»¶åŒ…ã€‚æ²¡é”™ï¼Œå‡çº§æ—¶å¹¶ä¸æ˜¯è¦†ç›–å¼å®‰è£…ï¼Œè€Œæ˜¯åœ¨ /usr/local/Cellar/<formulaname> ä¸­å¤šäº†ä¸€ä¸ªæ›´é«˜ç‰ˆæœ¬å·çš„ç›®å½•ï¼Œç„¶åç¬¦å·é“¾æ¥æŒ‡å‘æ›´é«˜ç‰ˆæœ¬ç›®å½•ä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚æ‰€ä»¥ï¼Œå¦‚æœä¸æƒ³è¦è¿™ç§å†—ä½™ï¼Œå°±å¯ä»¥ç”¨ brew cleanup æ¥æ¸…é™¤æ—§ç‰ˆæœ¬çš„ç›®å½•ã€‚</formulaname></p><p><strong>brew outdated:</strong></p><p>æŸ¥çœ‹å“ªäº› formula å¯ä»¥å‡çº§ã€‚</p><p><strong>brew info formulaName:</strong></p><p>æŸ¥çœ‹ formula çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ brew info git, brew info caskroom/cask/git-it ç­‰ã€‚</p><p><strong>brew update:</strong></p><p>æ›´æ–°æ‰€æœ‰ tap ä¸­çš„åŒ…ä¿¡æ¯ï¼Œå…¶å®ä¹Ÿå°±æ˜¯æŠŠæ¯ä¸ª tap å¯¹åº”çš„æœ¬åœ° git é¡¹ç›®æ›´æ–°åˆ°æœåŠ¡å™¨æœ€æ–°æäº¤ï¼Œä»¥ä¾¿å¯ä»¥æœç´¢åˆ°æœ€æ–°æ·»åŠ çš„åŒ…ä»¥åŠå·²æœ‰åŒ…çš„æœ€æ–°å‘å¸ƒä¿¡æ¯ã€‚</p><p><strong>brew list:</strong></p><p>åˆ—å‡ºå·²å®‰è£…çš„æ‰€æœ‰åŒ…ã€‚</p><h3 id="tap-çš„ç®¡ç†ï¼š"><a href="#tap-çš„ç®¡ç†ï¼š" class="headerlink" title="tap çš„ç®¡ç†ï¼š"></a>tap çš„ç®¡ç†ï¼š</h3><p><strong>brew tap tapName:</strong></p><p>æ–°å¢ä¸€ä¸ª tapã€‚</p><p><strong>brew untap tapName:</strong></p><p>ç§»é™¤ä¸€ä¸ª tapã€‚</p><p><strong>brew tap-info tapName:</strong></p><p>åˆ—å‡ºä¸€ä¸ª tap çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><p>æ›´å¤šæ“ä½œï¼Œå¯ä»¥å‚è€ƒ<a href="https://github.com/Homebrew/brew/blob/master/docs/Manpage.md" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ï¼Œå†…å®¹å¾ˆå…¨é¢ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Homebrew </tag>
            
            <tag> macOS </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>HomeBrew Cask åŠ å¿«ä¸‹è½½çš„è„šæœ¬</title>
      <link href="/2018/09/26/HomeBrew%20Cask%20%E5%8A%A0%E5%BF%AB%E4%B8%8B%E8%BD%BD%E7%9A%84%E8%84%9A%E6%9C%AC/"/>
      <url>/2018/09/26/HomeBrew%20Cask%20%E5%8A%A0%E5%BF%AB%E4%B8%8B%E8%BD%BD%E7%9A%84%E8%84%9A%E6%9C%AC/</url>
      <content type="html"><![CDATA[<p>Homebrew æ˜¯ä¸ªå¥½å·¥å…·ï¼Œé™¤äº†ç”¨å®ƒå®‰è£…å‘½ä»¤è¡Œè½¯ä»¶å¤–ï¼Œæˆ‘ä¹Ÿä¼šç”¨å®ƒæ¥å®‰è£… GUI è½¯ä»¶ã€‚è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯ Homebrew ä¼šç›´æ¥å¸®æˆ‘æ¥è¿é“¾æ¥åˆ° GUI è½¯ä»¶çš„å¯æ‰§è¡Œæ–‡ä»¶çš„ç¬¦å·é“¾æ¥ï¼Œè¿™æ ·ï¼Œæˆ‘åœ¨ç»ˆç«¯ä½¿ç”¨ç¬¦å·é“¾æ¥ï¼Œå°±å¯ä»¥æ‰“ GUI è½¯ä»¶äº†ã€‚ä¾‹å¦‚ï¼ŒSublime Text çš„ç¬¦å·é“¾æ¥æ˜¯ sublï¼Œé‚£ä¹ˆåœ¨ç»ˆç«¯ä»»ä½•ç›®å½•ä¸­ï¼Œä¸€è¡Œ subl â€œnew text.txtâ€ å°±å¯ä»¥ç”¨ Sublime Text æ‰“å¼€new text.txtäº†ã€‚</p><p>é—®é¢˜æ˜¯ï¼Œbrew cask install xxx çš„ä¸‹è½½é€Ÿåº¦ç»å¸¸ä¼šéå¸¸æ…¢ï¼Œè€Œæˆ‘æŠŠä¸‹è½½è½¯ä»¶åŒ…çš„ URL ç›´æ¥å¤åˆ¶åˆ° Chrome ä¸­å»ä¸‹è½½ï¼Œåˆ™éå¸¸å¿«ï¼Œè¿™å°±å¾ˆå°´å°¬äº†ã€‚ç»è¿‡ç¨å¾®æ£€æŸ¥ï¼Œæˆ‘å‘ç°brew cask install xxx è¿‡ç¨‹ä¸­ï¼Œä¼šåœ¨ Cache/Cask ç›®å½•(å…¶å®å°±æ˜¯ brew â€“cacheå‘½ä»¤çš„ç»“æœ)ä¸­ç”Ÿæˆä¸€ä¸ªç±»ä¼¼äºxxxâ€“v1.2.3.zip.incompleteè¿™æ ·çš„æ–‡ä»¶ã€‚äºæ˜¯æˆ‘æŠŠè‡ªå·±ç”¨ Chrome ä¸‹è½½çš„æ–‡ä»¶ï¼Œå¤åˆ¶åˆ° Cache/Cask ä¸­æ¥ï¼Œç„¶åæ›´åä¸º xxxâ€“v1.2.3.zipï¼Œä¹Ÿå°±æ˜¯æŠŠ .incomplete å»æ‰ã€‚ç„¶åå† brew cask install xxxä¸€ä¸‹ï¼Œå‘ç° Homebrew æç¤ºè½¯ä»¶åŒ…å·²ç»ä¸‹è½½å¥½äº†ï¼Œäºæ˜¯ç«‹åˆ»å¼€å§‹å®‰è£…äº†ã€‚</p><p>ä¸Šé¢è¿™æ ·çš„æ–¹å¼ç¡®å®é¿å…äº†ä¸‹è½½æ…¢çš„é—®é¢˜ï¼Œä¸è¿‡è¿™æ ·æ‰‹åŠ¨æ“ä½œï¼Œæ€»æ˜¯ä¸é‚£ä¹ˆé«˜(yÇ’u)æ•ˆ(bÄ«)ç‡(gÃ©)ï¼Œæ‰€ä»¥æˆ‘å°±æƒ³è¦å†™ä¸ªå°è„šæœ¬æ¥è‡ªåŠ¨åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚æˆ‘é€‰æ‹©äº†ä½¿ç”¨ shell è„šæœ¬ã€‚æ­¤å¤„è¦åæ§½ä¸€ä¸‹ shell è„šæœ¬çš„è¯­æ³•ï¼Œéš¾è®°ï¼ŒçœŸçš„æ˜¯å¾ˆéš¾è®°(æ¯”å¦‚å­—ç¬¦ä¸²æ“ä½œ)ï¼æ¯”èµ·æ¥ï¼Œå‡ ä¹ä»»ä½•ä¸€é—¨ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•éƒ½è¦å¥½è®°å¾—å¤šã€‚</p><p>åºŸè¯è¯´äº†å¾ˆå¤šäº†ï¼Œä¸‹é¢æ˜¯è„šæœ¬å†…å®¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$#</span>"</span> -eq <span class="string">"1"</span> ]; <span class="keyword">then</span> </span><br><span class="line">    <span class="comment"># æ‰¾åˆ°æœ¬åœ°æè¿°éœ€è¦å®‰è£…çš„è½¯ä»¶åŒ…çš„ ruby æ–‡ä»¶ </span></span><br><span class="line">    tap_path=`brew --repo caskroom/cask` </span><br><span class="line">    file_path=<span class="string">"<span class="variable">$&#123;tap_path&#125;</span>/Casks/<span class="variable">$&#123;1&#125;</span>.rb"</span> </span><br><span class="line">    <span class="keyword">if</span> [ -f <span class="string">"<span class="variable">$file_path</span>"</span> ]; <span class="keyword">then</span> </span><br><span class="line">        <span class="comment"># ä»é‡Œé¢è¯»å–ç‰ˆæœ¬ä¿¡æ¯ï¼Œä¸‹è½½çš„ URL </span></span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">read</span> key value; <span class="keyword">do</span> </span><br><span class="line">            <span class="keyword">if</span> [[ <span class="variable">$key</span> == <span class="string">"version"</span> ]]; <span class="keyword">then</span> </span><br><span class="line">                len=$((<span class="variable">$&#123;#value&#125;</span>-2)) </span><br><span class="line">                version=<span class="variable">$&#123;value:1:$&#123;len&#125;</span>&#125; </span><br><span class="line">            <span class="keyword">elif</span> [[ <span class="variable">$key</span> == <span class="string">"url"</span> ]]; <span class="keyword">then</span> </span><br><span class="line">                len=$((<span class="variable">$&#123;#value&#125;</span>-2)) </span><br><span class="line">                url=<span class="variable">$&#123;value:1:$&#123;len&#125;</span>&#125; </span><br><span class="line">                url=<span class="variable">$&#123;url/\#\&#123;version\&#125;</span>/<span class="variable">$version</span>&#125; </span><br><span class="line">                <span class="comment"># ä½¿ç”¨ Chrome æ¥ä¸‹è½½ </span></span><br><span class="line">                /Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome <span class="variable">$url</span> </span><br><span class="line">            <span class="keyword">fi</span> </span><br><span class="line">        <span class="keyword">done</span> &lt; <span class="variable">$file_path</span> </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Cask '<span class="variable">$1</span>' is unavailable: No Cask with this name exists."</span> </span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    cache_dir=`brew --cache`</span><br><span class="line">    downloaded_name=<span class="variable">$&#123;url##*/&#125;</span></span><br><span class="line">    target_name=<span class="variable">$1</span>--<span class="variable">$&#123;version&#125;</span>.<span class="variable">$&#123;downloaded_name##*.&#125;</span> </span><br><span class="line">    <span class="comment"># æ¯ä¸ªä¸‰ç§’é’Ÿæ£€æŸ¥ä¸€ä¸‹ä¸‹è½½å¥½äº†æ²¡ï¼Œå¥½äº†å°±æŠŠä¸‹è½½å¥½çš„æ–‡ä»¶ç§»åŠ¨åˆ° </span></span><br><span class="line">    <span class="comment"># Cache/Cask ä¸­ï¼Œå¹¶ä¸”æ”¹åä¸º Homebrew æƒ³è¦çš„æ–¹å¼ã€‚ </span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span> </span><br><span class="line">        <span class="keyword">if</span> [ -e ~/Downloads/<span class="variable">$downloaded_name</span> ]; <span class="keyword">then</span> </span><br><span class="line">            mv ~/Downloads/<span class="variable">$downloaded_name</span> <span class="variable">$cache_dir</span>/Cask/<span class="variable">$target_name</span> </span><br><span class="line">            <span class="comment"># å®‰è£… </span></span><br><span class="line">            brew cask install <span class="variable">$1</span> </span><br><span class="line">            <span class="built_in">break</span> </span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            sleep 3 </span><br><span class="line">        <span class="keyword">fi</span> </span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"usage: cask-install Cask-Name"</span> </span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Homebrew </tag>
            
            <tag> macOS </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Android Touch äº‹ä»¶çš„ä¼ é€’ä¸å¤„ç†</title>
      <link href="/2018/09/26/Android%20Touch%20%E4%BA%8B%E4%BB%B6%E7%9A%84%E4%BC%A0%E9%80%92%E4%B8%8E%E5%A4%84%E7%90%86/"/>
      <url>/2018/09/26/Android%20Touch%20%E4%BA%8B%E4%BB%B6%E7%9A%84%E4%BC%A0%E9%80%92%E4%B8%8E%E5%A4%84%E7%90%86/</url>
      <content type="html"><![CDATA[<p>ä¸€ã€MotionEvent</p><p>MotionEvent æ˜¯ Android ç³»ç»Ÿä¸­æŠ¥å‘ŠåŠ¨ä½œè¾“å…¥ï¼ˆå¦‚è§¦æ‘¸å±å¹•ï¼Œæ»šåŠ¨çƒï¼Œé¼ æ ‡ï¼‰ç­‰äº‹ä»¶çš„ç±»ã€‚å…¶ä¸­æœ‰æ•´å½¢æ•°çš„ Action å’Œæè¿°äº‹ä»¶çš„å„ç§æµ®ç‚¹å‹åæ ‡ã€‚MotionEvent çš„ action çš„æœ€ä½ä¸€ä¸ªå­—èŠ‚ï¼Œå…¶å–å€¼æˆ‘ä»¬å¸¸è§çš„ ACTION_DOWN, MOVE, POINTER_DOWN, POINTER_UP, UP, CANCEL (åé¢å¯èƒ½ç®€ç§°ä¸º DOWN ç­‰ç­‰) è¿™äº›äº†ã€‚è™½ç„¶æˆ‘ä»¬å¯èƒ½ä¼šç²—æš´çš„ä½¿ç”¨ä¸‹é¢è¿™æ ·çš„æ–¹å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (event.getAction()) &#123;</span><br><span class="line">    <span class="keyword">case</span> MotionEvent.ActionDown:</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    ... </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å…¶å®ä¸Šé¢è¿™æ ·ä»…é€‚ç”¨äºå•ç‚¹è§¦æ§åœºæ™¯ï¼ŒåŸå› æ˜¯ getAction() æ–¹æ³•è¿”å›çš„ç»“æœä¸­ï¼Œæœ€ä½çš„1ä¸ªå­—èŠ‚æ‰å¯¹åº”ä¸Šé¢è¯´çš„ ACTION_DOWNï¼Œè€Œæ¬¡æœ€ä½ä¸€ä¸ªå­—èŠ‚åˆ™è¡¨ç¤º PointerIndex (è¿™ä¸ªæ¦‚å¿µåé¢ä¼šæåˆ°)ï¼Œå¯¹äºå•ç‚¹è§¦æ§åœºæ™¯ï¼ŒPointerIndex å§‹ç»ˆä¸º0ï¼Œæ‰€ä»¥ä¸Šé¢çš„ä»£ç æ‰èƒ½è·‘é€šã€‚æ›´å¥½çš„æ–¹å¼ï¼Œå…¶å®æ˜¯ä½¿ç”¨ getActionMasked() æ–¹æ³•ï¼Œæ­¤å¤„æŸ¥çœ‹æºç å³å¯éå¸¸æ¸…æ™°ã€‚</p><p>å¯¹äºä¸€ä¸²è§¦æ‘¸äº‹ä»¶ï¼ˆæŒ‡æ‰‹æ¥è§¦åˆ°å±å¹•åˆ°æ‰‹å®Œå…¨ç¦»å¼€å±å¹•ï¼‰ï¼Œç”¨æˆ·ç¬¬ä¸€ä¸ªæ‰‹æŒ‡æ¥è§¦åˆ°å±å¹•æ—¶ï¼Œè§¦å‘ DOWN, æ‰‹æŒ‡åœ¨å±å¹•ä¸Šç§»åŠ¨æ—¶ï¼ŒæŒç»­è§¦å‘å‡ºå¾ˆå¤š MOVEï¼Œç¬¬äºŒä¸ªä»¥ä¸Šçš„æ‰‹æŒ‡è§¦æ‘¸åˆ°å±å¹•æ˜¯ï¼Œè§¦å‘ POINTER_DOWNï¼Œéæœ€åä¸€ä¸ªç¦»å¼€å±å¹•çš„æ‰‹æŒ‡ç¦»å¼€å±å¹•æ—¶è§¦å‘ POINTER_UP, æœ€åä¸€ä¸ªæ‰‹æŒ‡ç¦»å¼€å±å¹•æ—¶ï¼Œè§¦å‘ UPã€‚</p><p>åœ¨ä¸€ä¸²è§¦æ‘¸äº‹ä»¶è¿‡ç¨‹ä¸­ï¼Œè§†å›¾ä» window detach çš„è¯ï¼Œæˆ–è€… View çš„ PFLAG_CANCEL_NEXT_UP_EVENT æ ‡è®°ä½è®¾ç½®äº†æ—¶ï¼Œæˆ–è€… View æœ¬æ¥å¤„ç†äº†ä¸€ä¸ª Down äº‹ä»¶ä½†æ˜¯æ¥ä¸‹æ¥çš„ MOVE ç­‰äº‹ä»¶è¢« ViewGroup æ‹¦æˆªäº†ï¼Œå°†ä¼šè§¦å‘ CANCELã€‚å½“ç„¶ï¼Œåº”è¯¥è¿˜æœ‰åˆ«çš„è§¦å‘ CANCEL äº‹ä»¶çš„åœºæ™¯ã€‚ä¸‹å›¾æ˜¯ä¸€ä¸² Touch äº‹ä»¶çš„ä¾‹å­ï¼š</p><pre><code>Down â†’ Move â†’...â†’ Move â†’ PointerDown â†’ Move â†’...â†’ PointerUp â†’ Move â†’...â†’ Move â†’ Up</code></pre><p>MotionEvent ä¸­æœ‰ä¸ª Pointer çš„æ¦‚å¿µï¼ŒPointer å¤§è‡´è¡¨ç¤ºè§¦æ‘¸åˆ°å±å¹•çš„å„ä¸ªæ‰‹æŒ‡ã€‚getPointerCount() å³ä¸ºå¤šç‚¹è§¦æ§çš„ç‚¹æ•°ã€‚æ¯ä¸ª pointer éƒ½æœ‰ä¸€ä¸ª index (å–å€¼æ˜¯0åˆ°getPointerCount()-1)å’Œ idï¼ˆæœ€å¤§æ˜¯31ï¼Œæ„å‘³ç€ä¸€ä¸²è§¦æ‘¸äº‹ä»¶ä¸­ï¼Œæœ€å¤šå…è®¸æ‰‹æŒ‡æ¥è§¦å±å¹•32æ¬¡ï¼‰ï¼Œå‰è€…åœ¨ä¸€ä¸² Touch äº‹ä»¶ä¸­å¯èƒ½ä¼šå˜åŒ–ï¼Œè€Œåè€…ä¿æŒä¸å˜ï¼Œä¾‹å¦‚å¤šç‚¹è§¦æ§æ—¶ï¼Œå¤§æ‹‡æŒ‡å¯¹åº”çš„ index æœ¬æ¥æ˜¯0ï¼Œåé¢å¯èƒ½å˜æˆäº†1äº†. getPointerId(int pointerIndex)å’ŒfindPointerIndex(int pointerId)è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯ index å’Œ id é—´çš„ä¸€ä¸€æ˜ å°„ã€‚ é‚£ä¸ºä»€ä¹ˆè¦æœ‰ index å’Œ id ä¸¤ä¸ªä¸œè¥¿å‘¢ï¼Ÿ</p><p>index å’Œ id çš„åŒºåˆ«ã€‚ä¸¾ä¸ªä¾‹å­å°±æ¸…æ¥šäº†ã€‚å‡è®¾èµ·å§‹æ—¶ï¼Œå³æ‰‹çš„é£ŸæŒ‡ï¼Œä¸­æŒ‡ï¼Œæ— åæŒ‡ä¾æ¬¡å…ˆåè½åœ¨å±å¹•ä¸Šï¼Œé‚£ä¹ˆä¸‰ä¸ªæŒ‡å¤´çš„ index å’Œ id åˆ†åˆ«éƒ½æ˜¯ 0, 1, 2ã€‚æ­¤æ—¶æŠ¬èµ·ä¸­æŒ‡ï¼Œé‚£ä¹ˆé£ŸæŒ‡çš„ index å’Œ id ä¸å˜ï¼Œè€Œæ— åæŒ‡çš„ index å˜æˆ1ï¼Œid ä¾ç„¶æ˜¯2ã€‚å³ index æ€»æ˜¯ 0, 1, 2,â€¦, getPointerCount() - 1. è€Œ id åˆ™å¯èƒ½å¤§äº getPointerCount(), å¦ä¸€é¢åˆ™æ˜¯ï¼Œpointer çš„ id åœ¨æ•´ä¸ªä¸€ä¸²è§¦æ‘¸äº‹ä»¶ä¸­ä¿æŒä¸å˜ã€‚</p><p>MotionEvent çš„ getX() ä¸ getX(int pointerIndex), å‰è€…ç­‰ä»·äºåè€…çš„ getX(0), getY ç±»ä¼¼. getPointerIdBits() è¿”å›ä¸€ä¸ªç±»ä¼¼äºæ ‡å¿—æ•°çš„ä¸œè¥¿ï¼Œå…¶äºŒè¿›åˆ¶ä»å³å‘å·¦æ•°ï¼Œç¬¬ i ä½ä¸º1è¡¨ç¤ºå­˜åœ¨ id æ˜¯ i çš„ pointerï¼Œæ­¤å¤„åº”çœ‹æºç ã€‚å¯ä»¥æƒ³è§æ­¤ç»“æœçš„äºŒè¿›åˆ¶å½¢å¼ä¸­1çš„ä¸ªæ•°å³ä¸ºå¤šç‚¹è§¦æ§çš„ç‚¹æ•°ã€‚</p><p><img src="http://tao93.top/images/2018/09/01/1535807958.png" alt="pointer_id_bits"></p><p>äºŒã€Touch äº‹ä»¶çš„ç”Ÿæˆ</p><p>Touch äº‹ä»¶çš„æ ¹æºæ˜¯ä»ç¡¬ä»¶è€Œæ¥ï¼Œè€Œ ViewRootImpl$ViewPostImeInputStage#processPointerEvent æ–¹æ³•æ˜¯ä¸€ä¸ªæ¯”è¾ƒåˆé€‚çš„å¼€å§‹è¿½è¸ª Touch äº‹ä»¶çš„èµ·ç‚¹ï¼Œæ­¤å¤„åº”çœ‹æºç ã€‚äº‹ä»¶å¦‚æœæ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œæœ€ç»ˆå¯èƒ½å°†åœ¨ ViewRootImpl #finishInputEvent ä¸­å›æ”¶æ‰(è¿™ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹)ã€‚Touch äº‹ä»¶çš„ä¼ é€’å †æ ˆ (æŒ‰è°ƒç”¨çš„é¡ºåºæ’åˆ—)ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">ViewRootImpl$</span><span class="bash">ViewPostImeInputStage<span class="comment">#processPointerEvent</span></span></span><br><span class="line"><span class="meta">View#</span><span class="bash">dispatchPointerEvent</span></span><br><span class="line"><span class="meta">DecorView#</span><span class="bash">dispatchTouchEvent</span></span><br><span class="line"><span class="meta">Activity#</span><span class="bash">dispatchTouchEvent</span></span><br><span class="line"><span class="meta">PhoneWindow#</span><span class="bash">superDispatchTouchEvent</span></span><br><span class="line"><span class="meta">DecorView#</span><span class="bash">superDispatchTouchEvent</span></span><br><span class="line"><span class="meta">ViewGroup#</span><span class="bash">dispatchTouchEvent</span></span><br></pre></td></tr></table></figure><p>Touch äº‹ä»¶ä¼ é€’åˆ°äº† ViewGroup çš„ dispatchTouchEvent æ–¹æ³•åï¼Œå°±å¼€å§‹æ˜¯æœ¬æ–‡è¦å…³æ³¨çš„ç„¦ç‚¹äº†ï¼Œå³ä¸€ä¸² Touch äº‹ä»¶åœ¨ View æ ‘ä¸Šæ˜¯å¦‚ä½•ä¼ é€’å’Œæ¶ˆè´¹çš„ã€‚</p><p>ä¸‰ã€ä¼ é€’å’Œå¤„ç† Touch äº‹ä»¶</p><p>ä¸‹é¢æ˜¯äº‹ä»¶ä¼ é€’å’Œå¤„ç†ä¸­æœ€é‡è¦çš„ 4 ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">View#</span><span class="bash">dispatchTouchEventï¼Œé ViewGroup çš„ View æ¥å— Touch äº‹ä»¶çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸é‡è½½å®ƒã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="meta">View#</span><span class="bash">onTouchEventï¼ŒView(å« ViewGroup)è‡ªå·±å°è¯•å»æ¶ˆè´¹ Touch äº‹ä»¶ï¼Œç»å¸¸ä¼šè¢«é‡è½½ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="meta">ViewGroup#</span><span class="bash">dispatchTouchEventï¼Œé‡è½½äº† View çš„åŒåæ–¹æ³•ï¼Œä½œä¸º ViewGroup æ¥å— Touch äº‹ä»¶ï¼Œæ­¤æ–¹æ³•ä¸­åŒ…å«ã€Œä¼ é€’ Touch äº‹ä»¶ç»™ childã€å’Œã€Œå°è¯•è‡ªå·±æ¶ˆè´¹ Touch äº‹ä»¶ã€è¿™æ ·ä¸¤ä¸ªåˆ†æ”¯é€»è¾‘ï¼Œä¸€èˆ¬ä¸é‡è½½å®ƒã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="meta">ViewGroup#</span><span class="bash">onInterceptTouchEventï¼ŒViewGroup åˆ¤æ–­è‡ªå·±è¦ä¸è¦æ‹¦æˆª Touch äº‹ä»¶çš„æ–¹æ³•ï¼Œæ‹¦æˆªæ„å‘³ç€è‡ªå·±å°è¯•æ¶ˆè´¹æ­¤äº‹ä»¶ï¼Œæœ‰æ—¶å€™è¢«é‡è½½ã€‚</span></span><br></pre></td></tr></table></figure><p><strong>ä¼ é€’:</strong></p><p>åœ¨ View æ ‘ä¸­ï¼ŒTouch äº‹ä»¶æ˜¯ç”± parent view ä¼ é€’ç»™ child View (child view ä¹Ÿå¯èƒ½æ˜¯ ViewGroup)çš„ã€‚åœ¨ä¸€ä¸² touch äº‹ä»¶ä¸­æ‰“å¤´çš„æ€»æ˜¯ DOWN äº‹ä»¶ï¼Œparent view é€šè¿‡è°ƒç”¨ child view çš„ dispatchTouchEventæ–¹æ³•æŠŠ DOWN äº‹ä»¶ä¼ é€’ç»™ child viewï¼Œè¿™å°±ç»™äº† child ä¸€ä¸ªæ¶ˆè´¹æ­¤äº‹ä»¶çš„æœºä¼šã€‚child çš„ dispatchTouchEvent æ–¹æ³•è¿”å› true çš„è¯ï¼Œå°±è¡¨ç¤º child æ¶ˆè´¹äº† DOWN äº‹ä»¶ï¼Œè¿”å› false å°±è¡¨ç¤ºä¸æ¶ˆè´¹ã€‚å¦‚æœ child æ¶ˆè´¹äº† Down äº‹ä»¶ï¼Œé‚£ä¹ˆæœ€ç®€å•çš„æƒ…å†µå°±æ˜¯åç»­çš„ move ç­‰äº‹ä»¶éƒ½ä¼šé€šè¿‡è°ƒç”¨ child çš„ dispatchTouchEvent æ–¹æ³•ç›´æ¥äº¤ç»™æ­¤ childï¼Œä¸ç®¡å®ƒçš„ dispatchTouchEvent æ–¹æ³•è¿”å›ä»€ä¹ˆï¼›å¦‚æœ child æ²¡æœ‰æ¶ˆè´¹ DOWN äº‹ä»¶ï¼Œé‚£ä¹ˆå•ç‚¹è§¦æ§æƒ…å½¢ä¸‹ï¼Œåç»­çš„ move ç­‰äº‹ä»¶ä¸æ­¤ child å†ä¹Ÿæ— ç¼˜äº†ã€‚</p><p><strong>æ¶ˆè´¹ï¼š</strong></p><p>View(åŒ…æ‹¬ ViewGroup) æ¶ˆè´¹ Touch äº‹ä»¶ï¼Œåœ¨ä»£ç ä¸Šç­‰ä»·äºè°ƒç”¨å½“å‰ç±»çš„ onTouchEvent æ–¹æ³•ã€‚ç„¶å ouTouchEvent çš„è¿”å›ç»“æœä½œä¸ºæ˜¯å¦æ¶ˆè´¹äº†æ­¤äº‹ä»¶çš„ä¾æ®ã€‚</p><p><strong>æ‹¦æˆªï¼š</strong></p><p>æ‹¦æˆªæ˜¯æŒ‡ ViewGroup æœ‰æœºä¼šåœ¨æŠŠ touch äº‹ä»¶ dispatch ç»™ child å‰ï¼Œé€šè¿‡è°ƒç”¨è‡ªå·±çš„ onInterceptTouchEvent æ¥åˆ¤æ–­è¦ä¸è¦æŠŠ touch äº‹ä»¶æˆªä¸‹æ¥ç»™è‡ªå·±å°è¯•æ¶ˆè´¹ã€‚å¯¹äº DOWN äº‹ä»¶ï¼ŒonInterceptTouchEvent æ€»æ˜¯ä¼šè¢«è°ƒç”¨ï¼›å¯¹äºå…¶ä»–äº‹ä»¶ï¼Œchild æœ‰æœºä¼šåœ¨ parent çš„onInterceptTouchEvent è¢«è°ƒç”¨ä¹‹å‰ï¼Œè¯·æ±‚ parent ä¸è¦æ‹¦æˆªï¼Œè¿™ä¸ªè¯·æ±‚å°±æ˜¯é€šè¿‡ child è°ƒç”¨ parent çš„ requestDisallowInterceptTouchEvent æ–¹æ³•æ¥å®ç°çš„ã€‚</p><p><strong>DOWN äº‹ä»¶ï¼š</strong></p><p>DOWN äº‹ä»¶æ˜¯ä¸€ä¸² touch äº‹ä»¶çš„ç¬¬ä¸€ä¸ªäº‹ä»¶ï¼Œåœ¨ ViewGroup çš„ dispatchTouchEvent æ–¹æ³•ä¸­ï¼Œæ¥åˆ°æ­¤äº‹ä»¶æ—¶ï¼Œé¦–å…ˆä¼šåšä¸€äº›æ¸…é™¤å·¥ä½œï¼Œç„¶åæ£€æŸ¥è‡ªå·±è¦ä¸è¦æ‹¦æˆªæ­¤äº‹ä»¶å’Œæ˜¯ä¸æ˜¯è¦è½¬ä¸º CANCEL äº‹ä»¶ã€‚å¦‚æœä¸æ‹¦æˆªä¸”ä¸è½¬ä¸º CANCELï¼Œé‚£ä¹ˆæŒ¨ä¸ªæ£€æŸ¥ childï¼Œåœ¨æ°å½“çš„æ—¶å€™è°ƒç”¨ child çš„ dispatchTouchEvent æ¥çœ‹æœ‰æ²¡æœ‰ child ä¼šæ¶ˆè´¹æ­¤äº‹ä»¶ã€‚</p><p>ä¸Šé¢ 4 æ®µè¯ï¼Œç”¨ä¼ªä»£ç æ¥è¡¨ç¤ºï¼Œå¤§æ¦‚å°±æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewGroup</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> intercepted; <span class="comment">// æ‹¦æˆªå³ä¸æŠŠäº‹ä»¶ä¼ ç»™ child </span></span><br><span class="line">        <span class="keyword">boolean</span> handled = <span class="keyword">false</span>; <span class="comment">// View group æ˜¯å¦æ¶ˆè´¹äº†äº‹ä»¶ </span></span><br><span class="line">        <span class="keyword">if</span> (is DOWN || child ever comsumed previous event) &#123; </span><br><span class="line">            <span class="keyword">if</span> (! disallowIntercept) &#123; <span class="comment">// PS: å¯¹äº DOWN å…¶å® disallowIntercept ä¸€å®šæ˜¯ false </span></span><br><span class="line">                intercepted = onInterceptTouchEvent(event); </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">                intercepted = <span class="keyword">false</span>; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">            intercepted = <span class="keyword">true</span>; </span><br><span class="line">        &#125; <span class="keyword">if</span> (! canceled &amp;&amp; !intercepted) &#123;</span><br><span class="line">            <span class="keyword">for</span> (View child : all children) &#123;</span><br><span class="line">                <span class="keyword">if</span> (! child able to consume event) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>; </span><br><span class="line">                &#125; <span class="keyword">if</span> (dispatchTransformedTouchEvent(event, child)) &#123; </span><br><span class="line">                    <span class="comment">// åšä¸€äº›è®°å½•å·¥ä½œï¼Œç„¶å break </span></span><br><span class="line">                    <span class="keyword">break</span>; </span><br><span class="line">                &#125;</span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">// previous event æŒ‡è¿™ä¸€ä¸² touch äº‹ä»¶ä¸­åœ¨ event å‰é¢çš„é‚£äº› </span></span><br><span class="line">        <span class="keyword">if</span> (no child ever consumed previous event) &#123;</span><br><span class="line">            handled = <span class="keyword">super</span>.dispatchTransformedTouchEvent(event); </span><br><span class="line">            <span class="comment">// å°è¯•è‡ªè¡Œæ¶ˆè´¹ event </span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="comment">// å…¶å®é down äº‹ä»¶æ‰èƒ½èµ°åˆ°è¿™ä¸ª else åˆ†æ”¯ </span></span><br><span class="line">            <span class="keyword">for</span> (child : children who has consumed previous event) &#123;</span><br><span class="line">                <span class="keyword">if</span> (child.dispatchTouchEvent(event) </span><br><span class="line">                    handled = <span class="keyword">true</span>; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> handled; </span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> result = <span class="keyword">false</span>; </span><br><span class="line">        <span class="keyword">if</span> (mOnTouchListener != <span class="keyword">null</span> &amp;&amp; isEnabled &amp;&amp; mOnTouchListener.onTouch(<span class="keyword">this</span>, event)) &#123; </span><br><span class="line">            result = <span class="keyword">true</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">// onTouch ä¼˜äº onTouchEvent æ¥ä»£è¡¨ View å°è¯•æ¶ˆè´¹ event </span></span><br><span class="line">        <span class="keyword">if</span> (! result &amp;&amp; onTouchEvent(event)) &#123; </span><br><span class="line">            result = <span class="keyword">true</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> result; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isEnabled()) &#123;</span><br><span class="line">            <span class="keyword">return</span> isClickable() || isLongClickable(); </span><br><span class="line">        &#125; <span class="keyword">if</span> (isClickable || isLongClickable) &#123; </span><br><span class="line">            ...</span><br><span class="line">            retrun <span class="keyword">true</span>; </span><br><span class="line">        &#125; retrun <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å„ä¸ªç±»å’Œæ–¹æ³•çš„è§’è‰²æè¿°å¦‚ä¸‹ï¼š</p><blockquote><p>ViewGroup#dispatchTouchEventï¼Œä»£è¡¨ ViewGroup æ¥å—äº‹ä»¶ï¼Œå¤„ç†æ‹¦æˆªé€»è¾‘ï¼Œå°è¯•åˆ†å‘äº‹ä»¶ç»™ childï¼Œè°ƒç”¨ View#dispatchTouchEventæ¥å°è¯•è‡ªè¡Œæ¶ˆè´¹ Touch äº‹ä»¶ã€‚è¿”å›å€¼è¡¨ç¤ºè‡ªå·±è¿™é¢—å­æ ‘æœ‰æ²¡æœ‰æ¶ˆè´¹äº‹ä»¶ã€‚</p></blockquote><blockquote><p>View#dispatchTouchEvent ä»£è¡¨é ViewGroup çš„ View æ¥å—äº‹ä»¶ï¼Œè°ƒç”¨çœŸæ­£å°è¯•æ¶ˆè´¹äº‹ä»¶çš„ä»£ç ï¼ˆonTouchEvent æˆ–è€… onTouch ä¹‹ç±»çš„æ–¹æ³•ï¼‰ã€‚è¿”å›å€¼è¡¨ç¤ºè‡ªå·±æœ‰æ²¡æœ‰æ¶ˆè´¹äº‹ä»¶ã€‚</p></blockquote><blockquote><p>ViewGroup#onInterceptTouchEventï¼Œè¿”å›å€¼è¡¨ç¤º ViewGroup è¦ä¸è¦æ‹¦æˆªäº‹ä»¶ã€‚</p></blockquote><blockquote><p>ViewGroup#requestDisallowInterceptï¼Œè¢« child æ¥è°ƒç”¨ï¼Œè¡¨ç¤ºè¯·æ±‚ parent ä¸è¦æ‹¦æˆªï¼Œè¿™ä¸ªè¯·æ±‚ä»…åœ¨é DOWN äº‹ä»¶æœ‰æ•ˆï¼Œä¸”ä¼šé€’å½’å‘ä¸Šè°ƒç”¨æ‰€æœ‰ parent çš„åŒåæ–¹æ³•ã€‚</p></blockquote><blockquote><p>TouchTarget ç±»ï¼Œæ­¤ç±»åŒ…å«æ¶ˆè´¹è¿‡ Touch äº‹ä»¶çš„ child å’Œå®ƒæ¶ˆè´¹è¿‡å“ªäº› pointer çš„äº‹ä»¶è¿™äº›ä¿¡æ¯ï¼ŒTouchTarget å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚åœ¨ ViewGroup ä¸­ï¼Œå­˜æœ‰ä¸€ä¸ª TouchTarget é“¾è¡¨ï¼Œéå†æ­¤é“¾è¡¨ï¼Œå³å¯çŸ¥é“ä¸€ä¸ª pointer æ˜¯å¦å·²æœ‰äº‹ä»¶è¢«æŸä¸ª child å¤„ç†è¿‡ã€‚</p></blockquote><p>ä»¥ä¸Šçš„ä»‹ç»ï¼Œå…¶å®æ˜¯çœç•¥äº†ä¸å°‘ä¿¡æ¯ï¼ŒçœŸæ­£çš„äº‹ä»¶åˆ†å‘è¿‡ç¨‹ï¼Œè¦æ›´å¤æ‚ä¸å°‘ï¼Œä¸‹é¢æ˜¯æˆ‘å°è¯•ç”»çš„ä¸€å¼ æµç¨‹å›¾ (æŠŠå›¾å’Œæºç å¯¹ç…§ç€ç†è§£å¯èƒ½ä¼šæœ‰äº›å¸®åŠ©)ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535809116.png" alt=""></p><p>å¯¹äºä¸Šå›¾ï¼Œæœ‰ä¸€äº›éœ€è¦è§£é‡Šçš„åœ°æ–¹ï¼š</p><ol><li><p>TouchTarget æŒæœ‰ä¸€ä¸ª child Viewï¼Œå’Œæ­¤ child View æ›¾æ¶ˆè´¹è¿‡ Down æˆ–è€… pointerDown äº‹ä»¶çš„é‚£äº› Pointer çš„ idï¼Œè¿™äº› pointer id æ˜¯ä»¥ id bits çš„å½¢å¼å­˜å‚¨ä¸ºä¸€ä¸ªæ•´æ•°çš„ã€‚</p></li><li><p>TouchTarget é“¾è¡¨çš„å¤´ç»“ç‚¹æ˜¯ç”± mFirstTouchTarget å¼•ç”¨çš„ã€‚åœ¨ä¸€ä¸²äº‹ä»¶ç»“æŸ(å¤„ç†å®Œ UP)åï¼Œæ­£å¸¸æƒ…å†µé“¾è¡¨åº”è¯¥æ¸…ç©ºï¼Œåœ¨ä¸€ä¸² Touch äº‹ä»¶åˆ°æ¥å‰(å¤„ç† Down å‰)ä¹Ÿä¼šæ¸…ç©ºï¼Œç®—æ˜¯è¡¥åˆ€ã€‚</p></li><li><p>é“¾è¡¨çš„æ„ä¹‰æ˜¯ï¼Œå­˜å‚¨ child æ›¾ç»æ¶ˆè´¹è¿‡æŸäº› pointer çš„ Down æˆ–è€… PointerDown äº‹ä»¶è¿™ç§ä¿¡æ¯ã€‚å½“ä¸€ä¸ª Pointer ç»“æŸäº†ï¼ˆæ‰‹æŒ‡å¤´ç¦»å¼€å±å¹•ï¼‰ï¼Œé‚£ä¹ˆæ‰€æœ‰æ¶ˆè´¹è¿‡å®ƒçš„ Down æˆ–è€… PointerDown äº‹ä»¶çš„ TouchTarget éƒ½éœ€è¦ç§»é™¤æ‰å®ƒçš„ idï¼Œäº‹å®ä¸Šï¼Œè¿™ä¸€ä¸² touch äº‹ä»¶ä¸­å†ä¹Ÿä¸ä¼šæœ‰è¿™ä¸ª id äº†ï¼›å¦‚æœä¸€ä¸ª TouchTarget çš„ pointer idç§»é™¤å…‰äº†ï¼Œé‚£ä¹ˆæ„å‘³ç€æ­¤ TouchTarget æŒæœ‰çš„ child æ²¡æœ‰æ¶ˆè´¹è¿‡ä»»æ„(ç°å­˜)çš„ pointer çš„ Down æˆ–è€… PointerDownï¼Œäºæ˜¯å¯ä»¥æŠŠæ­¤ TouchTarget ä»é“¾è¡¨ç§»é™¤äº†ã€‚</p></li><li><p>æ¯æ¬¡ä¸€ä¸ª Down æˆ–è€… PointerDown äº‹ä»¶ ev åˆ°æ¥æ—¶ï¼Œå¯¹äº ViewGroup çš„æ¯ä¸ª child xï¼Œè‹¥ ev çš„åæ ‡è½åœ¨ x çš„èŒƒå›´å†…(å¦åˆ™å°± continueï¼Œè€ƒè™‘ä¸‹ä¸€ä¸ª child)ï¼Œè¿›ä¸€æ­¥ã€Œå¦‚æœ x åœ¨é“¾è¡¨ä¸­(è¯´æ˜ x æ¶ˆè´¹è¿‡ Down æˆ–è€… pointerDown äº‹ä»¶)ï¼Œé‚£ä¹ˆ x å°±æ˜¯è¦è¢«åˆ†å‘çš„ childï¼›å¦åˆ™å¦‚æœ x.dispatchTouchEvent(ev) è¿”å› true äº†ï¼Œé‚£ä¹ˆ x åŒæ ·æ˜¯è¦è¢«åˆ†å‘çš„ childï¼Œè™½ç„¶æ­¤æ—¶åˆ†å‘å·²ç»ç»“æŸäº†ã€ã€‚</p></li><li><p>æ¯ä¸ª move äº‹ä»¶ ev åˆ°æ¥æ—¶ï¼Œé“¾è¡¨ä¸ºç©ºçš„è¯ï¼Œæ˜¾ç„¶æ²¡æœ‰ child æ¶ˆè´¹è¿‡ down æˆ–è€… pointerDownï¼Œé‚£ä¹ˆç›´æ¥è®© viewGroup å¤„ç† ev å°±å¥½äº†ã€‚é“¾è¡¨ä¸ä¸ºç©ºçš„è¯ï¼Œå¯¹äºé“¾è¡¨çš„æ¯ä¸ª TouchTarget t æŒæœ‰çš„ child xï¼šå¦‚æœè½¬æˆäº† cancel äº‹ä»¶ï¼Œé‚£ä¹ˆå‘ x åˆ†å‘ä¸€ä¸ª cancel äº‹ä»¶ï¼Œå¦å¤–æŠŠ t ä»é“¾è¡¨ç§»é™¤(ç§»é™¤çš„åŸå› æ˜¯ï¼Œä¾‹å¦‚ x æ­£åœ¨ detachingï¼Œæ‰€ä»¥æ‰å¼•å‘ cancelï¼Œé‚£ä¹ˆå½“ç„¶éœ€è¦æŠŠæŒæœ‰ x çš„ t ç§»é™¤)ï¼Œç„¶å overï¼Œå³ move äº‹ä»¶ä¸¢å¤±äº†ï¼›æ²¡è½¬æˆ cancelï¼Œé‚£å°±æ£€æŸ¥ t çš„ idBits ä¸­æœ‰æ²¡æœ‰ ev çš„ä»»æ„ä¸€ä¸ª pointer çš„ idï¼Œæœ‰åˆ™æŠŠ ev äº¤ç»™ xï¼Œæ²¡æœ‰åˆ™ continueã€‚</p></li></ol><p>å››ã€æºç åˆ†æ</p><p>ä¸‹é¢ç²˜è´´ä¸€å¤§æ®µåŠ ä¸Šäº†æˆ‘çš„ç†è§£ä½œä¸ºæ³¨é‡Šçš„æºç ï¼Œä»£ç çœŸçš„å¾ˆé•¿å¾ˆé•¿ï¼Œè¿™è¿˜ä»…ä»…æ˜¯ ViewGroup#dispatchTouchEvent è¿™ä¸€ä¸ªæ–¹æ³•çš„ä»£ç ã€‚å…³äºå¤šç‚¹è§¦æ§çš„å¤„ç†é€»è¾‘ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰å½»åº•æ˜ç™½ï¼Œsighã€‚ã€‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> handled = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">// è‹¥å½“å‰ç±»ä¸Šé¢è¦†ç›–äº†å…¶ä»–window, ä¸” ev çš„flagå·²æ ‡è®°è¿‡æ»¤ã€Œè¦†ç›–ã€æƒ…å†µä¸‹çš„äº‹ä»¶ï¼Œåˆ™ç›´æ¥è·³è¿‡</span></span><br><span class="line">    <span class="keyword">if</span> (onFilterTouchEventForSecurity(ev)) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> action = ev.getAction();</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> actionMasked = action &amp; MotionEvent.ACTION_MASK;</span><br><span class="line">        <span class="comment">// Handle an initial down.</span></span><br><span class="line">        <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">            <span class="comment">// Throw away all previous state when starting a new touch gesture.</span></span><br><span class="line">            <span class="comment">// The framework may have dropped the up or cancel event for the previous gesture</span></span><br><span class="line">            <span class="comment">// due to an app switch, ANR, or some other state change.</span></span><br><span class="line">            cancelAndClearTouchTargets(ev); <span class="comment">//å¦‚é“¾è¡¨éç©º, å‘å…¶ä¸­æ‰€æœ‰ touchTarget æŒæœ‰çš„ child å‘ cancel äº‹ä»¶, å¹¶æ¸…ç©ºé“¾è¡¨</span></span><br><span class="line">            resetTouchState(); <span class="comment">// reset æ­¤ ViewGroup çš„ CANCEL_NEXT_UP å’Œ DISALLOW_INTERCEPT</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Check for interception.</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> intercepted;</span><br><span class="line">        <span class="comment">// down äº‹ä»¶, æˆ–è€…é“¾è¡¨ä¸ç©º(æ„æ€æ˜¯æ›¾æœ‰ down äº‹ä»¶è¢«æŸä¸ª child æ¶ˆè´¹è¿‡)æ—¶, è€ƒè™‘æ‹¦æˆª</span></span><br><span class="line">        <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN</span><br><span class="line">                || mFirstTouchTarget != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// å‰é¢çš„ resetTouchState() ä½¿å¾— disallowIntercept å¿…å®šæ˜¯ false</span></span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">boolean</span> disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (!disallowIntercept) &#123;</span><br><span class="line">                intercepted = onInterceptTouchEvent(ev);</span><br><span class="line">                ev.setAction(action); <span class="comment">// restore action in case it was changed</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                intercepted = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// å…¶ä»–æƒ…å†µ, ä¸ç”¨æŠŠäº‹ä»¶äº¤ç»™ä»»ä½• child, æ‰€ä»¥ç›´æ¥èµ‹å€¼ intercepted = true</span></span><br><span class="line">            <span class="comment">// There are no touch targets and this action is not an initial down</span></span><br><span class="line">            <span class="comment">// so this view group continues to intercept touches.</span></span><br><span class="line">            intercepted = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Check for cancelation.</span></span><br><span class="line">        <span class="comment">// æ­¤ ViewGroup æœ‰ cancel_next_up æ ‡å¿—, é‚£ä¹ˆå°±è½¬æˆ cancel äº‹ä»¶</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> canceled = resetCancelNextUpFlag(<span class="keyword">this</span>)</span><br><span class="line">                || actionMasked == MotionEvent.ACTION_CANCEL;</span><br><span class="line">        <span class="comment">// Update list of touch targets for pointer down, if needed.</span></span><br><span class="line">        <span class="comment">// API 11 ä»¥ä¸Š, split å¿…ä¸º true</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> split = (mGroupFlags &amp; FLAG_SPLIT_MOTION_EVENTS) != <span class="number">0</span>;</span><br><span class="line">        TouchTarget newTouchTarget = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">// æ ‡è®° down/pointerDown è¢«æŸä¸ª child æ¶ˆè´¹</span></span><br><span class="line">        <span class="keyword">boolean</span> alreadyDispatchedToNewTouchTarget = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (!canceled &amp;&amp; !intercepted) &#123;</span><br><span class="line">            <span class="comment">// down/pointerDown æ‰å¯»æ±‚ child æ¥æ¥ç›˜, å…¶ä½™ç±»å‹çš„äº‹ä»¶éƒ½æ˜¯è°æ¶ˆè´¹äº† down/pointerDown å°±äº¤ç»™è°</span></span><br><span class="line">            <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN</span><br><span class="line">                    || (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_DOWN)</span><br><span class="line">                    || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123;</span><br><span class="line">                <span class="comment">// å¾—åˆ° ev å½“å‰ action æ‰€æ‰€å±çš„ pointer çš„ index</span></span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> actionIndex = ev.getActionIndex(); <span class="comment">// always 0 for down</span></span><br><span class="line">                <span class="comment">// idBitsToAssign åŒ…å«ä¸€ä¸ª id, å³ ev æ‰€å± pointer çš„ id</span></span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> idBitsToAssign = split ? <span class="number">1</span> &lt;&lt; ev.getPointerId(actionIndex)</span><br><span class="line">                        : TouchTarget.ALL_POINTER_IDS;</span><br><span class="line">                <span class="comment">// Clean up earlier touch targets for this pointer id in case they</span></span><br><span class="line">                <span class="comment">// have become out of sync.</span></span><br><span class="line">                <span class="comment">// down/pointerDown æ„å‘³ç€æ–°çš„ pointer, æ¸…é™¤ä¸€ä¸‹é“¾è¡¨ä¸­å’Œæ–° pointer çš„ id ä¹‹é—´çš„ç“œè‘›</span></span><br><span class="line">                removePointersFromTouchTargets(idBitsToAssign);</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> childrenCount = mChildrenCount;</span><br><span class="line">                <span class="keyword">if</span> (newTouchTarget == <span class="keyword">null</span> &amp;&amp; childrenCount != <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">float</span> x = ev.getX(actionIndex);</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">float</span> y = ev.getY(actionIndex);</span><br><span class="line">                    <span class="comment">// Find a child that can receive the event.</span></span><br><span class="line">                    <span class="comment">// Scan children from front to back.</span></span><br><span class="line">                    <span class="keyword">final</span> ArrayList&lt;View&gt; preorderedList = buildTouchDispatchChildList();</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">boolean</span> customOrder = preorderedList == <span class="keyword">null</span></span><br><span class="line">                            &amp;&amp; isChildrenDrawingOrderEnabled();</span><br><span class="line">                    <span class="keyword">final</span> View[] children = mChildren;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = childrenCount - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">                        <span class="keyword">final</span> <span class="keyword">int</span> childIndex = getAndVerifyPreorderedIndex(</span><br><span class="line">                                childrenCount, i, customOrder);</span><br><span class="line">                        <span class="keyword">final</span> View child = getAndVerifyPreorderedView(</span><br><span class="line">                                preorderedList, children, childIndex);</span><br><span class="line">                        </span><br><span class="line">                        <span class="comment">// ä¸èƒ½æ¥å—æˆ–è€…æ˜¯ ev åæ ‡ä¸åœ¨ child å†…éƒ¨åˆ™ continue</span></span><br><span class="line">                        <span class="keyword">if</span> (!canViewReceivePointerEvents(child)</span><br><span class="line">                                || !isTransformedTouchPointInView(x, y, child, <span class="keyword">null</span>)) &#123;</span><br><span class="line">                            ev.setTargetAccessibilityFocus(<span class="keyword">false</span>);</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        newTouchTarget = getTouchTarget(child);</span><br><span class="line">                        <span class="keyword">if</span> (newTouchTarget != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            <span class="comment">// è¯´æ˜ ev è½åœ¨ child å†…éƒ¨ä¸” child ä»¥å‰å“åº”è¿‡ down/pointerDown, é‚£ä¹ˆç”± child æ¥æ¥ç›˜, æ•… break</span></span><br><span class="line">                            <span class="comment">// å¦‚æœ ev æ˜¯ Down äº‹ä»¶, åˆ—è¡¨å°šç©º, åˆ™èµ°ä¸åˆ°è¿™é‡Œæ¥</span></span><br><span class="line">                            <span class="comment">// Child is already receiving touch within its bounds.</span></span><br><span class="line">                            <span class="comment">// Give it the new pointer in addition to the ones it is handling.</span></span><br><span class="line">                            <span class="comment">// child æ‰€å± TouchTarget å¯èƒ½å¢åŠ ä¸€ä¸ª pointer id</span></span><br><span class="line">                            newTouchTarget.pointerIdBits |= idBitsToAssign;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        resetCancelNextUpFlag(child);</span><br><span class="line">                        <span class="comment">// å°è¯•è®© child æ¶ˆè´¹ ev</span></span><br><span class="line">                        <span class="keyword">if</span> (dispatchTransformedTouchEvent(ev, <span class="keyword">false</span>, child, idBitsToAssign)) &#123;</span><br><span class="line">                            <span class="comment">// Child wants to receive touch within its bounds.</span></span><br><span class="line">                            mLastTouchDownTime = ev.getDownTime();</span><br><span class="line">                            <span class="keyword">if</span> (preorderedList != <span class="keyword">null</span>) &#123;</span><br><span class="line">                                <span class="comment">// childIndex points into presorted list, find original index</span></span><br><span class="line">                                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; childrenCount; j++) &#123;</span><br><span class="line">                                    <span class="keyword">if</span> (children[childIndex] == mChildren[j]) &#123;</span><br><span class="line">                                        mLastTouchDownIndex = j;</span><br><span class="line">                                        <span class="keyword">break</span>;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                mLastTouchDownIndex = childIndex;</span><br><span class="line">                            &#125;</span><br><span class="line">                            mLastTouchDownX = ev.getX();</span><br><span class="line">                            mLastTouchDownY = ev.getY();</span><br><span class="line">                            <span class="comment">// æ¶ˆè´¹æˆåŠŸçš„è¯, ç”¨ child æ–°å»º TouchTarget, æ’åˆ°é“¾è¡¨å¤´éƒ¨,</span></span><br><span class="line">                            newTouchTarget = addTouchTarget(child, idBitsToAssign);</span><br><span class="line">                            alreadyDispatchedToNewTouchTarget = <span class="keyword">true</span>;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// The accessibility focus didn't handle the event, so clear</span></span><br><span class="line">                        <span class="comment">// the flag and do a normal dispatch to all children.</span></span><br><span class="line">                        ev.setTargetAccessibilityFocus(<span class="keyword">false</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (preorderedList != <span class="keyword">null</span>) preorderedList.clear();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (newTouchTarget == <span class="keyword">null</span> &amp;&amp; mFirstTouchTarget != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// æ²¡æ‰¾åˆ°æ¥ç›˜çš„, ä¸”é“¾è¡¨ä¸ç©º(æ„æ€æ˜¯æœ‰ Down/pointerDown è¢« child View æ¶ˆè´¹è¿‡)</span></span><br><span class="line">                    <span class="comment">// Did not find a child to receive the event.</span></span><br><span class="line">                    <span class="comment">// Assign the pointer to the least recently added target.</span></span><br><span class="line">                    <span class="comment">// å¼ºè¡Œè®©é“¾è¡¨æœ«å°¾èŠ‚ç‚¹æŒæœ‰çš„ child æ¥æ¥ç›˜</span></span><br><span class="line">                    newTouchTarget = mFirstTouchTarget;</span><br><span class="line">                    <span class="keyword">while</span> (newTouchTarget.next != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        newTouchTarget = newTouchTarget.next;</span><br><span class="line">                    &#125;</span><br><span class="line">                    newTouchTarget.pointerIdBits |= idBitsToAssign;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Dispatch to touch targets.</span></span><br><span class="line">        <span class="keyword">if</span> (mFirstTouchTarget == <span class="keyword">null</span>) &#123; <span class="comment">// child view å‹æ ¹æ²¡æœ‰æ¶ˆè´¹è¿‡äº‹ä»¶</span></span><br><span class="line">            <span class="comment">// No touch targets so treat this as an ordinary view.</span></span><br><span class="line">            <span class="comment">// view group å°è¯•è‡ªè¡Œæ¶ˆè´¹</span></span><br><span class="line">            handled = dispatchTransformedTouchEvent(ev, canceled, <span class="keyword">null</span>,</span><br><span class="line">                    TouchTarget.ALL_POINTER_IDS);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Dispatch to touch targets, excluding the new touch target if we already</span></span><br><span class="line">            <span class="comment">// dispatched to it.  Cancel touch targets if necessary.</span></span><br><span class="line">            TouchTarget predecessor = <span class="keyword">null</span>;</span><br><span class="line">            TouchTarget target = mFirstTouchTarget;</span><br><span class="line">            <span class="comment">// éå†é“¾è¡¨</span></span><br><span class="line">            <span class="keyword">while</span> (target != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">final</span> TouchTarget next = target.next;</span><br><span class="line">                <span class="keyword">if</span> (alreadyDispatchedToNewTouchTarget &amp;&amp; target == newTouchTarget) &#123;</span><br><span class="line">                    <span class="comment">// ev æ˜¯ Down æˆ–è€… pointer Down ä¸”å®ƒè¢« target æŒæœ‰çš„ child æ¶ˆè´¹äº†</span></span><br><span class="line">                    handled = <span class="keyword">true</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123; <span class="comment">// å¯¹äºå…¶ä»–çš„ Touch target</span></span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">boolean</span> cancelChild = resetCancelNextUpFlag(target.child)</span><br><span class="line">                            || intercepted;</span><br><span class="line">                    <span class="comment">// å‘é€ cancel æˆ–è€… ev ç»™ child, æˆ–è€…å•¥ä¹Ÿä¸åš(target çš„ idBits æ²¡æœ‰ ev ä¸­ä»»æ„çš„ pointer çš„ id)</span></span><br><span class="line">                    <span class="keyword">if</span> (dispatchTransformedTouchEvent(ev, cancelChild,</span><br><span class="line">                            target.child, target.pointerIdBits)) &#123;</span><br><span class="line">                        handled = <span class="keyword">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (cancelChild) &#123; <span class="comment">// æ”¶åˆ° cancel å,child å°±ä¸è¯¥å†æ”¶åˆ°äº‹ä»¶äº†, å¯¹åº”çš„ TouchTarget ä¹Ÿè¦ç§»é™¤</span></span><br><span class="line">                        <span class="keyword">if</span> (predecessor == <span class="keyword">null</span>) &#123;</span><br><span class="line">                            mFirstTouchTarget = next;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            predecessor.next = next;</span><br><span class="line">                        &#125;</span><br><span class="line">                        target.recycle();</span><br><span class="line">                        target = next;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                predecessor = target;</span><br><span class="line">                target = next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Update list of touch targets for pointer up or cancel, if needed.</span></span><br><span class="line">        <span class="keyword">if</span> (canceled</span><br><span class="line">                || actionMasked == MotionEvent.ACTION_UP</span><br><span class="line">                || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123;</span><br><span class="line">            resetTouchState(); <span class="comment">// up äº‹ä»¶å,è¿™ä¸€ä¸² Touch äº‹ä»¶å°±ç»“æŸäº†, æ¸…ç†é“¾è¡¨ç­‰</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_UP) &#123;</span><br><span class="line">            <span class="comment">// æŸä¸ª pointer æ²¡äº†, é‚£ä¹ˆæ¸…ç©ºé“¾è¡¨ä¸­å’Œè¿™ä¸ª pointer çš„ç“œè‘›</span></span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> actionIndex = ev.getActionIndex();</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> idBitsToRemove = <span class="number">1</span> &lt;&lt; ev.getPointerId(actionIndex);</span><br><span class="line">            removePointersFromTouchTargets(idBitsToRemove);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!handled &amp;&amp; mInputEventConsistencyVerifier != <span class="keyword">null</span>) &#123;</span><br><span class="line">        mInputEventConsistencyVerifier.onUnhandledEvent(ev, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> handled;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº”ã€æ»‘åŠ¨å†²çªåˆ†æç¤ºä¾‹</p><p>åœ¨ã€Šå®‰å“å¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹ä¸€ä¹¦ä¸­è®² touch äº‹ä»¶çš„æœ€åï¼Œè®²äº†æ»‘åŠ¨å†²çªçš„è§£å†³æ–¹æ³•ã€‚æ‰€è°“æ»‘åŠ¨å†²çªæœ€ç®€å•çš„æƒ…å½¢å°±æ˜¯ä¸€ä¸ªæ°´å¹³æ»‘åŠ¨çš„ ScrollView é‡Œé¢æ”¾ä¸€ä¸ªç«–ç›´æ»‘åŠ¨çš„ listViewï¼Œä¸¤è€…æ»‘åŠ¨æ–¹å‘ä¸åŒï¼Œå³ä¸ºæ»‘åŠ¨å†²çªã€‚å¯¹äºè¿™ä¸ªæƒ…å½¢ï¼Œè§£å†³æ»‘åŠ¨å†²çªï¼Œå…¶å®å°±æ˜¯åœ¨æ‰‹æŒ‡ä¸Šä¸‹æ»‘æ—¶å§ move äº‹ä»¶ç»™ childï¼ˆlistViewï¼‰å¤„ç†ï¼Œè€Œæ‰‹æŒ‡å·¦å³æ»‘åŠ¨æ—¶ç»™ parent å¤„ç†ï¼ˆScrollViewï¼‰å³å¯ã€‚ä¸‹é¢æ˜¯ä¹¦ä¸­çš„ä¸€ç§è§£å†³æ–¹å¼ï¼Œä½¿ç”¨ä¸Šé¢è®²çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬å¯ä»¥é€å½»çš„åˆ†æè¿™ç§è§£å†³æ–¹å¼ã€‚</p><p>ä¸‹é¢æ˜¯ã€Šå®‰å“å¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹ä¸­æä¾›çš„å…¶ä¸­ä¸€ç§è§£å†³æ–¹æ³•ï¼Œæˆ‘åŠ å…¥äº†æ¯”è¾ƒè¯¦ç»†çš„æ³¨é‡Šä½œä¸ºè§£é‡Šï¼Œåœ¨å‰é¢çš„åŸºç¡€ä¸Šï¼Œè¿™ç§è§£å†³æ–¹æ³•çš„é€»è¾‘å°±å¾ˆæ˜ç¡®äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChildView</span> <span class="keyword">extends</span> <span class="title">android</span>.<span class="title">view</span>.<span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        ViewParent parent = getParent();</span><br><span class="line">        <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">switch</span> (event.getActionMasked()) &#123;</span><br><span class="line">                <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                    <span class="comment">// æ­¤æ¬¡è¯·æ±‚å…¶å®åœ¨ Down äº‹ä»¶åçš„é¦–ä¸ª Move ä¼ è‡³ parent ä¸­æ—¶ç”Ÿæ•ˆ</span></span><br><span class="line">                    <span class="comment">// è‹¥ä¸è¯·æ±‚ï¼Œåˆ™å°†ä¼šå‘ç”Ÿæ‹¦æˆªï¼Œåç»­äº‹ä»¶éƒ½å’Œ child æ— ç¼˜ï¼Œæ‰€ä»¥å¿…é¡»è¯·æ±‚åˆ«æ‹¦æˆª</span></span><br><span class="line">                    parent.requestDisallowInterceptTouchEvent(<span class="keyword">true</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">                    <span class="comment">// å¦‚æœæœŸæœ› parent æ¥å¤„ç†ï¼Œé‚£ä¹ˆè§£é™¤è¯·æ±‚ï¼Œåˆ™ä¸‹ä¸€æ¬¡ Move äº‹ä»¶æ—¶å¿…å®šæ‹¦æˆªï¼Œåç»­äº‹ä»¶å°±å…¨éƒ¨äº¤ç»™ parent äº†ã€‚</span></span><br><span class="line">                    <span class="comment">// å¦åˆ™ï¼Œä»€ä¹ˆä¹Ÿä¸åšï¼Œå³äº‹ä»¶ä¼šç»§ç»­æºæºä¸æ–­çš„äº¤ç»™ child</span></span><br><span class="line">                    <span class="keyword">if</span> (parent should handle event)&#123;</span><br><span class="line">                        parent.requestDisallowInterceptTouchEvent(<span class="keyword">false</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParentView</span> <span class="keyword">extends</span> <span class="title">ViewGroup</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Down æ—¶ï¼Œå¿…ç„¶è°ƒæ­¤æ–¹æ³•ï¼Œæ­¤æ—¶ä¸åº”æ‹¦æˆªï¼Œå¦åˆ™ child æ°¸è¿œæ— æ³•å¤„ç† move äº‹ä»¶</span></span><br><span class="line">        <span class="comment">// å…¶ä»–äº‹ä»¶æ—¶ï¼Œè‹¥ child è¯·æ±‚ä¸æ‹¦æˆªï¼Œé‚£ä¹ˆåé¢çš„äº‹ä»¶éƒ½äº¤ç»™ child äº†ï¼›å¦åˆ™ï¼Œå°±ä¼š</span></span><br><span class="line">        <span class="comment">// è°ƒç”¨æ­¤æ–¹æ³•ï¼Œæ­¤æ–¹æ³•è¿™æ—¶è¿”å› True å³è¡¨ç¤ºæ‹¦æˆªï¼Œé‚£ä¹ˆä¼šå‘ä¸€ä¸ª cancel ç»™ childï¼Œåç»­çš„äº‹ä»¶å°±å’Œ child æ— ç¼˜äº†</span></span><br><span class="line">        <span class="keyword">return</span> ev.getActionMasked() != MotionEvent.ACTION_DOWN;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°æ­¤ï¼Œè¿™ç¯‡é•¿é•¿çš„ã€å¹¶ä¸å®Œç¾çš„åˆ†æä¹Ÿå°±ç»“æŸäº†ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Android ImageView ScaleType</title>
      <link href="/2018/09/26/Android%20ImageView%20ScaleType/"/>
      <url>/2018/09/26/Android%20ImageView%20ScaleType/</url>
      <content type="html"><![CDATA[<p>æˆ‘ç»å¸¸è®°ä¸ä½ Android ä¸­ ImageView çš„å„ç§ ScaleType çš„å«ä¹‰ï¼Œçœ‹æ–‡æ¡£ä¸€æ—¶ä¹Ÿç¡®å®šä¸äº†ï¼Œæ‰€ä»¥å¹²è„†æŠŠæ‰€æœ‰ ScaleType æŒ¨ä¸ªå°è¯•äº†ä¸€éï¼Œç„¶åæ¸…æ¥šçš„è®°å½•ä¸‹æ¥ï¼Œä»¥å¤‡ä»ŠåæŸ¥é˜…ã€‚</p><p><strong>CEMTER</strong></p><p>å›¾ç‰‡å¤§å°ä¸åšä»»ä½•ç¼©æ”¾ï¼Œä»…ä»…æŠŠå›¾ç‰‡ä¸­å¿ƒå’Œè§†å›¾ä¸­å¿ƒé‡åˆã€‚å¯èƒ½å›¾ç‰‡å°äºè§†å›¾æ¡†ï¼Œä¹Ÿå¯èƒ½åè¿‡æ¥ã€‚</p><p><strong>CENTER_CROP</strong></p><p>å°†å›¾ç‰‡æ”¾å¤§æˆ–è€…ç¼©å°ï¼Œç›´åˆ°è§†å›¾æ¡†è¢«å¸ƒæ»¡ï¼Œä¸”å›¾ç‰‡çš„ä¸¤ä¸ªè¾¹ç¼˜æˆ–è€…æ‰€æœ‰è¾¹ç¼˜å’Œè§†å›¾æ¡†çš„å¯¹åº”è¾¹ç¼˜é‡åˆã€‚</p><p><strong>CENTER_INSIDE</strong></p><p>å¯èƒ½å°†å›¾ç‰‡ç¼©å°ï¼Œä½†æ˜¯ä¸ä¼šæ”¾å¤§ï¼Œç›®æ ‡æ˜¯æŠŠå›¾ç‰‡æ”¾ç½®åœ¨è§†å›¾æ¡†ä¹‹å†…ï¼Œä¸èƒ½æœ‰éœ²åœ¨å¤–é¢çš„ï¼Œå›¾ç‰‡ä¸­å¿ƒå’Œè§†å›¾æ¡†ä¸­å¿ƒé‡åˆã€‚</p><p><strong>FIT_CENTER</strong></p><p>å›¾ç‰‡å¯èƒ½æ”¾å¤§ä¹Ÿå¯èƒ½ç¼©å°ï¼Œç›®æ ‡æ˜¯è®©å›¾ç‰‡åœ¨æ˜¯å›¾æ¡†å†…éƒ¨ï¼Œä¸”å›¾ç‰‡å æ®æœ€å¤§çš„å¯ç”¨ç©ºé—´ï¼Œå›¾ç‰‡ä¸­å¿ƒå’Œè§†å›¾æ¡†ä¸­å¿ƒé‡åˆã€‚</p><p><strong>FIT_START</strong></p><p>ç±»ä¼¼äº fit_center åªä¸è¿‡å›¾ç‰‡ä¸­å¿ƒå¯èƒ½å’Œè§†å›¾æ¡†ä¸­å¿ƒä¸é‡åˆï¼Œè€Œæ˜¯å›¾ç‰‡å¤„åœ¨è§†å›¾æ¡†çš„ä¸Šä¾§æˆ–è€…å·¦ä¾§ã€‚</p><p><strong>FIT_END</strong></p><p>ç±»ä¼¼äº fit_center åªä¸è¿‡å›¾ç‰‡ä¸­å¿ƒå¯èƒ½å’Œè§†å›¾æ¡†ä¸­å¿ƒä¸é‡åˆï¼Œè€Œæ˜¯å›¾ç‰‡å¤„åœ¨è§†å›¾æ¡†çš„ä¸‹ä¾§æˆ–è€…å³ä¾§ã€‚</p><p><strong>FIT_XY</strong></p><p>å›¾ç‰‡å¯èƒ½ä¼šè¢«æ‹‰ä¼¸ï¼Œæ•ˆæœæ˜¯å›¾ç‰‡çš„å››ä¸ªè¾¹ç¼˜å’Œè§†å›¾æ¡†çš„å››ä¸ªè¾¹ç¼˜æ— æ¡ä»¶é‡åˆã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
