<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="A blog of Liu Tao"><title>博客系统迁移记录 | Liu Tao</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">博客系统迁移记录</h1><a id="logo" href="/.">Liu Tao</a><p class="description">A little older, a little wiser, but happy to see you.</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">博客系统迁移记录</h1><div class="post-meta">Sep 26, 2018</div><a class="disqus-comment-count" data-disqus-identifier="2018/09/26/博客系统迁移记录/" href="/2018/09/26/博客系统迁移记录/#disqus_thread"></a><div class="post-content"><p>此前我用的是 <a href="http://www.zblogcn.com/" target="_blank" rel="noopener">Z-blog 系统</a>，这个系统上手简单，不过仅支持在网页在线编写文章。这种方式弊端是比较死板，如果将来需要把文章移动到别的地方会很麻烦，而如果是用 MarkDown 来写文章就不会有这个麻烦了。本文就详细记录这次博客系统迁移的细节，包含 Linux 系统配置、Nginx 的配置、<a href="https://hexo.io/" target="_blank" rel="noopener">hexo</a> 的配置和 deploy 脚本等内容。</p>
<p>首先是，这次又把 VPS 的 Server 硬盘重置了，每次重置后都需要重新设置配置一遍 Linux 系统（我的 VPS 是 Ubuntu 16.04），所以这次记录一下配置的过程，也就是各种配置命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">adduser liutao <span class="comment"># add user, with root user</span></span><br><span class="line">usermod -aG sudo liutao <span class="comment"># add sudo permission, with root user</span></span><br><span class="line">su - liutao <span class="comment"># switch to user liutao</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># update repository info</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get upgrade</span><br><span class="line"></span><br><span class="line"><span class="comment"># configure shadowsocks</span></span><br><span class="line">sudo apt install python-pip</span><br><span class="line">sudo pip install shadowsocks</span><br><span class="line">sudo mkdir /etc/shadowsocks</span><br><span class="line"></span><br><span class="line"><span class="comment"># create config file</span></span><br><span class="line">sudo vim /etc/shadowsocks/ss.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"server"</span>:<span class="string">"0.0.0.0"</span>,</span><br><span class="line">    <span class="string">"server_port"</span>:22222,</span><br><span class="line">    <span class="string">"local_port"</span>:1080,</span><br><span class="line">    <span class="string">"password"</span>:<span class="string">"your pass word"</span>,</span><br><span class="line">    <span class="string">"timeout"</span>:1000,</span><br><span class="line">    <span class="string">"method"</span>:<span class="string">"aes-256-cfb"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># add service configuration info,.</span></span><br><span class="line">sudo vim /etc/systemd/system/shadowsocks.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Shadowsocks Server</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/bin/ssserver -c /etc/shadowsocks/ss.json</span><br><span class="line">Restart=on-abort</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"><span class="comment"># start shadowsocks service</span></span><br><span class="line">sudo systemctl start shadowsocks</span><br><span class="line"></span><br><span class="line"><span class="comment"># start shadowsocks on startup</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> shadowsocks</span><br><span class="line"></span><br><span class="line"><span class="comment"># install linuxbrew</span></span><br><span class="line">sh -c <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/Linuxbrew/install/master/install.sh)</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># install zsh</span></span><br><span class="line">sudo apt-get install zsh</span><br><span class="line"></span><br><span class="line"><span class="comment"># install oh my zsh, this dependends on zsh</span></span><br><span class="line">sh -c <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)</span>"</span></span><br><span class="line">vim .zshrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># install Nginx, MySQL, Php</span></span><br><span class="line">wget http://soft.vpser.net/lnmp/lnmp1.5-full.tar.gz</span><br><span class="line">gunzip lnmp1.5-full.tar.gz</span><br><span class="line">tar xf lnmp1.5-full.tar</span><br><span class="line"><span class="built_in">cd</span> lnmp1.5-full</span><br><span class="line">sudo ./install.sh lnmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># install word-press</span></span><br><span class="line">wget https://wordpress.org/latest.zip</span><br><span class="line">unzip latest.zip -d wordpress</span><br><span class="line"></span><br><span class="line"><span class="comment"># set root to be/home/liutao/wordpress</span></span><br><span class="line">sudo vim /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br><span class="line">sudo nginx -s reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 然后本地浏览器打开 http://tao93.top/ 开始设置 WordPress</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># create database named wordpress</span></span><br><span class="line">mysql -u root -p</span><br><span class="line">&gt; create database wordpress</span><br><span class="line"></span><br><span class="line"><span class="comment"># 然后在浏览器中填入刚刚的 database 名字，及其他信息</span></span><br><span class="line"><span class="comment"># 在 server 中的 WordPress 根目录中创建 wp-config.php 并填入浏览器页面显示的内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 找到 nginx 使用的 config 文件</span></span><br><span class="line">sudo nginx -t</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为了解决一些权限问题，www 是 nginx 配置文件中声明的 web server 的 user name</span></span><br><span class="line"><span class="comment"># 这样就把 group 改为了 www，并且 group 用户都有 write 的权限</span></span><br><span class="line">sudo chgrp -R www &lt;root_dir_of_wordpress&gt;</span><br><span class="line">sudo chmod -R g+w &lt;root_dir_of_wordpress&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 另外还在 &lt;root_dir_of_wordpress&gt; 中的 wp-config.php 文件中插入了 define('FS_METHOD','direct'); 这样一行，不知道是不是必要的</span></span><br></pre></td></tr></table></figure>
<p>以上就是最终配置到 WordPress 的过程。之所以配置 WordPress，是因为我查到 WordPress 可以使用 Markdown，另外 WordPress 自带评论功能，插件和主题也非常丰富，所以就先使用 WordPress。结果发现 WordPress 的 Markdown 还需要安装插件才能支持，另外支持也不是很好，比如代码块会把比较长的行转行显示（即不是可以左右滑动），代码行号与高亮都没要。</p>
<p>所以，我还是痛下决心，换回到 hexo。hexo 比较简单，本地安装 hexo 后，在空目录中执行 hexo init 即可生成一堆相关文件，其中的 public 用来存放从当前 theme 和 markdown 文件生成的 static web 文件；而 source 目录用来存放 markdown 文件。简单使用步骤：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in hexo root directory</span></span><br><span class="line">hexo g <span class="comment"># generate static web files</span></span><br><span class="line"></span><br><span class="line">hexo server <span class="comment"># start local web server, then browse http://localhost:4000 to preview web pages</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># copy files in public to server's directory, therefore updated pages can be browsed at http://tao93.top/</span></span><br></pre></td></tr></table></figure>
<p>以上就是简单的用法，不过实际上我做了一些额外工作。例如为了避免 markdown 文件意外丢失，我们需要把它们备份到 server 上，server 和 local 同时丢失的可能性极小。另外，markdown 中插入图片时，可以先把图片放在本地，然后 markdown 中指向图片的本地路径，这样生成的 web 文件会把图片拷贝到 public 目录中某处，然后 html 文件引用 public 目录中的 image，这时的引用其实就是一个 url 了。但是我不是这样做的，我是先把要插入的图片拷贝到 Server 的 public 目录某处，这样就会得到一个指向次图片的 url，然后再 markdown 中直接使用这个 url。这样的话，只要 server 的图片库保持稳定，markdown 文件就不用和本地图片库绑定在一起。同样的，server 的图片库也需要备份到 local，以确保安全。下面就开始介绍以上两点。</p>
<p>首先是本地 source 目录需要备份到 server 上，我的方式是本地 source 目录使用 git 来追踪，然后 server 上简历一个 bare repository source.git，这样本地的每次 commit 都 push 到 server 上的 source.git，就可以作为备份了。相应的本地的 public 目录也要 push 到 server 上的 public.git 这样一个 bare repository，然后在 server 上的 public 中，从 public.git 这个 remote git pull 一下，这样 server 中的 public 就有了最新的 web 文件。</p>
<p>接下来是图片上传到 server 中，为了方便，我写了一个 Python 脚本，用来把本地图片上传到 server，或者把剪贴板的图片 (便于复制图片的情景) 上传到 server，然后将对应的 url 粘贴到剪贴板，这样的话，只需要执行这个 Python 脚本，就可以上传本地图片或者剪贴板上的图片，并把得到的 url 复制到剪贴板，然后就可以直接粘贴到 markdown 中。以下是这个 upload_pic.py 脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> ImageGrab, Image</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">now = datetime.datetime.now()</span><br><span class="line"></span><br><span class="line"><span class="comment"># store image files in date format directory path in server</span></span><br><span class="line">date_path = now.strftime(<span class="string">'%Y/%m/%d'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># use timestamp as image file name in server</span></span><br><span class="line">f_name = str(int(now.timestamp()))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(sys.argv) == <span class="number">1</span>:</span><br><span class="line">    <span class="comment"># get picture in clipboard</span></span><br><span class="line">    im = ImageGrab.grabclipboard()</span><br><span class="line">    <span class="comment"># check whether it's a picture</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(im, Image.Image):</span><br><span class="line">    </span><br><span class="line">        <span class="comment"># file name in server</span></span><br><span class="line">        f_name = str(int(datetime.datetime.now().timestamp())) + <span class="string">'.png'</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># save in local</span></span><br><span class="line">        im.save(f_name)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># the url of the image</span></span><br><span class="line">        url = <span class="string">'http://tao93.top/images/'</span> + date_path + <span class="string">'/'</span> + f_name</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># copy the url to clipboard</span></span><br><span class="line">        os.system(<span class="string">"echo '%s' | pbcopy"</span> % url)</span><br><span class="line">        print(<span class="string">'url has been copied'</span>)</span><br><span class="line">        print(<span class="string">'copying...'</span>)</span><br><span class="line">        dest_path = <span class="string">'/home/liutao/hexo_blog/public/images/'</span> + date_path</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># mkdir in server and copy the image</span></span><br><span class="line">        os.system(<span class="string">"ssh liutao@tao93.top 'mkdir -p "</span> + dest_path + <span class="string">"'"</span>)</span><br><span class="line">        os.system(<span class="string">'scp '</span> + f_name + <span class="string">' liutao@tao93.top:'</span> + dest_path)</span><br><span class="line">        print(<span class="string">'copy finished'</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># remove local image file</span></span><br><span class="line">        os.remove(f_name)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">'clipboard content is not a image!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> len(sys.argv) == <span class="number">2</span>:</span><br><span class="line">    <span class="keyword">if</span> os.path.isfile(sys.argv[<span class="number">1</span>]):</span><br><span class="line">        <span class="comment"># file name in server</span></span><br><span class="line">        f_name = str(int(datetime.datetime.now().timestamp()))</span><br><span class="line">        dot_loc = sys.argv[<span class="number">1</span>].rfind(<span class="string">'.'</span>)</span><br><span class="line">        <span class="keyword">if</span> dot_loc &gt;= <span class="number">0</span>:</span><br><span class="line">            f_name += sys.argv[<span class="number">1</span>][dot_loc:] <span class="comment"># append the file extension</span></span><br><span class="line">        </span><br><span class="line">        url = <span class="string">'http://tao93.top/images/'</span> + date_path + <span class="string">'/'</span> + f_name</span><br><span class="line">        os.system(<span class="string">"echo '%s' | pbcopy"</span> % url)</span><br><span class="line">        print(<span class="string">'url has been copied'</span>)</span><br><span class="line">        print(<span class="string">'copying...'</span>)</span><br><span class="line">        dest_path = <span class="string">'/home/liutao/hexo_blog/public/images/'</span> + date_path</span><br><span class="line">        os.system(<span class="string">"ssh liutao@tao93.top 'mkdir -p "</span> + dest_path + <span class="string">"'"</span>)</span><br><span class="line">        os.system(<span class="string">'scp '</span> + sys.argv[<span class="number">1</span>] + <span class="string">' liutao@tao93.top:'</span> + dest_path + <span class="string">'/'</span> + f_name)</span><br><span class="line">        print(<span class="string">'copy finished'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(sys.argv[<span class="number">1</span>] + <span class="string">' is not a file!'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'too much arguments'</span>)</span><br></pre></td></tr></table></figure>
<p>为了简化步骤，我写了一个 deploy.sh 脚本放在本地 hexo blog 根目录中，这样只需要在 source 目录中编辑 markdown 文件，然后 commit，再调用 deploy.sh 脚本即可。此脚本把其他要做的事情都做了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># into source </span></span><br><span class="line"><span class="built_in">cd</span> <span class="built_in">source</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># make sure it's commited in source directory</span></span><br><span class="line">status=$(git status -s)</span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$status</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="comment"># git push in source</span></span><br><span class="line">    git push</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">'not commited in source directory!'</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># back into parent directory</span></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># generate static web files</span></span><br><span class="line">hexo g</span><br><span class="line"></span><br><span class="line"><span class="comment"># git push in local public directory</span></span><br><span class="line"><span class="built_in">cd</span> public</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">'update web files'</span></span><br><span class="line">git push</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># git pull in server's public directory</span></span><br><span class="line">ssh liutao@tao93.top <span class="string">'cd /home/liutao/hexo_blog/public; git pull'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># git commit in server's images directory</span></span><br><span class="line">ssh liutao@tao93.top <span class="string">'cd /home/liutao/hexo_blog/public/images; git add .; git commit -m "add images"'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># git pull in local's images directory</span></span><br><span class="line"><span class="built_in">cd</span> images</span><br><span class="line">git pull</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'========='</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'Finished!'</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'========='</span></span><br></pre></td></tr></table></figure>
<p>这样上面的脚本就把生成 web 文件，拷贝 public 中的 web 文件拷贝到 server，把 server 中的 image 目录中的信息更新到 local 的 images 目录这样几个事情。</p>
<p>附：</p>
<p>如果要本地 git repo 没有 commit，remote repo 有 commit，现在需要本地的 master 分支 track remote 的 master 分支：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先添加 origin，设置好 url</span></span><br><span class="line">git remote add origin liutao@tao93.top:/home/liutao/hexo_blog/public/images/.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 然后 fetch 一下 远程的状态</span></span><br><span class="line">git fetch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此时如果 git pull --set-upstream-to 是不行的，会说本地 master 分支不存在，而需要下面这样才行</span></span><br><span class="line">git checkout master</span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/Other/">Other</a></div><div class="post-nav"><a class="pre" href="/2018/09/26/常用的 Bash 命令总结/">常用的 Bash 命令总结</a><a class="next" href="/2018/09/26/修车小能手上线/">修车小能手上线</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论（请确保 Disqus 可以正常加载）</button></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'http://tao93.top/2018/09/26/博客系统迁移记录/';
    this.page.identifier = '2018/09/26/博客系统迁移记录/';
    this.page.title = '博客系统迁移记录';
  };</script><script type="text/javascript" id="disqus-lazy-load-script">$.ajax({
url: 'https://disqus.com/next/config.json',
timeout: 2500,
type: 'GET',
success: function(){
  var d = document;
  var s = d.createElement('script');
  s.src = '//liu-tao.disqus.com/embed.js';
  s.setAttribute('data-timestamp', + new Date());
  (d.head || d.body).appendChild(s);
  $('.disqus_click_btn').css('display', 'none');
},
error: function() {
  $('.disqus_click_btn').css('display', 'block');
}
});</script><script type="text/javascript" id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//liu-tao.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script type="text/javascript" id="disqus-count-script">$(function() {
     var xhr = new XMLHttpRequest();
     xhr.open('GET', '//disqus.com/next/config.json', true);
     xhr.timeout = 2500;
     xhr.onreadystatechange = function () {
       if (xhr.readyState === 4 && xhr.status === 200) {
         $('.post-meta .post-comments-count').show();
         var s = document.createElement('script');
         s.id = 'dsq-count-scr';
         s.src = 'https://liu-tao.disqus.com/count.js';
         s.async = true;
         (document.head || document.body).appendChild(s);
       }
     };
     xhr.ontimeout = function () { xhr.abort(); };
     xhr.send(null);
   });
</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/swift/" style="font-size: 15px;">swift</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/macOS/" style="font-size: 15px;">macOS</a> <a href="/tags/Shell/" style="font-size: 15px;">Shell</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/Homebrew/" style="font-size: 15px;">Homebrew</a> <a href="/tags/AOSP/" style="font-size: 15px;">AOSP</a> <a href="/tags/Other/" style="font-size: 15px;">Other</a> <a href="/tags/Bash/" style="font-size: 15px;">Bash</a> <a href="/tags/Algorithm/" style="font-size: 15px;">Algorithm</a> <a href="/tags/adb/" style="font-size: 15px;">adb</a> <a href="/tags/VPS/" style="font-size: 15px;">VPS</a> <a href="/tags/ShadowSocks/" style="font-size: 15px;">ShadowSocks</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/12/04/矩阵运算在 Android 中的简单场景/">矩阵运算在 Android 中的简单场景</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/24/微信 Android 版是如何计步的/">微信 Android 版是如何计步的</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/02/不一样的 RelativeLayout measure 过程/">不一样的 RelativeLayout measure 过程</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/01/一键设置 Android http proxy 的尝试/">一键设置 Android http proxy 的尝试</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/18/注意下面的端口号不一定是 1086/">ShadowSocks for Gradle & Shell</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/10/Don't let Your App Drain your Users' Battery/">Don't let Your App Drain your Users' Battery</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/26/通过 wifi 连接 adb/">通过 wifi 连接 adb</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/26/记一次混淆问题导致的 bug/">记一次混淆问题导致的 bug</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/26/记一个简单的递归问题与解法/">记一个简单的递归问题与解法</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/26/日常修 Bug/">日常修 Bug</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> Recent Comments</i></div><script type="text/javascript" src="//liu-tao.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Liu Tao.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>