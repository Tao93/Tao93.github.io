<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="A blog of Liu Tao"><title>Android 自定义简易 PickerView | Liu Tao</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Android 自定义简易 PickerView</h1><a id="logo" href="/.">Liu Tao</a><p class="description">A little older, a little wiser, but happy to see you.</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Android 自定义简易 PickerView</h1><div class="post-meta">Apr 7, 2019</div><a class="disqus-comment-count" data-disqus-identifier="2019/04/07/Android 自定义简易 PickerView/" href="/2019/04/07/Android 自定义简易 PickerView/#disqus_thread"></a><div class="post-content"><p>最近的做的一项 feature 中，需要使用类似于 iOS 的 UIPickerView 的控件，功能是通过滚动 item 来选择其中一个，也就是下图这样的：</p>
<p><img src="https://tao93.top/images/2019/04/07/1554640301.png" alt=""></p>
<p>Android SDK 倒是有一个 NumberPicker 和这个非常类似，不过 NumberPicker 设计有点问题，滚动很慢，即使是手指快速滑动，也只能滚动五六个 items，而 Github 上确实有不少优秀的实现，可以和 iOS 的 UIPickerView 非常相似，不过其代码有些复杂，以至于想要速读代码然后自己写一份也比较费时间。所以，我就想到自己基于 Android 的 ListView 写一个简单的自定义 PickerView。</p>
<p>既然使用 ListView，那么首先需要解决问题有如下几个：</p>
<ol>
<li>如何让所有 item 都能通过滑动而滚动到视图中间，从而表示该 item 被选中？</li>
<li>如果让 ListView 的 idle 状态变为离散的，而非本来的任意滚动状态都可以为 idle？</li>
<li>怎么获取当前选中的 item 的序号？</li>
</ol>
<p>第一个问题比较好办，在 list 的首尾各填充一些空白的 item，这样就能让用户可见的所有 item 都能滑动到正中间。第二个问题，我的做法是，如果手指离开时，ListView 缓慢滑动，那么就在速度低于某个阈值时，让它滑动到恰好将一些 item 显示出来而不要有某个 item 只显示一部分；而如果手指离开时 ListView 快速滑动，那么就在 ListView 刚刚变为 idle 状态时，让它就近滑动到「恰好将一些 item 显示出来」的状态。第三个问题好办，计算一下当前显示的所有 item 的 position 就能知道最中间显示的 item 的 position。</p>
<p>另外还有一些细节问题：</p>
<ol>
<li>需要在中间绘制上两条灰色水平线；</li>
<li>需要在 canvas 的最上层绘制不是正中间区域绘制半透明矩形，从而让非选中的 item 看起来是灰色的；</li>
<li>点击非选中的 item 时，需要滚动 ListView 让该 item 滑动到正中间。</li>
</ol>
<p>实现的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Adapter interface for &#123;<span class="doctag">@link</span> PickerView&#125; which is like UIPickerView on iOS. </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PickerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="comment">/** get resource id of layout for each item of the picker view. */</span></span><br><span class="line">    <span class="meta">@LayoutRes</span> <span class="function"><span class="keyword">int</span> <span class="title">getItemLayoutResource</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** count of items in the picker view. */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** text string for the item at the specified position. */</span></span><br><span class="line">    <span class="function">String <span class="title">getItemAt</span><span class="params">(<span class="keyword">int</span> pos)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A view to let users to choose one item from a list, like UIPickerView on iOS.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PickerView</span> <span class="keyword">extends</span> <span class="title">FrameLayout</span> </span>&#123;</span><br><span class="line">    <span class="comment">/** the listView which is used to implement this PickerView */</span></span><br><span class="line">    <span class="keyword">private</span> ListView listView;</span><br><span class="line">    <span class="comment">/** the count of visible items, must be odd numbers, the middle item would be the the selected one. */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> visibleCount = <span class="number">5</span>; <span class="comment">// 5 items visible by default</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> itemHeight;</span><br><span class="line"></span><br><span class="line">    Paint dividerLinePaint;</span><br><span class="line">    Paint greyLayerPaint;</span><br><span class="line">    <span class="comment">/** adapter for this pickerView */</span></span><br><span class="line">    PickerAdapter adapter;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> dividerThickness;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> dividerMarginLeft;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> dividerMarginRight;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> velocityThreshold;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> VelocityTracker velocityTracker = VelocityTracker.obtain();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PickerView</span><span class="params">(@NonNull Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PickerView</span><span class="params">(@NonNull Context context, @Nullable AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PickerView</span><span class="params">(@NonNull Context context, @Nullable AttributeSet attrs, <span class="keyword">final</span> <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        setWillNotDraw(<span class="keyword">false</span>);</span><br><span class="line">        </span><br><span class="line">        itemHeight = getResources().getDimension(R.dimen.picker_view_item_height);</span><br><span class="line">        velocityThreshold = getResources().getDisplayMetrics().density * <span class="number">260</span>;</span><br><span class="line">        </span><br><span class="line">        TypedArray ta = context.obtainStyledAttributes(attrs, R.styleable.PickerView);</span><br><span class="line">        dividerThickness = ta.getDimension(R.styleable.PickerView_divider_thickness, getResources().getDisplayMetrics().density);</span><br><span class="line">        dividerMarginLeft = ta.getDimension(R.styleable.PickerView_divider_margin_left, <span class="number">0</span>);</span><br><span class="line">        dividerMarginRight = ta.getDimension(R.styleable.PickerView_divider_margin_right, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">int</span> dividerColor = ta.getColor(R.styleable.PickerView_divider_color, Color.LTGRAY);</span><br><span class="line">        ta.recycle();</span><br><span class="line"></span><br><span class="line">        dividerLinePaint = <span class="keyword">new</span> Paint();</span><br><span class="line">        dividerLinePaint.setColor(dividerColor);</span><br><span class="line">        dividerLinePaint.setStyle(Paint.Style.STROKE);</span><br><span class="line">        dividerLinePaint.setStrokeWidth(dividerThickness);</span><br><span class="line">        greyLayerPaint = <span class="keyword">new</span> Paint();</span><br><span class="line">        greyLayerPaint.setColor(<span class="number">0xb0ffffff</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAdapter</span><span class="params">(PickerAdapter adapter)</span> </span>&#123;</span><br><span class="line">        setAdapter(adapter, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAdapter</span><span class="params">(PickerAdapter adapter, <span class="keyword">int</span> initPos)</span> </span>&#123;</span><br><span class="line">        setAdapter(adapter, <span class="number">0</span>, initPos);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * set adapter and other two parameters.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> visibleCount count of visible items in the picker, must be odd numbers. </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> initPos position of the initially selected item, 0 means the first item would be selected.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAdapter</span><span class="params">(PickerAdapter adapter, <span class="keyword">int</span> visibleCount, <span class="keyword">int</span> initPos)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (adapter.getItemCount() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (visibleCount &gt; <span class="number">0</span> &amp;&amp; visibleCount % <span class="number">2</span> != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.visibleCount = visibleCount;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.adapter = adapter;</span><br><span class="line"></span><br><span class="line">        listView = <span class="keyword">new</span> ListView(getContext());</span><br><span class="line">        addView(listView, <span class="keyword">new</span> LinearLayout.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, (<span class="keyword">int</span>) (itemHeight * <span class="keyword">this</span>.visibleCount)));</span><br><span class="line">        listView.setOverScrollMode(View.OVER_SCROLL_NEVER);  <span class="comment">// remove over scroll effects.</span></span><br><span class="line">        listView.setVerticalScrollBarEnabled(<span class="keyword">false</span>);</span><br><span class="line">        listView.setDivider(<span class="keyword">null</span>);  <span class="comment">// remove listView's dividers</span></span><br><span class="line"></span><br><span class="line">        listView.setOnScrollListener(<span class="keyword">new</span> AbsListView.OnScrollListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScrollStateChanged</span><span class="params">(AbsListView view, <span class="keyword">int</span> scrollState)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (scrollState == AbsListView.OnScrollListener.SCROLL_STATE_IDLE) &#123;</span><br><span class="line">                    <span class="comment">// scroll to nearest place that fit the selection properly.</span></span><br><span class="line">                    scrollToNearest();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScroll</span><span class="params">(AbsListView view, <span class="keyword">int</span> firstVisibleItem, <span class="keyword">int</span> visibleItemCount, <span class="keyword">int</span> totalItemCount)</span> </span>&#123; &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        listView.setAdapter(<span class="keyword">new</span> InnerAdapter());</span><br><span class="line">        <span class="keyword">if</span> (initPos &gt; <span class="number">0</span> &amp;&amp; initPos &lt; adapter.getItemCount()) &#123;</span><br><span class="line">            listView.setSelection(initPos);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the position of the currently selected item, starting from 0.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSelectedPosition</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        listView.getFirstVisiblePosition();</span><br><span class="line">        View firstChild = listView.getChildAt(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (Math.abs(firstChild.getTop()) &lt; firstChild.getHeight() / <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> listView.getFirstVisiblePosition();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> listView.getFirstVisiblePosition() + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> superResult = <span class="keyword">super</span>.dispatchTouchEvent(ev);</span><br><span class="line">        </span><br><span class="line">        velocityTracker.addMovement(ev);</span><br><span class="line">        <span class="keyword">if</span> (ev.getActionMasked() == MotionEvent.ACTION_UP) &#123;</span><br><span class="line">            velocityTracker.computeCurrentVelocity(<span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">float</span> yVelocity = velocityTracker.getYVelocity();</span><br><span class="line">            <span class="comment">// scroll to nearest proper place directly if the fling is very slow</span></span><br><span class="line">            <span class="keyword">if</span> (Math.abs(yVelocity) &lt; velocityThreshold) &#123;</span><br><span class="line">                scrollToNearest();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> superResult;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** scroll the listView to fit the nearest proper position */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scrollToNearest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        View firstChild = listView.getChildAt(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (Math.abs(firstChild.getTop()) &gt; Math.abs(firstChild.getBottom())) &#123;</span><br><span class="line">            listView.smoothScrollToPosition(listView.getLastVisiblePosition());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            listView.smoothScrollToPosition(listView.getFirstVisiblePosition());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDetachedFromWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        velocityTracker.recycle();</span><br><span class="line">        <span class="keyword">super</span>.onDetachedFromWindow();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.draw(canvas);</span><br><span class="line">        <span class="comment">//canvas.drawRect(0, itemHeight * 2, getWidth(), itemHeight * 3, dividerLinePaint);</span></span><br><span class="line">        canvas.drawLine(dividerMarginLeft, itemHeight * <span class="number">2</span> - dividerThickness, </span><br><span class="line">                getWidth() - dividerMarginRight, itemHeight * <span class="number">2</span> - dividerThickness, dividerLinePaint);</span><br><span class="line">        canvas.drawLine(dividerMarginLeft, itemHeight * <span class="number">3</span> + dividerThickness, </span><br><span class="line">                getWidth() - dividerMarginRight, itemHeight * <span class="number">3</span> + dividerThickness, dividerLinePaint);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// draw two transparent rectangles to make not selected items looks grey</span></span><br><span class="line">        canvas.drawRect(<span class="number">0</span>, <span class="number">0</span>, getWidth(), itemHeight * <span class="number">2</span> - dividerThickness, greyLayerPaint);</span><br><span class="line">        canvas.drawRect(<span class="number">0</span>, getHeight() - <span class="number">2</span> * itemHeight + dividerThickness, getWidth(), getBottom(), greyLayerPaint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * the adapter for the listView</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">InnerAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="comment">// we would add visibleCount - 1 empty strings to the list View, so the count should plus visibleCount - 1.</span></span><br><span class="line">            <span class="keyword">return</span> adapter.getItemCount() + visibleCount - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// there're visibleCount - 1 items with empty text, they would be equally put at the starting and ending.</span></span><br><span class="line">            <span class="keyword">if</span> (position &lt; visibleCount / <span class="number">2</span> || position &gt;= getCount() - visibleCount / <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> adapter.getItemAt(position - visibleCount / <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getItemId</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> position;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (convertView == <span class="keyword">null</span>) &#123;</span><br><span class="line">                convertView = View.inflate(getContext(), adapter.getItemLayoutResource(), <span class="keyword">null</span>);</span><br><span class="line">                convertView.setBackgroundColor(Color.WHITE); <span class="comment">// to avoid the default touch effect of listView item</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// select a item when it's clicked by users</span></span><br><span class="line">            convertView.setOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">int</span> cur = getSelectedPosition() + visibleCount / <span class="number">2</span>;</span><br><span class="line">                    <span class="keyword">if</span> (position &gt; cur) &#123;</span><br><span class="line">                        listView.smoothScrollToPosition(position + visibleCount / <span class="number">2</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (position &lt; cur) &#123;</span><br><span class="line">                        listView.smoothScrollToPosition(position - visibleCount / <span class="number">2</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            TextView textView = convertView.findViewById(R.id.picker_text_view);</span><br><span class="line">            textView.setText((String) getItem(position));</span><br><span class="line">            <span class="keyword">return</span> convertView;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还有一些小细节。比如 ListView 的高度需要正好是 itemView 的奇数倍，这样才能恰好只显示一些 item，并且最中间显示其中一个 item。再比如为了避免 ListView 自带的点击 item 时的视觉效果，需要给 itemView 设置纯白色背景。</p>
<p>至此，一个简易的 PickerView 就完成了。</p>
</div><div class="tags"><a href="/tags/Android/">Android</a></div><div class="post-nav"><a class="next" href="/2019/01/18/一个不一样的 ANR/">一个不一样的 ANR</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论（请确保 Disqus 可以正常加载）</button></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'https://tao93.top/2019/04/07/Android 自定义简易 PickerView/';
    this.page.identifier = '2019/04/07/Android 自定义简易 PickerView/';
    this.page.title = 'Android 自定义简易 PickerView';
  };</script><script type="text/javascript" id="disqus-lazy-load-script">$.ajax({
url: 'https://disqus.com/next/config.json',
timeout: 2500,
type: 'GET',
success: function(){
  var d = document;
  var s = d.createElement('script');
  s.src = '//liu-tao.disqus.com/embed.js';
  s.setAttribute('data-timestamp', + new Date());
  (d.head || d.body).appendChild(s);
  $('.disqus_click_btn').css('display', 'none');
},
error: function() {
  $('.disqus_click_btn').css('display', 'block');
}
});</script><script type="text/javascript" id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//liu-tao.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script type="text/javascript" id="disqus-count-script">$(function() {
     var xhr = new XMLHttpRequest();
     xhr.open('GET', '//disqus.com/next/config.json', true);
     xhr.timeout = 2500;
     xhr.onreadystatechange = function () {
       if (xhr.readyState === 4 && xhr.status === 200) {
         $('.post-meta .post-comments-count').show();
         var s = document.createElement('script');
         s.id = 'dsq-count-scr';
         s.src = 'https://liu-tao.disqus.com/count.js';
         s.async = true;
         (document.head || document.body).appendChild(s);
       }
     };
     xhr.ontimeout = function () { xhr.abort(); };
     xhr.send(null);
   });
</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Bash/" style="font-size: 15px;">Bash</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/Shell/" style="font-size: 15px;">Shell</a> <a href="/tags/macOS/" style="font-size: 15px;">macOS</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/AOSP/" style="font-size: 15px;">AOSP</a> <a href="/tags/swift/" style="font-size: 15px;">swift</a> <a href="/tags/Other/" style="font-size: 15px;">Other</a> <a href="/tags/Homebrew/" style="font-size: 15px;">Homebrew</a> <a href="/tags/ShadowSocks/" style="font-size: 15px;">ShadowSocks</a> <a href="/tags/Algorithm/" style="font-size: 15px;">Algorithm</a> <a href="/tags/adb/" style="font-size: 15px;">adb</a> <a href="/tags/VPS/" style="font-size: 15px;">VPS</a> <a href="/tags/Firmware/" style="font-size: 15px;">Firmware</a> <a href="/tags/Samsung/" style="font-size: 15px;">Samsung</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/GSI/" style="font-size: 15px;">GSI</a> <a href="/tags/Project-Treble/" style="font-size: 15px;">Project Treble</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/04/07/Android 自定义简易 PickerView/">Android 自定义简易 PickerView</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/18/一个不一样的 ANR/">一个不一样的 ANR</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/12/Android 绘制圆形图片/">Android 绘制圆形图片</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/01/给三星 tablet SM-T830 刷机[续]/">给三星 tablet SM-T830 刷机[续]</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/22/Android Toast 两个 Crash/">Android Toast 两个 Crash</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/22/Java Comparable Contracts/">Java Comparable Contracts</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/08/Flash stock firmware in SM-T830/">给三星 tablet SM-T830 刷机</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/04/矩阵运算在 Android 中的简单场景/">矩阵运算在 Android 中的简单场景</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/24/微信 Android 版是如何计步的/">微信 Android 版是如何计步的</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/02/不一样的 RelativeLayout measure 过程/">不一样的 RelativeLayout measure 过程</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> Recent Comments</i></div><script type="text/javascript" src="//liu-tao.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">Liu Tao.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>