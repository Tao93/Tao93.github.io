<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Liu Tao</title>
  
  <subtitle>A little older, a little wiser, but happy to see you.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://tao93.top/"/>
  <updated>2019-11-06T20:45:34.327Z</updated>
  <id>https://tao93.top/</id>
  
  <author>
    <name>Liu Tao</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Kotlin Summary</title>
    <link href="https://tao93.top/2019/11/04/Kotlin%20Summary/"/>
    <id>https://tao93.top/2019/11/04/Kotlin Summary/</id>
    <published>2019-11-04T16:44:56.826Z</published>
    <updated>2019-11-06T20:45:34.327Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-Before-all"><a href="#1-Before-all" class="headerlink" title="1. Before all"></a>1. Before all</h3><h4 id="Whatâ€™s-Kotlin"><a href="#Whatâ€™s-Kotlin" class="headerlink" title="Whatâ€™s Kotlin"></a>Whatâ€™s Kotlin</h4><ol><li>By Jetbrains which created Intellij IDEA</li><li>Targeting JVM and more, interoperate with Java</li><li>Concise and safe, with many modern features</li></ol><h4 id="the-REPL-read-evaluate-print-loop"><a href="#the-REPL-read-evaluate-print-loop" class="headerlink" title="the REPL(read, evaluate, print, loop)"></a>the REPL(read, evaluate, print, loop)</h4><p>Install Kotlin commandline tools in macOS:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install kotlin</span><br></pre></td></tr></table></figure><p>Execute <code>kotlinc</code> to start REPL</p><p><img src="http://tao93.top/images/2019/11/05/1572994981.png" alt=""></p><h3 id="2-Types"><a href="#2-Types" class="headerlink" title="2. Types"></a>2. Types</h3><h4 id="Built-in-types"><a href="#Built-in-types" class="headerlink" title="Built-in types"></a>Built-in types</h4><p><code>String, Char, Boolean, Int, Double, List&lt;T&gt;, Set&lt;T&gt;, Map&lt;K, V&gt;, Array&lt;T&gt;</code></p><p>Not like Java, Kotlin has no primitives (int, float etc.) hence avoids the boxing between primitives and objects. </p><p>However, in byte code generated by Kotlin, primitives are used to improve performance.</p><h3 id="3-Conditionals"><a href="#3-Conditionals" class="headerlink" title="3. Conditionals"></a>3. Conditionals</h3><h4 id="Conditional-operators"><a href="#Conditional-operators" class="headerlink" title="Conditional operators"></a>Conditional operators</h4><div class="table-container"><table><thead><tr><th style="text-align:center">Operator</th><th style="text-align:center">Description</th></tr></thead><tbody><tr><td style="text-align:center">&lt;</td><td style="text-align:center">Evaluates whether the value on the left is less than the value on the right.</td></tr><tr><td style="text-align:center">&lt;=</td><td style="text-align:center">Evaluates whether the value on the left is less than or equal to the value on the right.</td></tr><tr><td style="text-align:center">&gt;</td><td style="text-align:center">Evaluates whether the value on the left is greater than the value on the right.</td></tr><tr><td style="text-align:center">&gt;=</td><td style="text-align:center">Evaluates whether the value on the left is greater than or equal to the value on the right.</td></tr><tr><td style="text-align:center">==</td><td style="text-align:center">Evaluates whether the value on the left is equal to the value on the right (like equals in Java).</td></tr><tr><td style="text-align:center">!=</td><td style="text-align:center">Evaluates whether the value on the left is not equal to the value on the right.</td></tr><tr><td style="text-align:center">===</td><td style="text-align:center">Evaluates whether the two instances point to the same reference (like == in Java).</td></tr><tr><td style="text-align:center">!==</td><td style="text-align:center">Evaluates whether the two instances do not point to the same reference.</td></tr></tbody></table></div><h3 id="4-Functions"><a href="#4-Functions" class="headerlink" title="4. Functions"></a>4. Functions</h3><h4 id="Kotlin-supports-file-level-functions"><a href="#Kotlin-supports-file-level-functions" class="headerlink" title="Kotlin supports file level functions"></a>Kotlin supports file level functions</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    println(fileLevelFunc())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">fileLevelFunc</span><span class="params">()</span></span> = <span class="string">"file level"</span> <span class="comment">// expression function</span></span><br></pre></td></tr></table></figure><h4 id="Default-value-of-parameters"><a href="#Default-value-of-parameters" class="headerlink" title="Default value of parameters"></a>Default value of parameters</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    greeting(<span class="string">"Earth"</span>) <span class="comment">// default value for 2nd parameter</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">greeting</span><span class="params">(name: <span class="type">String</span>, greeting: <span class="type">String</span> = <span class="string">"good morning"</span>)</span></span> &#123;</span><br><span class="line">    println(<span class="string">"<span class="subst">$&#123;greeting.capitalize()&#125;</span>! <span class="variable">$name</span>."</span>) <span class="comment">// e.g. Good morning! Saturn.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Named-function-parameters"><a href="#Named-function-parameters" class="headerlink" title="Named function parameters"></a>Named function parameters</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    greeting(greeting = <span class="string">"Hello"</span>, name = <span class="string">"Earth"</span>) <span class="comment">// named parameters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">greeting</span><span class="params">(name: <span class="type">String</span>, greeting: <span class="type">String</span> = <span class="string">"good morning"</span>)</span></span> &#123;</span><br><span class="line">    println(<span class="string">"<span class="subst">$&#123;greeting.capitalize()&#125;</span>! <span class="variable">$name</span>."</span>) <span class="comment">// e.g. Good morning! Saturn.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Function-names-in-backticks"><a href="#Function-names-in-backticks" class="headerlink" title="Function names in backticks"></a>Function names in backticks</h4><p>Itâ€™s said this is useful to call Java methods whose names are reserved words in Kotlin, or to name some special methods.</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> `ðŸ˜‚`<span class="params">()</span></span> &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    `ðŸ˜‚`() <span class="comment">// call a function</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Inline-functions"><a href="#Inline-functions" class="headerlink" title="Inline functions"></a>Inline functions</h4><p>Kotlin support inline functions, which is good for performance.</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">factorial</span><span class="params">(n: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">if</span> (n &gt; <span class="number">2</span>) &#123;</span><br><span class="line">        n * factorial(n - <span class="number">1</span>)  <span class="comment">// wrong, recursion is not allowed for inline functions</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        n</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-Anonymous-functions"><a href="#5-Anonymous-functions" class="headerlink" title="5. Anonymous functions"></a>5. Anonymous functions</h3><p>An example of anoymous function:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> numLetters = <span class="string">"Mississippi"</span>.count(&#123; letter -&gt;</span><br><span class="line">    letter == <span class="string">'s'</span></span><br><span class="line">&#125;)</span><br><span class="line">print(numLetters) <span class="comment">// would Prints 4</span></span><br></pre></td></tr></table></figure><p>The complete structure of an anoymous function should be like:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> funcVariable: (ParamType1, ParamType2) -&gt; ReturnType = </span><br><span class="line">&#123; param1: ParamType1, param2: ParamType2 -&gt;</span><br><span class="line">...</span><br><span class="line">expression_to_be_returned <span class="comment">// no return keyword, just put the expression here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Parameter types are usually omitted when they caould be inferred. Single parameterâ€™s name could be omitted if its type could ba inferred, and we take <code>it</code> as the parameter name. Unused parameter name could be marked as <strong><code>_</code></strong>.</p><p>Examples:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> numLetters = <span class="string">"Mississippi"</span>.count(&#123;</span><br><span class="line">    it == <span class="string">'s'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> afterFilter = <span class="string">"Mississippi"</span>.filterIndexed(&#123; _, char-&gt;</span><br><span class="line">    char != <span class="string">'s'</span></span><br><span class="line">&#125;)</span><br><span class="line">print(afterFilter) <span class="comment">// prints Miiippi</span></span><br></pre></td></tr></table></figure><p><strong><em>Note</em></strong>: an anonymous function must be called immediately, assigned to a variable, or be passed as a parameter.</p><p>Anonymous functions as parameter is often in a different style when it is required as the <strong>last</strong> parameter in another function:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// count starting from a specified index.</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">count</span><span class="params">(str: <span class="type">String</span>, startIdx: <span class="type">Int</span>, predicate: (<span class="type">Char</span>)</span></span> -&gt; <span class="built_in">Boolean</span>): <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> str.substring(startIdx).count(predicate)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// style 1</span></span><br><span class="line">count(<span class="string">"Mississippi"</span>, <span class="number">5</span>, &#123;</span><br><span class="line">    it == <span class="string">'s'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// style 2, looks like definition of count, but actually it's anonymous function as parameter</span></span><br><span class="line">count(<span class="string">"Mississippi"</span>, <span class="number">5</span>) &#123;</span><br><span class="line">    it == <span class="string">'s'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Want to declare a function type that returns something like <code>void</code> in Java? You need the <code>Unit</code>.</p><p>You can also refer a non anonymous function as parameter in call to another function by using <code>::</code>. But I donâ€™t think this is common.</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">isS</span><span class="params">(char: <span class="type">Char</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> char == <span class="string">'s'</span></span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">val</span> numLetters = <span class="string">"Mississippi"</span>.count(::isS)</span><br></pre></td></tr></table></figure><h3 id="6-Null-Safety-and-Exceptions"><a href="#6-Null-Safety-and-Exceptions" class="headerlink" title="6. Null Safety and Exceptions"></a>6. Null Safety and Exceptions</h3><p>For nullable variables, there are some common solutions to handle potential null pointer exceptions.</p><p><strong>Safe call operator</strong>:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> beverage = readLine()?.capitalize() <span class="comment">// the type of beverage would be String?.</span></span><br></pre></td></tr></table></figure><p><strong>Nonnull assertion</strong>:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> beverage = readLine()!!.capitalize() <span class="comment">// your responsibility to avoid null pointer exception</span></span><br></pre></td></tr></table></figure><p><strong>Check before use</strong>:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> result = readLine()</span><br><span class="line"><span class="keyword">var</span> beverage = <span class="keyword">if</span> (result != <span class="literal">null</span>) &#123; <span class="comment">// type of beverage would be String.</span></span><br><span class="line">    result.capitalize() + result.toLowerCase()</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="string">""</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>However, check before use isnâ€™t always safe, e.g. a field of an object might be assigned null between your null checking and usage of the field. For such case, you would need a local variable to get rid of this risk:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> localVar = a.b</span><br><span class="line"><span class="keyword">if</span> (localVar != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// do something refers a.b</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Elvis operator</strong>:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> beverage = readLine()?.capitalize() ?: <span class="string">""</span>  <span class="comment">// type of beverage would be String.</span></span><br></pre></td></tr></table></figure><h4 id="Exceptions-in-Kotlin"><a href="#Exceptions-in-Kotlin" class="headerlink" title="Exceptions in Kotlin"></a>Exceptions in Kotlin</h4><p>Kotlin doesnâ€™t require handling of those checked Exceptions of Java. Therefore you can do IO operations without try-catch and exception declaration in the method signature.</p><h3 id="7-Collections"><a href="#7-Collections" class="headerlink" title="7. Collections"></a>7. Collections</h3><h4 id="destructuring"><a href="#destructuring" class="headerlink" title="destructuring"></a>destructuring</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> (type, name, price) = aList  <span class="comment">// fetch the leading 3 elements from a list.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> (type, _, price) = aList <span class="comment">// skip elements in specified indexes.</span></span><br></pre></td></tr></table></figure><h4 id="protection-of-immutable-list-is-not-valid-at-runtime"><a href="#protection-of-immutable-list-is-not-valid-at-runtime" class="headerlink" title="protection of immutable list is not valid at runtime"></a>protection of immutable list is not valid at runtime</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> a = listOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">(a <span class="keyword">as</span> MutableList&lt;<span class="built_in">Int</span>&gt;).<span class="keyword">set</span>(<span class="number">0</span>, <span class="number">100</span>)</span><br><span class="line">println(a) <span class="comment">// would print [100, 2, 3]</span></span><br></pre></td></tr></table></figure><h3 id="8-Class-definition"><a href="#8-Class-definition" class="headerlink" title="8. Class definition"></a>8. Class definition</h3><h4 id="Visibility-modifiers-of-class-members"><a href="#Visibility-modifiers-of-class-members" class="headerlink" title="Visibility modifiers of class members"></a>Visibility modifiers of class members</h4><div class="table-container"><table><thead><tr><th style="text-align:center">Modifier</th><th style="text-align:center">Description</th></tr></thead><tbody><tr><td style="text-align:center">public (default)</td><td style="text-align:center">The function or property will be accessible by code outside of the class. By default, functions and properties without a visibility modifier are public.</td></tr><tr><td style="text-align:center">private</td><td style="text-align:center">The function or property will be accessible only within the same class.</td></tr><tr><td style="text-align:center">protected</td><td style="text-align:center">The function or property will be accessible only within the same class or its subclass.</td></tr><tr><td style="text-align:center">internal</td><td style="text-align:center">The function or property will be accessible within the same module.</td></tr></tbody></table></div><h4 id="Class-fields"><a href="#Class-fields" class="headerlink" title="Class fields"></a>Class fields</h4><p>For class fields, default <code>getter</code> is available for <code>val</code> and <code>var</code> fields. But <code>setter</code> is only for <code>var</code> fields. Yet we can override the default <code>setter</code> and <code>getter</code>:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span></span>(_name: String, _age: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// a field always return capitalized string when you get it</span></span><br><span class="line">    <span class="keyword">val</span> name = _name</span><br><span class="line">        <span class="keyword">get</span>() = field.capitalize()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// a field only allows increasing</span></span><br><span class="line">    <span class="keyword">var</span> age = _age</span><br><span class="line">        <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            <span class="keyword">if</span> (value &gt; field) &#123;</span><br><span class="line">                field = value</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>You can override the visibility of a setter to make it less permissive then fieldâ€™s visibility. E.g., you want to make a field readable everywhere but only writable in the file:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span></span>(_age: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="comment">// a field only allows increasing in current file.</span></span><br><span class="line">    <span class="keyword">var</span> age = _age</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            <span class="keyword">if</span> (value &gt; field) &#123;</span><br><span class="line">                field = value</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Computed-fields"><a href="#Computed-fields" class="headerlink" title="Computed fields"></a>Computed fields</h4><p>Has getter or/and setter but no real fields to store values.</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dice</span></span>() &#123;</span><br><span class="line">    <span class="keyword">val</span> rolledValue</span><br><span class="line">        <span class="keyword">get</span>() = (<span class="number">1.</span><span class="number">.6</span>).shuffled().first()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-Object-initialization"><a href="#9-Object-initialization" class="headerlink" title="9. Object initialization"></a>9. Object initialization</h3><h4 id="The-primary-contructor"><a href="#The-primary-contructor" class="headerlink" title="The primary contructor"></a>The primary contructor</h4><p>Add parameter list inside a pair of parenthesis after the class name, make it looks like a method. For fields <strong>with default getter and setter</strong>, you can declare them inside the parameter list by adding <code>var</code> or <code>val</code>:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// visibility modifier and default values are also available</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span></span>(<span class="keyword">val</span> name: String, <span class="keyword">private</span> <span class="keyword">var</span> age: <span class="built_in">Int</span> = <span class="number">0</span>)</span><br></pre></td></tr></table></figure><h4 id="secondary-constructor"><a href="#secondary-constructor" class="headerlink" title="secondary constructor"></a>secondary constructor</h4><p>Must call the primary constructor or another secondary constructor(of course no cycle call)</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span></span>(<span class="keyword">val</span> name: String, <span class="keyword">private</span> <span class="keyword">var</span> age: <span class="built_in">Int</span> = <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(): <span class="keyword">this</span>(<span class="string">"Unknown"</span>)  <span class="comment">// call primary constructor with default parameter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Apart from default parameter values, named parameters are also available for constructors.</p><h4 id="Lazy-initialization"><a href="#Lazy-initialization" class="headerlink" title="Lazy initialization"></a>Lazy initialization</h4><p>Only initialize a field when itâ€™s accessed (by the getter)</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span> </span>&#123;</span><br><span class="line">    <span class="keyword">val</span> number: <span class="built_in">Int</span> <span class="keyword">by</span> lazy &#123;</span><br><span class="line">        (<span class="number">0</span> until <span class="number">10</span>).shuffled().first()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-Inheritance"><a href="#10-Inheritance" class="headerlink" title="10. Inheritance"></a>10. Inheritance</h3><p>In Java, we only override methods. But in Kotlin, both class functions and fields could be overridden. Also, in Kotlin, classes, functions and fields must be marked <code>open</code> explicity to make them inheritable or able to be overridden. </p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Room</span></span>(<span class="keyword">val</span> name: String) &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">open</span> <span class="keyword">val</span> dangerLevel = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">description</span><span class="params">()</span></span> = <span class="string">"Room: <span class="variable">$name</span>\n"</span> +</span><br><span class="line">            <span class="string">"Danger level: <span class="variable">$dangerLevel</span>"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">load</span><span class="params">()</span></span> = <span class="string">"Nothing much to see here..."</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TownSquare</span> : <span class="type">Room</span></span>(<span class="string">"Town Square"</span>) &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> dangerLevel = <span class="keyword">super</span>.dangerLevel - <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">load</span><span class="params">()</span></span> = <span class="string">"The villagers rally and cheer as you enter!"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Functions are final by default unless they are inherited from an open class. To prevent inherited functions from being overriden again, we can mark it <code>final</code>.</p><p>In Kotlinâ€™s inheritance, we always have:</p><p><img src="http://tao93.top/images/2019/11/05/1572968935.png" alt=""></p><p>However, when compiled into bytecode, the class Room doesnâ€™t inherits the class Any in JVM rule.</p><h3 id="11-Objects"><a href="#11-Objects" class="headerlink" title="11. Objects"></a>11. Objects</h3><h4 id="singleton-by-object-keyword"><a href="#singleton-by-object-keyword" class="headerlink" title="singleton by object keyword"></a>singleton by <code>object</code> keyword</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    UserManager.getUser(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// constructors are not allowed for such objects</span></span><br><span class="line"><span class="keyword">object</span> UserManager &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> users = mutableListOf&lt;String&gt;(<span class="string">"A"</span>, <span class="string">"B"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getUser</span><span class="params">(idx: <span class="type">Int</span>)</span></span>: String? &#123;</span><br><span class="line">        <span class="keyword">return</span> users.getOrNull(idx)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Anonymous-inner-class"><a href="#Anonymous-inner-class" class="headerlink" title="Anonymous inner class"></a>Anonymous inner class</h4><p>In java, we often implement interfaces or extend simple classes as anonymous inner class, such as click listeners and view adapters.</p><p>In Kotlin, they could be divided into 2 categories. For interfaces with only one method and declared in Java, we can use a format called Lambda:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">generateButton.setOnClickListener &#123; view -&gt;</span><br><span class="line">    fetchData()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">useI</span><span class="params">(i: <span class="type">I</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">useI(I &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// I.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">I</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>For other cases, the format is like this:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">listView.adapter = <span class="keyword">object</span> : BaseAdapter() &#123;  <span class="comment">// call the constructor here.</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getView</span><span class="params">(pos: <span class="type">Int</span>, view: <span class="type">View</span>?, parent: <span class="type">ViewGroup</span>?)</span></span>: View &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getItem</span><span class="params">(pos: <span class="type">Int</span>)</span></span>: Any &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getItemId</span><span class="params">(pos: <span class="type">Int</span>)</span></span>: <span class="built_in">Long</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getCount</span><span class="params">()</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Nested classes by default cannot access members of the outer class, unless they are marked inner:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">outerFunc</span><span class="params">()</span></span> = <span class="string">"1"</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Nested</span> </span>&#123;</span><br><span class="line">        init &#123;</span><br><span class="line">            outerFunc()  <span class="comment">// wrong, unable to access</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    inner <span class="class"><span class="keyword">class</span> <span class="title">Inner</span> </span>&#123;</span><br><span class="line">        init &#123;</span><br><span class="line">            outerFunc()  <span class="comment">// ok</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">object</span> UserManager &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> users = mutableListOf&lt;String&gt;(<span class="string">"A"</span>, <span class="string">"B"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">        init &#123;</span><br><span class="line">            users <span class="comment">// ok. this is nested class inside an object class.</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Data-classes"><a href="#Data-classes" class="headerlink" title="Data classes"></a>Data classes</h4><p>Data classes are suitable for model, thatâ€™s what the <code>data</code> means.</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Coordinate</span></span>(<span class="keyword">var</span> x: <span class="built_in">Int</span>, <span class="keyword">var</span> y: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> inFirstQuadrant = (x &gt;<span class="number">0</span> &amp;&amp; y &gt; <span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Characteristics of the data classes:</p><ul><li><p>Implementation of <code>toString</code>, <code>equal</code> and <code>copy</code> regarding the fields declared in the primary constructor;</p></li><li><p>Must have a primary constructor whose all parameters are marked with <code>val</code> or <code>var</code>;</p></li><li><p>Cannot be <code>abstract</code>, <code>open</code>, or <code>inner</code>.</p></li></ul><h4 id="Operator-overloading"><a href="#Operator-overloading" class="headerlink" title="Operator overloading"></a>Operator overloading</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Coordinate</span></span>(<span class="keyword">var</span> x: <span class="built_in">Int</span>, <span class="keyword">var</span> y: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">plusAssign</span><span class="params">(another: <span class="type">Coordinate</span>)</span></span> &#123;</span><br><span class="line">        x += another.x</span><br><span class="line">        y += another.y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> coo = Coordinate(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">coo += Coordinate(<span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure><h3 id="12-Generics"><a href="#12-Generics" class="headerlink" title="12 Generics"></a>12 Generics</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span></span>(<span class="keyword">val</span> name: String)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Novel</span></span>(name: String): Book(name)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Textbook</span></span>(name: String): Book(name)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bookshelf</span>&lt;<span class="type">T: Book</span>&gt;</span>(<span class="keyword">vararg</span> <span class="keyword">val</span> books: T)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> shelf1 = Bookshelf(Novel(<span class="string">"A song of Ice &amp; Fire"</span>), Novel(<span class="string">"The load of the rings"</span>))</span><br><span class="line"><span class="keyword">val</span> shelf2 = Bookshelf(Novel(<span class="string">"A song of Ice &amp; Fire"</span>), Textbook(<span class="string">"Introduction to Algorithms"</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T: CharSequence&gt;</span> <span class="title">count</span><span class="params">(cs: <span class="type">T</span>, startIdx: <span class="type">Int</span>, char: <span class="type">Char</span>)</span></span> =</span><br><span class="line">    cs.substring(startIdx).count &#123;</span><br><span class="line">        it == char</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> list1: List&lt;Book&gt; = listOf&lt;Novel&gt;(Novel(<span class="string">"A"</span>), Novel(<span class="string">"B"</span>))</span><br><span class="line"><span class="keyword">val</span> list2: MutableList&lt;Book&gt; = mutableListOf&lt;Novel&gt;(Novel(<span class="string">"A"</span>), Novel(<span class="string">"B"</span>)) <span class="comment">// wrong</span></span><br></pre></td></tr></table></figure><p>Actually the <code>List</code> interface is like this:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">List</span>&lt;<span class="type">out E</span>&gt; : <span class="type">Collection</span>&lt;<span class="type">E</span>&gt; </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Here <code>out</code> means: any fields of a List whih the generic type <code>E</code> must be <code>val</code>. Thus <code>E</code> is a type only for readable fields.</p><p>On the other hand, there is <code>in</code>, which means a generic type is only for writable variables:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>&lt;<span class="type">in T</span>&gt; </span>&#123; <span class="comment">// no fields of type T can be available to outside</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> item: T? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">setItem</span><span class="params">(newItem: <span class="type">T</span>)</span></span> &#123;</span><br><span class="line">        item = newItem</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> a: A&lt;Novel&gt; = A&lt;Book&gt;()</span><br></pre></td></tr></table></figure><p>The wildcard in Java generics has some similarities with the <code>in</code> and <code>out</code> in Kotlin, but they are not equivalent concepts.</p><h3 id="13-Extensions"><a href="#13-Extensions" class="headerlink" title="13. Extensions"></a>13. Extensions</h3><p>Based on anonymous function and generics, Kotlin brings the extensions, which enable us to extend classes with new functions and fields without inheritance. The Kotlin standard library contains a large numbers of extensions.</p><p>The code below</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">count</span><span class="params">(str: <span class="type">String</span>, startIdx: <span class="type">Int</span>, predicate: (<span class="type">Char</span>)</span></span> -&gt; <span class="built_in">Boolean</span>) =</span><br><span class="line">    str.substring(startIdx).count(predicate)</span><br><span class="line">    </span><br><span class="line">count(<span class="string">"Mississippi"</span>, <span class="number">5</span>) &#123;</span><br><span class="line">    it == <span class="string">'s'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>could be refactored as</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// just like we have extended the String class, a final class.</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> String.<span class="title">count</span><span class="params">(startIdx: <span class="type">Int</span>, predicate: (<span class="type">Char</span>)</span></span> -&gt; <span class="built_in">Boolean</span>) =</span><br><span class="line">    substring(startIdx).count(predicate)</span><br><span class="line"></span><br><span class="line"><span class="string">"Mississippi"</span>.count(<span class="number">5</span>) &#123;</span><br><span class="line">    it == <span class="string">'s'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Extend with fields is also available:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> String.countS</span><br><span class="line">    <span class="keyword">get</span>() = count &#123; it == <span class="string">'s'</span> || it == <span class="string">'S'</span> &#125;</span><br><span class="line"></span><br><span class="line">println(<span class="string">"Mississippi"</span>.countS) <span class="comment">// would print 4</span></span><br></pre></td></tr></table></figure><p>Like computed properties, extended fields have no backing fields, actually the extended fields has no essential differences with extended methods.</p><p>Visibility modifiers are also valid for the extensions.</p><p>Extensions on nullable types:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// for such extension, the this is nullable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> String?.<span class="title">printWithDefault</span><span class="params">(<span class="keyword">default</span>: <span class="type">String</span>)</span></span> = println(<span class="keyword">this</span> ?: <span class="keyword">default</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> s: String? = <span class="literal">null</span></span><br><span class="line">s.printWithDefault(<span class="string">"what?"</span>) <span class="comment">// no need to write s?. even when s is null.</span></span><br></pre></td></tr></table></figure><p>Generics in extensions:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> T.<span class="title">prt</span><span class="params">()</span></span> &#123;</span><br><span class="line">    println(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(<span class="number">1</span> + <span class="number">1</span>).prt()</span><br></pre></td></tr></table></figure><p>Extensions in Kotlin standard library:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Calls the specified function [block] with `this` value as its argument and returns its result.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * For detailed usage information see the documentation for [scope functions](https://kotlinlang.org/docs/reference/scope-functions.html#let).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@kotlin</span>.<span class="keyword">internal</span>.InlineOnly</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T, R&gt;</span> T.<span class="title">let</span><span class="params">(block: (<span class="type">T</span>)</span></span> -&gt; R): R &#123;</span><br><span class="line">    contract &#123;</span><br><span class="line">        callsInPlace(block, InvocationKind.EXACTLY_ONCE)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> block(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Usage of the <code>let</code>:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Y</span></span>(<span class="keyword">val</span> pair: Pair&lt;String, String&gt;?)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> y = Y(Pair(<span class="string">"hello"</span>, <span class="string">"world"</span>))</span><br><span class="line">y.pair?.let &#123;</span><br><span class="line">    println(it.first + <span class="string">" "</span> + it.second)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> p = y.pair</span><br><span class="line"><span class="keyword">if</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">    println(p.first + <span class="string">" "</span> + p.second)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Extension function type:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> greetings: String.() -&gt; <span class="built_in">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">"Hello "</span> + <span class="keyword">this</span>.capitalize())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">"Mississippi"</span>.greetings()</span><br></pre></td></tr></table></figure><p>Another extension in Kotlin standard library:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Calls the specified function [block] with `this` value as its receiver and returns its result.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * For detailed usage information see the documentation for [scope functions](https://kotlinlang.org/docs/reference/scope-functions.html#run).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@kotlin</span>.<span class="keyword">internal</span>.InlineOnly</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T, R&gt;</span> T.<span class="title">run</span><span class="params">(block: <span class="type">T</span>.()</span></span> -&gt; R): R &#123;</span><br><span class="line">    contract &#123;</span><br><span class="line">        callsInPlace(block, InvocationKind.EXACTLY_ONCE)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> block()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">File(<span class="string">"x.txt"</span>).run &#123;</span><br><span class="line">    setReadable(<span class="literal">true</span>)</span><br><span class="line">    setWritable(<span class="literal">true</span>)</span><br><span class="line">    setExecutable(<span class="literal">false</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="14-Java-Interoperability"><a href="#14-Java-Interoperability" class="headerlink" title="14. Java Interoperability"></a>14. Java Interoperability</h3><h4 id="Nullity"><a href="#Nullity" class="headerlink" title="Nullity"></a>Nullity</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in java side, mark non-private fields, return type and parameter type</span></span><br><span class="line"><span class="comment">// with annotations, thus helps Kotlin side handle nullity</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JavaClass</span> </span>&#123;</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">public</span> String x = <span class="string">"x"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">public</span> String f(<span class="meta">@NotNull</span> String y) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Jetbrains created their annotations like this:<br><img src="http://tao93.top/images/2019/11/05/1572992024.png" alt=""></p><p>While the annotations by Google is like this:<br><img src="http://tao93.top/images/2019/11/05/1572992106.png" alt=""></p><h3 id="File-level-Kotlin-members"><a href="#File-level-Kotlin-members" class="headerlink" title="File level Kotlin members"></a>File level Kotlin members</h3><p>Letâ€™s say we have a kotlin file Hello.kt which is:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in Hello.kt file</span></span><br><span class="line"><span class="comment">// by default, the Hello.kt would generate a JVM class as HelloKt, </span></span><br><span class="line"><span class="comment">// but we can change it like the following line.</span></span><br><span class="line"><span class="meta">@file:JvmName</span>(<span class="string">"Hello"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// file level members would be static members in generated JVM class</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">f</span><span class="params">()</span></span> = <span class="string">"hello from kotlin."</span></span><br></pre></td></tr></table></figure><h3 id="Kotlin-functions-with-default-parameter-values"><a href="#Kotlin-functions-with-default-parameter-values" class="headerlink" title="Kotlin functions with default parameter values"></a>Kotlin functions with default parameter values</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add this annotation to make it generates several overloaded JVM methods</span></span><br><span class="line"><span class="meta">@JvmOverloads</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">f</span><span class="params">(name: <span class="type">String</span> = <span class="string">"Unknown"</span>, age: <span class="type">Int</span> = <span class="number">0</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Access-members-of-companion-object-in-Java"><a href="#Access-members-of-companion-object-in-Java" class="headerlink" title="Access members of companion object in Java"></a>Access members of companion object in Java</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">H</span> </span>&#123;</span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="meta">@JvmField</span>  <span class="comment">// with this, H.x is valid in Java, or it would be H.companion.x</span></span><br><span class="line">        <span class="keyword">val</span> x = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">@JvmStatic</span>  <span class="comment">// with this, H.f is valid in Java</span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">f</span><span class="params">()</span></span>&#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Exceptions"><a href="#Exceptions" class="headerlink" title="Exceptions"></a>Exceptions</h4><p>As we said earlier, Kotlin doesnâ€™t require we to try-catch code blocks which may throw checked Java Exceptions or add a <code>throws</code> declaration in the method signatures. So if a Java method is called with <code>throws</code> declaration is called in kotlin, we might missed the exceptions warning by the Java method.</p><p>For Kotlin methods which would be called by Java and might throw checked exceptions, marked it with annotation:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Throws(IOException::class)</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">f</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> FileNotFoundException()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Referred-functions-of-Kotlin"><a href="#Referred-functions-of-Kotlin" class="headerlink" title="Referred functions of Kotlin"></a>Referred functions of Kotlin</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in Test.kt file</span></span><br><span class="line"><span class="keyword">val</span> translator = &#123; utterance: String -&gt;</span><br><span class="line">    println(utterance.toLowerCase().capitalize())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaClass</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Function1&lt;String, Unit&gt; translator = RoomKt.getTranslator();</span><br><span class="line">        translator.invoke(<span class="string">"MONey"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Whatâ€™s the <code>Function1</code>:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** A function that takes 1 argument. */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Function1</span>&lt;<span class="type">in P1, out R</span>&gt; : <span class="type">Function</span>&lt;<span class="type">R</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/** Invokes the function with the specified argument. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">invoke</span><span class="params">(p1: <span class="type">P1</span>)</span></span>: R</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Corutines"><a href="#Corutines" class="headerlink" title="Corutines"></a>Corutines</h3>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;1-Before-all&quot;&gt;&lt;a href=&quot;#1-Before-all&quot; class=&quot;headerlink&quot; title=&quot;1. Before all&quot;&gt;&lt;/a&gt;1. Before all&lt;/h3&gt;&lt;h4 id=&quot;Whatâ€™s-Kotlin&quot;&gt;&lt;a href=
      
    
    </summary>
    
    
      <category term="Kotlin" scheme="https://tao93.top/tags/Kotlin/"/>
    
  </entry>
  
  <entry>
    <title>5 åˆ†é’Ÿæé«˜ macOS ä½¿ç”¨æ•ˆçŽ‡</title>
    <link href="https://tao93.top/2019/08/09/macOS%20%E6%95%88%E7%8E%87/"/>
    <id>https://tao93.top/2019/08/09/macOS æ•ˆçŽ‡/</id>
    <published>2019-08-09T07:57:21.000Z</published>
    <updated>2019-10-10T23:22:36.697Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æèµ· macOSï¼Œå¤§å®¶å¯èƒ½ä¼šæƒ³åˆ°ç²¾è‡´ã€å¹¿å‘Šå°‘ã€è½¯ç¡¬æ­é…æžä½³ã€Unix ç­‰ç­‰ï¼Œè¿™äº›ä¹Ÿæ˜¯ macOS é€æ¸åœ¨è½¯ä»¶å¼€å‘è€…ã€è®¾è®¡å¸ˆã€æ–‡å­—å·¥ä½œè€…ç­‰ç¾¤é‡Œä¸­æˆä¸ºã€Œæ ‡é…ã€çš„åŽŸå› ã€‚ç„¶è€Œæ€»ç»“æˆ‘è¿™å‡ å¹´çš„ä½¿ç”¨ç»éªŒï¼Œæˆ‘è®¤ä¸ºæœ‰è®¸å¤šå·¥å…·å’Œæ–¹æ³•ï¼Œå¯ä»¥åœ¨é»˜è®¤çš„ macOS åŸºç¡€ä¸Šï¼Œæ›´è¿›ä¸€æ­¥æé«˜æˆ‘ä»¬çš„æ•ˆçŽ‡ã€‚æœ¬æ–‡åŸºäºŽ macOS 10.14.6ï¼Œä¸æ¯”è¾ƒ macOS å’Œå…¶å®ƒç³»ç»Ÿå­°ä¼˜å­°åŠ£ï¼Œè€Œæ˜¯é’ˆå¯¹ã€Œæ‰€æœ‰ç”¨æˆ·ã€å’Œã€Œç¨‹åºå‘˜ã€ä¸¤ä¸ªç¾¤ä½“åˆ†åˆ«åˆ†äº«ä¸€äº›æˆ‘çš„ç»éªŒï¼Œæ¬¢è¿Žè®¨è®ºå’Œäº¤æµã€‚å¦å¤–ï¼Œæœ¬æ–‡æŽ¨èçš„å‡ ä¹Žéƒ½æ˜¯å…è´¹æˆ–è€…å¼€æºçš„å·¥å…·ï¼Œå—¯ï¼Œæˆ‘å°±æ˜¯è¿™ä¹ˆä¸ºå¤§å®¶çš„é’±åŒ…ç€æƒ³ï¼ˆ<del>æˆ‘å¯ä¸ä¼šè¯´æ˜¯å› ä¸ºæˆ‘ç©·</del>ï¼‰ã€‚</p><h3 id="å¯¹æ‰€æœ‰ç”¨æˆ·"><a href="#å¯¹æ‰€æœ‰ç”¨æˆ·" class="headerlink" title="å¯¹æ‰€æœ‰ç”¨æˆ·"></a>å¯¹æ‰€æœ‰ç”¨æˆ·</h3><h4 id="å‰ªè´´æ¿ç®¡ç†"><a href="#å‰ªè´´æ¿ç®¡ç†" class="headerlink" title="å‰ªè´´æ¿ç®¡ç†"></a>å‰ªè´´æ¿ç®¡ç†</h4><p>å‰ªè´´æ¿ç®¡ç†å·¥å…·å¸®æˆ‘ä»¬ç»´æŠ¤æ–‡æœ¬å’Œ<strong>å›¾ç‰‡</strong>çš„å¤åˆ¶åŽ†å²ï¼Œä»Žè€Œè®©æˆ‘ä»¬èƒ½ç²˜è´´ä¸Šä¸Šä¸Šä¸Šä¸Šä¸Šä¸Šä¸Šä¸Šä¸Šä¸Šä¸Š(<del>è¯·ä¸è¦è¯´æˆ‘å‡‘å­—æ•°</del>)â€¦æ¬¡å¤åˆ¶çš„å†…å®¹ã€‚æ˜¾è€Œæ˜“è§è¿™æ˜¯å¯¹ä»»ä½•äººéƒ½éžå¸¸æœ‰ç”¨ enhancementï¼Œè¿™ä¹Ÿæ˜¯ä¸ºå•¥æˆ‘æŠŠå®ƒæ”¾åœ¨ç¬¬ä¸€ä¸ªä»‹ç»ã€‚çŽ°åœ¨ <a href="https://www.alfredapp.com/" target="_blank" rel="noopener">Alfred</a> ç­‰å·¥å…·å·²é›†æˆäº†å‰ªè´´æ¿ç®¡ç†çš„åŠŸèƒ½ï¼Œä¸è¿‡ï¼Œæœ¬ç€å¼€æºä¼˜å…ˆ(<del>å…è´¹</del>)çš„åŽŸåˆ™ï¼Œæˆ‘è¦æŽ¨èçš„æ˜¯ GitHub ä¸Šçš„ <a href="https://github.com/Clipy/Clipy" target="_blank" rel="noopener">Clipy</a>ï¼Œå®‰è£…å¹¶ç¨å¾®è®¾ç½®åŽï¼ŒæŒ‰ä¸‹è®¾å®šå¥½çš„å¿«æ·é”®ï¼Œå°±èƒ½å‡ºçŽ°ä¸‹å›¾çš„å¼¹æ¡†ï¼š</p><p><img src="http://tao93.top/images/2019/08/03/1564845517.png" alt=""></p><p>ç„¶åŽåªéœ€è¦æŒ‰ä¸Šä¸‹æ–¹å‘é”®é€‰æ‹©ï¼Œå°±å¯ä»¥ç²˜è´´ä¸Šä¸Šä¸Šä¸Šâ€¦æ¬¡å¤åˆ¶è¿‡çš„å†…å®¹äº†ã€‚ä¸è¿‡éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œåœ¨ Clipy çš„<a href="https://github.com/Clipy/Clipy/releases" target="_blank" rel="noopener">ä¸‹è½½é¡µé¢</a>ï¼ŒåŠ¡å¿…ä¸‹è½½ 1.15 ç‰ˆæœ¬ï¼Œå› ä¸º 1.2.0 å’Œ 1.2.1 éƒ½æœ‰ä¸€ä¸ª bug ä½¿å¾—å®ƒæ— æ³•å°†å¤åˆ¶çš„å›¾ç‰‡çº³å…¥ç®¡ç†ã€‚</p><h4 id="è½¯ä»¶å¸è½½"><a href="#è½¯ä»¶å¸è½½" class="headerlink" title="è½¯ä»¶å¸è½½"></a>è½¯ä»¶å¸è½½</h4><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒmacOS ä¸Šå®‰è£…è½¯ä»¶ä¸€èˆ¬æ˜¯å°†ä¸€ä¸ª XXX.app æ‹–åˆ°ä¸€ä¸ª Applications ç›®å½•ä¸­ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ‹·è´çš„åŠ¨ä½œï¼Œå®Œæˆè¿™ä¸ªåŽï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ Spotlight æœç´¢æˆ–è€…åœ¨ Launchpad ç‚¹å‡»å›¾æ ‡æ¥æ‰“å¼€å®ƒã€‚äº‹å®žä¸Šï¼ŒXXX.app å…¶å®žæ˜¯ä¸€ä¸ªç›®å½•ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªåŽç¼€ä¸º app çš„æ–‡ä»¶ï¼Œè¿™å¯ä»¥é€šè¿‡åœ¨ XXX.app ä¸Šå³é”®ï¼Œç„¶åŽç‚¹å‡»<code>Show Package contents</code>ï¼Œå¦‚å›¾ï¼š</p><p><img src="http://tao93.top/images/2019/08/03/1564845703.png" alt=""></p><p>XXX.app ç›®å½•åŒ…å«ä¸€ä¸ªè½¯ä»¶è¿è¡Œèµ·æ¥æ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä½†å½“æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªæ–°å®‰è£…çš„è½¯ä»¶ï¼Œå®ƒå¾€å¾€ä¼šåœ¨ä¸€äº›åˆ«çš„åœ°æ–¹ (ä¸åœ¨ Applications ä¹Ÿä¸åœ¨ XXX.app ä¸­) ç”Ÿæˆä¸€äº›é…ç½®æ–‡ä»¶ã€‚æ‰€ä»¥ä»…ä»…åœ¨ Applications ä¸­åˆ é™¤ XXX.app å¹¶ä¸èƒ½ç§»é™¤ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ï¼Œä»Žè€Œå¦‚æžœå“ªå¤©å†æ¬¡å®‰è£…è¿™ä¸ªè½¯ä»¶ï¼Œè€çš„é…ç½®ä¾ç„¶ä¼šäº§ç”Ÿä½œç”¨ã€‚è‹¥è¦å½»åº•å¸è½½è½¯ä»¶ï¼Œå¯ä»¥ä½¿ç”¨è½»é‡çº§çš„ <a href="https://freemacsoft.net/appcleaner/" target="_blank" rel="noopener">AppCleaner</a>ï¼Œå®ƒå¯ä»¥å¸®æˆ‘ä»¬æœç´¢å‡ºéœ€å¸è½½è½¯ä»¶çš„æœ¬ä½“å’Œæ‰€æœ‰é…ç½®æ–‡ä»¶ï¼Œç„¶åŽæˆ‘ä»¬é€‰æ‹©åˆ é™¤å“ªäº›ï¼š</p><p><img src="http://tao93.top/images/2019/08/03/1564846208.png" alt=""></p><h4 id="è§£åŽ‹ç¼©"><a href="#è§£åŽ‹ç¼©" class="headerlink" title="è§£åŽ‹ç¼©"></a>è§£åŽ‹ç¼©</h4><p>å¯¹äºŽè½¯ä»¶ï¼Œå…¶å®žæˆ‘æ˜¯èƒ½ç”¨ç³»ç»Ÿè‡ªå¸¦çš„å°±ç”¨ç³»ç»Ÿè‡ªå¸¦çš„ï¼Œç„¶è€Œ macOS ä¸Šé¢çš„ <code>Archive Utility.app</code> è§£åŽ‹æŸäº›æ ¼å¼æ—¶ä¼šå‡ºé”™ï¼Œä¹Ÿä¸èƒ½é€‰æ‹©æ–‡æœ¬ç¼–ç ï¼Œæ‰€ä»¥å°±æœ‰å¿…è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹è§£åŽ‹è½¯ä»¶äº†ï¼Œæ¯”å¦‚è½»é‡çš„ <a href="https://theunarchiver.com/" target="_blank" rel="noopener">The Unarchiver</a> äº†ã€‚</p><h4 id="æ–‡æœ¬ç¼–è¾‘å™¨"><a href="#æ–‡æœ¬ç¼–è¾‘å™¨" class="headerlink" title="æ–‡æœ¬ç¼–è¾‘å™¨"></a>æ–‡æœ¬ç¼–è¾‘å™¨</h4><p>åŒæ ·çš„ï¼ŒmacOS çš„ <code>TextEdit.app</code> ä¹Ÿæ˜¯ä¸å ªé‡ä»»ï¼Œå°±å¥½æ¯”æ˜¯ Windows ä¸Šçš„è®°äº‹æœ¬ä¸€æ ·ã€‚å¦‚æžœä½ ä¹Ÿä¸çŸ¥é“è‡ªå·±è¯¥ç”¨ä»€ä¹ˆæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œé‚£ <a href="http://www.sublimetext.com/" target="_blank" rel="noopener">Sublime Text</a> æ˜¯ä¸ªå¾ˆä¸é”™çš„é€‰æ‹©ã€‚è½»é‡ã€åŠŸèƒ½å¼ºå¤§ã€å®šåˆ¶è¡Œå¼ºã€æ”¯æŒå„ç§èŠ±å¼çš„æ’ä»¶ï¼Œè¿™å°±æ˜¯ Sublime Textã€‚æˆ‘æœ€å–œæ¬¢å®ƒçš„ä¸€ä¸ªåŠŸèƒ½æ˜¯ï¼Œåœ¨å®ƒçš„ä¸€ä¸ª tab ä¸­å†™ç‚¹ä¸œè¥¿ï¼Œä¸ç”¨ä¿å­˜ä¸ºæ–‡ä»¶å°±å¯ä»¥é€€å‡ºè½¯ä»¶ç”šè‡³å…³æœºï¼Œç­‰ä¸‹æ¬¡æ‰“å¼€å®ƒï¼Œä¸€åˆ‡å†…å®¹éƒ½æ¢å¤äº†ï¼Œè¿™ç‰¹åˆ«é€‚åˆç”¨æ¥è®°ç‚¹ä¸œè¥¿ã€‚</p><h4 id="çª—å£ç®¡ç†"><a href="#çª—å£ç®¡ç†" class="headerlink" title="çª—å£ç®¡ç†"></a>çª—å£ç®¡ç†</h4><p>çª—å£ç®¡ç†ä¹Ÿå°±æ˜¯æŠŠçª—å£æ”¾å¤§ç¼©å†™å’ŒæŒªåŠ¨çš„æ“ä½œã€‚macOS é»˜è®¤çš„çª—å£æ“ä½œè¢«ä¸€äº›äººè®¤ä¸ºä¸å¦‚ Windows å¥½ç”¨ï¼Œå…¶å®žæˆ‘è®¤ä¸ºç¨å¾®è®¾ç½®ä¸€ä¸‹ï¼Œå°±èƒ½è®©è¿™äº›äººçš„ðŸ¤å•¦ã€‚é¦–å…ˆï¼ŒmacOS å…¶å®žä¸éœ€è¦æˆ‘ä»¬ç»å¸¸å›žåˆ°æ¡Œé¢ï¼Œè¿™æœ‰åˆ«äºŽ Windows çš„ç»å¸¸å›žåˆ°æ¡Œé¢ç‚¹å‡»å›¾æ ‡å¯åŠ¨è½¯ä»¶ã€‚macOS ä¸­ï¼Œå½“éœ€è¦åˆ‡æ¢åˆ°åˆ«çš„è½¯ä»¶æ—¶ï¼Œä¸åº”è¯¥ç”¨æœ€å°åŒ– (å¿«æ·é”® Cmd+M) çš„æ“ä½œï¼Œå› ä¸ºæ°¸è¿œä¸çŸ¥é“æœ€å°åŒ–åŽéœ²å‡ºæ¥çš„æ˜¯å“ªä¸€ä¸ªè½¯ä»¶ï¼Œæ‰€ä»¥åº”è¯¥ç›´æŽ¥ç‚¹å‡»æˆ– Cmd+Tab å‰å¾€æƒ³è¦åŽ»çš„è½¯ä»¶ï¼Œé™¤éžä½ çš„æŸä¸ªè½¯ä»¶çœŸçš„æœ‰è§ä¸å¾—äººçš„ä¸œè¥¿ï¼Œåˆ«äººæ¥åˆ°ä½ ç”µè„‘å‰æ—¶ä½ å¯ä»¥ç–¾é€Ÿåœ°æŒ‰ä¸‹ Cmd+M ç»„åˆé”®ã€‚æ›´åˆ«ææœ€å°åŒ–åŽï¼Œé”®ç›˜æ“ä½œå°†ä¸èƒ½æŠŠè¯¥çª—å£æ‹‰å›žæ¥ï¼Œè€Œåªèƒ½é ç‚¹ å‡» (é¼ æ ‡æˆ–è§¦æ‘¸æ¿)ï¼Œè€Œé€šå¸¸é”®ç›˜æ“ä½œæ›´å¿«é€Ÿã€‚</p><p>æ‰¯è¿œäº†ï¼Œå›žåˆ°çª—å£ç®¡ç†ï¼Œå¦‚æžœæ„¿æ„ä»˜è´¹ï¼Œå¯ä»¥é€‰ç”¨ <a href="https://manytricks.com/moom/" target="_blank" rel="noopener">Moom</a> æˆ– <a href="https://www.folivora.ai/bettersnaptool" target="_blank" rel="noopener">BetterSnapTool</a> ä¸¤æ¬¾ä»˜è´¹è½¯ä»¶ï¼Œå½“ç„¶ä»–ä»¬éƒ½å¯å…è´¹è¯•ç”¨ã€‚å®ƒä»¬æä¾›è¶³å¤Ÿçš„åŠŸèƒ½è®©æˆ‘ä»¬èŠ±å¼ç®¡ç†çª—å£ï¼Œå¿«æ·é”®ä¹Ÿå¥½ï¼Œè§¦å‘è§’ä¹Ÿç½¢ã€‚å¦‚æžœä½ ä¸æƒ³å¤§åŠ¨å¹²æˆˆï¼Œå…¶å®žæˆ‘ä»¬æœ€éœ€è¦çš„åªæœ‰ä¸¤ä¸ªæ“ä½œï¼šçª—å£æœ€å¤§åŒ–(ä¸æ˜¯å¼€å¯å…¨å±è§†å›¾)å’Œçª—å£å¤§å°å›žé€€ã€‚å‰è€…è®©æˆ‘ä»¬å°†å½“å‰è½¯ä»¶å¡«æ»¡å±å¹•ï¼Œä»Žè€Œèšç²¾ä¼šç¥žå·¥ä½œ(<del>æ‘¸é±¼</del>)ï¼›åŽè€…æ„æ€æ˜¯è®©çª—å£ä»Žæœ€å¤§åŒ–å˜å›žæœ¬æ¥çš„å¤§å°ã€‚è¿™ä¸¤ä¸ªæ“ä½œä¸€èˆ¬å¯ä»¥é€šè¿‡ macOS è‡ªå¸¦çš„ Zoom æ“ä½œï¼Œä¹Ÿå°±æ˜¯ menu bar ä¸­ Window èœå•ä¸‹çš„ Zoomã€‚è¿™ä¸ª Zoom é»˜è®¤æ²¡æœ‰å¿«æ·é”®ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥åœ¨ç³»ç»Ÿä¸­è®¾ç½®ï¼š<code>System Preferences.app</code> &gt; <code>Keyboard</code> &gt; <code>Shortcuts</code> &gt; <code>App Shortcuts</code>ï¼Œç„¶åŽç‚¹<code>+</code>æŒ‰é’®å¹¶å¦‚ä¸‹æ·»åŠ ï¼š</p><p><img src="http://tao93.top/images/2019/08/04/1564848618.png" alt=""></p><p>æ­¤åŽæŒ‰ä¸Šé¢è®¾ç½®çš„å¿«æ·é”®ï¼Œå°±èƒ½æœ€å¤§çª—å£åŒ–å’Œå›žé€€çª—å£äº†ã€‚</p><h4 id="å¿«æ·é”®"><a href="#å¿«æ·é”®" class="headerlink" title="å¿«æ·é”®"></a>å¿«æ·é”®</h4><p>å¿«æ·é”®çš„ä¸–ç•Œçº·ç¹å¤æ‚ï¼Œæœ‰æ—¶å€™ç”šè‡³ä¸å°å¿ƒè§¦å‘äº†ä¸ªä»€ä¹ˆå¿«æ·é”®å´ä¸çŸ¥æƒ…ï¼Œç„¶åŽä¸€è„¸ðŸ˜³ã€‚è¨€å½’æ­£ä¼ ï¼Œé€‚ç”¨æœ€å¹¿ï¼Œä½¿ç”¨é¢‘çŽ‡æœ€é«˜çš„å°‘æ•°åŸºæœ¬å¿«æ·é”®æ‰æ˜¯æœ€å€¼å¾—æçš„ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">å¿«æ·é”®</th><th style="text-align:center">ä½œç”¨</th></tr></thead><tbody><tr><td style="text-align:center">Cmd + N</td><td style="text-align:center">ä¸€èˆ¬æ˜¯æ–°å»ºçª—å£</td><td></td></tr><tr><td style="text-align:center">Cmd + T</td><td style="text-align:center">ä¸€èˆ¬æ˜¯æ–°å»º Tab æ ‡ç­¾é¡µ</td></tr><tr><td style="text-align:center">Cmd + ` (ESC ä¸‹æ–¹æŒ‰é”®)</td><td style="text-align:center">åœ¨å½“å‰è½¯ä»¶çš„ä¸åŒçª—å£é—´åˆ‡æ¢</td></tr><tr><td style="text-align:center">Cmd + Shift + [</td><td style="text-align:center">å½“å‰çª—å£å‘å·¦ä¾§ Tab åˆ‡æ¢</td></tr><tr><td style="text-align:center">Cmd + Shift + ]</td><td style="text-align:center">å½“å‰çª—å£å‘å³ä¾§ Tab åˆ‡æ¢</td></tr><tr><td style="text-align:center">Cmd + W</td><td style="text-align:center">å…³é—­å½“å‰ Tab æˆ–å½“å‰çª—å£</td></tr><tr><td style="text-align:center">Cmd + Q</td><td style="text-align:center">å½»åº•é€€å‡ºè½¯ä»¶</td></tr><tr><td style="text-align:center">Ctrl + Cmd + Space</td><td style="text-align:center">å–èŒæ—¶å¯ç”¨ï¼Œè¯•è¯•ä½ å°±çŸ¥é“äº†</td></tr><tr><td style="text-align:center">Option + Cmd + C</td><td style="text-align:center">å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„</td></tr><tr><td style="text-align:center">Cmd + L</td><td style="text-align:center">Safari ä¸Ž Chrome ä¸­ focus åœ°å€æ </td></tr><tr><td style="text-align:center">Option + Cmd + Delete</td><td style="text-align:center">æ°¸ä¹…åˆ é™¤ç›®å½•æˆ–æ–‡ä»¶</td></tr><tr><td style="text-align:center">F11</td><td style="text-align:center">æ‰’å¼€æ‰€æœ‰çª—å£çœ‹ä¸‹æ¡Œé¢</td></tr><tr><td style="text-align:center">Cmd + ,</td><td style="text-align:center">è¿›åå¥½è®¾ç½®ï¼Œå¯¹å‡ ä¹Žæ‰€æœ‰è½¯ä»¶æœ‰æ•ˆ</td></tr></tbody></table></div><p>macOS æœ‰ Mission Control å’Œ App ExposÃ© ä¸¤ä¸ªåŠŸèƒ½ï¼Œåˆ†åˆ«æœ‰é»˜è®¤çš„å¿«æ·é”® Cmd + â†‘ å’Œ Cmd + â†“ï¼Œå‰è€…æ˜¾ç¤ºæ‰€æœ‰çª—å£ï¼ŒåŽè€…æ˜¾ç¤ºå½“å‰è½¯ä»¶çš„æ‰€æœ‰çª—å£ã€‚å½“ç„¶ï¼Œå®ƒä»¬è¿˜å¯ä»¥åœ¨è§¦æ‘¸æ¿è®¾ç½®ä¸­é€šè¿‡è®¾ç½®æ‰‹åŠ¿æ¥è§¦å‘ã€‚</p><p>Windows ä¸­å‡ºçŽ°ä¸€ä¸ªå¼¹æ¡†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ Tab é”®æ¥åˆ‡æ¢ focus åˆ°ä¸åŒæŒ‰é’®ä¸Šï¼Œç„¶åŽæŒ‰ Enter æˆ–ç©ºæ ¼æ¥ä»£æ›¿ç‚¹å‡»æŒ‰é’®ã€‚macOS å…¶å®žä¹Ÿå¯ä»¥ï¼Œä½†é»˜è®¤æœªå¼€å¯ï¼Œå¼€å¯æ–¹æ³•æ˜¯ï¼š<code>System Preferences.app</code> &gt; <code>Keyboard</code> &gt; <code>Shortcuts</code>ï¼Œç„¶åŽ <code>Full Keyboard Access</code> é€‰ä¸­ <code>All controls</code> å³å¯ã€‚</p><p>åœ¨ä¸€äº›å¤§é”®ç›˜ä¸Šï¼Œå³ä¾§ä¼šæœ‰å¾ˆå¤šæ²¡æœ‰å­˜åœ¨æ„Ÿçš„æŒ‰é”®ï¼Œæ¯”å¦‚ Home å’Œ Endã€‚å…¶å®žå®ƒä»¬çš„ä½œç”¨ä¹‹ä¸€æ˜¯å°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œé¦–/è¡Œæœ«ï¼Œæ‰€ä»¥å®ƒä»¬æ­é…ä¸Š Shift æŒ‰é”®ï¼Œå°±å¯ä»¥å¿«é€Ÿé€‰ä¸­å½“å‰å…‰æ ‡è‡³è¡Œé¦–/è¡Œæœ«çš„æ–‡æœ¬ï¼Œå³å¿«æ·é”® Home/End + Shiftã€‚è€Œè¦é€‰ä¸­æ•´è¡Œï¼Œä¹Ÿå¯å…ˆ Home ç„¶åŽ End + Shift å³å¯ã€‚macOS ä¸­ï¼ŒHome å’Œ End å¯åˆ†åˆ«ç”± Cmd + â† å’Œ Cmd + â†’ å®žçŽ°ï¼Œå¦‚æ­¤ä¸€æ¥ï¼ŒæŒ‰ä¸‹ Cmd å’Œ Shift å†æŒ‰å·¦å³æ–¹å‘é”®å³å¯ã€‚</p><p>æœ‰æ—¶å€™æˆ‘ä»¬æƒ³å¼ºé€€ä¸€äº›æ— å“åº”çš„è½¯ä»¶ï¼Œå¯ä»¥æŒ‰ Option + Cmd + ESC ç„¶åŽåœ¨çª—å£ä¸­å¼ºé€€æŸä¸ªè½¯ä»¶ã€‚å¦‚æžœä½ ä¸è®°å¾—è¿™ä¸ªå¿«æ·é”®ï¼Œé€šå¸¸åœ¨ Dock ä¸­å³é”®å›¾æ ‡ä¹Ÿä¼šæœ‰å¼ºé€€çš„é€‰é¡¹ã€‚æåˆ° ESCï¼Œé¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œç»å¤§éƒ¨åˆ†å„å¼å„æ ·çš„å°å¼¹æ¡†ï¼Œéƒ½å¯ä»¥é€šè¿‡æŒ‰ ESC æ¥æŠŠå¼¹æ¡†å…³é—­æŽ‰ã€‚</p><h4 id="å…‰æ ‡è¦å¿«"><a href="#å…‰æ ‡è¦å¿«" class="headerlink" title="å…‰æ ‡è¦å¿«"></a>å…‰æ ‡è¦å¿«</h4><p>å¦‚æžœä½ è®¤ä¸ºæˆ‘è¯´çš„æ˜¯å…‰æ ‡éšé¼ æ ‡æˆ–æ‰‹æŒ‡åœ¨è§¦æ‘¸æ¿ä¸Šç§»åŠ¨é€Ÿåº¦çš„å¿«æ…¢ï¼Œé‚£ä½ å°±é”™å•¦ï¼è™½ç„¶æˆ‘çš„ç¡®å»ºè®®å‰é¢è¯´çš„è¿™ä¸ªå¿«æ…¢å¯ä»¥â€¦æžå¿«ç‚¹ï¼ˆæ¯•ç«Ÿè¿™æ ·å¯ä»¥å‡å°‘æœ‰æ—¶å€™åœ¨è§¦æ‘¸æ¿ä¸Šæ‰‹æŒ‡æ»‘åŠ¨ä¸€æ¬¡è¿˜æ²¡åˆ°ç›®çš„åœ°ï¼Œéœ€è¦æŠ¬èµ·æ‰‹æŒ‡æŽ¥åŠ›ç»§ç»­æ»‘åŠ¨)ï¼Œå¯æˆ‘æ›´æƒ³è¯´çš„æ˜¯<strong>é•¿æŒ‰</strong>é”®ç›˜çš„å·¦å³æ–¹å‘é”®æ—¶ï¼Œå…‰æ ‡åœ¨å­—ç¬¦ä¹‹é—´ç§»åŠ¨çš„é€Ÿåº¦ã€‚é¦–æ¬¡ä½¿ç”¨ Mac æ—¶ï¼Œæˆ‘å°±å‘çŽ°è¿™ä¸ªç§»åŠ¨é€Ÿåº¦å¤ªæ…¢ï¼Œä»¤äººæŠ“ç‹‚ï¼å¹¸è€Œä¸å°±æˆ‘å°±å¾—çŸ¥åœ¨ <code>System Preferences.app</code> &gt; <code>Keyboard</code> ä¸­æŠŠ <code>Key Repeat</code> å’Œ <code>Delay Until Repeat</code> éƒ½è®¾ç½®åˆ°æœ€å³ä¾§ï¼Œå°±èƒ½é•¿æŒ‰å·¦å³æ–¹å‘é”®æ—¶ï¼Œå…‰æ ‡æ¯”è¾ƒå¿«åœ°ç§»åŠ¨äº†ã€‚</p><p>ä»€ä¹ˆï¼Ÿä½ è¿˜è¦æ›´å¿«ï¼Ÿå—¯ï¼ŒåŠžæ³•ä¹Ÿæ˜¯æœ‰çš„ï¼ŒæŒ‰ä½ Option çš„åŒæ—¶ï¼Œé•¿æŒ‰æˆ–è¿žå‡»å·¦å³æ–¹å‘é”®ï¼Œå…‰æ ‡å°†ä»¥è‹±æ–‡ word ä¸ºå•ä½ç§»åŠ¨ï¼Œæ‰€ä»¥ç§»åŠ¨é€Ÿåº¦ä¼šæ›´å¿«ã€‚</p><h4 id="é»˜è®¤æ‰“å¼€æ–¹å¼"><a href="#é»˜è®¤æ‰“å¼€æ–¹å¼" class="headerlink" title="é»˜è®¤æ‰“å¼€æ–¹å¼"></a>é»˜è®¤æ‰“å¼€æ–¹å¼</h4><p>è¯´åˆ°è¿™ä¸ªå°±æƒ³èµ· Xcodeï¼Œä½†å‡¡å’Œä»£ç æœ‰ç‚¹å…³ç³»çš„æ–‡ä»¶ï¼ŒmacOS éƒ½ä¼šé»˜è®¤è®© Xcode æ‰“å¼€ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œæˆ‘éƒ½æ˜¯ç–¾é€Ÿåœ° Cmd+Q é€€å‡º Xcode ç„¶åŽåœ¨ Finder ä¸­å³é”®åˆšåˆšæ‰“å¼€çš„æ–‡ä»¶ï¼Œæ­¤æ—¶<strong>æŒ‰ä½ Option</strong> å¹¶åœ¨ <code>Always Open With</code> èœå•ä¸­é€‰æ‹©æˆ‘æƒ³è¦çš„è½¯ä»¶ï¼Œæ¯”å¦‚ <code>Sublime Text</code>ï¼Œåˆ°è¿™ï¼ŒXcode å†ä¹Ÿæ— æ³•æŸ“æŒ‡è¿™ä¸ªæ–‡ä»¶æ ¼å¼äº† ðŸ˜ã€‚</p><h4 id="ç®€å•ç®¡ç†å¯åŠ¨é¡¹"><a href="#ç®€å•ç®¡ç†å¯åŠ¨é¡¹" class="headerlink" title="ç®€å•ç®¡ç†å¯åŠ¨é¡¹"></a>ç®€å•ç®¡ç†å¯åŠ¨é¡¹</h4><p>Windows ä¸­æˆ‘ä»¬å¾€å¾€ç”¨å„ç§ç”µè„‘ç®¡å®¶æ¥é™åˆ¶æŸäº›è½¯ä»¶å¼€æœºè‡ªå¯çš„æµæ°“è¡Œä¸ºï¼ŒmacOS ä¸­è¿™æ ·çš„æµæ°“å°‘å¾ˆå¤šï¼Œä½†å½“çœŸçš„æœ‰äº†çš„æ—¶å€™ï¼Œæˆ–è€…æˆ‘ä»¬åè¦æŠŠæŸäº›è½¯ä»¶è®¾ç½®è‡ªå¯ (æ¯”å¦‚æˆ‘ä¼šæŠŠé‚®ä»¶å®¢æˆ·ç«¯è®¾ç½®å¼€æœºè‡ªå¯ï¼Œè¿™æ ·ç”µè„‘é‡å¯åŽï¼Œæˆ‘ä¸ä¼šå¿˜è®°æ‰“å¼€å®ƒè€Œé”™è¿‡é‚®ä»¶é€šçŸ¥ï¼Œ<del>å—¯ï¼Œæˆ‘å°±æ˜¯çƒ­çˆ±å·¥ä½œ</del>)ã€‚æ“ä½œå¾ˆç®€å•ï¼Œ<code>System Preferences.app</code> &gt; <code>Users &amp; Groups</code> &gt; <code>Login Items</code>ï¼Œç„¶åŽä¸æƒ³è¦çš„ login item åˆ æŽ‰ï¼Œæƒ³å¢žåŠ çš„åŠ ä¸Šï¼ŒOKã€‚æŽ¨èæŠŠæ¯å¤©éƒ½ç”¨çš„å·¥å…·è½¯ä»¶åŠ ä¸ŠåŽ»ï¼Œæ¯”å¦‚å‰é¢è¯´çš„ Clipyã€‚</p><h4 id="æˆªå±ä¸Žå½•å±"><a href="#æˆªå±ä¸Žå½•å±" class="headerlink" title="æˆªå±ä¸Žå½•å±"></a>æˆªå±ä¸Žå½•å±</h4><p>macOS ç³»ç»Ÿè‡ªå¸¦çš„æˆªå±åŠŸèƒ½ï¼Œåœ¨ <code>System Preferences.app</code> &gt; <code>Keyboard</code> &gt; <code>Shortcuts</code> &gt; <code>Screenshots</code> ä¸­å¯ä¸€è§ˆæ— é—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://tao93.top/images/2019/08/04/1564911138.png" alt=""></p><p>æœ‰æˆªå–å…¨å±å’Œæˆªå–é€‰ä¸­åŒºåŸŸå¹¶æ”¾åˆ°å‰ªè´´æ¿ï¼›ä¹Ÿæœ‰æˆªå–å…¨å±å’Œæˆªå–é€‰ä¸­åŒºåŸŸå¹¶<strong>ä½œä¸ºæ–‡ä»¶ä¿å­˜</strong>åˆ°æ¡Œé¢ï¼Œå¹¶ä¸”è¿™ç§æ–¹å¼ä¸‹ï¼Œæˆªå›¾åˆšå®Œæˆæ—¶æ¡Œé¢å³ä¸‹è§’ä¼šå’Œ iOS ä¸€æ ·çŸ­æ—¶é—´å†…æ˜¾ç¤ºä¸€ä¸ªç¼©ç•¥å›¾ï¼Œç‚¹å‡»å®ƒçš„è¯å¯ä»¥ç¼–è¾‘åˆšåˆšçš„æˆªå›¾ã€‚ä»¥ä¸ŠåŠŸèƒ½æ— æ³•æˆªå›¾åˆ°å‰ªè´´æ¿åŒæ—¶æä¾›ç¼–è¾‘åŠŸèƒ½ï¼Œæ­¤å¤–å½•å±åŠŸèƒ½ä¹Ÿæ˜¯ç¼ºå¤±çš„ï¼Œæ‰€ä»¥å®‰è£…ç¬¬ä¸‰æ–¹æˆªå›¾è½¯ä»¶åŠ¿åœ¨å¿…è¡Œã€‚</p><p>è¯´å‡ºæ¥å¯èƒ½æœ‰ç‚¹ lowï¼Œå…¶å®žæˆ‘æˆªå±å’Œå½•å±ä¸€ç›´æ˜¯ç”¨ QQ å†…åµŒçš„æˆªå›¾åŠŸèƒ½ã€‚å¯¹ï¼Œå°±æ˜¯è…¾è®¯é‚£ä¸ª QQã€‚ç®€å•æ¥è¯´ï¼ŒQQ è¿™ä¸ªæˆªå›¾å·¥å…·æ˜¯å¯ä»¥å•ç‹¬è¿è¡Œçš„ï¼Œå¹¶ä¸ä¾èµ– QQ çš„è¿è¡Œï¼Œæˆ‘æŠŠè¿™ä¸ªå·¥å…·æŒ‰ä¸Šä¸€æ¡ã€Œç®€å•ç®¡ç†å¯åŠ¨é¡¹ã€ä¸­çš„æ–¹æ³•è®¾ç½®ä¸ºå¼€æœºè‡ªå¯ã€‚è¿™æ ·ä¸ç”¨ç®¡ QQ çš„æ­»æ´»å°±å¯ä»¥ä¸€ç›´ä½¿ç”¨å®ƒäº†ã€‚</p><p>æ­¥éª¤æ˜¯ï¼š</p><ul><li>æ‰“å¼€ QQ &gt; <code>Cmd + ,</code> è¿›å…¥è®¾ç½® &gt; <code>Function</code> &gt; ç‚¹ <code>Capture &amp; Record Screen</code> å³è¾¹çš„ <code>Preferences</code>ï¼Œè¿™æ—¶æ˜¾ç¤ºä¸‹é¢çš„è®¾ç½®ç•Œé¢ï¼š</li></ul><p><img src="http://tao93.top/images/2019/08/04/1564911840.png" alt=""></p><ul><li>è®¾ç½®å¥½ä½ æƒ³è¦çš„æˆªå±å¿«æ·é”®å’Œå½•å±å¿«æ·é”®ï¼Œå¹¶ç¡®ä¿<code>Runs in background after you quit QQ</code> å‹¾é€‰ä¸Šäº†ã€‚</li><li>åœ¨ Applications çš„ QQ.app ä¸Šå³é”®å†ç‚¹ <code>Show Package Contents</code>ï¼Œç„¶åŽæŒ‰å¦‚ä¸‹è·¯å¾„æ‰¾åˆ° <code>QQ jietu plugin.app</code>ï¼Œæœ€åŽå°†å®ƒæ‹–è¿› Login Items å³å¯ï¼š</li></ul><p><img src="http://tao93.top/images/2019/08/04/1564912051.png" alt=""></p><p>è‡³æ­¤ï¼ŒæŒ‰ä¸‹ä¹‹å‰è®¾ç½®çš„æˆªå›¾å¿«æ·é”®ï¼Œä¼šå‡ºçŽ° Screenshotï¼ŒScreen Recording å’Œ Recognition ä¸‰ä¸ªé€‰é¡¹ï¼Œåˆ†åˆ«æ˜¯æˆªå±ã€å½•å±ã€è¯†åˆ«å›¾ç‰‡ä¸­çš„æ–‡æœ¬ï¼ŒåŠŸèƒ½è¿˜ç®—å¤Ÿç”¨çš„ã€‚</p><p><img src="http://tao93.top/images/2019/08/04/1564912278.png" alt=""></p><h4 id="Finder"><a href="#Finder" class="headerlink" title="Finder"></a>Finder</h4><p>å…³äºŽ Finderï¼Œæœ‰ä¸€ä¸‹å‡ ç‚¹å»ºè®®ï¼š</p><ul><li>åœ¨ Finder çš„è®¾ç½®ä¸­ï¼Œå°† <code>New Finder windows show</code> æ”¹ä¸ºä½¿ç”¨é¢‘çŽ‡æœ€é«˜çš„ç›®å½•ï¼Œæ¯”å¦‚ Download æˆ–ä¸ªäººå·¥ä½œç›®å½•ï¼š</li></ul><p><img src="http://tao93.top/images/2019/08/04/1564912792.png" alt=""></p><ul><li>åœ¨ Finder çš„è®¾ç½®ä¸­ï¼Œå°†æœç´¢è®¾ç½®ä¸ºæœç´¢å½“å‰ç›®å½• (é»˜è®¤å±…ç„¶æ˜¯æœç´¢æ•´ä¸ª Mac ðŸ˜¢)ï¼š</li></ul><p><img src="http://tao93.top/images/2019/08/04/1564913032.png" alt=""></p><ul><li>åœ¨æµè§ˆç›®å½•æˆ–æ–‡ä»¶æ—¶ï¼Œå»ºè®®ç”¨ä¸‹é¢çš„è§†å›¾</li></ul><p><img src="http://tao93.top/images/2019/08/04/1564913106.png" alt=""></p><ul><li>å»ºè®®å¤šä½¿ç”¨ Tab æ ‡ç­¾é¡µï¼Œè€Œä¸æ˜¯æ‰“å¼€æ–°çš„ Finder çª—å£ã€‚</li></ul><h3 id="å¯¹ç¨‹åºå‘˜"><a href="#å¯¹ç¨‹åºå‘˜" class="headerlink" title="å¯¹ç¨‹åºå‘˜"></a>å¯¹ç¨‹åºå‘˜</h3><p>ä»¥ä¸‹æ˜¯é¢å‘ç¨‹åºå‘˜çš„å†…å®¹<del>ï¼Œéžæˆ˜æ–—äººå‘˜è¯·é€Ÿé€Ÿæ’¤é€€</del>ã€‚</p><h4 id="Terminal"><a href="#Terminal" class="headerlink" title="Terminal"></a>Terminal</h4><p>ç½‘ä¸Šå¾ˆå¤šæ–‡ç« ä¸€ä¸Šæ¥å°±æ˜¯ <a href="https://www.iterm2.com/" target="_blank" rel="noopener">iTerm2</a>ï¼Œä¸è¿‡æˆ‘å€’æ˜¯è§‰å¾— macOS è‡ªå¸¦çš„ Terminal å·²ç»å¤Ÿå¼ºå¤§äº†ï¼Œå¹¶ä¸”å­—ä½“æ›´å¥½çœ‹ç‚¹ï¼Œå†è¯´æœ¬ç€èƒ½ç”¨ç³»ç»Ÿè‡ªå¸¦å°±ä¸ç”¨ç¬¬ä¸‰æ–¹ï¼Œæˆ‘å°±ä¸€ç›´é»˜è®¤ä½¿ç”¨ Terminalã€‚</p><p>macOS ä¸Š Terminal çª—å£é»˜è®¤å¤ªå°äº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶è®¾ç½® &gt; Profiles &gt; Window &gt; Window Size ä¸­è®¾ç½®æ›´å¤§çš„è¡Œåˆ—æ•°ï¼Œä»Žè€Œå……åˆ†åˆ©ç”¨æˆ‘ä»¬çš„å±å¹•ï¼ŒçœåŽ»æ‹–æ‹½çª—å£è¾¹ç¼˜çš„è¡Œä¸ºã€‚</p><p>å¦‚æžœæ—¶å¸¸ä½¿ç”¨ Terminalï¼Œä»¥ä¸‹å¿«æ·é”®æ˜¯éžå¸¸ Life Saving çš„ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">å¿«æ·é”®</th><th style="text-align:center">ä½œç”¨</th></tr></thead><tbody><tr><td style="text-align:center">Ctrl + U</td><td style="text-align:center">æ¸…é™¤å·²è¾“å…¥çš„å†…å®¹</td></tr><tr><td style="text-align:center">Ctrl + A</td><td style="text-align:center">å…‰æ ‡ç§»åŠ¨åˆ°è¡Œé¦–</td></tr><tr><td style="text-align:center">Ctrl + E</td><td style="text-align:center">å…‰æ ‡ç§»åŠ¨åˆ°è¡Œæœ«</td></tr><tr><td style="text-align:center">Ctrl + K</td><td style="text-align:center">åˆ é™¤å…‰æ ‡ä¹‹åŽçš„å†…å®¹</td></tr></tbody></table></div><p>ç»†å¿ƒçš„è¯»è€…å¯èƒ½ä¼šå‘çŽ°ä¸Šé¢å¿«æ·é”®éƒ½æ˜¯ä½¿ç”¨åäººç±»çš„ Ctrl è€Œä¸æ˜¯ Mac ä¸Šçš„ Cmdï¼Œå…¶å®žä¸Šé¢çš„å¿«æ·é”®åŽ†å²éžå¸¸æ‚ ä¹… (é‚£æ—¶å¯èƒ½è¿˜æ²¡æœ‰è‹¹æžœå…¬å¸)ï¼Œæ˜¯ä»Žæ—©æœŸ Unix ç³»ç»Ÿæµä¼ ä¸‹æ¥ï¼Œæ‰€ä»¥åŒæ ·é€‚ç”¨äºŽ Linux (å¯èƒ½ä¼šæœ‰ç»†å¾®å·®åˆ«)ã€‚å¦å¤–ï¼Œä¹‹å‰ã€Œå…‰æ ‡è¦å¿«ã€è®²çš„æŒ‰ä½ Option æ—¶æŒ‰å·¦å³æ–¹å‘é”®æ¥å¿«é€Ÿç§»åŠ¨å…‰æ ‡ï¼Œåœ¨æ­¤åŒæ ·é€‚ç”¨ã€‚</p><p>é¡ºå¸¦è¯´ä¸‹å¯èƒ½å¤§å®¶ä¸çŸ¥é“çš„ä¸¤ä¸ªéžå¸¸æœ‰ç”¨çš„å‘½ä»¤ï¼Œfile å’Œ typeã€‚å‰è€…å¯æ ¹æ®æ–‡ä»¶ meta data åˆ¤æ–­æ–‡ä»¶ç±»åž‹ï¼ŒåŽè€…å¯å‘ŠçŸ¥ä½ ä¸€ä¸ªå‘½ä»¤æ˜¯ä»¥ä¸‹æ¥æºä¸­çš„å“ªä¸€ç§ï¼šå†…å»ºå‘½ä»¤ (æ¯”å¦‚ type, cd ç­‰)ã€æŒ‡å®šè·¯å¾„ä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶ã€ç¬¦å·é“¾æŽ¥ã€‚å¦å¤–å¦‚æžœç”µè„‘ä¸­ä¸å°å¿ƒæœ‰ä¸¤ä¸ªæŸå‘½ä»¤(æ¯”å¦‚ä¸¤ä¸ª python)ä¸”éƒ½åŠ å…¥äº† PATH çŽ¯å¢ƒå˜é‡ï¼Œ<code>type xxx</code> ä¼šæ˜¾ç¤ºå½“å‰ä½¿ç”¨çš„ xxx çš„è·¯å¾„ï¼Œè€Œ <code>which -a xxx</code> åˆ™æ˜¾ç¤ºæ‰€æœ‰å·²åŠ å…¥ PATH çŽ¯å¢ƒå˜é‡ çš„ xxxã€‚</p><h4 id="Oh-My-Zsh"><a href="#Oh-My-Zsh" class="headerlink" title="Oh My Zsh"></a>Oh My Zsh</h4><p><a href="https://ohmyz.sh/" target="_blank" rel="noopener">Oh My Zsh</a> æ˜¯ä¹…è´Ÿç››åçš„å¼€æºé¡¹ç›®ï¼Œå®ƒå‡ ä¹Žè®© macOS ä¸­ Zsh çš„ä¸Šæ‰‹éš¾åº¦å˜ä¸ºäº† 0ã€‚é¦–å…ˆå•°å—¦ä¸€ä¸‹ï¼ŒmacOS ä¸€ç›´ä½¿ç”¨ bash ä½œä¸ºé»˜è®¤ Shellï¼Œè¿™ä¹Ÿæ˜¯å¸¸è§ Linux å‘è¡Œç‰ˆçš„åšæ³•ã€‚</p><p>æˆ‘ä¸ªäººæœ€å–œæ¬¢ On My Zsh çš„ä¸€ä¸‹ç‰¹æ€§ï¼š</p><ul><li>æŒ‰å·²è¾“å…¥æ–‡æœ¬æœç´¢åŽ†å²å‘½ä»¤ã€‚å¤§å®¶éƒ½çŸ¥é“ bash ä¸­æŒ‰å‘ä¸Šæ–¹å‘é”®å¯ä»¥ä¸€æ¡æ¡æ˜¾ç¤ºåŽ†å²å‘½ä»¤ï¼Œè€Œ On My Zsh åˆ™å¯ä»¥æ¯”å¦‚è¾“å…¥ <code>adb shell</code> åŽæŒ‰å‘ä¸Šæ–¹å‘é”®ï¼Œæ˜¾ç¤ºçš„å…¨éƒ¨æ˜¯ <code>adb shell</code> å¼€å¤´çš„åŽ†å²å‘½ä»¤ï¼Œè¿™è®©æˆ‘ä»¬æ›´å¿«æ‰¾åˆ°æƒ³è¦çš„åŽ†å²å‘½ä»¤ã€‚</li><li>æ›´ç®€å•çš„ç›®å½•é€‰æ‹©ã€‚æ¯”å¦‚è¾“å…¥ ls åŽï¼ŒæŒ‰ tab é”®ï¼Œä¼šæ˜¾ç¤ºå½“å‰ç›®å½•æ‰€æœ‰ itemï¼Œç„¶åŽå¯ä»¥ç›´æŽ¥æŒ‰ä¸Šæ–¹å‘é”®é€‰ä¸­ item å†æŒ‰å›žè½¦ç¡®è®¤ã€‚</li><li>å¦‚æžœå½“å‰ç›®å½•åœ¨ Git é¡¹ç›®ä¸­ï¼Œä¼šæ˜¾ç¤ºå½“å‰åˆ†æ”¯ï¼Œä»¥åŠæ˜¯å¦æœ‰æœªæäº¤æ”¹åŠ¨çš„å°å‰å‰ã€‚</li><li>æ›´ä¸°å¯Œçš„é«˜äº®è‰²å’Œä¸»é¢˜å®šåˆ¶åŠŸèƒ½ã€‚</li></ul><p>å¦‚æžœä¸Šé¢æœ‰ä½ æƒ³è¦åŠŸèƒ½ï¼Œè¯·è‡ªè¡Œå®‰è£… ðŸ˜</p><h4 id="Homebrew"><a href="#Homebrew" class="headerlink" title="Homebrew"></a>Homebrew</h4><p><a href="https://brew.sh/" target="_blank" rel="noopener">Homebrew</a> æ˜¯åˆä¸€ä¸ªä¸Šä¸‡ star çš„å¼€æºé¡¹ç›®ï¼Œå¤§å®¶å¯èƒ½æ—©å°±çŸ¥é“äº†å®ƒï¼Œæ‰€ä»¥æˆ‘å°±åªç®€å•è¯´è¯´ã€‚</p><p>Homebrew è‡ªç§°æ˜¯ macOS ä¸Šç¼ºå¤±çš„åŒ…ç®¡ç†å™¨ï¼Œçš„ç¡®å¦‚æ­¤ï¼ŒLinux å‘è¡Œç‰ˆæœ‰å„ç§ç®¡ç†å‘½ä»¤è¡Œè½¯ä»¶åŒ…çš„åŒ…ç®¡ç†å™¨ï¼Œè€Œ macOS é»˜è®¤æ²¡æœ‰ã€‚</p><p>Homebrew çš„ <a href="https://github.com/Homebrew/homebrew-core" target="_blank" rel="noopener">core repo</a> ä¸ºæ¯ä¸ªåŒ…ç»´æŠ¤ä¸€ä¸ª ruby è„šæœ¬æ–‡ä»¶ï¼Œæ”¹æ–‡ä»¶è®°å½•äº†è¿™ä¸ªåŒ…çš„ä¾èµ–ä¿¡æ¯ï¼Œç‰ˆæœ¬æ›´è¿­ä¿¡æ¯ï¼Œä»Žå“ªé‡ŒèŽ·å– binary åŒ…æˆ–è€…æºä»£ç ã€ç¼–è¯‘æ–¹æ³•ç­‰ç­‰ä¿¡æ¯ã€‚æœ‰äº†è¿™äº›ä¿¡æ¯ï¼ŒHomebrew å°±å¯ä»¥ç®¡ç†åŒ…çš„å®‰è£…(åŒ…æ‹¬ä¸‹è½½æºç ç¼–è¯‘çš„æ–¹å¼)ã€å‡çº§ã€å¸è½½ã€ä¾èµ–ä¸‹è½½ç­‰ï¼Œä¹Ÿå°±å®žçŽ°äº†åŒ…ç®¡ç†å™¨çš„åŠŸèƒ½ã€‚è¿™ä¸ª core repo åœ¨æˆ‘ä»¬æœ¬åœ°ä¹Ÿæœ‰ä¸€ä»½ï¼ŒHomebrew çš„ updating å…¶å®žæœ¬åœ°çš„ repo pull è¿œç¨‹çš„å˜åŒ–ï¼Œä¹Ÿå°±æ˜¯è¿™äº› ruby è„šæœ¬çš„å¢žåˆ æ”¹ç»™ pull è¿‡æ¥ã€‚è½¯ä»¶åŒ…çš„åå­—æ˜¯å”¯ä¸€æ€§çš„ï¼Œå› è€Œä¸Šè¿° ruby è„šæœ¬ç›´æŽ¥ä»¥è½¯ä»¶åŒ…çš„åå­—å‘½åï¼Œä¹Ÿæ˜¯ä¸ä¼šé‡å¤çš„ã€‚</p><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒHomebrew æŠŠ core repo å’ŒåŽé¢è®²åˆ°çš„ cask repo å«åš tapï¼Œè€Œ tap é‡Œé¢ç®¡ç†çš„ä¾èµ–åŒ…ï¼Œå«åš formulaï¼Œäº†è§£è¿™äº›æœ¯è¯­æœ‰åˆ©äºŽçœ‹æ‡‚ Homebrew çš„æç¤ºã€‚</p><p>Homebrew å®‰è£…è½¯ä»¶åŒ…ï¼Œé€šå¸¸æ˜¯åœ¨ <code>/usr/local</code> ç›®å½•ä¸­ä»¥è¯¥è½¯ä»¶åŒ…åå­—ä¸ºåå»ºç«‹ç›®å½•ï¼Œç„¶åŽå…¶ä¸­å†ä»¥ç‰ˆæœ¬å·ä¸ºåå»ºç«‹ç›®å½•ï¼Œç‰ˆæœ¬å·ç›®å½•ä¸­å«æœ‰è¯¥ç‰ˆæœ¬çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä¸”å¾€å¾€æœ‰ä¸ª bin ç›®å½•æ¥åŒ…å«è½¯ä»¶åŒ…çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒHomebrew å¯ä»¥åŒäº‹ç»´æŠ¤å¤šä¸ªç‰ˆæœ¬ã€‚è€ŒçœŸæ­£åŠ å…¥åˆ° PATH çŽ¯å¢ƒå˜é‡çš„å…¶å®žæ˜¯ <code>/usr/local/bin</code> ç›®å½•ã€‚Homebrew æ¯æ›´æ–°æˆ–å®‰è£…ä¸€ä¸ªè½¯ä»¶åŒ…ï¼Œ<code>/usr/local/bin</code> ä¸­éƒ½ä¼šæ›´æ–°æˆ–æ–°å»ºä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼Œæ¥æŒ‡å‘æ­¤è½¯ä»¶åŒ…æœ€æ–°çš„ç‰ˆæœ¬çš„çœŸæ­£å¯æ‰§è¡Œæ–‡ä»¶ã€‚ä»Žè€Œæˆ‘ä»¬æ‰§è¡Œæ­¤ç¬¦å·é“¾æŽ¥ï¼Œå°±å¯ä»¥è¿è¡Œæœ€æ–°çš„è½¯ä»¶åŒ…ã€‚</p><p>Homebrew ç®¡ç†çš„å‘½ä»¤è¡Œè½¯ä»¶ï¼Œå¾ˆå¤šæ˜¯ GNU å¼€æºè½¯ä»¶ï¼Œè¿™äº›è½¯ä»¶çš„åˆ†å‘åœ¨å›½å†…æœ‰ä¸å°‘é•œåƒï¼Œä»Žè€Œèƒ½åŠ å¿«æˆ‘ä»¬çš„ä¸‹è½½é€Ÿåº¦ã€‚ä¸ºæ­¤ï¼Œcore repo åœ¨å›½å†…ä¹Ÿæœ‰é•œåƒ (æ¯”å¦‚<a href="http://mirrors.ustc.edu.cn/help/brew.git.html" target="_blank" rel="noopener">ä¸­å›½ç§‘å¤§çš„é•œåƒ</a>)ï¼Œåªä¸è¿‡è¿™ä¸ªé•œåƒå¹¶éžå’Œ Homebrew å®˜æ–¹çš„ repo å®Œå…¨ä¸€è‡´ï¼Œè€Œæ˜¯ä¸‹è½½é“¾æŽ¥æŒ‡å‘å›½å†…çš„ä¸€äº›è½¯ä»¶æºé•œåƒï¼Œä¹Ÿåªæœ‰è¿™æ ·æ‰èƒ½çœŸæ­£åŠ å¿«ä¸‹è½½è½¯ä»¶åŒ…çš„é€Ÿåº¦ã€‚</p><p>æ­¤å¤–ï¼ŒHomebrew ä¹Ÿæ”¯æŒä¸€äº› GUI è½¯ä»¶ (å¦‚ Google Chrome å’Œ Sublime Text ç­‰) çš„ç®¡ç†ã€‚GUI è½¯ä»¶çš„ç®¡ç†ï¼Œæ˜¯ç”± <a href="https://github.com/Homebrew/homebrew-cask" target="_blank" rel="noopener">cask repo</a> æ¥æ”¯æ’‘çš„ã€‚ä½¿ç”¨ Homebrew å®‰è£… GUI è½¯ä»¶ï¼Œé€šå¸¸ä¹Ÿä¼šåœ¨ <code>/usr/local/bin</code> ä¸­æ–°å»ºç¬¦å·é“¾æŽ¥æ¥ï¼Œä½¿æˆ‘ä»¬å¯ä»¥åœ¨ Shell ä¸­å¯åŠ¨ GUI è½¯ä»¶ã€‚æ¯”å¦‚ Sublime Text å®‰è£…å¥½åŽï¼Œå°±ä¼šæœ‰ subl è¿™ä¸ªç¬¦å·é“¾æŽ¥ï¼š</p><p><img src="http://tao93.top/images/2019/08/04/1564931295.png" alt=""></p><p>æˆ‘ä»¬ç›´æŽ¥æ‰§è¡Œ <code>subl</code> å³å¯æ‰“å¼€ Sublime Textï¼Œè€Œ <code>subl</code> åŠ ä¸Šæ–‡ä»¶åï¼Œè¿˜å¯æ‰“å¼€æŒ‡å®šæ–‡ä»¶ã€‚</p><h4 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h4><p>æ­£åˆ™è¡¨è¾¾å¼åœ¨æˆ‘ä»¬æœç´¢ã€æ›¿æ¢ç»“æž„å¤æ‚çš„æ–‡æœ¬æ—¶éžå¸¸æœ‰ç”¨ã€‚è¿‡åŽ»ï¼Œç¨‹åºå‘˜åªèƒ½ç”¨ grep å’Œ sed å‘½ä»¤æ¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æŸ¥æ‰¾ã€æ›¿æ¢æ–‡æœ¬ï¼Œè€ŒçŽ°åœ¨ï¼Œè®¸å¤š IDE å’Œæ–‡æœ¬ç¼–è¾‘å™¨éƒ½æ”¯æŒåœ¨æŸ¥æ‰¾å’Œæ›¿æ¢æ—¶ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚</p><h4 id="æœ€åŽçš„æœ€åŽ"><a href="#æœ€åŽçš„æœ€åŽ" class="headerlink" title="æœ€åŽçš„æœ€åŽ"></a>æœ€åŽçš„æœ€åŽ</h4><p>æ•ˆçŽ‡ï¼Œåœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­æ˜¯æŒ‡åŒæ ·æ—¶é—´å†…å®Œæˆå·¥ä½œçš„å¤šå°‘ã€‚è¿½æ±‚æ•ˆçŽ‡æ˜¯æ— å¯åŽšéžçš„ï¼Œç„¶è€Œå¤„åœ¨è¿™æ ·ä¸€ä¸ªå¿«èŠ‚å¥çš„çŽ°ä»£ç¤¾ä¼šä¸­ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ä¹Ÿéœ€è¦æ…¢ä¸‹æ¥ï¼Œæ‚ ç„¶å’Œç¼“çš„æ“æŒæˆ‘ä»¬çš„ç”µè„‘ï¼Œäº«å—ä»»åŠ¡å®ŒæˆåŽçš„ä¸€åˆ»å®é™<del>ï¼Œä¸ç„¶åˆ«äººä»¥ä¸ºäº¤ç»™æˆ‘ä»¬çš„ä»»åŠ¡å¤ªç®€å•äº†</del>ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;æèµ· macOSï¼Œå¤§å®¶å¯èƒ½ä¼šæƒ³åˆ°ç²¾è‡´ã€å¹¿å‘Šå°‘ã€è½¯ç¡¬æ­é…æžä½³ã€Unix ç­‰ç­‰ï¼Œè¿™äº›ä¹Ÿæ˜¯ macOS é€æ¸åœ¨è½¯ä»¶å¼€å‘è€…ã€è®¾è®¡å¸ˆã€æ–‡å­—å·¥ä½œè€…ç­‰ç¾¤é‡Œ
      
    
    </summary>
    
    
      <category term="macOS" scheme="https://tao93.top/tags/macOS/"/>
    
  </entry>
  
  <entry>
    <title>ç»™ä¸‰æ˜Ÿ tablet SM-T830 åˆ·æœº</title>
    <link href="https://tao93.top/2019/07/10/Flash%20stock%20firmware%20in%20SM-T830/"/>
    <id>https://tao93.top/2019/07/10/Flash stock firmware in SM-T830/</id>
    <published>2019-07-11T03:54:34.000Z</published>
    <updated>2019-07-11T03:54:34.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>å‰å¤©å…¬å¸å‘ç»™æˆ‘ä¸€éƒ¨ä¸‰æ˜Ÿ tablet ä½œä¸ºæµ‹è¯•æœºï¼Œæ˜¯ Tab S4 wifi ç‰ˆï¼Œå…·ä½“åž‹å·æ˜¯ SM-T830ï¼Œè™½ç„¶ä¸æ˜¯æˆ‘æœŸå¾…çš„ Pixel 3 XLï¼Œä½†æ˜¯é…ç½®ä¹Ÿè¿˜ä¸é”™ï¼ŒåŠ ä¸Šå±å¹•ä¹Ÿæ¯”è¾ƒå¤§ã€‚ä½†æ˜¯å‘å°±å‘åœ¨ï¼Œè¿™æ˜¯ä¸€éƒ¨å›½è¡Œçš„æœºå™¨ï¼Œæ²¡æœ‰ Google Mobile Service (GMS) ä¸è¯´ï¼Œè¿˜å……æ–¥äº†ä¸å°‘å›½å†…ç”Ÿæ€çš„æ‚ç‰©ï¼Œæ¯”å¦‚ç³»ç»Ÿè®¾ç½®ä¸­çš„ device storage ç•Œé¢ï¼Œå±…ç„¶å†™ç€ã€Œpowered by 360ã€ï¼Œè¿˜æœ‰ä¸€äº›é¢„è£…çš„å›½å†…åº”ç”¨ã€‚</p><p>è¿™æ—¶æ‘†åœ¨æˆ‘å‰é¢çš„æœ‰ä¸‰ç§æ–¹æ³•ï¼šç¬¬ä¸€ï¼Œåˆ·æœºåˆ·å…¥ä¸€ä¸ªåŽŸç”Ÿ Android ç³»ç»Ÿï¼Œè¿™å½“ç„¶æ˜¯æœ€å®Œç¾Žçš„ï¼›ç¬¬äºŒï¼Œæ‰¾ä¸€ä¸ªä¸‰æ˜Ÿå®˜æ–¹çš„ä½†æ˜¯æ˜¯å›½å¤–ç‰ˆçš„ç³»ç»Ÿåˆ·å…¥ï¼Œè¿™ç§ç³»ç»Ÿä¼šæœ‰ GMSï¼›ç¬¬ä¸‰ï¼Œè‡ªå·±æŠŠç¡®å®žçš„ Google æœåŠ¡å®‰è£…ä¸ŠåŽ»ï¼Œå‡‘æ´»ç€ç”¨ã€‚</p><p>ä»¥ä¸Šç¬¬ä¸€ç§æ–¹æ³•ï¼Œæˆ‘åœ¨ç½‘ä¸ŠæŸ¥äº†æŸ¥ï¼Œå‡ ä¹Žä¸å¯èƒ½ï¼Œå› ä¸ºè¿™ä¸ª æœºåž‹æ¯”è¾ƒå°ä¼—ï¼Œç½‘ä¸Šæ ¹æœ¬æ²¡æœ‰ç»™å®ƒåˆ·åŽŸç”Ÿç³»ç»Ÿçš„æ–¹æ³•ï¼Œå°±è¿ž <a href="https://lineageos.org/" target="_blank" rel="noopener">LineageOS</a> ä¹Ÿæ²¡æœ‰æ”¯æŒè¿™ä¸ªæœºåž‹ã€‚ç¬¬äºŒç§æ–¹æ³•ï¼Œæ˜¯æ¯”è¾ƒå¯è¡Œçš„ï¼Œè¿™æ¬¾ tablet å³ä½¿å°ä¼—ï¼Œä¹Ÿæ˜¯åœ¨å…¨çƒé”€å”®çš„ï¼Œå›½å¤–ç»å¤§éƒ¨åˆ†åœ°åŒºé”€å”®çš„éƒ½æ˜¯å¸¦æœ‰ GMS çš„ï¼Œæ­¤å¤–è¿™æ˜¯ä¸ª WiFi ç‰ˆæœºåž‹ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒè¿è¥å•†å’Œç½‘ç»œåˆ¶å¼çš„é—®é¢˜ï¼Œæ‰€ä»¥åˆ·æˆåŠŸçš„è¯ï¼Œè™½ä¸æ˜¯åŽŸç”Ÿ Androidï¼Œä½†ä¹Ÿæœ‰å®Œæ•´å¯é çš„ GMS å…¨ä»¶å¥—ã€‚ç¬¬ä¸‰ç§æ–¹æ³•ï¼Œæ”¹åŠ¨æœ€å°ï¼Œä½†æ˜¯ä¹Ÿå¯èƒ½æœ‰åŽé—ç—‡ï¼Œå› ä¸ºè¿™æ ·è‡ªè¡Œè¡¥å……å®‰è£… Google service çš„æ–¹å¼æœ‰å¯èƒ½æ˜¯ä¸å®Œå¤‡å¯é çš„ï¼ŒæŒ‡ä¸å®šå•¥æ—¶å€™å°±å‡ºç‚¹ bugã€‚</p><p>æ‰€ä»¥æˆ‘å°±å¼€å§‹å®žæ–½ç¬¬äºŒç§æ–¹æ³•ï¼šåˆ·å…¥ä¸‰æ˜Ÿå®˜æ–¹å›ºä»¶çš„å›½å¤–ç‰ˆæœ¬ï¼Œæœ€åŽè¿™ä»¶äº‹æŠ˜è…¾äº†æˆ‘ä¸€å¤©å¤šã€‚</p><h4 id="ä¸‹è½½-é”™è¯¯çš„-å›ºä»¶åŒ…"><a href="#ä¸‹è½½-é”™è¯¯çš„-å›ºä»¶åŒ…" class="headerlink" title="ä¸‹è½½ (é”™è¯¯çš„) å›ºä»¶åŒ…"></a>ä¸‹è½½ (é”™è¯¯çš„) å›ºä»¶åŒ…</h4><p>é¦–å…ˆæ˜¯èŽ·å–å›ºä»¶åŒ…ï¼Œåœ¨ç½‘ä¸Šæ‰¾äº†ä¸€é€šï¼Œæ‰¾åˆ°äº† xda ä¸Šçš„<a href="https://forum.xda-developers.com/galaxy-tab-s4/how-to/sm-t830-t830xxu1arh1-t3831918" target="_blank" rel="noopener">è¿™ä¸ªå¸–å­</a>ï¼Œé‡Œé¢è´´å‡ºäº†å­˜æ”¾åœ¨ Google drive çš„é€‚ç”¨äºŽ SM-T830 çš„ä¸¤ä¸ªå®˜æ–¹å›ºä»¶çš„é“¾æŽ¥ï¼Œä¸€ä¸ªæ˜¯æ³•å›½ç‰ˆï¼Œå¦ä¸€ä¸ªæ˜¯é˜¿æ‹‰ä¼¯è”åˆé…‹é•¿å›½ç‰ˆã€‚å¸–å­çš„ä½œè€…è¿˜è¯´ï¼Œä»–å¯¹åˆ·æœºå¯èƒ½å‡ºçŽ°çš„åŽæžœä¸è´Ÿä»»ä½•è´£ä»»ï¼Œæä¾›è¿™ä¸¤ä¸ªåŒ…åªæ˜¯è®©å¤§å®¶å…æ”¶ä¸€äº›ç½‘ç«™è¦æ”¶è´¹æ‰èƒ½ä¸‹è½½å›ºä»¶åŒ…æˆ–è€…æ˜¯ä»˜è´¹æ‰èƒ½æé€Ÿä¸‹è½½çš„æ¶å¿ƒã€‚è¯è¯´ï¼ŒSM-T830 çš„å°ä¼—ï¼Œä»Žæˆ‘æœé xda ä¹Ÿæ²¡æ‰¾åˆ°å‡ ä¸ªå’Œå®ƒç›¸å…³çš„å¸–å­å³å¯ç•¥è§ä¸€æ–‘ã€‚</p><p>å›ºä»¶åŒ…å¤§å°çº¦æ˜¯ 3.6 GBï¼Œèµ·å…ˆæˆ‘ä»Žæµè§ˆå™¨ç›´æŽ¥ä¸‹è½½ Google drive ä¸Šçš„å›ºä»¶åŒ…ï¼Œç½‘é€Ÿå¾ˆæ…¢åªæœ‰ 100KB/S çš„æ ·å­ï¼Œä¸‹äº†æŒºä¹…æœ€åŽéƒ½å¤±è´¥äº†ã€‚åŽé¢æˆ‘å‘çŽ°ï¼Œå…ˆæŠŠå›ºä»¶æ·»åŠ åˆ°æˆ‘è‡ªå·±çš„ Google drive ç©ºé—´ï¼Œç„¶åŽåœ¨æ‰‹æœºä¸Šçš„ Google drive åº”ç”¨ä¸­ä¸‹è½½ï¼Œé…åˆå…¬å¸çš„ç½‘ç»œçŽ¯å¢ƒï¼Œé€Ÿåº¦å¯ä»¥å¾ˆå¿«ï¼Œå·®ä¸å¤šåŠä¸ªå°æ—¶å°±ä¸‹è½½å¥½äº†ã€‚</p><h4 id="ä¼å›¾ç”¨è™šæ‹Ÿæœºï¼Œå¤±è´¥"><a href="#ä¼å›¾ç”¨è™šæ‹Ÿæœºï¼Œå¤±è´¥" class="headerlink" title="ä¼å›¾ç”¨è™šæ‹Ÿæœºï¼Œå¤±è´¥"></a>ä¼å›¾ç”¨è™šæ‹Ÿæœºï¼Œå¤±è´¥</h4><p>ä¸‰æ˜Ÿçš„å†…éƒ¨åˆ·æœºå·¥å…· odinï¼Œåªèƒ½ç”¨ Windows è¿è¡Œï¼Œæˆ‘æ‰‹é‡Œåªæœ‰ Macï¼Œæ‰€ä»¥æˆ‘ä¸€å¼€å§‹å¸Œæœ›ç”¨ virtual box ä¸­çš„ win10 è™šæ‹Ÿæœºæ¥æ“ä½œã€‚æˆ‘ä»Žç¡¬ç›˜é‡Œé¢æŠŠå¾ˆä¹…å‰å¤‡ä»½çš„ win10 çš„ virtual disk image (ä¹Ÿå°±æ˜¯ä¸€ä¸ª .vdi æ–‡ä»¶) æ‹·è´åˆ°ç”µè„‘ï¼Œç„¶åŽä»¥æ­¤æ–°å»ºä¸€ä¸ªè™šæ‹Ÿæœºï¼ŒæˆåŠŸçš„è¿è¡Œï¼Œä½†æ˜¯é¼“æ£äº†åŠå¤©ï¼Œä¹Ÿæ— æ³•è®©è¿™ä¸ªè™šæ‹Ÿæœºè¿žæŽ¥ USB è®¾å¤‡ï¼Œåˆ«è¯´è¿™å° tablet ä¸è¡Œï¼Œè¿ž U ç›˜éƒ½ä¸è¡Œã€‚VirtualBox VM Extension Pack å®‰è£…äº†ï¼Œåœ¨ win10 é‡Œé¢ä¹Ÿå®‰è£…äº† Guest Additionsï¼ŒUSB device filters ä¹Ÿé…ç½®äº†ï¼Œå°±æ˜¯ä¸è¡Œï¼Œåªèƒ½æ”¾å¼ƒï¼Œæ‰¾åŒäº‹å€Ÿç”¨ Windows å°å¼æœºã€‚</p><p><strong>2019å¹´1æœˆ1æ—¥æ›´æ–°</strong>ï¼šæˆ‘åŽé¢ VirtualBox è£… Windows è™šæ‹Ÿæœºæ˜¯å¯ä»¥è¿žæŽ¥åˆ° Android è®¾å¤‡çš„ï¼Œå¹¶ä¸”å¯ä»¥åˆ·æœºï¼Œè§<a href="https://tao93.top/2019/01/01/%E7%BB%99%E4%B8%89%E6%98%9F%20tablet%20SM-T830%20%E5%88%B7%E6%9C%BA[%E7%BB%AD]/">ç»™ä¸‰æ˜Ÿ tablet SM-T830 åˆ·æœº[ç»­]</a> çš„æœ€åŽä¸€éƒ¨åˆ†</p><h4 id="å¤±è´¥çš„åˆ·æœº"><a href="#å¤±è´¥çš„åˆ·æœº" class="headerlink" title="å¤±è´¥çš„åˆ·æœº"></a>å¤±è´¥çš„åˆ·æœº</h4><p>åœ¨åŒäº‹çš„å°å¼æœºä¸Šæ“ä½œä¹‹å‰ï¼Œæˆ‘åœ¨ç½‘ä¸Šå·²ç»çœ‹äº†ä¸€æ®µè®²è§£åˆ·æœºè¿‡ç¨‹çš„è§†é¢‘ï¼Œæ„Ÿè§‰æŒºç®€å•çš„ï¼Œå°±å‡ ä¸ªæ­¥éª¤è€Œå·²ã€‚ç­‰åˆ°å¼€å§‹åœ¨ Windows ä¸Šé¢å¼€å§‹å¼„ï¼Œæˆ‘æŠŠå›ºä»¶åŒ…è§£åŽ‹ï¼Œç„¶åŽç”¨ odin å¼€å§‹ï¼Œè¿™æ‰å‘çŽ°é‚£ä¸ªè§†é¢‘å…¶å®žè¿‡æ—¶äº†ï¼Œè§†é¢‘ä¸­å›ºä»¶åŒ…è§£åŽ‹åŽåªæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯æˆ‘è§£åŽ‹åŽå…¶å®žæœ‰ 4 ä¸ªæ–‡ä»¶ã€‚å…¶å®žè¿™ä¸€ç‚¹ Odin ä¸­éƒ½å·²ç»æç¤ºäº†ï¼Œnew model éœ€è¦ 4 ä¸ªæ–‡ä»¶ï¼š</p><p><img src="http://tao93.top/images/2018/12/08/1544280785.png" alt=""></p><p>æ‰€ä»¥æˆ‘çš„å›ºä»¶åŒ…æ˜¯æ¯”è¾ƒæ–°çš„ï¼Œæ‰€ä»¥æœ‰å¤šä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯ä»”ç»†å¯¹æ¯”å‘çŽ°æœ‰ç‚¹é—®é¢˜ï¼Œodin éœ€è¦çš„æ˜¯ BL, AP, CP, HOME_CSC 4 éƒ¨åˆ†ï¼Œä½†æ˜¯æˆ‘çš„å›ºä»¶åŒ…è§£åŽ‹åŽ 4 ä¸ªæ–‡ä»¶çš„æ–‡ä»¶åæ˜¯å¦‚ä¸‹æ‰€ç¤º (æ–‡ä»¶æˆ‘å·²ç»åˆ æŽ‰äº†ï¼Œæ‰€ä»¥æ²¡æ³•è´´å‡ºå®Œæ•´æ–‡ä»¶å)ï¼š</p><blockquote><p>BLâ€¦<br>APâ€¦<br>CSCâ€¦<br>HOME_CSCâ€¦</p></blockquote><p>ç›¸å½“äºŽæ²¡æœ‰ CP å¼€å¤´çš„ï¼Œåè€Œä¼¼ä¹Žæœ‰ä¸¤ä¸ª CSC çš„ï¼Œè¿™æ—¶æˆ‘ä¹Ÿæ²¡å¤ºå¤šç®¡ï¼Œä¾æ¬¡ç‚¹å‡» odin ä¸­çš„ BL, AP, CP, CSC å››ä¸ªå®‰è£…ï¼Œç„¶åŽæŠŠ 4 ä¸ªæ–‡ä»¶éƒ½æ·»åŠ è¿›åŽ»ï¼Œç„¶åŽå°±ç‚¹ start äº†ï¼Œç„¶åŽå°±å¤±è´¥äº†ã€‚äºŽæ˜¯æˆ‘æŠŠ CP å’Œ CSC éœ€è¦çš„æ–‡ä»¶è°ƒæ¢äº†ä¸€ä¸‹ï¼Œè¿˜æ˜¯å¤±è´¥ã€‚</p><p>è¿™æ—¶å€™æˆ‘å°±æŸ¥äº†ä¸€ä¸‹ä¸ºå•¥å°‘äº† CP å¼€å¤´çš„æ–‡ä»¶ï¼Œè¿™æ‰å‘çŽ°ï¼ŒåŽŸæ¥ WiFi ç‰ˆå°±æ˜¯æ²¡æœ‰ CP æ–‡ä»¶ï¼Œè¿™æ˜¯å’ŒåŸºå¸¦ç›¸å…³çš„ï¼Œåªæœ‰å¯æ’å¡ä¸Šç½‘çš„ç‰ˆæœ¬æ‰æœ‰ã€‚é¡ºä¾¿ä¹Ÿå‘çŽ°äº†æˆ‘çš„ CSCâ€¦ å’Œ HOME_CSCâ€¦ ä¸¤ä¸ªæ–‡ä»¶çš„åŒºåˆ«ï¼Œæ®è¯´å‰è€…æ˜¯å½»åº•æ¸…ç©ºæ•°æ®ï¼ŒåŽè€…ä¼šä¿ç•™ç”¨æˆ·æ•°æ®ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªæ–‡ä»¶å…¶å®žä½œç”¨æ˜¯ç±»ä¼¼çš„ï¼Œå…¶å®žæˆ‘ä¹Ÿæ³¨æ„åˆ°å®ƒä»¬å¤§å°ä¹Ÿéžå¸¸ç›¸è¿‘ï¼Œéƒ½æ˜¯ 180MB å·¦å³ã€‚</p><p>äºŽæ˜¯æˆ‘å°±ç©ºå‡º CP é‚£é‡Œä¸æ·»åŠ æ–‡ä»¶ï¼Œå…¶ä½™ 3 ä¸ªæ·»åŠ ä¸Šï¼Œç„¶åŽ startï¼Œç»“æžœå·¦è¾¹æ–‡æœ¬æ¡†åœç•™åœ¨ â€˜setupconnection..â€™ï¼Œæˆ‘ä¸€æŸ¥ï¼Œå‘çŽ°å¾ˆå¤šè¯´å¡åœ¨è¿™ä¸€æ­¥çš„ï¼Œçº·çº·åœ¨æ±‚ helpã€‚æ²¡åŠžæ³•æˆ‘å°±åªèƒ½ç»§ç»­æŸ¥ï¼Œæœ‰è¯´è¦å…ˆè¿è¡Œ odin åŽè¿žæŽ¥ USB æ•°æ®çº¿çš„(è¯•äº†ä¸è¡Œ)ã€‚æŸ¥äº†ä¸€é˜µï¼Œç»ˆäºŽæŸ¥åˆ°ä¸€ä¸ªçœ‹èµ·æ¥æ¯”è¾ƒé è°±çš„<a href="https://forum.xda-developers.com/sprint-galaxy-s6/help/odin-stuck-setupconnection-t3574320" target="_blank" rel="noopener">æ–¹æ³•</a>ï¼Œä¾ç„¶æ˜¯ xda è®ºå›ä¸Šçš„ï¼š</p><p><img src="http://tao93.top/images/2018/12/08/1544281510.png" alt=""></p><p>æˆ‘æŒ‰ç…§ä¸Šé¢è¯´çš„ä¸€æ­¥ä¸€æ­¥èµ°ï¼Œä¾ç„¶å¤±è´¥ï¼Œä½†æ˜¯æ²¡å†å¡åœ¨ setupconnection äº†ã€‚æˆ‘æ€»ç»“å‘çŽ°ï¼Œodin åº”è¯¥ç¡®å®žæœ‰ bugï¼Œæ˜Žæ˜Žè®¾å¤‡è¿žæŽ¥æ­£å¸¸ï¼Œå®ƒå°±æ˜¯å¡åœ¨è¿™ä¸€æ­¥ï¼Œè¿™æ—¶å€™å¯ä»¥è¿™ä¹ˆåšï¼š1. é‡æ–°å¯åŠ¨è®¾å¤‡ï¼Œ1. æ–­å¼€ USB è¿žæŽ¥ï¼Œ3. è¿›å…¥ downloading modeï¼Œ4. è¿žæŽ¥ USB ç„¶åŽå†åœ¨ odin ä¸­ startï¼Œå°±ä¸ä¼šå¡åœ¨é‚£ä¸€æ­¥äº†ã€‚</p><p>è¿›å…¥ Download æ¨¡å¼çš„æ–¹æ³•ï¼šå…ˆå…³æœºï¼Œç„¶åŽåŒæ—¶æŒ‰ä½ Volumn Up å’Œ Power é”®ï¼Œç­‰å±å¹•äº®åŽç«‹å³æ¾æ‰‹ï¼Œæ­¤æ—¶ä¼šè¿›å…¥ Recovery mode (ä¸‰æ˜Ÿè‡ªå·±çš„ recovery æˆ–è€…ç¬¬ä¸‰æ–¹ recovery æ¯”å¦‚ TWRP)ã€‚å¦‚æžœæ˜¯ä¸‰æ˜Ÿçš„ recoveryï¼Œé€‰æ‹© boot to bootloader å³å¯ï¼Œå¦‚æžœæ˜¯ TWRPï¼Œé€‰æ‹©è¿›å…¥ Download æ¨¡å¼å³å¯ã€‚</p><p>å›žåˆ°åˆšåˆšè¯´çš„ï¼Œè™½ç„¶æ²¡å¡åœ¨ setupconnection äº†ï¼Œä½†æ˜¯ä¾ç„¶å¤±è´¥ï¼Œæç¤ºå¤§æ¦‚æ˜¯ï¼š</p><blockquote><p><id:0 004=""> abl.elf</id:0></p><p><id:0 004=""> FAIL! (Auth)</id:0></p><id:0 004=""><p><id:0 004=""> Complete(Write) operation failed.</id:0></p><p><osm> All threads completed. (succeed 0 / failed 1)</osm></p></id:0></blockquote><p>ä»¥ abl.elf ä¸ºå…³é”®å­—åˆæ˜¯ä¸€ç•ªåœ¨ç½‘ä¸Šæœç´¢ï¼Œæœ€åŽå‘çŽ°<a href="http://bbs.gfan.com/android-9245022-1-1.html" target="_blank" rel="noopener">è¿™ä¸ªå¸–å­æœ‰</a>äººé‡åˆ°è¿™ä¸ªé—®é¢˜æœ€åŽè§£å†³äº†ï¼š</p><p><img src="http://tao93.top/images/2018/12/08/1544281993.png" alt=""></p><p>èµ·åˆæˆ‘å¯¹ã€Œå›ºä»¶ç‰ˆæœ¬è½åŽäºŽçŽ°æœ‰ç‰ˆæœ¬ã€è¿™å¥è¯ä¸ä»¥ä¸ºç„¶ï¼Œå› ä¸ºæˆ‘è§‰å¾—è¿™ä¸å°±æ„å‘³ç€åªèƒ½å‡çº§ä¸èƒ½é™çº§å˜›ï¼Œä¸ç§‘å­¦ã€‚ä½†åŽé¢æˆ‘å¿½ç„¶æƒ³åˆ°ï¼Œè¿™å¥è¯æ„æ€å¯èƒ½æ˜¯åˆ·æœºä¸èƒ½åˆ·é‚£äº›ç‰ˆæœ¬æ¯”è®¾å¤‡å‡ºåŽ‚æ—¶ç³»ç»Ÿç‰ˆæœ¬è¿˜æ›´æ—§çš„å›ºä»¶ï¼Œå°±ä¸Šè¿™ä¸ªäººç¡®å®žè§£å†³äº†é—®é¢˜ï¼Œå¹¶ä¸”æˆ‘å‰é¢ä¸‹çš„å›ºä»¶åŒ…éƒ½æ˜¯ 2018 å¹´ 8 æœˆä»½çš„ï¼Œç¡®å®žæœ‰ç‚¹æ—§ï¼Œæ‰€ä»¥æˆ‘å¼€å§‹æƒ³æ€Žä¹ˆä¸‹æœ€æ–°çš„ç”¨äºŽ SM-T830 çš„å›ºä»¶ã€‚</p><h4 id="ä¸‹è½½æœ€æ–°çš„å›ºä»¶åŒ…"><a href="#ä¸‹è½½æœ€æ–°çš„å›ºä»¶åŒ…" class="headerlink" title="ä¸‹è½½æœ€æ–°çš„å›ºä»¶åŒ…"></a>ä¸‹è½½æœ€æ–°çš„å›ºä»¶åŒ…</h4><p>è¿™æ—¶ï¼Œå°±åˆå›žåˆ°å¼€å§‹æ‰¾å›ºä»¶åŒ…çš„æ­¥éª¤äº†ï¼Œç½‘ä¸Šæ»¡æ˜¯å‡é“¾æŽ¥ï¼Œæˆ–è€…æ˜¯è¦æ³¨å†Œï¼Œè¦äº¤è´¹çš„ï¼Œæ‰¾å¾—äººå¿ƒç´¯ã€‚ä¸è¿‡ï¼Œæœ€åŽç«Ÿç„¶æ‰¾åˆ°ä¸€ä¸ªå« SamFirm tool çš„ç¥žå™¨ï¼Œè¿™ä¸ªç¥žå™¨å¯ä»¥ç›´æŽ¥é«˜é€Ÿä¸‹è½½æƒ³è¦çš„æœ€æ–°å›ºä»¶ï¼Œç®€ç›´ä¸èƒ½æ›´æ£’ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¾“å…¥ç³»ç»Ÿåž‹å·ï¼Œç„¶åŽé€‰æ‹© auto æ¨¡å¼æ¥æŸ¥æ‰¾ï¼Œå°±èƒ½æ‰¾åˆ°æœ€æ–°çš„å›ºä»¶ï¼Œå¹¶ä¸”ä¸‹è½½é€Ÿåº¦è¿˜å¾ˆå¿«ï¼<a href="https://forum.xda-developers.com/galaxy-tab-s/general/tool-samfirm-samsung-firmware-t2988647" target="_blank" rel="noopener">è¿™ä¸ªå¸–å­</a>å¯ä»¥ä¸‹è½½åˆ°è¿™ä¸ªç¥žå™¨ã€‚</p><p><img src="http://tao93.top/images/2018/12/08/1544283275.png" alt=""></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå‡†ç¡®åœ°å¡«å…¥åž‹å·ï¼Œå¡«å…¥è¦ä¸‹è½½çš„å›ºä»¶çš„å›½å®¶æˆ–åœ°åŒºä»£å·ï¼ˆè¿™é‡Œæˆ‘è¦å¡«çš„å°±æ˜¯æŸä¸ªå¤–å›½æˆ–å›½å¤–åœ°åŒºï¼Œè¿™æ ·å›ºä»¶åŒ…æ‰ä¼šæœ‰ GMSï¼‰ã€‚è¿™ä¸ªå›½å®¶æˆ–åœ°åŒºä»£å·å¯ä»¥ä»Ž<a href="https://www.sammobile.com/firmwares/galaxy-tab-s4/SM-T830/" target="_blank" rel="noopener">è¿™é‡Œ</a>æ‰¾åˆ°ï¼Œæˆ‘åœ¨ä¸Šä¸€å¼ å›¾ä¸­å¡«å…¥çš„æ˜¯ XEFï¼Œå…¶å®žå°±æ˜¯ä»£è¡¨æ³•å›½ã€‚å¡«å¥½åŽå‹¾é€‰ Autoï¼Œç„¶åŽç‚¹å‡» Check Updateï¼Œå³å¯æ£€æŸ¥åˆ°æœ€æ–°å›ºä»¶åŒ…çš„ä¿¡æ¯ï¼Œæˆ‘åœ¨ä»Šå¤©ï¼ˆ2018å¹´12æœˆ8æ—¥ï¼‰æ£€æŸ¥åˆ°çš„ SM-T830 çš„æ³•å›½ç‰ˆæœ€æ–°å›ºä»¶åŒ…å¦‚ä¸Šå›¾ç®­å¤´æ‰€ç¤ºï¼Œæ˜¯ 2018å¹´10æœˆ24æ—¥æ›´æ–°çš„ã€‚ç„¶åŽå°±å¯ä»¥åœ¨ SamFirm å³è¾¹ç‚¹ä¸‹è½½äº†ã€‚å»ºè®®å‹¾é€‰ Decrypt automaticallyï¼Œå¦åˆ™ ä¸‹è½½å¥½å›ºä»¶åŒ…åŽè¿˜éœ€è¦é‡æ–°è§£å¯†ï¼Œè´¹æ—¶é—´ã€‚</p><p>å›½å®¶æˆ–åœ°åŒºä»£å·æˆªå›¾ï¼š</p><p><img src="http://tao93.top/images/2018/12/08/1544283882.png" alt=""></p><h4 id="æˆåŠŸåˆ·æœº"><a href="#æˆåŠŸåˆ·æœº" class="headerlink" title="æˆåŠŸåˆ·æœº"></a>æˆåŠŸåˆ·æœº</h4><p>ä¸‹è½½åˆ°æœ€æ–°å›ºä»¶åŽï¼Œè§£åŽ‹ï¼Œç„¶åŽç”¨ odin ä¾æ¬¡å¡«å…¥ BL AP CSC ä¸‰ä¸ªåœ°æ–¹çš„æ–‡ä»¶ï¼Œç‚¹ startï¼Œç»§ç»­å¡åœ¨ setupconnectionï¼ŒæŒ‰ç…§æˆ‘ä¹‹å‰çš„æ€»ç»“è·³è¿‡è¿™ä¸ª setupconnectionï¼Œç„¶åŽçœŸæ­£å¼€å§‹åˆ·æœºï¼Œå¤§æ¦‚ 10 åˆ†é’Ÿä¸åˆ°å°±åˆ·å¥½äº†ã€‚</p><h4 id="å†™åœ¨æœ€åŽ"><a href="#å†™åœ¨æœ€åŽ" class="headerlink" title="å†™åœ¨æœ€åŽ"></a>å†™åœ¨æœ€åŽ</h4><p>åˆ·ä¸ªæœºé‡åˆ°çš„å‘è¿˜çœŸæ˜¯æŒºå¤šï¼ŒæŠŠè¿™äº›è®°å½•ä¸‹æ¥ï¼Œè¯´ä¸å®šä»¥åŽå…¬å¸çš„å›½è¡Œè®¾å¤‡éœ€è¦åˆ·æœºï¼Œè¿™äº›è®°å½•å°±èƒ½æ´¾ä¸Šç”¨åœºäº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h4&gt;&lt;p&gt;å‰å¤©å…¬å¸å‘ç»™æˆ‘ä¸€éƒ¨ä¸‰æ˜Ÿ tablet ä½œä¸ºæµ‹è¯•æœºï¼Œæ˜¯ Tab S4 wifi ç‰ˆï¼Œå…·ä½“åž‹å·æ˜¯ SM-T830ï¼Œè™½ç„¶ä¸æ˜¯æˆ‘æœŸå¾…çš„ Pixel 
      
    
    </summary>
    
    
      <category term="Android" scheme="https://tao93.top/tags/Android/"/>
    
      <category term="Firmware" scheme="https://tao93.top/tags/Firmware/"/>
    
      <category term="Samsung" scheme="https://tao93.top/tags/Samsung/"/>
    
  </entry>
  
  <entry>
    <title>å†æ¬¡å°† hexo blog æ”¾ç½®åˆ° Github Pages</title>
    <link href="https://tao93.top/2019/07/05/%E5%86%8D%E6%AC%A1%E5%B0%86%20hexo%20blog%20%E6%94%BE%E7%BD%AE%E5%88%B0%20Github%20Pages/"/>
    <id>https://tao93.top/2019/07/05/å†æ¬¡å°† hexo blog æ”¾ç½®åˆ° Github Pages/</id>
    <published>2019-07-06T02:59:53.000Z</published>
    <updated>2019-10-10T23:35:18.419Z</updated>
    
    <content type="html"><![CDATA[<h4 id="æ’è¯"><a href="#æ’è¯" class="headerlink" title="æ’è¯"></a>æ’è¯</h4><p>ç”µè„‘æ¢äº†åŽï¼Œæˆ‘æŠŠ hexo blog æ•´ä¸ªç›®å½•æ‹·è´åˆ°æ–°ç”µè„‘ï¼Œç„¶åŽæ–°ç”µè„‘å®‰è£… nodeï¼Œå®‰è£… hexoï¼Œç”¨ npm å®‰è£…ä¸»é¢˜æ‰€éœ€çš„ä¾èµ–ï¼Œç„¶åŽ generate å‡ºæ¥çš„ç½‘é¡µæ–‡ä»¶æ ·å¼æœ‰é—®é¢˜ï¼Œæœ€åŽå›žé€€åˆ° node v10 æ‰è§£å†³ã€‚ä¼¼ä¹Ž node å¯¹åŽ†å²ç‰ˆæœ¬çš„å…¼å®¹æ€§ä¸ä½³ï¼Œä¹Ÿå¯èƒ½æ˜¯ç”¨ npm å®‰è£…çš„ä¸€äº›ä¾èµ–æ²¡é€‚é…æœ€æ–°çš„ nodeï¼Œç¥žå‘ï¼</p><h4 id="ç¼˜èµ·"><a href="#ç¼˜èµ·" class="headerlink" title="ç¼˜èµ·"></a>ç¼˜èµ·</h4><p>ç§Ÿäº†ä¸€å¹´çš„é˜¿é‡Œäº‘ä½äºŽé¦™æ¸¯çš„ VPS åˆ°æœŸäº†ï¼Œä½†åˆ°æœŸä¸æ˜¯å…³é”®ï¼Œå…³é”®æ˜¯å¤§çº¦ä¸€ä¸ªå¤šæœˆå‰ï¼Œæˆ‘çš„ VPS å½»åº•è¢«å±è”½äº†ï¼Œåœ¨å›½å†… ping IP éƒ½å®Œå…¨ä¸é€šï¼Œåªæœ‰å¢ƒå¤–æ‰èƒ½æ­£å¸¸è®¿é—®ã€‚å‘é˜¿é‡Œäº‘åé¦ˆï¼Œå¯¹æ–¹å»ºè®®æˆ‘é‡æ–° deploy ä¸€ä¸ª VPSã€‚æˆ‘ä»¥ä¸ºé‡æ–° deploy ä¸€ä¸‹å¾ˆç®€å•ï¼Œç„¶è€Œäº‹å®žæ˜¯é‡æ–° deploy éœ€è¦æˆ‘é‡æ–°ä¸‹è®¢å•ï¼Œç„¶åŽç”¨æ–°è®¢å•æ¥ deployï¼ŒåŽŸæœ‰è®¢å•å°±å½“åºŸäº†ã€‚è€Œé˜¿é‡Œäº‘åªæä¾›æ•°æ®å¤‡ä»½å’Œæ¢å¤æœåŠ¡ï¼Œç”¨äºŽå°†åŽŸ VPS çš„æ•°æ®è¿ç§»åˆ°æ–° VPSï¼Œå¹¶ä¸”è¿™é¡¹æœåŠ¡ä¹Ÿæ˜¯æ”¶è´¹çš„ã€‚è¿™æ˜¯åœ¨è®©äººå¿æ— å¯å¿ã€‚è¿˜å¥½åŽŸè®¢å•å½“æ—¶åªå‰©ä¸€ä¸ªå¤šæœˆï¼Œæ‰€ä»¥æˆ‘æ‰“å®šæ³¨æ„ä¸ç”¨é˜¿é‡Œäº‘äº†ã€‚</p><p>å¦å¤–æˆ‘ç®€å•è¯•äº†ä¸€ä¸‹ Vultr çš„æœåŠ¡ï¼Œå…ˆè¯•äº†ä¸ª $2.5/Mo çš„ï¼Œç»“æžœå‘çŽ°åªæœ‰ IPv6 è€Œæ²¡æœ‰ IPv4ã€‚åŽé¢æˆ‘ç”³è¯·é€€æ¬¾ï¼Œé€€æ¬¾å€’æ˜¯å¾ˆè¿…é€Ÿï¼Œåªæ˜¯æ‰£æŽ‰äº†æˆ‘ä½™é¢çš„ä¸€éƒ¨åˆ†ï¼Œå·¥å•é‡Œé¢è¯¢é—®ï¼Œå¯¹æ–¹ä¹Ÿåªæ˜¯è¯´è¿™ä¸ªæ˜¯åè®®è§„å®šï¼Œæ—¢ç„¶æ‚¨å·²ä½¿ç”¨æˆ‘ä»¬çš„äº§å“ã€åŒæ„çš„åè®®ï¼Œé‚£ä¹ˆåªèƒ½è¯·æ‚¨è°…è§£ã€‚äºŽæ˜¯æˆ‘å¯¹ Vultr ä¹Ÿæ— å¥½æ„Ÿäº†ã€‚</p><p>åŠ ä¹‹å¬æˆ‘çš„åŒå­¦è®²èµ·äº†åˆ«çš„å¥½ä½¿çš„ç¿»å¢™æ–¹å¼ï¼ŒäºŽæ˜¯ç”¨ VPS ç¿»å¢™çš„éœ€æ±‚ä¹Ÿæ²¡ä»€ä¹ˆäº†ï¼ŒäºŽæ˜¯æˆ‘æƒ³åˆ°äº†ç”¨ Github Pages æ¥ host æˆ‘çš„ hexo blogã€‚</p><h4 id="å‰å¥"><a href="#å‰å¥" class="headerlink" title="å‰å¥"></a>å‰å¥</h4><p>å¦‚æˆ‘åœ¨ <a href="https://tao93.github.io/2018/09/26/%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB%E8%AE%B0%E5%BD%95/" target="_blank" rel="noopener">åšå®¢ç³»ç»Ÿè¿ç§»è®°å½•</a> ä¸­æ‰€è¯´ï¼Œæˆ‘ä½¿ç”¨è‡ªå·±å†™çš„ä¸€ä¸ª deploy.sh è„šæœ¬ï¼Œè¿™ä¸ªè„šæœ¬ä¼šå°†æˆ‘çš„ Markdown æ–‡ä»¶çš„æ”¹åŠ¨ push åˆ° VPS ä¸Šï¼ˆä»¥ä½œå¤‡ä»½ï¼Œé¿å…æœ¬åœ°ç”µè„‘æ•°æ®ä¸¢å¤±ï¼‰ï¼Œç„¶åŽè°ƒç”¨ hexo åœ¨ public ç›®å½•ç”Ÿæˆç½‘é¡µæ–‡ä»¶ï¼Œå¹¶ commit å† push åˆ° VPSï¼Œä»Žè€Œè®© blog ç½‘é¡µåˆ·æ–°ï¼Œæœ€åŽæˆ‘ blog ä¸­ç”¨åˆ°çš„å›¾ç‰‡ï¼Œæˆ‘éƒ½æ˜¯æ”¾ç½®åˆ° VPSï¼Œç„¶åŽè‡ªåŠ¨ç”Ÿæˆ image url å¹¶æ’å…¥åˆ° Markdown ä¸­çš„ï¼Œå› æ­¤ä¸ºé˜² VPS æ•°æ®ä¸¢å¤±ï¼Œè¿™ä¸ªè„šæœ¬è¿˜æŠŠ VPS ä¸­çš„å›¾ç‰‡ç›®å½• commitï¼Œç„¶åŽåœ¨æœ¬åœ°æŠŠå›¾ç‰‡ç›®å½• pull ä¸‹æ¥ã€‚è¿™æ ·ä¸€æ¥ï¼Œå›¾ç‰‡å’ŒåŽŸå§‹çš„ Markdown æ–‡ä»¶ï¼Œå°±éƒ½åœ¨æœ¬åœ°å’Œ VPS ä¸­éƒ½æœ‰å®Œæ•´å¤‡ä»½ï¼Œä¸€æ–¹æ•°æ®ä¸¢å¤±æ—¶ï¼Œå¦ä¸€æ–¹å¯ä»¥è¢«ç”¨æ¥æ¢å¤æ•°æ®ã€‚</p><p>å½“æ—¶èƒ½æœ‰è¿™ç§å¤‡ä»½æ€æƒ³ï¼Œä¹Ÿæ˜¯å› ä¸ºæ›¾ç›®ç¹ä¸€ä¸ªæœ‹å‹çš„äº‹æ•…ã€‚è¿™ä¸ªæœ‹å‹ä¹Ÿæ˜¯ç”¨ VPS æ¥ host hexo blogï¼Œè€Œ Markdown æ–‡ä»¶åªåœ¨æœ¬åœ°æœ‰ä¸€ä»½ï¼ŒæŸå¤©ä»–æœ¬åœ°æ•°æ®ä¸¢å¤±äº†ï¼Œæœ€åŽä»–ä¸å¾—ä¸å€ŸåŠ© VPS ä¸Šçš„ç½‘é¡µæ–‡ä»¶æ¥é‡å†™ Markdown æ–‡ä»¶ï¼Œè€Œä»–åˆæ˜¯ blog é«˜äº§ç”¨æˆ·ï¼Œå¯æƒ³è€ŒçŸ¥è¿™æ˜¯å¤šä¹ˆç¹çã€‚</p><h4 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h4><p>ä¹‹å‰æˆ‘æœ‰ 3 git repoï¼Œåˆ†åˆ«æ˜¯åŒ…å« Markdown æ–‡ä»¶çš„ sourceï¼ŒåŒ…å«ç”Ÿæˆçš„ç½‘é¡µæ–‡ä»¶çš„ publicï¼Œè¿˜æœ‰å°±æ˜¯ Imageã€‚å‰ä¸¤è€…éƒ½æ˜¯æˆ‘æœ¬åœ° commitï¼Œç„¶åŽ push åˆ° VPSï¼Œæœ€åŽçš„ Image åˆ™æ˜¯ VPS ä¸Šä¸æ–­å¢žåŠ æ–°å›¾ç‰‡ï¼Œç„¶åŽ VPS ä¸Š commitï¼Œæœ¬åœ°å† pullã€‚</p><p>çŽ°åœ¨æ”¹ç”¨ Github Pages åŽï¼Œæˆ‘åªèƒ½æœ‰ä¸€ä¸ª repo (<a href="https://github.com/Tao93/Tao93.github.io)æ¥" target="_blank" rel="noopener">https://github.com/Tao93/Tao93.github.io)æ¥</a> host blog æ‰€éœ€è¦çš„ç½‘é¡µæ–‡ä»¶å’Œé‚£äº›å›¾ç‰‡ï¼Œæ‰€ä»¥æˆ‘å°±æŠŠ Image å…¨éƒ¨æ”¾è¿› public ä¸­äº†ï¼Œè¿™æ ·å°±å°‘äº† Image è¿™ä¸ª git repoã€‚å¦å¤–ï¼ŒGithub Pages æ˜¯ https çš„ï¼Œæ‰€ä»¥æˆ‘è¿˜éœ€è¦åœ¨ hexo config ä¸­æŠŠ http æ”¹ä¸º httpsã€‚</p><p>å¦å¤–ï¼Œä¸ºäº†å¤‡ä»½ Markdown æ–‡ä»¶ï¼Œæˆ‘å¦å¤–å¼€äº† <a href="https://github.com/Tao93/hexo-blog-post" target="_blank" rel="noopener">https://github.com/Tao93/hexo-blog-post</a> è¿™ä¸ª repo æ¥ä¿å­˜æˆ‘çš„ Markdown æ–‡ä»¶ã€‚</p><p>å¾€åŽï¼Œæˆ‘æ›´æ–° blog çš„æµç¨‹å°±æ˜¯ï¼šæœ¬åœ° source repo ä¸­æ–°å¢žæˆ–ä¿®æ”¹ Markdown æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­éœ€è¦æ’å…¥å›¾ç‰‡æ—¶ï¼ŒæŠŠå›¾ç‰‡æ”¾å…¥ <code>public/Images</code> ä¸­æŒ‡å®šè·¯å¾„ï¼Œç„¶åŽä»¥æ­¤è·¯å¾„å¾—åˆ° image url å¹¶ä½¿ç”¨è¯¥ url æ¥æ’å…¥å›¾ç‰‡ï¼Œæœ€åŽåœ¨ source repo ä¸­ commitï¼›ç„¶åŽ deploy.sh è„šæœ¬å…ˆå°† source repo push åˆ° <a href="https://github.com/Tao93/hexo-blog-postï¼Œç„¶åŽè°ƒç”¨" target="_blank" rel="noopener">https://github.com/Tao93/hexo-blog-postï¼Œç„¶åŽè°ƒç”¨</a> hexo åœ¨ public ä¸­ç”Ÿæˆç½‘é¡µæ–‡ä»¶ï¼Œæœ€åŽå°† public repo push åˆ° <a href="https://github.com/Tao93/Tao93.github.ioï¼Œè‡³æ­¤" target="_blank" rel="noopener">https://github.com/Tao93/Tao93.github.ioï¼Œè‡³æ­¤</a> blog ç½‘é¡µå°±æ›´æ–°äº†ã€‚</p><p>ä»Žä¸Šé¢æ‰€è®²å¯çŸ¥ï¼ŒMarkdown æ–‡ä»¶å’Œ Image éƒ½æ˜¯ Github å’Œæœ¬åœ°éƒ½æœ‰ï¼Œäº’ä¸ºå¤‡ä»½ï¼Œç¡®ä¿å®‰å…¨ã€‚å¦å¤–ä¸Šé¢çš„æ’å…¥å›¾ç‰‡ï¼Œä¾ç„¶æ˜¯ä½¿ç”¨æˆ‘åœ¨ <a href="https://tao93.github.io/2018/09/26/%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB%E8%AE%B0%E5%BD%95/" target="_blank" rel="noopener">åšå®¢ç³»ç»Ÿè¿ç§»è®°å½•</a> è¯´çš„ upload_pic è„šæœ¬ï¼Œè¿™ä¸ªè„šæœ¬å¯ä»¥è‡ªåŠ¨å°†æˆ‘å¤åˆ¶çš„å›¾ç‰‡æ–‡ä»¶æˆ–è€…æ˜¯æˆªå›¾å†…å®¹å¤åˆ¶åˆ° <code>public/images</code> çš„æŒ‰æ—¥æœŸå‘½åçš„ç›®å½•å¹¶ç”¨æ—¶é—´æˆ³å‘½åï¼Œç„¶åŽå† generate ä¸€ä¸ªç”Ÿæˆçš„ url å¹¶æŠŠ url å¤åˆ¶åˆ°æˆ‘çš„å‰ªè´´æ¿ã€‚å› æ­¤æˆ‘åªéœ€è¦å¤åˆ¶æˆ–æˆªå›¾ï¼Œç„¶åŽå†è°ƒç”¨ upload_picï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ª url ç”¨äºŽåœ¨ Markdown ä¸­æ’å…¥å›¾ç‰‡ã€‚</p><p>æœ€åŽï¼Œä¸€å¹´å‰ä¹°äº†é˜¿é‡Œäº‘ 3 å¹´çš„åŸŸå tao93.topï¼Œæˆ‘è®©å®ƒæŒ‡å‘ tao93.github.io äº†ã€‚</p><p>æœ€åŽçš„æœ€åŽï¼Œæ’å…¥ä¸¤å¼ å›¾ç‰‡æµ‹è¯•ä¸€ä¸‹ï¼Œä¸€å¼ æ˜¯æˆªå›¾ï¼Œå¦ä¸€å¼ æ˜¯å¤åˆ¶å›¾ç‰‡æ–‡ä»¶ã€‚</p><p><img src="http://tao93.top/images/2019/07/06/1562381892.png" alt=""></p><p><img src="http://tao93.top/images/2019/07/06/1562381957.png" alt=""></p><p>&lt;å®Œ&gt;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;æ’è¯&quot;&gt;&lt;a href=&quot;#æ’è¯&quot; class=&quot;headerlink&quot; title=&quot;æ’è¯&quot;&gt;&lt;/a&gt;æ’è¯&lt;/h4&gt;&lt;p&gt;ç”µè„‘æ¢äº†åŽï¼Œæˆ‘æŠŠ hexo blog æ•´ä¸ªç›®å½•æ‹·è´åˆ°æ–°ç”µè„‘ï¼Œç„¶åŽæ–°ç”µè„‘å®‰è£… nodeï¼Œå®‰è£… hexoï¼Œç”¨ npm å®‰è£…ä¸»é¢˜æ‰€éœ€çš„ä¾èµ–ï¼Œç„¶åŽ 
      
    
    </summary>
    
    
      <category term="Hexo Blog" scheme="https://tao93.top/tags/Hexo-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Android è‡ªå®šä¹‰ç®€æ˜“ PickerView</title>
    <link href="https://tao93.top/2019/04/07/Android%20%E8%87%AA%E5%AE%9A%E4%B9%89%E7%AE%80%E6%98%93%20PickerView/"/>
    <id>https://tao93.top/2019/04/07/Android è‡ªå®šä¹‰ç®€æ˜“ PickerView/</id>
    <published>2019-04-07T12:28:04.685Z</published>
    <updated>2019-07-05T14:01:31.229Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘çš„åšçš„ä¸€é¡¹ feature ä¸­ï¼Œéœ€è¦ä½¿ç”¨ç±»ä¼¼äºŽ iOS çš„ UIPickerView çš„æŽ§ä»¶ï¼ŒåŠŸèƒ½æ˜¯é€šè¿‡æ»šåŠ¨ item æ¥é€‰æ‹©å…¶ä¸­ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯ä¸‹å›¾è¿™æ ·çš„ï¼š</p><p><img src="http://tao93.top/images/2019/04/07/1554640301.png" alt=""></p><p>Android SDK å€’æ˜¯æœ‰ä¸€ä¸ª NumberPicker å’Œè¿™ä¸ªéžå¸¸ç±»ä¼¼ï¼Œä¸è¿‡ NumberPicker è®¾è®¡æœ‰ç‚¹é—®é¢˜ï¼Œæ»šåŠ¨å¾ˆæ…¢ï¼Œå³ä½¿æ˜¯æ‰‹æŒ‡å¿«é€Ÿæ»‘åŠ¨ï¼Œä¹Ÿåªèƒ½æ»šåŠ¨äº”å…­ä¸ª itemsï¼Œè€Œ Github ä¸Šç¡®å®žæœ‰ä¸å°‘ä¼˜ç§€çš„å®žçŽ°ï¼Œå¯ä»¥å’Œ iOS çš„ UIPickerView éžå¸¸ç›¸ä¼¼ï¼Œä¸è¿‡å…¶ä»£ç æœ‰äº›å¤æ‚ï¼Œä»¥è‡³äºŽæƒ³è¦é€Ÿè¯»ä»£ç ç„¶åŽè‡ªå·±å†™ä¸€ä»½ä¹Ÿæ¯”è¾ƒè´¹æ—¶é—´ã€‚æ‰€ä»¥ï¼Œæˆ‘å°±æƒ³åˆ°è‡ªå·±åŸºäºŽ Android çš„ ListView å†™ä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰ PickerViewã€‚</p><p>æ—¢ç„¶ä½¿ç”¨ ListViewï¼Œé‚£ä¹ˆé¦–å…ˆéœ€è¦è§£å†³é—®é¢˜æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š</p><ol><li>å¦‚ä½•è®©æ‰€æœ‰ item éƒ½èƒ½é€šè¿‡æ»‘åŠ¨è€Œæ»šåŠ¨åˆ°è§†å›¾ä¸­é—´ï¼Œä»Žè€Œè¡¨ç¤ºè¯¥ item è¢«é€‰ä¸­ï¼Ÿ</li><li>å¦‚æžœè®© ListView çš„ idle çŠ¶æ€å˜ä¸ºç¦»æ•£çš„ï¼Œè€Œéžæœ¬æ¥çš„ä»»æ„æ»šåŠ¨çŠ¶æ€éƒ½å¯ä»¥ä¸º idleï¼Ÿ</li><li>æ€Žä¹ˆèŽ·å–å½“å‰é€‰ä¸­çš„ item çš„åºå·ï¼Ÿ</li></ol><p>ç¬¬ä¸€ä¸ªé—®é¢˜æ¯”è¾ƒå¥½åŠžï¼Œåœ¨ list çš„é¦–å°¾å„å¡«å……ä¸€äº›ç©ºç™½çš„ itemï¼Œè¿™æ ·å°±èƒ½è®©ç”¨æˆ·å¯è§çš„æ‰€æœ‰ item éƒ½èƒ½æ»‘åŠ¨åˆ°æ­£ä¸­é—´ã€‚ç¬¬äºŒä¸ªé—®é¢˜ï¼Œæˆ‘çš„åšæ³•æ˜¯ï¼Œå¦‚æžœæ‰‹æŒ‡ç¦»å¼€æ—¶ï¼ŒListView ç¼“æ…¢æ»‘åŠ¨ï¼Œé‚£ä¹ˆå°±åœ¨é€Ÿåº¦ä½ŽäºŽæŸä¸ªé˜ˆå€¼æ—¶ï¼Œè®©å®ƒæ»‘åŠ¨åˆ°æ°å¥½å°†ä¸€äº› item æ˜¾ç¤ºå‡ºæ¥è€Œä¸è¦æœ‰æŸä¸ª item åªæ˜¾ç¤ºä¸€éƒ¨åˆ†ï¼›è€Œå¦‚æžœæ‰‹æŒ‡ç¦»å¼€æ—¶ ListView å¿«é€Ÿæ»‘åŠ¨ï¼Œé‚£ä¹ˆå°±åœ¨ ListView åˆšåˆšå˜ä¸º idle çŠ¶æ€æ—¶ï¼Œè®©å®ƒå°±è¿‘æ»‘åŠ¨åˆ°ã€Œæ°å¥½å°†ä¸€äº› item æ˜¾ç¤ºå‡ºæ¥ã€çš„çŠ¶æ€ã€‚ç¬¬ä¸‰ä¸ªé—®é¢˜å¥½åŠžï¼Œè®¡ç®—ä¸€ä¸‹å½“å‰æ˜¾ç¤ºçš„æ‰€æœ‰ item çš„ position å°±èƒ½çŸ¥é“æœ€ä¸­é—´æ˜¾ç¤ºçš„ item çš„ positionã€‚</p><p>å¦å¤–è¿˜æœ‰ä¸€äº›ç»†èŠ‚é—®é¢˜ï¼š</p><ol><li>éœ€è¦åœ¨ä¸­é—´ç»˜åˆ¶ä¸Šä¸¤æ¡ç°è‰²æ°´å¹³çº¿ï¼›</li><li>éœ€è¦åœ¨ canvas çš„æœ€ä¸Šå±‚ç»˜åˆ¶ä¸æ˜¯æ­£ä¸­é—´åŒºåŸŸç»˜åˆ¶åŠé€æ˜ŽçŸ©å½¢ï¼Œä»Žè€Œè®©éžé€‰ä¸­çš„ item çœ‹èµ·æ¥æ˜¯ç°è‰²çš„ï¼›</li><li>ç‚¹å‡»éžé€‰ä¸­çš„ item æ—¶ï¼Œéœ€è¦æ»šåŠ¨ ListView è®©è¯¥ item æ»‘åŠ¨åˆ°æ­£ä¸­é—´ã€‚</li></ol><p>å®žçŽ°çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Adapter interface for &#123;<span class="doctag">@link</span> PickerView&#125; which is like UIPickerView on iOS. </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PickerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="comment">/** get resource id of layout for each item of the picker view. */</span></span><br><span class="line">    <span class="meta">@LayoutRes</span> <span class="function"><span class="keyword">int</span> <span class="title">getItemLayoutResource</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** count of items in the picker view. */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** text string for the item at the specified position. */</span></span><br><span class="line">    <span class="function">String <span class="title">getItemAt</span><span class="params">(<span class="keyword">int</span> pos)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A view to let users to choose one item from a list, like UIPickerView on iOS.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PickerView</span> <span class="keyword">extends</span> <span class="title">FrameLayout</span> </span>&#123;</span><br><span class="line">    <span class="comment">/** the listView which is used to implement this PickerView */</span></span><br><span class="line">    <span class="keyword">private</span> ListView listView;</span><br><span class="line">    <span class="comment">/** the count of visible items, must be odd numbers, the middle item would be the the selected one. */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> visibleCount = <span class="number">5</span>; <span class="comment">// 5 items visible by default</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> itemHeight;</span><br><span class="line"></span><br><span class="line">    Paint dividerLinePaint;</span><br><span class="line">    Paint greyLayerPaint;</span><br><span class="line">    <span class="comment">/** adapter for this pickerView */</span></span><br><span class="line">    PickerAdapter adapter;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> dividerThickness;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> dividerMarginLeft;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> dividerMarginRight;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> velocityThreshold;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> VelocityTracker velocityTracker = VelocityTracker.obtain();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PickerView</span><span class="params">(@NonNull Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PickerView</span><span class="params">(@NonNull Context context, @Nullable AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PickerView</span><span class="params">(@NonNull Context context, @Nullable AttributeSet attrs, <span class="keyword">final</span> <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        setWillNotDraw(<span class="keyword">false</span>);</span><br><span class="line">        </span><br><span class="line">        itemHeight = getResources().getDimension(R.dimen.picker_view_item_height);</span><br><span class="line">        velocityThreshold = getResources().getDisplayMetrics().density * <span class="number">260</span>;</span><br><span class="line">        </span><br><span class="line">        TypedArray ta = context.obtainStyledAttributes(attrs, R.styleable.PickerView);</span><br><span class="line">        dividerThickness = ta.getDimension(R.styleable.PickerView_divider_thickness, getResources().getDisplayMetrics().density);</span><br><span class="line">        dividerMarginLeft = ta.getDimension(R.styleable.PickerView_divider_margin_left, <span class="number">0</span>);</span><br><span class="line">        dividerMarginRight = ta.getDimension(R.styleable.PickerView_divider_margin_right, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">int</span> dividerColor = ta.getColor(R.styleable.PickerView_divider_color, Color.LTGRAY);</span><br><span class="line">        ta.recycle();</span><br><span class="line"></span><br><span class="line">        dividerLinePaint = <span class="keyword">new</span> Paint();</span><br><span class="line">        dividerLinePaint.setColor(dividerColor);</span><br><span class="line">        dividerLinePaint.setStyle(Paint.Style.STROKE);</span><br><span class="line">        dividerLinePaint.setStrokeWidth(dividerThickness);</span><br><span class="line">        greyLayerPaint = <span class="keyword">new</span> Paint();</span><br><span class="line">        greyLayerPaint.setColor(<span class="number">0xb0ffffff</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAdapter</span><span class="params">(PickerAdapter adapter)</span> </span>&#123;</span><br><span class="line">        setAdapter(adapter, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAdapter</span><span class="params">(PickerAdapter adapter, <span class="keyword">int</span> initPos)</span> </span>&#123;</span><br><span class="line">        setAdapter(adapter, <span class="number">0</span>, initPos);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * set adapter and other two parameters.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> visibleCount count of visible items in the picker, must be odd numbers. </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> initPos position of the initially selected item, 0 means the first item would be selected.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAdapter</span><span class="params">(PickerAdapter adapter, <span class="keyword">int</span> visibleCount, <span class="keyword">int</span> initPos)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (adapter.getItemCount() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (visibleCount &gt; <span class="number">0</span> &amp;&amp; visibleCount % <span class="number">2</span> != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.visibleCount = visibleCount;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.adapter = adapter;</span><br><span class="line"></span><br><span class="line">        listView = <span class="keyword">new</span> ListView(getContext());</span><br><span class="line">        addView(listView, <span class="keyword">new</span> LinearLayout.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, (<span class="keyword">int</span>) (itemHeight * <span class="keyword">this</span>.visibleCount)));</span><br><span class="line">        listView.setOverScrollMode(View.OVER_SCROLL_NEVER);  <span class="comment">// remove over scroll effects.</span></span><br><span class="line">        listView.setVerticalScrollBarEnabled(<span class="keyword">false</span>);</span><br><span class="line">        listView.setDivider(<span class="keyword">null</span>);  <span class="comment">// remove listView's dividers</span></span><br><span class="line"></span><br><span class="line">        listView.setOnScrollListener(<span class="keyword">new</span> AbsListView.OnScrollListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScrollStateChanged</span><span class="params">(AbsListView view, <span class="keyword">int</span> scrollState)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (scrollState == AbsListView.OnScrollListener.SCROLL_STATE_IDLE) &#123;</span><br><span class="line">                    <span class="comment">// scroll to nearest place that fit the selection properly.</span></span><br><span class="line">                    scrollToNearest();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScroll</span><span class="params">(AbsListView view, <span class="keyword">int</span> firstVisibleItem, <span class="keyword">int</span> visibleItemCount, <span class="keyword">int</span> totalItemCount)</span> </span>&#123; &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        listView.setAdapter(<span class="keyword">new</span> InnerAdapter());</span><br><span class="line">        <span class="keyword">if</span> (initPos &gt; <span class="number">0</span> &amp;&amp; initPos &lt; adapter.getItemCount()) &#123;</span><br><span class="line">            listView.setSelection(initPos);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the position of the currently selected item, starting from 0.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSelectedPosition</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        listView.getFirstVisiblePosition();</span><br><span class="line">        View firstChild = listView.getChildAt(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (Math.abs(firstChild.getTop()) &lt; firstChild.getHeight() / <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> listView.getFirstVisiblePosition();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> listView.getFirstVisiblePosition() + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> superResult = <span class="keyword">super</span>.dispatchTouchEvent(ev);</span><br><span class="line">        </span><br><span class="line">        velocityTracker.addMovement(ev);</span><br><span class="line">        <span class="keyword">if</span> (ev.getActionMasked() == MotionEvent.ACTION_UP) &#123;</span><br><span class="line">            velocityTracker.computeCurrentVelocity(<span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">float</span> yVelocity = velocityTracker.getYVelocity();</span><br><span class="line">            <span class="comment">// scroll to nearest proper place directly if the fling is very slow</span></span><br><span class="line">            <span class="keyword">if</span> (Math.abs(yVelocity) &lt; velocityThreshold) &#123;</span><br><span class="line">                scrollToNearest();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> superResult;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** scroll the listView to fit the nearest proper position */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scrollToNearest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        View firstChild = listView.getChildAt(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (Math.abs(firstChild.getTop()) &gt; Math.abs(firstChild.getBottom())) &#123;</span><br><span class="line">            listView.smoothScrollToPosition(listView.getLastVisiblePosition());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            listView.smoothScrollToPosition(listView.getFirstVisiblePosition());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDetachedFromWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        velocityTracker.recycle();</span><br><span class="line">        <span class="keyword">super</span>.onDetachedFromWindow();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.draw(canvas);</span><br><span class="line">        <span class="comment">//canvas.drawRect(0, itemHeight * 2, getWidth(), itemHeight * 3, dividerLinePaint);</span></span><br><span class="line">        canvas.drawLine(dividerMarginLeft, itemHeight * <span class="number">2</span> - dividerThickness, </span><br><span class="line">                getWidth() - dividerMarginRight, itemHeight * <span class="number">2</span> - dividerThickness, dividerLinePaint);</span><br><span class="line">        canvas.drawLine(dividerMarginLeft, itemHeight * <span class="number">3</span> + dividerThickness, </span><br><span class="line">                getWidth() - dividerMarginRight, itemHeight * <span class="number">3</span> + dividerThickness, dividerLinePaint);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// draw two transparent rectangles to make not selected items looks grey</span></span><br><span class="line">        canvas.drawRect(<span class="number">0</span>, <span class="number">0</span>, getWidth(), itemHeight * <span class="number">2</span> - dividerThickness, greyLayerPaint);</span><br><span class="line">        canvas.drawRect(<span class="number">0</span>, getHeight() - <span class="number">2</span> * itemHeight + dividerThickness, getWidth(), getBottom(), greyLayerPaint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * the adapter for the listView</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">InnerAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="comment">// we would add visibleCount - 1 empty strings to the list View, so the count should plus visibleCount - 1.</span></span><br><span class="line">            <span class="keyword">return</span> adapter.getItemCount() + visibleCount - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// there're visibleCount - 1 items with empty text, they would be equally put at the starting and ending.</span></span><br><span class="line">            <span class="keyword">if</span> (position &lt; visibleCount / <span class="number">2</span> || position &gt;= getCount() - visibleCount / <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> adapter.getItemAt(position - visibleCount / <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getItemId</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> position;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (convertView == <span class="keyword">null</span>) &#123;</span><br><span class="line">                convertView = View.inflate(getContext(), adapter.getItemLayoutResource(), <span class="keyword">null</span>);</span><br><span class="line">                convertView.setBackgroundColor(Color.WHITE); <span class="comment">// to avoid the default touch effect of listView item</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// select a item when it's clicked by users</span></span><br><span class="line">            convertView.setOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">int</span> cur = getSelectedPosition() + visibleCount / <span class="number">2</span>;</span><br><span class="line">                    <span class="keyword">if</span> (position &gt; cur) &#123;</span><br><span class="line">                        listView.smoothScrollToPosition(position + visibleCount / <span class="number">2</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (position &lt; cur) &#123;</span><br><span class="line">                        listView.smoothScrollToPosition(position - visibleCount / <span class="number">2</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            TextView textView = convertView.findViewById(R.id.picker_text_view);</span><br><span class="line">            textView.setText((String) getItem(position));</span><br><span class="line">            <span class="keyword">return</span> convertView;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€äº›å°ç»†èŠ‚ã€‚æ¯”å¦‚ ListView çš„é«˜åº¦éœ€è¦æ­£å¥½æ˜¯ itemView çš„å¥‡æ•°å€ï¼Œè¿™æ ·æ‰èƒ½æ°å¥½åªæ˜¾ç¤ºä¸€äº› itemï¼Œå¹¶ä¸”æœ€ä¸­é—´æ˜¾ç¤ºå…¶ä¸­ä¸€ä¸ª itemã€‚å†æ¯”å¦‚ä¸ºäº†é¿å… ListView è‡ªå¸¦çš„ç‚¹å‡» item æ—¶çš„è§†è§‰æ•ˆæžœï¼Œéœ€è¦ç»™ itemView è®¾ç½®çº¯ç™½è‰²èƒŒæ™¯ã€‚</p><p>è‡³æ­¤ï¼Œä¸€ä¸ªç®€æ˜“çš„ PickerView å°±å®Œæˆäº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘çš„åšçš„ä¸€é¡¹ feature ä¸­ï¼Œéœ€è¦ä½¿ç”¨ç±»ä¼¼äºŽ iOS çš„ UIPickerView çš„æŽ§ä»¶ï¼ŒåŠŸèƒ½æ˜¯é€šè¿‡æ»šåŠ¨ item æ¥é€‰æ‹©å…¶ä¸­ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯ä¸‹å›¾è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://tao93.top/images/2019/04/07/15546
      
    
    </summary>
    
    
      <category term="Android" scheme="https://tao93.top/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€ä¸ªä¸ä¸€æ ·çš„ ANR</title>
    <link href="https://tao93.top/2019/01/18/%E4%B8%80%E4%B8%AA%E4%B8%8D%E4%B8%80%E6%A0%B7%E7%9A%84%20ANR/"/>
    <id>https://tao93.top/2019/01/18/ä¸€ä¸ªä¸ä¸€æ ·çš„ ANR/</id>
    <published>2019-01-18T13:04:23.787Z</published>
    <updated>2019-07-05T14:03:18.662Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘ç¢°åˆ°ä¸€ä¸ª ANR é—®é¢˜ï¼Œæ‹¿åˆ° traces æ–‡ä»¶åŽï¼Œæ˜¾ç¤ºä¸»çº¿ç¨‹çš„å †æ ˆæ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">at android<span class="selector-class">.os</span><span class="selector-class">.MessageQueue</span><span class="selector-class">.nativePollOnce</span>(Native method)</span><br><span class="line">at android<span class="selector-class">.os</span><span class="selector-class">.MessageQueue</span><span class="selector-class">.next</span>(MessageQueue<span class="selector-class">.java</span>:<span class="number">323</span>)</span><br><span class="line">at android<span class="selector-class">.os</span><span class="selector-class">.Looper</span><span class="selector-class">.loop</span>(Looper<span class="selector-class">.java</span>:<span class="number">135</span>)</span><br><span class="line">at android<span class="selector-class">.app</span><span class="selector-class">.ActivityThread</span><span class="selector-class">.main</span>(ActivityThread<span class="selector-class">.java</span>:<span class="number">5417</span>)</span><br><span class="line">at java<span class="selector-class">.lang</span><span class="selector-class">.reflect</span><span class="selector-class">.Method</span><span class="selector-class">.invoke</span>!(Native method)</span><br><span class="line">at com<span class="selector-class">.android</span><span class="selector-class">.internal</span><span class="selector-class">.os</span><span class="selector-class">.ZygoteInit</span><span class="variable">$MethodAndArgsCaller</span>.run(ZygoteInit<span class="selector-class">.java</span>:<span class="number">726</span>)</span><br><span class="line">at com<span class="selector-class">.android</span><span class="selector-class">.internal</span><span class="selector-class">.os</span><span class="selector-class">.ZygoteInit</span><span class="selector-class">.main</span>(ZygoteInit<span class="selector-class">.java</span>:<span class="number">616</span>)</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€æ®µå †æ ˆï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹è¡¨æ˜Žä¸»çº¿ç¨‹æ˜¯æ­£å¸¸çš„ï¼Œå³å¤„åœ¨ç­‰å¾…åŒºä¸‹ä¸€æ¡ä¸»çº¿ç¨‹æ¶ˆæ¯çš„è¿‡ç¨‹ä¸­ï¼Œè€Œä¸æ˜¯é™·åœ¨æŸä¸ªè€—æ—¶ç‰¹åˆ«é•¿çš„æ¶ˆæ¯ä¸­ã€‚</p><p>ç»è¿‡åå¤æµ‹è¯•ï¼Œæœ€åŽç¡®è®¤è¿™ä¸ª ANR å’Œè®¾ç½®äº† Default UncaughtExceptionHandler æœ‰å…³ï¼Œé—®é¢˜ä»£ç å¯ä»¥ç®€åŒ–æˆä¸‹é¢çš„æ ·å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        Thread.setDefaultUncaughtExceptionHandler(<span class="keyword">new</span> Thread.UncaughtExceptionHandler() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uncaughtException</span><span class="params">(<span class="keyword">final</span> Thread t, Throwable e)</span> </span>&#123;</span><br><span class="line">                Log.i(<span class="string">"uncaught"</span>, Thread.currentThread().toString());</span><br><span class="line">                Log.i(<span class="string">"uncaught"</span>, t.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Thread thread;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        findViewById(R.id.btn).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"hello world"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).start();</span><br><span class="line">                <span class="comment">//throw new RuntimeException("hello world!!");</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç çš„è¡¨çŽ°æ˜¯ï¼Œå¦‚æžœåªè®©ç¬¬ 26 è¡ŒæŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆä¸€åˆ‡çœ‹èµ·æ¥éƒ½æ­£å¸¸ï¼Œä½†æ˜¯å¦‚æžœè®©ç¬¬ 29 è¡ŒæŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆåº”ç”¨ç›´æŽ¥å°±æ— å“åº”äº†ã€‚</p><p>ç»è¿‡ä¸€ç•ªæŸ¥æ‰¾ä¸ŽéªŒè¯ï¼Œæˆ‘å‘çŽ°åŽŸå› å¤§è‡´æ˜¯ï¼Œå½“ä¸€ä¸ª Java çº¿ç¨‹æŠ›å‡ºäº†æœªæ•èŽ·çš„å¼‚å¸¸æ—¶ï¼ŒJVM å…ˆä¼šè°ƒç”¨åˆ° UncaughtExceptionHandlerï¼Œç„¶åŽå†ä¼šæŠŠæ­¤çº¿ç¨‹åœæ­¢æŽ‰ã€‚æ‰€ä»¥è¿™æ®µä»£ç ä¸­ï¼Œå¦‚æžœä¸»çº¿ç¨‹æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆç¬¬ 6 è¡Œçš„æ–¹æ³•ç»“æŸåŽï¼Œä¸»çº¿ç¨‹å°±ä¼šè¢« JVM ç»™åœæ­¢æŽ‰ï¼Œæ—¢ç„¶ä¸»çº¿ç¨‹éƒ½åœæ­¢æŽ‰äº†ï¼Œé‚£è‡ªç„¶å°±æ— å“åº”äº†ï¼Œä¹Ÿå°±ä¼šå‘ç”Ÿ ANR äº†ã€‚</p><p>äº‹å®žä¸Šï¼Œä¸€èˆ¬æˆ‘ä»¬è®¾ç½®è‡ªå®šä¹‰ UncaughtExceptionHandler æ—¶ï¼Œéƒ½ä¼šåœ¨è‡ªå®šä¹‰çš„ uncaughtException æ–¹æ³•æœ€åŽå†è°ƒç”¨ä¸€éè¢«æˆ‘ä»¬é¡¶æ›¿æŽ‰çš„ç³»ç»Ÿé»˜è®¤çš„ UncaughtExceptionHandlerï¼Œä»¥ä¾¿æŠŠåº”ç”¨ kill æŽ‰ï¼Œè€Œè¿™ä¸ªä¾‹å­ï¼Œå……åˆ†çš„æ˜¾ç¤ºäº†ï¼Œå½“æœªæ•èŽ·å¼‚å¸¸å‘ç”ŸåŽï¼Œå°±ç®—èµ–ç€ä¸ kill æŽ‰åº”ç”¨ä¹Ÿæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºå¯èƒ½ä¸»çº¿ç¨‹éƒ½å·²ç»è¢«åœæŽ‰äº†ã€‚</p><p>å…³äºŽ JVM å…ˆè°ƒç”¨ UncaughtExceptionHandler ç„¶åŽæŠŠå‘ç”Ÿæœªæ•èŽ·å¼‚å¸¸çš„çº¿ç¨‹åœæ­¢æŽ‰çš„è¯´æ³•ï¼Œè§äºŽ <a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-11.html#jls-11.3" target="_blank" rel="noopener">Java Language Specification 11.3</a>ï¼Œå¦‚ä¸‹æ‰€ç¤ºçš„ç‰‡æ®µï¼š</p><p><img src="http://tao93.top/images/2019/01/18/1547816082.png" alt=""></p><p>é‚£ä¹ˆä¸»çº¿ç¨‹è¢«åœæ­¢æŽ‰ï¼Œæ˜¯ä¸ªä»€ä¹ˆæ ·çš„çŠ¶æ€å‘¢ï¼Œæˆ‘ç”¨ä¸‹é¢çš„ä»£ç ï¼ŒæŠŠä¸»çº¿ç¨‹çš„çŠ¶æ€ç»™è¾“å‡ºæ¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        Thread.setDefaultUncaughtExceptionHandler(<span class="keyword">new</span> Thread.UncaughtExceptionHandler() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uncaughtException</span><span class="params">(<span class="keyword">final</span> Thread t, Throwable e)</span> </span>&#123;</span><br><span class="line">                Log.i(<span class="string">"uncaught"</span>, Thread.currentThread().toString());</span><br><span class="line">                Log.i(<span class="string">"uncaught"</span>, t.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Thread thread;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        findViewById(R.id.btn).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">final</span> Thread mainThread = Thread.currentThread();</span><br><span class="line">                Log.i(<span class="string">"&lt;&lt;&lt;"</span>, mainThread.getState().toString());</span><br><span class="line">                <span class="keyword">if</span> (thread == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    thread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i) &#123;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                                    e.printStackTrace();</span><br><span class="line">                                &#125;</span><br><span class="line">                                Log.i(<span class="string">"&lt;&lt;&lt;"</span>, mainThread.getState().toString());</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    thread.start();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"hello world!!"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„ç¬¬ 24 è¡Œå’Œç¬¬ 35 è¡Œä¸€å…±ä¼š 4 æ­¤è¾“å‡ºä¸»çº¿ç¨‹çš„çŠ¶æ€ï¼Œç»“æžœå¦‚ä¸‹é¢æ‰€ç¤ºï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">01<span class="selector-tag">-18</span> 21<span class="selector-pseudo">:00</span><span class="selector-pseudo">:24.308</span> 14533 14533 <span class="selector-tag">I</span> &lt;&lt;&lt;     : <span class="selector-tag">RUNNABLE</span></span><br><span class="line">01<span class="selector-tag">-18</span> 21<span class="selector-pseudo">:00</span><span class="selector-pseudo">:25.309</span> 14533 14570 <span class="selector-tag">I</span> &lt;&lt;&lt;     : <span class="selector-tag">NEW</span></span><br><span class="line">01<span class="selector-tag">-18</span> 21<span class="selector-pseudo">:00</span><span class="selector-pseudo">:26.310</span> 14533 14570 <span class="selector-tag">I</span> &lt;&lt;&lt;     : <span class="selector-tag">NEW</span></span><br><span class="line">01<span class="selector-tag">-18</span> 21<span class="selector-pseudo">:00</span><span class="selector-pseudo">:27.311</span> 14533 14570 <span class="selector-tag">I</span> &lt;&lt;&lt;     : <span class="selector-tag">NEW</span></span><br></pre></td></tr></table></figure><p>ä»Žä¸Šé¢ä»£ç å¯çŸ¥ï¼Œä¸»çº¿ç¨‹ä»Ž RUNNABLE çŠ¶æ€å˜æˆäº† NEW çŠ¶æ€ï¼Œä¸ºä»€ä¹ˆæ˜¯ NEW çŠ¶æ€ï¼Œæˆ‘ä¹Ÿä¸æ¸…æ¥šï¼Œä¹Ÿè®¸å°†æ¥å¯¹ JVM äº†è§£æ›´å¤šäº†ï¼Œä¼šæ¸…é™¤å§ã€‚</p><p>å›žåˆ°è¿™ä¸ª ANR æ¥ï¼Œè¿™ä¸ªä¾‹å­è¯´æ˜Žï¼Œæˆ‘ä»¬å¦‚æžœä½¿ç”¨è‡ªå®šä¹‰çš„ UncaughtExceptionHandlerï¼Œè®°å¾—è¦æŠŠåº”ç”¨ kill æŽ‰ï¼Œè¿˜æœ‰ default çš„ UncaughtExceptionHandler æ˜¯å…¨å±€å…¬ç”¨çš„ï¼Œå¾ˆå®¹æ˜“ä¼šå‡ºçŽ°è¢«é¡¶æ›¿ (è¦†ç›–)ï¼Œæ‰€ä»¥åˆ‡è®°åˆ«éšæ„è°ƒç”¨ï¼Œå…å¾—å‡ºçŽ°æ„æ–™ä¹‹å¤–çš„é—®é¢˜ã€‚</p><p>ä¿®å¤è¿™æ ·çš„ ANRï¼Œåˆ†æˆä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯å…ˆç§»é™¤æˆ–è€…ä¿®æ”¹ä¸æ°å½“çš„è®¾ç½® UncaughtExceptionHandler çš„ä»£ç ï¼Œå…ˆæ¶ˆé™¤ ANRï¼Œç„¶åŽè¿˜éœ€è¦æŠŠå¼•å‘ ANR çš„å¦ä¸€ä¸ªåŽŸå› ï¼Œä¹Ÿå°±æ˜¯æœªæ•èŽ·çš„å¼‚å¸¸ç»™ä¿®å¤æŽ‰ï¼Œä¸ç„¶åº”ç”¨ä¸ä¼š ANR äº†ä½†æ˜¯ä¼š Crashã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘ç¢°åˆ°ä¸€ä¸ª ANR é—®é¢˜ï¼Œæ‹¿åˆ° traces æ–‡ä»¶åŽï¼Œæ˜¾ç¤ºä¸»çº¿ç¨‹çš„å †æ ˆæ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;
      
    
    </summary>
    
    
      <category term="Android" scheme="https://tao93.top/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Android ç»˜åˆ¶åœ†å½¢å›¾ç‰‡</title>
    <link href="https://tao93.top/2019/01/12/Android%20%E7%BB%98%E5%88%B6%E5%9C%86%E5%BD%A2%E5%9B%BE%E7%89%87/"/>
    <id>https://tao93.top/2019/01/12/Android ç»˜åˆ¶åœ†å½¢å›¾ç‰‡/</id>
    <published>2019-01-12T10:38:32.256Z</published>
    <updated>2019-01-12T10:38:33.385Z</updated>
    
    <content type="html"><![CDATA[<p>è®°å½•ä¸€ä¸‹ï¼Œä»¥å…å¿˜è®°ï¼Œä»¥å¤‡ä½¿ç”¨ã€‚</p><p>æ–¹æ³•ä¸€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Paint paint = <span class="keyword">new</span> Paint();</span><br><span class="line">    Shader shader;</span><br><span class="line">    Matrix mat = <span class="keyword">new</span> Matrix();</span><br><span class="line">    Bitmap bitmap;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView</span><span class="params">(Context context, @Nullable AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView</span><span class="params">(Context context, @Nullable AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// create a bitmap from the image resource what we want to draw</span></span><br><span class="line">        bitmap = BitmapFactory.decodeResource(getResources(), R.drawable.dossier_icon);</span><br><span class="line">        <span class="comment">// a bitmap shader, would be set into paint, here we use repeat tile mode, but since we'll</span></span><br><span class="line">        <span class="comment">// scale to make the bitmap fill the canvas just right, so there would be no repeat.</span></span><br><span class="line">        shader = <span class="keyword">new</span> BitmapShader(bitmap, Shader.TileMode.REPEAT, Shader.TileMode.REPEAT);</span><br><span class="line">        <span class="comment">// after this, the paint would contains this bitmap.</span></span><br><span class="line">        paint.setShader(shader);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> left, <span class="keyword">int</span> top, <span class="keyword">int</span> right, <span class="keyword">int</span> bottom)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onLayout(changed, left, top, right, bottom);</span><br><span class="line">        <span class="comment">// scale to make bitmap fill the canvas</span></span><br><span class="line">        mat.setScale((<span class="keyword">float</span>)getWidth() / bitmap.getWidth(), (<span class="keyword">float</span>)getHeight() / bitmap.getHeight());</span><br><span class="line">        shader.setLocalMatrix(mat);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(canvas);</span><br><span class="line">        <span class="comment">// draw a circle with the paint.</span></span><br><span class="line">        canvas.drawCircle(getWidth() / <span class="number">2</span>, getHeight() / <span class="number">2</span>, getWidth() / <span class="number">2</span>, paint);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•äºŒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyView2</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Path mPath;</span><br><span class="line">    <span class="keyword">private</span> Drawable mDrawable;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView2</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView2</span><span class="params">(Context context, @Nullable AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView2</span><span class="params">(Context context, @Nullable AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        mPath = <span class="keyword">new</span> Path();</span><br><span class="line">        mDrawable = getResources().getDrawable(R.drawable.dossier_icon);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> left, <span class="keyword">int</span> top, <span class="keyword">int</span> right, <span class="keyword">int</span> bottom)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onLayout(changed, left, top, right, bottom);</span><br><span class="line">        <span class="comment">// make the path to be a circle whose diameter is width of the view.</span></span><br><span class="line">        mPath.reset();</span><br><span class="line">        mPath.addCircle(getWidth() / <span class="number">2</span>, getHeight() / <span class="number">2</span>, getWidth() / <span class="number">2</span>, Path.Direction.CW);</span><br><span class="line">        <span class="comment">// drawable must setBounds before draw</span></span><br><span class="line">        mDrawable.setBounds(<span class="number">0</span>, <span class="number">0</span>, getWidth(), getHeight());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(canvas);</span><br><span class="line">        <span class="comment">// save current (default) clip</span></span><br><span class="line">        canvas.save();</span><br><span class="line">        <span class="comment">// make the clip to be the circle </span></span><br><span class="line">        canvas.clipPath(mPath);</span><br><span class="line">        <span class="comment">// draw the bitmapDrawable</span></span><br><span class="line">        mDrawable.draw(canvas);</span><br><span class="line">        <span class="comment">// restore default clip</span></span><br><span class="line">        canvas.restore();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•ä¸‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyView3</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">    Paint mPaint = <span class="keyword">new</span> Paint();</span><br><span class="line">    Paint whitePaint = <span class="keyword">new</span> Paint();</span><br><span class="line">    <span class="keyword">private</span> Bitmap bitmap;</span><br><span class="line">    <span class="keyword">private</span> Matrix mat = <span class="keyword">new</span> Matrix();</span><br><span class="line">    <span class="keyword">private</span> Xfermode mXfermode;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView3</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView3</span><span class="params">(Context context, @Nullable AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView3</span><span class="params">(Context context, @Nullable AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        mXfermode = <span class="keyword">new</span> PorterDuffXfermode(PorterDuff.Mode.SRC_IN);</span><br><span class="line">        whitePaint.setColor(Color.RED);</span><br><span class="line">        bitmap = BitmapFactory.decodeResource(getResources(), R.drawable.dossier_icon);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> left, <span class="keyword">int</span> top, <span class="keyword">int</span> right, <span class="keyword">int</span> bottom)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onLayout(changed, left, top, right, bottom);</span><br><span class="line">        mat.setScale((<span class="keyword">float</span>)getWidth() / bitmap.getWidth(), (<span class="keyword">float</span>)getHeight() / bitmap.getHeight());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(canvas);</span><br><span class="line">        <span class="comment">// save current layer and create a new layer</span></span><br><span class="line">        <span class="keyword">int</span> count = canvas.saveLayer(<span class="number">0</span>, <span class="number">0</span>, getWidth(), getHeight(), mPaint);</span><br><span class="line">        <span class="comment">// draw a white circle in the new layer</span></span><br><span class="line">        canvas.drawCircle(getWidth() / <span class="number">2</span>, getHeight() / <span class="number">2</span>, getWidth() / <span class="number">2</span>, whitePaint);</span><br><span class="line">        <span class="comment">// this xfer mode is src_in type, which could make image to be drawn in only previous white circle area.</span></span><br><span class="line">        mPaint.setXfermode(mXfermode);</span><br><span class="line">        <span class="comment">// draw bitmap in new layer</span></span><br><span class="line">        canvas.drawBitmap(bitmap, mat, mPaint);</span><br><span class="line">        <span class="comment">// this is necessary, or the influence would last</span></span><br><span class="line">        mPaint.setXfermode(<span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">// back to previous layer.</span></span><br><span class="line">        canvas.restoreToCount(count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‰ä¸ªæ–¹æ³•ä¸­ï¼Œæ–¹æ³•äºŒæœ€ç®€ä¾¿æ˜“ç”¨ï¼Œæ–¹æ³•ä¸‰æœ€ä¸æŽ¨èï¼Œå› ä¸ºæ–°å¢žä¸€ä¸ª canvas layer æ˜¯å¼€é”€å¾ˆå¤§çš„ï¼Œè¿™ä¸€ç‚¹ saveLayerAlpha æ–¹æ³•çš„æ³¨é‡Šæœ‰è¯´æ˜Žã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è®°å½•ä¸€ä¸‹ï¼Œä»¥å…å¿˜è®°ï¼Œä»¥å¤‡ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æ–¹æ³•ä¸€ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span cl
      
    
    </summary>
    
    
      <category term="Android" scheme="https://tao93.top/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>ç»™ä¸‰æ˜Ÿ tablet SM-T830 åˆ·æœº[ç»­]</title>
    <link href="https://tao93.top/2019/01/01/%E7%BB%99%E4%B8%89%E6%98%9F%20tablet%20SM-T830%20%E5%88%B7%E6%9C%BA%5B%E7%BB%AD%5D/"/>
    <id>https://tao93.top/2019/01/01/ç»™ä¸‰æ˜Ÿ tablet SM-T830 åˆ·æœº[ç»­]/</id>
    <published>2019-01-01T13:20:54.004Z</published>
    <updated>2019-07-05T14:04:33.387Z</updated>
    
    <content type="html"><![CDATA[<p>äº‹æƒ…çš„èµ·å› æ˜¯ï¼Œä»Ž xda ä¸Šé¢<a href="https://forum.xda-developers.com/galaxy-tab-s4/help/lineage-development-t3852509" target="_blank" rel="noopener">è¿™ä¸ªå¸–å­</a> çœ‹åˆ°ï¼Œæœ‰äººåœ¨ä¸‰æ˜Ÿ Tab S4 å¹³æ¿ä¸Šé¢åˆ·äº†ä¸ªç±»åŽŸç”Ÿ Android çš„ç³»ç»Ÿï¼Œä»–è¡¨ç¤ºç”¨èµ·æ¥æŒºå¥½ï¼Œåªä¸è¿‡ 4 ä¸ªæ‰¬å£°å™¨åªæœ‰åº•éƒ¨ä¸¤ä¸ªå¯ä»¥å‘å£°ã€‚çœ‹åˆ°è¿™ä¸ªæˆ‘å¿ƒé‡Œå°±ç—’ç—’ï¼Œå› ä¸ºä¸‰æ˜Ÿçš„å®˜æ–¹ rom æˆ‘å¹¶ä¸å–œæ¬¢ï¼Œé‡Œé¢æœ‰ä¸‰æ˜Ÿçš„ app storeï¼Œè¿˜æœ‰ä¸‰æ˜Ÿçš„ä¸€å¥—è´¦æˆ·ç³»ç»Ÿï¼Œè°ƒè¯•åˆ°ç³»ç»Ÿä»£ç çš„æ—¶å€™ï¼Œè¡Œå·ä¹Ÿå®Œå…¨å¯¹ä¸ä¸Š(Pixelæ˜¯å¯ä»¥å¯¹ä¸Šè¡Œå·çš„)ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿæƒ³ç»™æ‰‹é‡Œçš„ Tab S4 å¹³æ¿åˆ·ä¸€ä¸ªç±»åŽŸç”Ÿç³»ç»Ÿã€‚</p><p>ç„¶åŽæˆ‘å°±åœ¨ xda ä¸Šé¢æŸ¥äº†æŸ¥ï¼Œå‘çŽ°æˆ‘åº”è¯¥éœ€è¦å…ˆåˆ·å…¥ä¸€ä¸ª TWRP recoveryï¼Œç„¶åŽå†ä½¿ç”¨ TWRP åˆ·å…¥ç±»åŽŸç”Ÿç³»ç»Ÿã€‚å¦å¤–æˆ‘ä¹Ÿæ³¨æ„åˆ°ï¼Œä¹‹æ‰€ä»¥èƒ½åˆ·å¹¶æ²¡æœ‰é€‚é… Tab S4 çš„ ROMï¼Œå¾—å½’åŠŸäºŽ Project Trableã€‚è°·æ­Œæå‡º Project Trable æ˜¯ä¸ºäº†è®© Android ç³»ç»Ÿçš„å¼€å‘å’Œåº•å±‚é©±åŠ¨çš„å¼€å‘åˆ†ç¦»å¼€ï¼Œä¸¤è€…åªè¦æ»¡è¶³åè®®ï¼Œå°±å¯ä»¥ç»„åˆåœ¨ä¸€èµ·ï¼Œè¿™æ ·å°±å¯å‡å° Android ç³»ç»Ÿå‡çº§æ—¶åŽ‚å•†å¼€å‘é©±åŠ¨çš„å·¥ä½œï¼Œä»Žè€Œè®©è®¾å¤‡æ›´å¿«å‡çº§ Android ç³»ç»Ÿã€‚Project Trable ä¹Ÿä½¿å¾—é‚£äº›ç¬¦åˆè¦æ±‚çš„è®¾å¤‡ï¼Œå¯ä»¥åˆ·å¤§é‡æ»¡è¶³ Project Trable è¦æ±‚çš„ General System Image (GSI)ã€‚Tab S4 å°±æ˜¯ç¬¦åˆ Project Trable è¦æ±‚çš„ï¼Œæ‰€ä»¥æˆ‘å°±æ˜¯è¦ç»™å®ƒåˆ· GSIã€‚</p><p>å›žåˆ°å‰é¢è¯´çš„ TWRP çš„äº‹æƒ…ï¼ŒTWRP å®˜æ–¹å¹¶æ²¡æœ‰é€‚é… Tab S4 çš„ç‰ˆæœ¬ï¼Œä¸è¿‡æˆ‘åœ¨<a href="https://forum.xda-developers.com/galaxy-tab-s4/development/recovery-twrp-3-2-3-1-galaxy-tab-s4-t3843211" target="_blank" rel="noopener">è¿™ä¸ªå¸–å­</a>é‡Œé¢å‘çŽ°äº†ç”¨äºŽ Tab S4 çš„éžå®˜æ–¹ TWRPï¼Œå¹¶å†™å‡ºäº†æ­¥éª¤ï¼š</p><ol><li>ç¡®è®¤ OEM å·²è§£é”ï¼›</li><li>è®¾å¤‡è¿›å…¥ download æ¨¡å¼ï¼›</li><li>ä½¿ç”¨ odin çš„ AP slot æ¥åˆ·å…¥ TWRP åŽ‹ç¼©åŒ…ï¼Œè®°å¾—è¦å–æ¶ˆå‹¾é€‰ã€ŒAuto Rebootã€;</li><li>å…³æœºï¼Œç„¶åŽå†è¿›å…¥ TWRPï¼›</li><li>è¿›å…¥ TWRPï¼Œç„¶åŽåˆ·å…¥ Forced encryption disabler patchï¼Œformat DATA ä¸€ä¸‹ï¼›</li><li>è¿›å…¥ TWRPï¼Œåˆ·å…¥ Magisk åŽ‹ç¼©åŒ…ï¼ŒäºŽæ˜¯è®¾å¤‡å°± root äº†ã€‚</li></ol><p>æ­¥éª¤å…¶å®žå¾ˆç®€å•ï¼Œä¸è¿‡æˆ‘åœ¨è¿™é‡ŒæŠ˜è…¾äº† 3 å¤©ã€‚æˆ‘å…ˆæŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤æ¥ï¼Œç»“æžœå‘çŽ°è¿› TWRP åŽå°±æ— æ³•è®¿é—® internal storageï¼Œè‡ªç„¶å°±åˆ·ä¸äº† Forced encryption disabler patchã€‚æˆ‘è¯•äº†éžå¸¸å¤šæƒ³æ³•ï¼Œæ¯”å¦‚é‡åˆ·ä¸‰æ˜Ÿå®˜æ–¹å›ºä»¶ï¼Œåˆ·æ›´æ—§çš„å®˜æ–¹å›ºä»¶(åŽŸå› æ˜¯è¿™ä¸ªå¸–å­é‡Œé¢å·¥å…·å‘å‡ºæ¥æ—¶ï¼Œå®˜æ–¹å›ºä»¶è¿˜æ›´æ—§ä¸€äº›ï¼Œè€Œæˆ‘çœ‹åˆ°è¿™å¸–å­æ—¶å·²ç»æ›´æ–°åˆ°æ¯”è¾ƒæ–°äº†)ï¼Œåˆ·å›½è¡Œçš„å®˜æ–¹å›ºä»¶ï¼Œéƒ½ä¸è¡Œï¼Œå…¶ä¸­åˆ·æ›´ä½Žç‰ˆæœ¬çš„å›ºä»¶è¿˜æœ‰é™åˆ¶å³ BootLoader ä¸èƒ½é™çº§ï¼Œæ‰€ä»¥å…¶å®žå®˜æ–¹å›ºä»¶é™ä¸äº†å¤šå°‘çº§ã€‚æˆ‘è¿˜çœ‹åˆ°äº†<a href="https://www.thecustomdroid.com/install-twrp-samsung-galaxy-tab-s4-root-guide/" target="_blank" rel="noopener">è¿™ç§å¸–å­</a>ï¼Œé‡Œé¢å‘Šè¯‰æˆ‘è¯´ï¼Œéœ€è¦å…ˆåˆ·ä¸€ä¸ª DM-Verity patched bootï¼Œæˆ‘ä¹Ÿè¯•äº†ï¼Œå‘çŽ°åˆ·å®Œè¿™ä¸ª DM-Verity patched boot åŽç›´æŽ¥æ— æ³•è¿›å…¥ç³»ç»Ÿï¼ŒæŠ¥ Verification Failed é”™è¯¯ï¼Œå¿…é¡»é‡ç½®è®¾å¤‡æ‰è¡Œã€‚ç¿»é xda é‚£ä¸ª 40 å‡ é¡µçš„å¸–å­åŽï¼Œæˆ‘å‘çŽ°å…¶å®žè¿™ä¸ªå¸–å­å°±æ˜¯æŠ„ xda é‚£ä¸ªå¸–å­ï¼Œåªä¸è¿‡æŠ„çš„æ—¶å€™ï¼Œxda å¸–å­ä¸Šé¢çš„æ­¥éª¤ç¡®å®žç¬¬ä¸€æ­¥æ˜¯åˆ· DM-Verity patched bootï¼Œä¸è¿‡åŽæ¥ xda å¸–å­æ­¥éª¤æ›´æ–°äº†ï¼Œæˆäº†çŽ°åœ¨è¿™æ ·çš„ã€‚</p><p>ä¸æ˜¯æ— æ³•è®¿é—® internal storage å˜›ï¼ŒåŽæ¥æˆ‘ä¹°äº†ä¸ª micro SD å¡ï¼Œæ’è¿›è®¾å¤‡ï¼Œåœ¨ TWRP ä¸­è¿™ä¸ª micro SD æ˜¯å¯ä»¥è®¿é—®çš„ï¼Œæ‰€ä»¥æˆ‘å°±å¯ä»¥ç»§ç»­åˆ·å…¥ Forced encryption disabler patch å¹¶ format DATAï¼Œç„¶åŽæˆ‘å°± boot loop äº†ï¼ŒçœŸæ°”äººã€‚å³ä½¿æˆ‘å†åˆ·å…¥ GSIï¼Œä¾ç„¶æ˜¯ boot loopã€‚</p><p>åŽæ¥é‚£ä¸ª xda å¸–å­çš„ä½œè€…å›žå¤æˆ‘è¯´ã€Œå…¨ç¨‹æ²¡çœ‹åˆ°æˆ‘åˆ· Magisk çš„æè¿°ï¼Œä½† Magisk æ˜¯å¿…è¦çš„ï¼Œå¦åˆ™ä¼š boot loopã€ã€‚æˆ‘ç¡®å®žæ²¡åˆ· Magiskï¼Œå› ä¸ºæˆ‘å¹¶æ²¡æœ‰åƒ rootï¼Œæˆ‘åªæƒ³æžä¸ª TWRP ç„¶åŽåˆ· GSI è€Œå·²ã€‚äºŽæ˜¯æˆ‘å°±åˆ·äº† Magiskï¼Œå‘çŽ°ä¸åœ¨ boot loop äº†ï¼Œç„¶åŽå†<a href="https://github.com/phhusson/treble_experimentations/releases/tag/v108" target="_blank" rel="noopener">è¿™é‡Œ</a> ä¸‹è½½äº† system-arm64-aonly-gapps-su.img.xz è¿™ä¸ª GSI å¹¶åˆ·å…¥ï¼Œè¿™æ¬¡ç»ˆäºŽæˆåŠŸäº†ï¼Œè¿›å…¥äº†ä¸€ä¸ªç±»ä¼¼ AOSP user-debug ç±»åž‹çš„ aosp ç³»ç»Ÿï¼Œå¾ˆç®€é™‹ï¼Œè¿ž Contactï¼ŒSettingsï¼Œç­‰è¿™äº›åº”ç”¨éƒ½æ˜¯ aosp ç‰ˆæœ¬çš„ï¼Œå’Œæ­£å¸¸çš„å¾ˆä¸ä¸€æ ·ï¼Œç›¸æœºåº”ç”¨åˆ™ç›´æŽ¥æ‰“å¼€å°± crashã€‚é¡ºä¾¿è®°å½•ä¸€ä¸‹ TWRP åˆ· GSI çš„æ–¹æ³•ï¼Œå¾ˆç®€å•ï¼š</p><ol><li>è¿›å…¥ TWRPï¼Œwipe ä¸€ä¸‹ï¼›</li><li>è¿›å…¥ installï¼Œåˆ‡æ¢åˆ° install image æ¨¡å¼ï¼Œæ‰¾åˆ° GSIï¼›</li><li>partition é€‰æ‹© system imageï¼Œflashï¼›</li><li>é‡å¯</li></ol><p>å…³é”®æ˜¯ï¼Œè¿™ä¸ª aosp ç³»ç»Ÿæœ‰äº› bugï¼Œæœ€å—ä¸äº†çš„ bug æ˜¯ï¼Œé”å±ã€æ—‹è½¬æ—¶å±å¹•éƒ½ä¼šå˜å½¢ä¸€ä¸‹ï¼Œæˆªå±å¾—åˆ°çš„å›¾ç‰‡ä¹Ÿæ˜¯ä¼šå˜å½¢ä¸€ä¸‹ã€‚è¿™å’Œæˆ‘æœ€åˆçœ‹åˆ°çš„ xda å¸–å­é‡Œé¢é‚£äººè¯´çš„åªæ˜¯æ‰¬å£°å™¨æ²¡æœ‰å…¨éƒ¨å‘å£°å·®è¿œäº†ã€‚æ‰€ä»¥æˆ‘å°±æƒ³æ‰¾æ›´å¥½äº›çš„ GSIã€‚é—®äº†é‚£ä¸ªäººï¼Œç»“æžœæ²¡å›žå¤æˆ‘ã€‚</p><p>æœ€åŽæ‰¾åˆ°äº† <a href="https://forum.xda-developers.com/project-treble/trebleenabled-device-development/9-0-pixelexperience-p-t3833294" target="_blank" rel="noopener">Pixel Experience</a> ï¼Œè™½ç„¶ä¾ç„¶æœ‰ä¸€äº› bugï¼Œä¸è¿‡æ„Ÿè§‰è¿˜å¯ä»¥ã€‚</p><p>æ”¾å‡ å¼ æˆªå›¾ï¼š</p><p><img src="http://tao93.top/images/2019/01/01/1546351524.png" alt=""></p><p>æœ€åŽè¿˜æœ‰ä¸€ç‚¹ï¼Œè¿™æ¬¡æˆ‘æ˜¯ç”¨ Virtual Box ä¸­çš„ Win 10 è™šæ‹Ÿæœºåˆ·çš„ï¼Œè®© VirtualBox ä¸­çš„ Win 10 è™šæ‹Ÿæœºè¿žæŽ¥ä¸Š Android è®¾å¤‡ï¼Œéœ€è¦ç»™ VirtualBox å®‰è£… extension packï¼Œåœ¨ Win 10 è™šæ‹Ÿæœºä¸­å®‰è£… guest additionsï¼Œç„¶åŽè¿˜éœ€è¦åœ¨æ­¤ win 10 è™šæ‹Ÿæœºçš„è®¾ç½®ä¸­æ·»åŠ å¯¹åº”çš„ USB filter (éœ€è¦è®¾å¤‡è¿žæŽ¥ä¸ŠåŽæ‰èƒ½æ·»åŠ )ï¼Œå¹¶æŒ‰ç…§ USB ç±»åž‹å‹¾é€‰ USB 2.0 è¿˜æ˜¯ 3.0ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://tao93.top/images/2019/01/01/1546352547.png" alt=""></p><p>æœ€åŽï¼Œåœ¨è®¾å¤‡è¿žæŽ¥ä¸Šç”µè„‘åŽï¼ŒæŠŠ win 10 çš„çª—å£æ”¾åœ¨æœ€å‰é¢ï¼Œç„¶åŽå† macOS çš„èœå•æ å‹¾é€‰å¯¹åº”çš„ USB deviceï¼Œå‹¾é€‰çš„è¯ï¼Œå°±æ˜¯ win 10 è™šæ‹Ÿæœºè¿žæŽ¥è¯ USB è®¾å¤‡ï¼Œå¦åˆ™é©¾é©¶ macOS è¿žæŽ¥æ­¤ USB deviceï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="http://tao93.top/images/2019/01/01/1546353760.png" alt=""></p><p><strong>2019 å¹´ 5 æœˆ 29 æ—¥æ›´æ–°</strong></p><p>æœ€è¿‘å¾—çŸ¥ä¸‰æ˜Ÿå·²ç»ç»™ä¸€äº›è®¾å¤‡æŽ¨é€äº† Android Pie çš„æ›´æ–°ï¼Œè€Œç»„é‡Œé¢å‡ éƒ¨ Tab S4 éƒ½æ˜¯è¿è¡Œå›½å†…ç‰ˆç³»ç»Ÿçš„å›½è¡Œæœºå™¨ï¼Œæ‰€ä»¥æ²¡æœ‰æ”¶åˆ°æ›´æ–°é€šçŸ¥ï¼Œæ‰€ä»¥æˆ‘å°±æœ‰äº†æŠŠæˆ‘æ‰‹é‡Œçš„ Tab S4 åˆ·å›žåŸºäºŽ Android Pie çš„å›½å¤–ç‰ˆä¸‰æ˜Ÿç³»ç»Ÿã€‚</p><p>æ­¥éª¤å¾ˆç®€å•ï¼Œå…ˆç”¨ SamFirm tool ä¸‹è½½åŸºäºŽ Android Pie çš„ stock firmware åŒ…ï¼Œç„¶åŽè®¾å¤‡å…ˆè¿›å…¥ TWRP recovery (æˆ‘ä¹‹å‰åˆ·äº† TWRPï¼Œæ‰€ä»¥æœ‰è¿™ä¸ª)ï¼Œç„¶åŽç‚¹ Reboot å†ç‚¹ Download å³å¯è¿›å…¥ä¸‰æ˜Ÿè®¾å¤‡çš„ Download æ¨¡å¼ï¼Œç„¶åŽå°±æ˜¯å¾ˆç®€å•åœ°ä½¿ç”¨ odin å·¥å…·æŠŠç³»ç»Ÿåˆ·è¿›åŽ»å°±å¥½äº†ã€‚</p><p>æ³¨æ„ Download æ¨¡å¼å’Œ Recovery æ˜¯ä¸ä¸€æ ·çš„ã€‚TWRP æ˜¯ custom recoveryï¼Œè€Œä¸‰æ˜Ÿè‡ªå¸¦çš„ recovery æ˜¯ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„:</p><p><img src="http://tao93.top/images/2019/05/29/1559062868.png" alt=""></p><p>å³ä½¿ç”¨ TWRP å–ä»£äº†è‡ªå¸¦çš„ Recoveryï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥è¿›å…¥ Download æ¨¡å¼ï¼Œä»Žè€Œç”¨ odin åˆ·å›žåˆ°å®˜æ–¹ firmwareã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;äº‹æƒ…çš„èµ·å› æ˜¯ï¼Œä»Ž xda ä¸Šé¢&lt;a href=&quot;https://forum.xda-developers.com/galaxy-tab-s4/help/lineage-development-t3852509&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
      
    
    </summary>
    
    
      <category term="GSI" scheme="https://tao93.top/tags/GSI/"/>
    
      <category term="Project Treble" scheme="https://tao93.top/tags/Project-Treble/"/>
    
  </entry>
  
  <entry>
    <title>Android Toast ä¸¤ä¸ª Crash</title>
    <link href="https://tao93.top/2018/12/22/Android%20Toast%20%E4%B8%A4%E4%B8%AA%20Crash/"/>
    <id>https://tao93.top/2018/12/22/Android Toast ä¸¤ä¸ª Crash/</id>
    <published>2018-12-22T15:05:48.751Z</published>
    <updated>2019-07-05T14:01:06.385Z</updated>
    
    <content type="html"><![CDATA[<p>Toast æ˜¯ Android ç³»ç»Ÿä¸€ç§éžå¸¸ç®€å•çš„æç¤ºæ€§å°å·¥å…·ï¼Œæœ€è¿‘æˆ‘å°è¯•ä¿®å¤ Toast ç›¸å…³çš„ä¸¤ç§ Crashï¼Œæ‰€ä»¥æŠŠç›¸å…³çš„åŽŸå§”å’Œè¿‡ç¨‹è®°å½•äº†ä¸‹æ¥ã€‚å…ˆæ¥çœ‹ä¸€ä¸‹ç¬¬ä¸€ç§ Crash çš„ log:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">android.view.WindowManager$BadTokenException: Unable to add window -- token android.os.BinderProxy<span class="meta">@e</span>2815e is not valid; is your activity running?</span><br><span class="line">        at android.view.ViewRootImpl.setView(ViewRootImpl.java:<span class="number">679</span>)</span><br><span class="line">        at android.view.WindowManagerGlobal.addView(WindowManagerGlobal.java:<span class="number">342</span>)</span><br><span class="line">        at android.view.WindowManagerImpl.addView(WindowManagerImpl.java:<span class="number">93</span>)</span><br><span class="line">        at android.widget.Toast$TN.handleShow(Toast.java:<span class="number">459</span>)</span><br><span class="line">        at android.widget.Toast$TN$<span class="number">2</span>.handleMessage(Toast.java:<span class="number">342</span>)</span><br><span class="line">        at android.os.Handler.dispatchMessage(Handler.java:<span class="number">102</span>)</span><br><span class="line">        at android.os.Looper.loop(Looper.java:<span class="number">154</span>)</span><br><span class="line">        at android.app.ActivityThread.main(ActivityThread.java:<span class="number">6119</span>)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Native Method)</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ stack trace ä¸­çš„ä»£ç å…¨éƒ¨æ˜¯å…³äºŽ UI çº¿ç¨‹ä¸­å¤„ç†ä¸€ä¸ªæ¶ˆæ¯çš„ï¼Œè¿™ä¸ªæ¶ˆæ¯éœ€è¦åšçš„æ˜¯æŠŠ Toast éœ€è¦æ˜¾ç¤ºçš„ view æ·»åŠ åˆ° WindowManager ä¸­ï¼Œä»Žè€Œå¯ä»¥æ˜¾ç¤ºå‡ºæ¥ã€‚è¿™æ ·çš„ crash æ˜¯æ²¡æœ‰ä»»ä½• app ä»£ç ç‰µæ¶‰å…¶ä¸­çš„ï¼Œæ‰€ä»¥æ— æ³•ç¡®å®šæ˜¯ app ä½•å¤„çš„ä»£ç å¯¼è‡´çš„è¿™ä¸ª crashã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ Toast æ˜¾ç¤ºçš„å¤§è‡´è¿‡ç¨‹ã€‚</p><p>é¦–å…ˆæ˜¯é€šè¿‡ <code>Toast#makeText</code> æ–¹æ³•æˆ–è€… <code>Toast</code> æž„é€ å‡½æ•°åˆ›å»º Toast å¯¹è±¡ï¼Œç„¶åŽå°±å¯ä»¥è°ƒç”¨å®ƒçš„ show æ–¹æ³•äº†ã€‚ä¸è¿‡æ­¤æ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œå®ƒä»…ä»…æ˜¯å°†è¯¥ toast æ·»åŠ åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…æ˜¾ç¤ºï¼Œå³æ­¤æ–¹æ³•ä¸ç­‰ toast çœŸæ­£æ˜¾ç¤ºå°±å·²ç»è¿”å›žäº†ï¼Œè€Œ toast çš„æ˜¾ç¤ºéœ€è¦ç”¨ä¸€ä¸ªæ–°çš„ UI çº¿ç¨‹æ¶ˆæ¯ä¸­çš„ä»£ç æ¥æ˜¾ç¤ºå‡ºæ¥ã€‚</p><p><code>Toast#show</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Show the view for the specified duration.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mNextView == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"setView must have been called"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    INotificationManager service = getService();</span><br><span class="line">    String pkg = mContext.getOpPackageName();</span><br><span class="line">    TN tn = mTN;</span><br><span class="line">    tn.mNextView = mNextView;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        service.enqueueToast(pkg, tn, mDuration);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">        <span class="comment">// Empty</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„ç¬¬ 15 è¡Œæ˜¯ä¸€ä¸ªè·¨è¿›ç¨‹è°ƒç”¨äº† NotificationServiceManager çš„æ–¹æ³•ï¼Œè€Œä½œä¸ºå‚æ•°çš„ TN å¯¹è±¡æ˜¯å®žçŽ°äº† <a href="https://developer.android.com/reference/android/os/IInterface" target="_blank" rel="noopener">IInterface</a> çš„ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ Binder ä¼ ç»™å…¶ä»–è¿›ç¨‹ã€‚Toast çœŸæ­£çš„æ˜¾ç¤ºï¼Œéœ€è¦ç­‰ NotificationServiceManager å›žè°ƒå›žæ¥ï¼Œè¿™ä¸ªå›žè°ƒä¹Ÿå°±æ˜¯è°ƒç”¨ Toast å†…éƒ¨ç±» TN çš„ show æ–¹æ³•ã€‚è€Œä»Ž api 25 å¼€å§‹ï¼Œæ­¤æ–¹æ³•è¿˜ä¼šå°† NotificationServiceManager äº§ç”Ÿçš„ä¸€ä¸ª window token ä¼ é€’è¿‡æ¥ã€‚</p><p>api 25 ä¸­çš„ <code>TN#show</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * schedule handleShow into the right thread</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(IBinder windowToken)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (localLOGV) Log.v(TAG, <span class="string">"SHOW: "</span> + <span class="keyword">this</span>);</span><br><span class="line">    mHandler.obtainMessage(<span class="number">0</span>, windowToken).sendToTarget();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>api 24 ä¸­çš„ <code>TN#show</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * schedule handleShow into the right thread</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (localLOGV) Log.v(TAG, <span class="string">"SHOW: "</span> + <span class="keyword">this</span>);</span><br><span class="line">    mHandler.post(mShow);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤ <code>TN#show</code> æ–¹æ³•æ˜¯è¢«è¿œç¨‹è°ƒç”¨çš„ï¼Œæ‰€ä»¥å®žé™…ä¼šè¿è¡Œåœ¨ app çš„ Binder çº¿ç¨‹æ± çš„çº¿ç¨‹ä¸­ï¼Œæ‰€ä»¥æ­¤æ–¹æ³•å‘ä¸»çº¿ç¨‹å‘äº†ä¸€ä¸ªæ¶ˆæ¯ï¼Œè¿™ä¸ªæ¶ˆæ¯æ‰æ˜¯çœŸæ­£è®© toast æ˜¾ç¤ºçš„åœ°æ–¹ã€‚ä¸åŒçš„æ˜¯ api 25 çš„ä»£ç è¿˜ä¼šæŠŠ window token ä¹Ÿä¼ é€’åˆ°æ¶ˆæ¯ä¸­ã€‚å¤„ç†è¿™ä¸ªæ¶ˆæ¯çš„ä»£ç ï¼Œä¼šè°ƒç”¨ <code>TN#handleShow</code> æ–¹æ³•ï¼Œè¿™ä¸ª <code>handleShow</code> æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleShow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (localLOGV) Log.v(TAG, <span class="string">"HANDLE SHOW: "</span> + <span class="keyword">this</span> + <span class="string">" mView="</span> + mView</span><br><span class="line">            + <span class="string">" mNextView="</span> + mNextView);</span><br><span class="line">    <span class="keyword">if</span> (mView != mNextView) &#123;</span><br><span class="line">        <span class="comment">// remove the old view if necessary</span></span><br><span class="line">        handleHide();</span><br><span class="line">        mView = mNextView;</span><br><span class="line">        Context context = mView.getContext().getApplicationContext();</span><br><span class="line">        String packageName = mView.getContext().getOpPackageName();</span><br><span class="line">        <span class="keyword">if</span> (context == <span class="keyword">null</span>) &#123;</span><br><span class="line">            context = mView.getContext();</span><br><span class="line">        &#125;</span><br><span class="line">        mWM = (WindowManager)context.getSystemService(Context.WINDOW_SERVICE);</span><br><span class="line">        <span class="comment">// We can resolve the Gravity here by using the Locale for getting</span></span><br><span class="line">        <span class="comment">// the layout direction</span></span><br><span class="line">        <span class="keyword">final</span> Configuration config = mView.getContext().getResources().getConfiguration();</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> gravity = Gravity.getAbsoluteGravity(mGravity, config.getLayoutDirection());</span><br><span class="line">        mParams.gravity = gravity;</span><br><span class="line">        <span class="keyword">if</span> ((gravity &amp; Gravity.HORIZONTAL_GRAVITY_MASK) == Gravity.FILL_HORIZONTAL) &#123;</span><br><span class="line">            mParams.horizontalWeight = <span class="number">1.0f</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ((gravity &amp; Gravity.VERTICAL_GRAVITY_MASK) == Gravity.FILL_VERTICAL) &#123;</span><br><span class="line">            mParams.verticalWeight = <span class="number">1.0f</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        mParams.x = mX;</span><br><span class="line">        mParams.y = mY;</span><br><span class="line">        mParams.verticalMargin = mVerticalMargin;</span><br><span class="line">        mParams.horizontalMargin = mHorizontalMargin;</span><br><span class="line">        mParams.packageName = packageName;</span><br><span class="line">        mParams.removeTimeoutMilliseconds = mDuration ==</span><br><span class="line">            Toast.LENGTH_LONG ? LONG_DURATION_TIMEOUT : SHORT_DURATION_TIMEOUT;</span><br><span class="line">        <span class="keyword">if</span> (mView.getParent() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (localLOGV) Log.v(TAG, <span class="string">"REMOVE! "</span> + mView + <span class="string">" in "</span> + <span class="keyword">this</span>);</span><br><span class="line">            mWM.removeView(mView);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (localLOGV) Log.v(TAG, <span class="string">"ADD! "</span> + mView + <span class="string">" in "</span> + <span class="keyword">this</span>);</span><br><span class="line">        mWM.addView(mView, mParams);</span><br><span class="line">        trySendAccessibilityEvent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„ç¬¬ 37 è¡Œï¼Œæ‰æ˜¯çœŸæ­£æŠŠ toast çš„ view æ·»åŠ åˆ° WindowManagerï¼Œä¹Ÿå°±æ˜¯è®© toast æ˜¾ç¤ºå‡ºæ¥ï¼Œè‡³æ­¤ç†äº†ä¸€é toast æ˜¾ç¤ºçš„æµç¨‹ã€‚è€Œæœ€å‰é¢çš„ crash log è¡¨æ˜Žï¼Œcrash æ˜¯å‘ç”Ÿåœ¨ <code>ViewRootImpl#setView</code> æ–¹æ³•ä¸­çš„ï¼Œå¹¶ä¸”æç¤º window token invalidã€‚è¿™å…¶å®žå°±æ˜¯æç¤º ä»Ž NotificationManagerService ä¼ è¿‡æ¥ç»™ TN çš„ token å¯¹è±¡å¤±æ•ˆäº†ã€‚è€Œå¤±æ•ˆçš„åŽŸå› ï¼Œå…¶å®žå¾—ä»Ž NotificationManagerService ä¸­æ‰¾ã€‚</p><p><code>NotificationManagerService#showNextToastLocked</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showNextToastLocked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ToastRecord record = mToastQueue.get(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">while</span> (record != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (DBG) Slog.d(TAG, <span class="string">"Show pkg="</span> + record.pkg + <span class="string">" callback="</span> + record.callback);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            record.callback.show(record.token);</span><br><span class="line">            scheduleTimeoutLocked(record);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">            Slog.w(TAG, <span class="string">"Object died trying to show notification "</span> + record.callback</span><br><span class="line">                    + <span class="string">" in package "</span> + record.pkg);</span><br><span class="line">            <span class="comment">// remove it from the list and let the process die</span></span><br><span class="line">            <span class="keyword">int</span> index = mToastQueue.indexOf(record);</span><br><span class="line">            <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                mToastQueue.remove(index);</span><br><span class="line">            &#125;</span><br><span class="line">            keepProcessAliveIfNeededLocked(record.pid);</span><br><span class="line">            <span class="keyword">if</span> (mToastQueue.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                record = mToastQueue.get(<span class="number">0</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                record = <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ–¹æ³•å°±æ˜¯ NotificationManagerService å‘èµ·æ˜¾ç¤ºä¸‹ä¸€ä¸ª toast çš„ä»£ç ï¼Œæ³¨æ„åˆ°ç¬¬ 6 è¡Œè°ƒç”¨çš„ show æ–¹æ³•ï¼Œå…¶å®žå°±æ˜¯è¿œç¨‹è°ƒç”¨ TN å¯¹è±¡çš„ show æ–¹æ³•ï¼Œè€Œç¬¬ 6 è¡Œçš„ callback å…¶å®žå°±æ˜¯ TN å¯¹è±¡æ‰€å¯¹åº”çš„è¿œç¨‹ä»£ç†å¯¹è±¡ã€‚ç´§æŽ¥ç€ç¬¬ 7 è¡Œè°ƒç”¨çš„ scheduleTimeoutLocked æ–¹æ³•ï¼Œå…¶å®žè®¾å®šäº†ä¸€ä¸ªå¤±æ•ˆé™åˆ¶ï¼Œä½¿å¾—ç¬¬ 6 è¡Œä¼ é€’çš„ token ä¼šåœ¨å‡ ç§’å†…å¤±æ•ˆã€‚</p><p><code>scheduleTimeoutLocked</code> æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scheduleTimeoutLocked</span><span class="params">(ToastRecord r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mHandler.removeCallbacksAndMessages(r);</span><br><span class="line">    Message m = Message.obtain(mHandler, MESSAGE_TIMEOUT, r);</span><br><span class="line">    <span class="keyword">long</span> delay = r.duration == Toast.LENGTH_LONG ? LONG_DELAY : SHORT_DELAY;</span><br><span class="line">    mHandler.sendMessageDelayed(m, delay);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç å‘é€ä¸€ä¸ª delayed æ¶ˆæ¯(æˆªæ­¢ api 27ï¼Œæ­¤ delay æ—¶é•¿æ˜¯ 2 ç§’æˆ– 3.5 ç§’ï¼‰ï¼Œå¤„ç†ä¸Šé¢æ–¹æ³•å‘é€çš„æ¶ˆæ¯çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (msg.what)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> MESSAGE_TIMEOUT:</span><br><span class="line">            handleTimeout((ToastRecord)msg.obj);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¢«è°ƒç”¨çš„ <code>handleTimeOut</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handleTimeout</span><span class="params">(ToastRecord record)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (DBG) Slog.d(TAG, <span class="string">"Timeout pkg="</span> + record.pkg + <span class="string">" callback="</span> + record.callback);</span><br><span class="line">    <span class="keyword">synchronized</span> (mToastQueue) &#123;</span><br><span class="line">        <span class="keyword">int</span> index = indexOfToastLocked(record.pkg, record.callback);</span><br><span class="line">        <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            cancelToastLocked(index);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ç¬¬ 7 è¡Œè¢«è°ƒç”¨çš„ <code>cancelToastLocked</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">cancelToastLocked</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    ToastRecord record = mToastQueue.get(index);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        record.callback.hide();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">        Slog.w(TAG, <span class="string">"Object died trying to hide notification "</span> + record.callback</span><br><span class="line">                + <span class="string">" in package "</span> + record.pkg);</span><br><span class="line">        <span class="comment">// don't worry about this, we're about to remove it from</span></span><br><span class="line">        <span class="comment">// the list anyway</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ToastRecord lastToast = mToastQueue.remove(index);</span><br><span class="line">    mWindowManagerInternal.removeWindowToken(lastToast.token, <span class="keyword">true</span>, DEFAULT_DISPLAY);</span><br><span class="line"></span><br><span class="line">    keepProcessAliveIfNeededLocked(record.pid);</span><br><span class="line">    <span class="keyword">if</span> (mToastQueue.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// Show the next one. If the callback fails, this will remove</span></span><br><span class="line">        <span class="comment">// it from the list, so don't assume that the list hasn't changed</span></span><br><span class="line">        <span class="comment">// after this point.</span></span><br><span class="line">        showNextToastLocked();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ç¬¬ 13 è¡Œå°±æ˜¯ä½¿ window token å¤±æ•ˆçš„ä»£ç ã€‚è‡³æ­¤å¯çŸ¥ï¼ŒNotificationServiceManager è¿œç¨‹è°ƒç”¨ <code>TN#show</code> æ–¹æ³•åŽå‡ ç§’å†…ï¼Œæ­¤ token å°±ä¼šå¤±æ•ˆï¼Œåœ¨è¿™å‡ ç§’å†…å¦‚æžœ toast æ²¡æœ‰çœŸæ­£æ·»åŠ åˆ° WindowManagerï¼Œé‚£ä¹ˆç­‰æ·»åŠ çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºçŽ° BadTokenExceptionï¼Œåº”ç”¨å°±ä¼š crashã€‚è€Œé˜»ç¢ toast çš„ view è¢«æ·»åŠ åˆ° WindowManagerï¼Œåªæœ‰ UI çº¿ç¨‹çš„å¿™ç¢Œï¼Œä¹Ÿå°±æ˜¯å¦‚æžœ UI çº¿ç¨‹å·²ç»åœ¨æ‰§è¡Œæˆ–è€…é©¬ä¸Šè¦æ‰§è¡Œçš„å…¶ä»–æ¶ˆæ¯æ¯”è¾ƒè€—æ—¶ï¼Œé‚£ä¹ˆ toast çš„ view å°±æ— æ³•åŠæ—¶æ·»åŠ ã€‚</p><p>ä¸è¿‡ï¼ŒGoogle ä¹Ÿæ„è¯†åˆ°è¿™ç§ UI çº¿ç¨‹ block ä¸åˆ° ANR æ—¶é•¿å°± crash çš„çŽ°è±¡äº†ï¼Œæ‰€ä»¥åœ¨ api 26 ä¸­ï¼Œæ­¤ BadTokenException ç›´æŽ¥è¢«æ•èŽ·äº†ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢çš„ç¬¬ 42 è¡Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleShow</span><span class="params">(IBinder windowToken)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span> (mView != mNextView) &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">if</span> (localLOGV) Log.v(TAG, <span class="string">"ADD! "</span> + mView + <span class="string">" in "</span> + <span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">// Since the notification manager service cancels the token right</span></span><br><span class="line">        <span class="comment">// after it notifies us to cancel the toast there is an inherent</span></span><br><span class="line">        <span class="comment">// race and we may attempt to add a window after the token has been</span></span><br><span class="line">        <span class="comment">// invalidated. Let us hedge against that.</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mWM.addView(mView, mParams);</span><br><span class="line">            trySendAccessibilityEvent();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (WindowManager.BadTokenException e) &#123;</span><br><span class="line">            <span class="comment">/* ignore */</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æ­¤ crashï¼Œä»…ä»…å‘ç”Ÿåœ¨ api 25 çš„ç³»ç»Ÿä¸­ï¼Œè¦ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å‚è€ƒ github ä¸Šçš„ <a href="https://github.com/drakeet/ToastCompat" target="_blank" rel="noopener">ToastCompat</a> ä¸­çš„æ–¹æ³•ã€‚</p><p>å†æ¥çœ‹ä¸€ä¸‹å¦ä¸€ç§ Crash logï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalStateException: View android.widget.LinearLayout&#123;41a97eb8 V.E..... ......ID 0,0-540,105 #7f0b020d app:id/toast_layout_root&#125; has already been added to the window manager.</span><br><span class="line">   at android.view.WindowManagerGlobal.addView(WindowManagerGlobal.java:<span class="number">223</span>)</span><br><span class="line">   at android.view.WindowManagerImpl.addView(WindowManagerImpl.java:<span class="number">69</span>)</span><br><span class="line">   at android.widget.Toast$TN.handleShow(Toast.java:<span class="number">402</span>)</span><br><span class="line">   at android.widget.Toast$TN$<span class="number">1</span>.run(Toast.java:<span class="number">310</span>)</span><br><span class="line">   at android.os.Handler.handleCallback(Handler.java:<span class="number">730</span>)</span><br><span class="line">   at android.os.Handler.dispatchMessage(Handler.java:<span class="number">92</span>)</span><br><span class="line">   at android.os.Looper.loop(Looper.java:<span class="number">137</span>)</span><br><span class="line">   at android.app.ActivityThread.main(ActivityThread.java:<span class="number">5136</span>)</span><br><span class="line">   at java.lang.reflect.Method.invokeNative(Method.java)</span><br><span class="line">   at java.lang.reflect.Method.invoke(Method.java:<span class="number">525</span>)</span><br><span class="line">   at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:<span class="number">737</span>)</span><br><span class="line">   at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:<span class="number">553</span>)</span><br><span class="line">   at dalvik.system.NativeStart.main(NativeStart.java)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª crash åŽŸå› æ˜¯åŒä¸€ä¸ª view è¢«é‡å¤æ·»åŠ åˆ° WindowManager å¯¼è‡´çš„ã€‚æŠ›å‡ºå¼‚å¸¸çš„åœ°æ–¹æ˜¯ <code>WindowManagerGlobal#addView</code> æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢çš„ä»£ç ç¬¬ 15 è¡Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addView</span><span class="params">(View view, ViewGroup.LayoutParams params,</span></span></span><br><span class="line"><span class="function"><span class="params">            Display display, Window parentWindow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (view == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"view must not be null"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (display == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"display must not be null"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">            <span class="keyword">int</span> index = findViewLocked(view, <span class="keyword">false</span>);</span><br><span class="line">            <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mDyingViews.contains(view)) &#123;</span><br><span class="line">                    <span class="comment">// Don't wait for MSG_DIE to make it's way through root's queue.</span></span><br><span class="line">                    mRoots.get(index).doDie();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"View "</span> + view</span><br><span class="line">                            + <span class="string">" has already been added to the window manager."</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// The previous removeView() had not completed executing. Now it has.</span></span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><p>ä»Žä¸Šé¢ä»£ç å¯çŸ¥ï¼Œç¬¬ 10 è¡Œ index éžè´Ÿï¼Œä¸” mDyingViews åŒ…å«éœ€æ·»åŠ çš„ viewï¼Œåˆ™ä¼šæŠ›å‡ºæ­¤å¼‚å¸¸ã€‚ç¬¬ 10 è¡Œ index éžè´Ÿçš„åŽŸå› ï¼Œæ˜¯ mViews åŒ…å«æ­¤ viewï¼Œå¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">findViewLocked</span><span class="params">(View view, <span class="keyword">boolean</span> required)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> index = mViews.indexOf(view);</span><br><span class="line">    <span class="keyword">if</span> (required &amp;&amp; index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"View="</span> + view + <span class="string">" not attached to window manager"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> index;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œä¹Ÿå°±æ˜¯å½“éœ€è¦æ·»åŠ ä¸€ä¸ª view æ—¶ï¼Œå¦‚æžœæ­¤ view åœ¨ mViews ä¸­å´ä¸åœ¨ mDyingViews ä¸­ï¼Œé‚£å°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚çŽ°åœ¨æˆ‘ä»¬çœ‹ä¸€ä¸‹ <code>Toast#TN#handleShow</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleShow</span><span class="params">(IBinder windowToken)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span> (mView != mNextView) &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">if</span> (mView.getParent() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (localLOGV) Log.v(TAG, <span class="string">"REMOVE! "</span> + mView + <span class="string">" in "</span> + <span class="keyword">this</span>);</span><br><span class="line">            mWM.removeView(mView);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (localLOGV) Log.v(TAG, <span class="string">"ADD! "</span> + mView + <span class="string">" in "</span> + <span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">// Since the notification manager service cancels the token right</span></span><br><span class="line">        <span class="comment">// after it notifies us to cancel the toast there is an inherent</span></span><br><span class="line">        <span class="comment">// race and we may attempt to add a window after the token has been</span></span><br><span class="line">        <span class="comment">// invalidated. Let us hedge against that.</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mWM.addView(mView, mParams);</span><br><span class="line">            trySendAccessibilityEvent();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (WindowManager.BadTokenException e) &#123;</span><br><span class="line">            <span class="comment">/* ignore */</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç æ˜¾ç¤ºï¼Œå®žé™…ä¸Šï¼ŒToast è¢«çŽ°å®žæ—¶ï¼Œå…¶å®žä¼šå…ˆæŠŠ view ä»Ž WindowManager ç§»é™¤ï¼ˆæ³¨æ„ä¸€ä¸‹ç§»é™¤çš„å‰ææ˜¯ view çš„ parent ä¸ç©ºï¼‰ï¼Œç„¶åŽå†å°è¯•æ·»åŠ ã€‚æˆ‘ä»¬çœ‹çœ‹ WindowManagerGlobal#removeView æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeView</span><span class="params">(View view, <span class="keyword">boolean</span> immediate)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (view == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"view must not be null"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">        <span class="keyword">int</span> index = findViewLocked(view, <span class="keyword">true</span>);</span><br><span class="line">        View curView = mRoots.get(index).getView();</span><br><span class="line">        removeViewLocked(index, immediate);</span><br><span class="line">        <span class="keyword">if</span> (curView == view) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Calling with view "</span> + view</span><br><span class="line">                + <span class="string">" but the ViewAncestor is attached to "</span> + curView);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„ä¸Šé¢æ–¹æ³•æœ‰ä¸ª immediate å‚æ•°ï¼Œä¸è¿‡ä»Ž <code>Toast#TN#handleShow</code> è°ƒç”¨è¿‡æ¥æ—¶ï¼Œè¿™ä¸ªå‚æ•°ä¼šæ˜¯ falseã€‚çŽ°åœ¨å‡è®¾ view åŒ…å«åœ¨ mViews ä¸­ï¼Œé‚£ä¹ˆä¸Šé¢ç¬¬ 7 è¡Œ index å°†éžè´Ÿï¼Œä¸Šé¢ç¬¬ 9 è¡Œè°ƒç”¨äº† removeViewLocked æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">removeViewLocked</span><span class="params">(<span class="keyword">int</span> index, <span class="keyword">boolean</span> immediate)</span> </span>&#123;</span><br><span class="line">    ViewRootImpl root = mRoots.get(index);</span><br><span class="line">    View view = root.getView();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (view != <span class="keyword">null</span>) &#123;</span><br><span class="line">        InputMethodManager imm = InputMethodManager.getInstance();</span><br><span class="line">        <span class="keyword">if</span> (imm != <span class="keyword">null</span>) &#123;</span><br><span class="line">            imm.windowDismissed(mViews.get(index).getWindowToken());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">boolean</span> deferred = root.die(immediate);</span><br><span class="line">    <span class="keyword">if</span> (view != <span class="keyword">null</span>) &#123;</span><br><span class="line">        view.assignParent(<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">if</span> (deferred) &#123;</span><br><span class="line">            mDyingViews.add(view);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç  ç¬¬ 11 è¡Œå› ä¸º immediate ä¸º falseï¼Œæ‰€ä»¥è¿”å›žçš„ deferred æ˜¯ trueï¼Œé‚£ä¹ˆç¬¬ 15 è¡Œå°±ä¼šæŠŠ view æ·»åŠ åˆ° mDyingViewsã€‚</p><p>è‡³æ­¤æ€»ç»“ä¸€ä¸‹ï¼Œåªè¦ view çš„ parent ä¸ç©ºï¼Œé‚£ä¹ˆå®ƒå°±ä¼šå°è¯•è¢«ç§»é™¤ï¼Œå¦‚æžœ mViewæ˜¯ä¸­æœ‰æ¬¡ viewï¼Œåˆ™å°è¯•ç§»é™¤çš„ç»“æžœå°±æ˜¯ mDyingViews ä¹Ÿä¼šåŒ…å«æ­¤ viewï¼Œåˆ™ crash ä¸ä¼šå‘ç”Ÿã€‚</p><p>ç»è¿‡åˆ†æžç³»ç»Ÿä»£ç ï¼Œæˆ‘å‘çŽ°ç»™ view è®¾ç½® parent æ˜¯åœ¨ ViewRootImpl ä¸­çš„ setView æ–¹æ³•è°ƒç”¨ <code>view.assignParent(this)</code> åšåˆ°çš„ï¼Œè€Œ ViewRootImpl #setView æ˜¯åœ¨ WindowManagerGlobal#addView è°ƒç”¨çš„ã€‚ç½®ç©º parent åˆ™æ˜¯åœ¨ WindowManagerGlobal#removeViewLocked åšçš„ï¼Œè€Œä»Ž mViews ç§»é™¤ view æ˜¯åœ¨ WindowManagerGlobal#doRemoveView åšçš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">doRemoveView</span><span class="params">(ViewRootImpl root)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> index = mRoots.indexOf(root);</span><br><span class="line">        <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            mRoots.remove(index);</span><br><span class="line">            mParams.remove(index);</span><br><span class="line">            <span class="keyword">final</span> View view = mViews.remove(index);</span><br><span class="line">            mDyingViews.remove(view);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ThreadedRenderer.sTrimForeground &amp;&amp; ThreadedRenderer.isAvailable()) &#123;</span><br><span class="line">        doTrimForeground();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºŽè¿™äº›æ–¹æ³•éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹è°ƒç”¨çš„ï¼Œæ‰€ä»¥å¯ä»¥è‚¯å®šï¼Œåœ¨ addView æ—¶ï¼ŒmView åŒ…å« view æ—¶ï¼Œåˆ™æ­¤ view çš„ parentä¸ç©ºã€‚è€Œ mView ä¸åŒ…å« view æ—¶ï¼Œå®ƒçš„ parent ä¸ºç©ºã€‚çœ‹èµ·æ¥ä¼¼ä¹Žæ— æ‡ˆå¯å‡»ï¼Œç³»ç»Ÿä»£ç ç¡®ä¿äº† toast çš„æ˜¾ç¤ºä¸ä¼šå‡ºçŽ°é‡å¤æ·»åŠ  view å¯¼è‡´çš„ IllegalStateExceptionã€‚ä½†æ˜¯æ˜Žæ˜Ž crash å°±æ˜¯å‘ç”Ÿäº†ï¼Œåˆ†æžå †æ ˆä¹Ÿå¯çŸ¥å°±æ˜¯å‡ºçŽ°äº† view åœ¨ mViews ä¸­ä½†å´ä¸åœ¨ mDyingViews ä¸­çš„æƒ…å†µã€‚</p><p>ç»è¿‡åˆ†æžï¼Œæˆ‘å¯èƒ½æ‰¾åˆ°äº†ä¸€ç§åŽŸå› ã€‚å…ˆæ¥çœ‹ WindowManagerGlobal#addView æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addView</span><span class="params">(View view, ViewGroup.LayoutParams params,</span></span></span><br><span class="line"><span class="function"><span class="params">            Display display, Window parentWindow)</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">        ViewRootImpl root;</span><br><span class="line">        View panelParentView = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="keyword">int</span> index = findViewLocked(view, <span class="keyword">false</span>);</span><br><span class="line">            <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mDyingViews.contains(view)) &#123;</span><br><span class="line">                    <span class="comment">// Don't wait for MSG_DIE to make it's way through root's queue.</span></span><br><span class="line">                    mRoots.get(index).doDie();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"View "</span> + view</span><br><span class="line">                            + <span class="string">" has already been added to the window manager."</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// The previous removeView() had not completed executing. Now it has.</span></span><br><span class="line">            &#125;</span><br><span class="line">            ...</span><br><span class="line">            root = <span class="keyword">new</span> ViewRootImpl(view.getContext(), display);</span><br><span class="line"></span><br><span class="line">            view.setLayoutParams(wparams);</span><br><span class="line"></span><br><span class="line">            mViews.add(view);</span><br><span class="line">            mRoots.add(root);</span><br><span class="line">            mParams.add(wparams);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// do this last because it fires off messages to start doing things</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                root.setView(view, wparams, panelParentView);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">                <span class="comment">// BadTokenException or InvalidDisplayException, clean up.</span></span><br><span class="line">                <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    removeViewLocked(index, <span class="keyword">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">throw</span> e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆä¸Šé¢ä»£ç å¯èƒ½å­˜åœ¨ä¸€å¤„æ¼æ´žã€‚å‡è®¾ view ä¹‹å‰ä»Žæœªæ·»åŠ è¿‡ï¼Œé‚£ä¹ˆä½Ž 9 è¡Œè¿”å›ž -1ï¼Œç¬¬ 25 è‡³ 27 è¡ŒæŠŠ view æ·»åŠ åˆ°äº† mViews ä¸­ï¼Œç„¶åŽå‡è®¾æ­¤ view æ·»åŠ è¿‡ç¨‹ä¸­å¤±è´¥äº†ï¼Œå³ç¬¬ 31 è¡ŒæŠ›å‡ºäº†å¼‚å¸¸ï¼Œå¯æ˜¯æ­¤æ—¶ index æ˜¯ -1ï¼Œæ‰€ä»¥ç¬¬ 15 è¡Œä¼å›¾ç§»é™¤æ­¤ view æ˜¯åšä¸åˆ°çš„ï¼ŒäºŽæ˜¯æ­¤ view å°±ç•™åœ¨äº† mViews ä¸­ï¼Œè¿™å¯èƒ½æ˜¯ç³»ç»Ÿçš„ç§»é™¤æ¼æ´žã€‚å¦ä¸€ç§æƒ…å†µï¼Œå‡è®¾ç¬¬ 9 è¡Œè¿”å›žéžè´Ÿå€¼ï¼Œé‚£ä¹ˆæ­¤ view åœ¨ç¬¬ 13 è¡Œä¼šç«‹å³ç§»é™¤ï¼Œç¬¬ 25 è¡Œé‡æ–°æ·»åŠ åˆ° mView ä¸­æ—¶ï¼Œæ­¤ view æ–°çš„ index å·²ç»ä¸æ˜¯ç¬¬ 9 è¡Œçš„å€¼äº†ï¼Œç„¶åŽå¦‚æžœç¬¬ 31 è¡Œæ·»åŠ å¤±è´¥ï¼Œé‚£ä¹ˆç¬¬ 35 è¡Œå°†ä¼šè¢«æ‰§è¡Œï¼Œå¯æ˜¯ index æ˜¯é”™è¯¯çš„ï¼Œè¿™å°†ä¼šå¯¼è‡´é”™è¯¯çš„ view è¢«ç§»é™¤ï¼</p><p>ä¸Šé¢å¯èƒ½çš„æ¼æ´žè¦å‘ç”Ÿï¼Œéœ€è¦ç¬¬ 35 è¡ŒæŠ›å‡ºå¼‚å¸¸ï¼Œè€ŒæŸ¥çœ‹ <code>ViewRootImpl#setView</code> æ–¹æ³•å¯çŸ¥ï¼Œå¦‚æžœå¼‚å¸¸æŠ›å‡ºï¼Œé‚£ä¹ˆ view çš„ parent å°†å°šæœªè®¾ç½®:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setView</span><span class="params">(View view, WindowManager.LayoutParams attrs, View panelParentView)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mView == <span class="keyword">null</span>) &#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="keyword">if</span> (res &lt; WindowManagerGlobal.ADD_OKAY) &#123;</span><br><span class="line">                mAttachInfo.mRootView = <span class="keyword">null</span>;</span><br><span class="line">                mAdded = <span class="keyword">false</span>;</span><br><span class="line">                mFallbackEventHandler.setView(<span class="keyword">null</span>);</span><br><span class="line">                unscheduleTraversals();</span><br><span class="line">                setAccessibilityFocus(<span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">                <span class="keyword">switch</span> (res) &#123;</span><br><span class="line">                    <span class="keyword">case</span> WindowManagerGlobal.ADD_BAD_APP_TOKEN:</span><br><span class="line">                    <span class="keyword">case</span> WindowManagerGlobal.ADD_BAD_SUBWINDOW_TOKEN:</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> WindowManager.BadTokenException(</span><br><span class="line">                                <span class="string">"Unable to add window -- token "</span> + attrs.token</span><br><span class="line">                                + <span class="string">" is not valid; is your activity running?"</span>);</span><br><span class="line">                    <span class="keyword">case</span> WindowManagerGlobal.ADD_NOT_APP_TOKEN:</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> WindowManager.BadTokenException(</span><br><span class="line">                                <span class="string">"Unable to add window -- token "</span> + attrs.token</span><br><span class="line">                                + <span class="string">" is not for an application"</span>);</span><br><span class="line">                    <span class="keyword">case</span> WindowManagerGlobal.ADD_APP_EXITING:</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> WindowManager.BadTokenException(</span><br><span class="line">                                <span class="string">"Unable to add window -- app for token "</span> + attrs.token</span><br><span class="line">                                + <span class="string">" is exiting"</span>);</span><br><span class="line">                    <span class="keyword">case</span> WindowManagerGlobal.ADD_DUPLICATE_ADD:</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> WindowManager.BadTokenException(</span><br><span class="line">                                <span class="string">"Unable to add window -- window "</span> + mWindow</span><br><span class="line">                                + <span class="string">" has already been added"</span>);</span><br><span class="line">                    <span class="keyword">case</span> WindowManagerGlobal.ADD_STARTING_NOT_NEEDED:</span><br><span class="line">                        <span class="comment">// Silently ignore -- we would have just removed it</span></span><br><span class="line">                        <span class="comment">// right away, anyway.</span></span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    <span class="keyword">case</span> WindowManagerGlobal.ADD_MULTIPLE_SINGLETON:</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> WindowManager.BadTokenException(<span class="string">"Unable to add window "</span></span><br><span class="line">                                + mWindow + <span class="string">" -- another window of type "</span></span><br><span class="line">                                + mWindowAttributes.type + <span class="string">" already exists"</span>);</span><br><span class="line">                    <span class="keyword">case</span> WindowManagerGlobal.ADD_PERMISSION_DENIED:</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> WindowManager.BadTokenException(<span class="string">"Unable to add window "</span></span><br><span class="line">                                + mWindow + <span class="string">" -- permission denied for window type "</span></span><br><span class="line">                                + mWindowAttributes.type);</span><br><span class="line">                    <span class="keyword">case</span> WindowManagerGlobal.ADD_INVALID_DISPLAY:</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> WindowManager.InvalidDisplayException(<span class="string">"Unable to add window "</span></span><br><span class="line">                                + mWindow + <span class="string">" -- the specified display can not be found"</span>);</span><br><span class="line">                    <span class="keyword">case</span> WindowManagerGlobal.ADD_INVALID_TYPE:</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> WindowManager.InvalidDisplayException(<span class="string">"Unable to add window "</span></span><br><span class="line">                                + mWindow + <span class="string">" -- the specified window type "</span></span><br><span class="line">                                + mWindowAttributes.type + <span class="string">" is not valid"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</span><br><span class="line">                        <span class="string">"Unable to add window -- unknown error code "</span> + res);</span><br><span class="line">            &#125;</span><br><span class="line">            ...</span><br><span class="line">            view.assignParent(<span class="keyword">this</span>);</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»Žä¸Šé¢ä»£ç å¯çŸ¥ï¼Œå¦‚æžœæŠ›å‡ºå¼‚å¸¸ï¼Œ<code>view.assignParent(this)</code> å°†æœªè¢«è°ƒç”¨ã€‚</p><p>è‡³æ­¤ï¼Œå¯å°†æˆ‘çš„çŒœæµ‹æ€»ç»“ä¸ºï¼šå½“ä½¿ç”¨åŒä¸€ä¸ª view å¤šæ¬¡æ˜¾ç¤º toast æ—¶ï¼Œå¯èƒ½æŸä¸€æ¬¡æ·»åŠ å¤±è´¥ï¼Œå¯¼è‡´ view ç•™åœ¨ mViews ä¸­ï¼Œå¯æ˜¯ view çš„ parent åˆå› ä¸ºæ·»åŠ å¤±è´¥è€Œä¸ºç©ºï¼Œæ‰€ä»¥ Toast#TN#handleShow æ–¹æ³•æ²¡æœ‰è°ƒç”¨ä»Ž WindowManager ç§»é™¤æ­¤ view çš„ä»£ç ï¼Œæ‰€ä»¥ WindowManagerGlobal#addView è¢«è°ƒç”¨æ—¶ï¼Œview ä¸åœ¨ mDyingViews ä¸­ï¼Œæ‰€ä»¥ crash å‘ç”Ÿäº†ã€‚</p><p>å¯æ˜¯è¿™åªæ˜¯çŒœæµ‹ï¼Œæ— æ³•éªŒè¯çŒœæµ‹æ˜¯å¦æ­£ç¡®ã€‚</p><p>----- ä»¥ä¸‹æ˜¯ 2019 å¹´ 1 æœˆ 11 æ—¥çš„æ›´æ–° ------</p><p>çŽ°å·²å‘çŽ°å¤çŽ°ç¬¬äºŒç§ crash (IllegalStateException: view has already been added to the window manager) çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å¦‚ä¸‹çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> View toastLayout;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        toastLayout = LayoutInflater.from(<span class="keyword">this</span>).inflate(R.layout.connection_toast, <span class="keyword">null</span>);</span><br><span class="line">        </span><br><span class="line">        findViewById(R.id.btn).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                Toast toast = <span class="keyword">new</span> Toast(MainActivity.<span class="keyword">this</span>);</span><br><span class="line">                toast.setView(toastLayout);</span><br><span class="line">                toast.show();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1980</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ï¼Œç‚¹å‡»å‡ æ¬¡æŒ‰é’®æ¥æ‰§è¡Œ onClick æ–¹æ³•ï¼Œå°±å¯ä»¥å¤çŽ° crashã€‚å¤çŽ°æ€è·¯æ˜¯ï¼Œå…ˆè®©å‰ä¸€ä¸ª toast æŠŠ view æ·»åŠ åˆ° WindowManagerï¼Œä½†è¦è®©å®ƒæ·»åŠ å¤±è´¥ï¼Œç„¶åŽç¬¬äºŒæ¬¡å¦ä¸€ä¸ª toast å†æ·»åŠ æ­¤ viewï¼Œæ­¤æ¬¡å‘ç”Ÿ crashï¼Œè¿™ä¸ªæ€è·¯ä¹Ÿæ˜¯æŒ‰ç…§å‰é¢çš„çŒœæƒ³æ¥çš„ã€‚é¦–å…ˆï¼Œä¸Šé¢çš„ä»£ç æ˜¯å°†åŒä¸€ä¸ª view æ·»åŠ åˆ°ä¸åŒçš„ toast å¯¹è±¡åŽ» showï¼Œå½“æ·»åŠ åˆ°ç¬¬ä¸€ä¸ª toast è°ƒç”¨ show æ–¹æ³•åŽï¼Œä¸»çº¿ç¨‹ sleep 1980 æ¯«ç§’ï¼Œè¿™ä¸ªæ—¶é—´æ˜¯å¾ˆå¾®å¦™çš„ï¼ŒæŽ¥è¿‘ 2000 æ¯«ç§’ä½†æ˜¯å´ç•¥å°‘ã€‚è¿™ä¸ªæ—¶é—´å¯ä»¥ä½¿å¾—ä¸»çº¿ç¨‹é†’æ¥æ—¶ï¼Œtoast çš„ token å³å°†å¤±æ•ˆã€‚ä¸èƒ½ç”¨æ›´é•¿çš„ sleep æ—¶é—´æ˜¯å› ä¸ºé‚£æ ·çš„è¯ï¼Œä¸»çº¿ç¨‹è¿˜åœ¨ sleep ä¸­ token å·²å¤±æ•ˆï¼Œtoken çš„å¤±æ•ˆæ˜¯åœ¨ NotificationManagerService ä¸­äº§ç”Ÿçš„ï¼Œå¤±æ•ˆåŽï¼ŒNotificationManagerService ä¼šå¤„ç† MESSAGE_DURATION_REACHED æ¶ˆæ¯ï¼Œæœ€ç»ˆä¼šè·¨è¿›ç¨‹è°ƒç”¨åˆ° Toast#TN#hide æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•ä¼šè®©æˆ‘ä»¬ app çš„ä¸»çº¿ç¨‹æ¶ˆæ¯é˜Ÿåˆ—å¢žåŠ ä¸€ä¸ª HIDE æ¶ˆæ¯ï¼š</p><p><img src="http://tao93.top/images/2019/01/11/1547217156.png" alt=""></p><p>å¦‚æ­¤ä¸€æ¥ï¼Œå½“ä¸»çº¿ç¨‹ sleep ç»“æŸæ‰§è¡Œ Toast#TN#handleShow æ–¹æ³•æ—¶ï¼Œå°±ä¼šå› æ¶ˆæ¯é˜Ÿåˆ—å·²æœ‰ HIDE æ¶ˆæ¯è€Œæå‰è¿”å›ž:</p><p><img src="http://tao93.top/images/2019/01/11/1547217419.png" alt=""></p><p>æ—¢ç„¶éƒ½æå‰è¿”å›žäº†ï¼Œview ä¹Ÿå°±ä¸ä¼šè¢«ç¬¬ä¸€ä¸ª toast æ·»åŠ åˆ° WindowManagerï¼Œé‚£ä¹ˆä¹Ÿå°±ä¸ç¬¦åˆæˆ‘ä»¬çš„æ€è·¯ä¸­ã€Œè®©ç¬¬ä¸€ä¸ª toast æŠŠ view æ·»åŠ åˆ° WindowManager æ˜¯å‘ç”Ÿå¼‚å¸¸ã€çš„æƒ³æ³•ã€‚</p><p>æ‰€ä»¥ï¼Œéœ€è¦ 1980 æ¯«ç§’è¿™æ ·ä¸€ä¸ªæ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´ä½¿å¾—ä¸»çº¿ç¨‹é†’æ¥æ‰§è¡Œåˆ°ç¬¬ä¸€ä¸ª toast çš„ Toast#TN#handleShow æ—¶ï¼Œtoken è¿˜æ²¡å¤±æ•ˆï¼Œæ‰€ä»¥ handleShow æ–¹æ³•ä¸ä¼šæå‰è¿”å›žï¼Œæ‰€ä»¥ view ä¼šç»§ç»­å¾€ WindowManager æ·»åŠ ï¼Œä½†æ˜¯ 20 æ¯«ç§’ä¸è¶³ä»¥è®©è¿™ä¸ªæ·»åŠ é¡ºåˆ©å®Œæˆï¼Œç›¸åï¼Œå¾ˆå¯èƒ½æ·»åŠ æ—¶ token å¤±æ•ˆäº†ï¼Œ äºŽæ˜¯æ·»åŠ å¤±è´¥ï¼Œå‘ç”Ÿç¬¬ä¸€ç§ crash çš„ BadTokenException (Anddroid 8 ä»¥ä¸Šæ­¤å¼‚å¸¸ä¼šè¢«æ•èŽ·ï¼Œå‰æ–‡å·²æè¿°)ï¼Œè¿™æ ·å°±ç¬¦åˆæˆ‘ä»¬çš„æ€è·¯äº†ã€‚ä¸‹é¢æˆªå›¾è¯æ˜Žäº†ç¡®å®žå‘ç”Ÿäº† BadTokenExceptionï¼š</p><p><img src="http://tao93.top/images/2019/01/11/1547217762.png" alt=""></p><p>è‡³æ­¤ï¼ŒæŒ‰ç…§å‰é¢çš„æ€è·¯ï¼Œæ­¤ view å°†ä¼šæ—  parentï¼Œä½†æ˜¯å´ç•™åœ¨äº† WindowManagerGlobal çš„ mViews ä¸­ï¼Œå´åˆä¸åœ¨ mDyingViews ä¸­ï¼ŒäºŽæ˜¯ï¼Œå½“å†æ¬¡æŒ‰ä¸‹æŒ‰é’®ï¼Œæ‰§è¡Œå¦ä¸€ä¸ª toast æ·»åŠ æ­¤ view çš„ä»£ç æ—¶ï¼ŒWindowManagerGlobal#addView ä¸­å°†å‘ç”Ÿ IllegalStateExceptionï¼Œcrash ä¹Ÿå°±å¤çŽ°äº†ï¼Œæˆªå›¾ä¸ºè¯ï¼š</p><p><img src="http://tao93.top/images/2019/01/11/1547217909.png" alt=""></p><p>è‡³æ­¤ï¼Œtoast crash çš„åˆ†æžç®—æ˜¯æœ‰äº†ä¸€ä¸ªæ¯”è¾ƒå®Œæ»¡çš„ç»“å°¾ã€‚å¯¹äºŽæœ¬æ–‡ä¸­ 2019 å¹´ 1 æœˆ 11 æ—¥æ›´æ–°çš„éƒ¨åˆ†ï¼Œåœ¨æ­¤æ„Ÿè°¢åˆ˜æˆåŒå­¦æä¾›çš„å¸®åŠ©ï¼Œä»–æœ¬æ¥ç”¨æ¥å¤çŽ°é—®é¢˜çš„æ–¹å¼æ˜¯ã€Œå…ˆè°ƒä¸€ä¸ª toast çš„ showï¼Œsleep ä¸‰å››ç§’ï¼Œç„¶åŽå†ç”¨åŒä¸€ä¸ª view è°ƒå¦ä¸€ä¸ª toast çš„ showã€ï¼Œè¿™ä¸ªæ–¹å¼å› ä¸ºå‰é¢è®²çš„åŽŸå› è€Œæ— æ³•å¤çŽ° crashï¼Œä½†å´ç»™äº†æˆ‘çµæ„Ÿï¼Œè®©æˆ‘æƒ³åˆ°äº† 1980 æ¯«ç§’è¿™ä¸ªæ—¶é—´ï¼Œæœ€ç»ˆæˆåŠŸå¤çŽ°äº† crashã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Toast æ˜¯ Android ç³»ç»Ÿä¸€ç§éžå¸¸ç®€å•çš„æç¤ºæ€§å°å·¥å…·ï¼Œæœ€è¿‘æˆ‘å°è¯•ä¿®å¤ Toast ç›¸å…³çš„ä¸¤ç§ Crashï¼Œæ‰€ä»¥æŠŠç›¸å…³çš„åŽŸå§”å’Œè¿‡ç¨‹è®°å½•äº†ä¸‹æ¥ã€‚å…ˆæ¥çœ‹ä¸€ä¸‹ç¬¬ä¸€ç§ Crash çš„ log:&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;tabl
      
    
    </summary>
    
    
      <category term="Android" scheme="https://tao93.top/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Java Comparable Contracts</title>
    <link href="https://tao93.top/2018/12/22/Java%20Comparable%20Contracts/"/>
    <id>https://tao93.top/2018/12/22/Java Comparable Contracts/</id>
    <published>2018-12-22T13:10:08.148Z</published>
    <updated>2019-07-05T14:02:09.750Z</updated>
    
    <content type="html"><![CDATA[<p>å®žçŽ° Java ä¸­çš„ Comparable æŽ¥å£çš„å¯¹è±¡ï¼Œå¯ä»¥ç”¨åœ¨ Collections#sort ç­‰æ–¹æ³•ä¸­è¿›è¡ŒæŽ’åºç­‰ã€‚é€šå¸¸æ¥è¯´ï¼ŒComparable æŽ¥å£çš„ compareTo æ–¹æ³•éƒ½æ˜¯å†™èµ·æ¥æ¯”è¾ƒç®€å•çš„ã€‚ä¸è¿‡ï¼Œå¶å°”è¿˜æ˜¯å¯èƒ½ç¿»è½¦çš„ã€‚æ¯”å¦‚ä¸‹é¢çš„ crash logï¼Œå°±æ˜¯ç¿»è½¦çš„çŽ°åœºï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">java<span class="selector-class">.lang</span><span class="selector-class">.IllegalArgumentException</span>: Comparison method violates its general contract! </span><br><span class="line">  at java<span class="selector-class">.util</span><span class="selector-class">.TimSort</span><span class="selector-class">.mergeHi</span>(TimSort<span class="selector-class">.java</span>:<span class="number">868</span>) </span><br><span class="line">  at java<span class="selector-class">.util</span><span class="selector-class">.TimSort</span><span class="selector-class">.mergeAt</span>(TimSort<span class="selector-class">.java</span>:<span class="number">485</span>) </span><br><span class="line">  at java<span class="selector-class">.util</span><span class="selector-class">.TimSort</span><span class="selector-class">.mergeCollapse</span>(TimSort<span class="selector-class">.java</span>:<span class="number">408</span>) </span><br><span class="line">  at java<span class="selector-class">.util</span><span class="selector-class">.TimSort</span><span class="selector-class">.sort</span>(TimSort<span class="selector-class">.java</span>:<span class="number">214</span>) </span><br><span class="line">  at java<span class="selector-class">.util</span><span class="selector-class">.TimSort</span><span class="selector-class">.sort</span>(TimSort<span class="selector-class">.java</span>:<span class="number">173</span>) </span><br><span class="line">  at java<span class="selector-class">.util</span><span class="selector-class">.Arrays</span><span class="selector-class">.sort</span>(Arrays<span class="selector-class">.java</span>:<span class="number">659</span>) </span><br><span class="line">  at java<span class="selector-class">.util</span><span class="selector-class">.Collections</span><span class="selector-class">.sort</span>(Collections<span class="selector-class">.java</span>:<span class="number">217</span>)</span><br></pre></td></tr></table></figure><p>å¼‚å¸¸æ˜¾ç¤ºè¿åäº† general contractï¼Œè¿™äº› contract å…¶å®žåœ¨ Comparable#compareTo æ–¹æ³•çš„æ³¨é‡Šä¸­å°±è®²åˆ°äº†ï¼Œä¸»è¦å°±æ˜¯ç›¸åæ€§ã€ä¼ é€’æ€§ã€ç­‰ä»·æ€§ä¸‰æ¡ contractã€‚è¿™äº› contract å¯ä»¥å†™æˆä¸‹é¢è¿™æ ·çš„å½¢å¼ï¼š</p><ol><li><p>$sgn(x.compareTo(y)) = -sgn(y.compareTo(x)) $</p></li><li><p>$sgn(x.compareTo(y)) &gt; 0$ and $sgn(y.compareTo(z)) &gt; 0$ implies $sgn(x.compareTo(z)) &gt; 0$</p></li><li><p>$sgn(x.compareTo(y)) = 0$ implies sgn(x.compareTo(z)) = sgn(y.compareTo(z))$</p></li></ol><p>ä¸Šé¢çš„ $sgn$ å‡½æ•°å°±æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p><p><img src="http://tao93.top/images/2018/12/22/1545477555.png" alt=""></p><p>æ‰€ä»¥ç¬¬ä¸€æ¡çš„æ„æ€æ˜¯ x ä¸Ž y çš„æ¯”è¾ƒç»“æžœå’Œ y ä¸Ž x çš„æ¯”è¾ƒç»“æžœå¿…é¡»ç›¸åï¼›ç¬¬äºŒæ¡çš„æ„æ€æ˜¯ï¼Œæ¯”è¾ƒç»“æžœæ˜¯å…·æœ‰ä¼ é€’æ€§çš„ï¼Œç¬¬ 3 æ¡æ˜¯å¦‚æžœ x å’Œ y çš„æ¯”è¾ƒç»“æžœæ˜¯ç›¸ç­‰çš„ï¼Œé‚£ä¹ˆå®ƒä»¬ä¸Žä»»ä½• z çš„æ¯”è¾ƒç»“æžœç›¸åŒã€‚</p><p>ç®€å•å®žçŽ°çš„ compareTo æ–¹æ³•é€šå¸¸ä¸ä¼šè¿èƒŒä¸Šé¢çš„åè®®ï¼Œä¸è¿‡ï¼Œç¨å¾®å¤æ‚ç‚¹çš„ï¼Œå°±ä¸ä¸€å®šäº†ã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Object o2)</span> </span>&#123;</span><br><span class="line">    Data d2 = (Data) o2</span><br><span class="line">    <span class="keyword">if</span> (isSortByName()) &#123;</span><br><span class="line">        <span class="keyword">return</span> getName().compareTo(d2.getName());</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isSortByAge()) &#123;</span><br><span class="line">        <span class="keyword">return</span> getAge() - d2.getAge();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šé¢ä»£ç æ¥å®žçŽ° Comparable æŽ¥å£çš„å¯¹è±¡ï¼Œç„¶åŽè¿›è¡ŒæŽ’åºï¼Œæ˜¯å¯èƒ½å­˜åœ¨çš„é—®é¢˜çš„ã€‚åœ¨ä¸€æ¬¡å®Œæ•´çš„æŽ’åºè¿‡ç¨‹ä¸­ï¼Œä¸Šé¢çš„ compareTo æ–¹æ³•éœ€è¦è°ƒç”¨å¤šæ¬¡ï¼Œä½†æ˜¯ä¸Šé¢çš„ isSortByName å’Œ isSortByAge æ–¹æ³•çš„è¿”å›žæ˜¯å¯èƒ½å˜åŒ–çš„ï¼Œæ¯”å¦‚å¤šçº¿ç¨‹æƒ…å†µä¸‹å…¶ä»–çº¿ç¨‹å¯èƒ½ä¿®æ”¹äº† isSortByName æ–¹æ³•æ‰€ä½¿ç”¨çš„å˜é‡çš„å€¼ã€‚å½“ isSortByName çš„ç»“æžœå˜åŒ–æ—¶ï¼Œæ„å‘³ç€æŽ’åºçš„æ¯”è¾ƒæ ‡å‡†ä¹Ÿå˜äº†ï¼Œè‡ªç„¶éžå¸¸å®¹æ˜“è¿åå‰é¢è¯´åˆ°çš„ contractã€‚</p><p>è€Œä¸‹é¢çš„ä»£ç ç‰‡æ®µï¼ŒåŒæ ·æ˜¯æœ‰é—®é¢˜çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Object o2)</span> </span>&#123;</span><br><span class="line">    Data d2 = (Data) o2</span><br><span class="line">    <span class="keyword">boolean</span> date1Empty = TextUtils.isEmpty(getDateStr());</span><br><span class="line">    <span class="keyword">boolean</span> date2Empty = TextUtils.isEmpty(d2.getDateStr());</span><br><span class="line">    <span class="keyword">if</span> (date1Empty &amp;&amp; date2Empty) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (! date1Empty &amp;&amp; ! date2Empty) &#123;</span><br><span class="line">        SimpleDateFormat format = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"...."</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Date date1 = format.format(getDateStr());</span><br><span class="line">            Date date2 = format.format(d2.getDateStr());</span><br><span class="line">            <span class="keyword">return</span> date1.compareTo(date2);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(ParseException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„é—®é¢˜åœ¨äºŽï¼ŒParseException è¢«æ•èŽ·å¹¶ä¸”ç›´æŽ¥è¿”å›ž 0 äº†ã€‚è¿™æ„å‘³ç€ä¸¤ä¸ª date string åªè¦æœ‰ä¸€ä¸ªæ˜¯æ— æ³•è§£æžçš„ï¼Œé‚£ä¹ˆæ¯”è¾ƒç»“æžœå°±æ˜¯0ï¼Œä¹Ÿå°±æ˜¯ç›¸ç­‰ã€‚åŠ å…¥ a, b, c ä¸‰ä¸ª date stringï¼Œåªæœ‰ b æ˜¯æ— æ³•è§£æžçš„ï¼Œé‚£ä¹ˆ a å’Œ b æ¯”è¾ƒç»“æžœä¸º 0ï¼Œb å’Œ c æ¯”è¾ƒç»“æžœä¹Ÿæ˜¯ 0ï¼Œåˆ™æ ¹æ®ç¬¬ 3 æ¡ contractï¼Œa å’Œ c çš„æ¯”è¾ƒç»“æžœä¹Ÿåº”è¯¥æ˜¯ 0ï¼Œå¯æ˜¯ a å’Œ c éƒ½æ˜¯å¯ä»¥æ­£å¸¸è§£æžçš„ï¼Œå®ƒä»¬çš„æ¯”è¾ƒç»“æžœä¸ä¸€å®šæ˜¯ 0ã€‚æ‰€ä»¥ç¬¬ 3 æ¡ contract ä¼šè¢«è¿åã€‚</p><p>è¦æ”¹æ­£ä¸Šé¢çš„ä»£ç ç‰‡æ®µï¼Œå¯ä»¥ç›´æŽ¥æŠŠå¼‚å¸¸æŠ›å‡ºï¼Œä»¥æœŸæå‰å°†ä¸å¯è§£æžçš„ date string é¿å…æŽ‰ã€‚å¦ä¸€ç§æ–¹å¼æ›´å•°å—¦ç‚¹ï¼Œå°±æ˜¯ä¸¤ä¸ªä¸å¯è§£æžçš„ date string è®¤ä¸ºæ˜¯ç›¸ç­‰çš„ï¼Œç„¶åŽå¯è§£æžå’Œä¸å¯è§£æžçš„å­—ç¬¦ä¸²çš„æ¯”è¾ƒçº¦å®šå¥½å¤§å°å…³ç³»ï¼Œå¹¶ç¡®ä¿ç¬¦åˆç›¸åæ€§ contractã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å®žçŽ° Java ä¸­çš„ Comparable æŽ¥å£çš„å¯¹è±¡ï¼Œå¯ä»¥ç”¨åœ¨ Collections#sort ç­‰æ–¹æ³•ä¸­è¿›è¡ŒæŽ’åºç­‰ã€‚é€šå¸¸æ¥è¯´ï¼ŒComparable æŽ¥å£çš„ compareTo æ–¹æ³•éƒ½æ˜¯å†™èµ·æ¥æ¯”è¾ƒç®€å•çš„ã€‚ä¸è¿‡ï¼Œå¶å°”è¿˜æ˜¯å¯èƒ½ç¿»è½¦çš„ã€‚æ¯”å¦‚ä¸‹é¢çš„ crash logï¼Œå°±æ˜¯ç¿»è½¦çš„
      
    
    </summary>
    
    
      <category term="Java" scheme="https://tao93.top/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>çŸ©é˜µè¿ç®—åœ¨ Android ä¸­çš„ç®€å•åœºæ™¯</title>
    <link href="https://tao93.top/2018/12/04/%E7%9F%A9%E9%98%B5%E8%BF%90%E7%AE%97%E5%9C%A8%20Android%20%E4%B8%AD%E7%9A%84%E7%AE%80%E5%8D%95%E5%9C%BA%E6%99%AF/"/>
    <id>https://tao93.top/2018/12/04/çŸ©é˜µè¿ç®—åœ¨ Android ä¸­çš„ç®€å•åœºæ™¯/</id>
    <published>2018-12-04T14:52:16.196Z</published>
    <updated>2019-07-05T14:04:27.118Z</updated>
    
    <content type="html"><![CDATA[<p>è®©æˆ‘ä»¬å…ˆä»Žä½äºŽ android.graphics åŒ…ä¸­çš„ Bitmap ç±»çš„ä¸€ä¸ªæ–¹æ³•å¼€å§‹è¯´èµ·ï¼Œä¹Ÿå°±æ˜¯ createBitmap(Bitmap source, int x, int y, int width, int height, Matrix m, boolean filter) è¿™æ ·ä¸€ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¸­æœ‰ä¸ªçŸ©é˜µå‚æ•°ï¼Œé€šè¿‡ä¼ å…¥æ­¤çŸ©é˜µå‚æ•°ï¼Œå¯ä»¥å°† source Bitmap ç»è¿‡ä¸€å®šçš„è½¬æ¢å†åˆ›å»ºç›®æ ‡ Bitmapã€‚é‚£ä¹ˆè¿™ä¸ªçŸ©é˜µæ˜¯æ€Žä¹ˆèµ·ä½œç”¨çš„å‘¢ï¼Ÿå…ˆçœ‹ä¸€æ®µç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Matrix matrix = <span class="keyword">new</span> Matrix();</span><br><span class="line">matrix.postRotate(<span class="number">90</span>);</span><br><span class="line">Bitmap bitmap2 = Bitmap.createBitmap(bitmap1, <span class="number">0</span>, <span class="number">0</span>, bitmap1.width(), bitmap1.getHeight(), matrix, <span class="keyword">true</span>);</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç åšçš„äº‹æƒ…æ˜¯å°† bitmap1 é¡ºæ—¶é’ˆæ—‹è½¬ 90Â° å¾—åˆ° bitmap2ï¼Œèµ·å…³é”®ä½œç”¨çš„å°±æ˜¯è¿™ä¸ª matrixã€‚ç¬¬ä¸€è¡Œä»£ç ä¼šå¾—åˆ°ä¸€ä¸ª 3Ã—3 çš„å•ä½çŸ©é˜µï¼Œè€Œç¬¬äºŒè¡Œä»£ç ä¹‹åŽï¼ŒçŸ©é˜µå°†ä¼šå˜æˆä¸‹é¢è¿™æ ·ï¼š</p><script type="math/tex; mode=display">  \begin{bmatrix}   0 & -1 & 0 \\   1 & 0 & 0 \\   0 & 0 & 1  \end{bmatrix} Â·  \begin{bmatrix}   1 & 0 & 0 \\   0 & 1 & 0 \\   0 & 0 & 1  \end{bmatrix} =  \begin{bmatrix}  0 & -1 & 0 \\  1 & 0 & 0 \\  0 & 0 & 1  \end{bmatrix}</script><p>æ³¨æ„åœ¨ xy å¹³é¢å†…é¡ºæ—¶é’ˆ rotate 90Â° çš„æ“ä½œå¯¹åº”çš„çŸ©é˜µæ˜¯ </p><script type="math/tex; mode=display">\begin{bmatrix}cos 90Â° & -sin 90Â° & 0 \\sin 90Â° & cos90Â° & 0 \\0 & 0 & 1\end{bmatrix} = \begin{bmatrix}   0 & -1 & 0 \\   1 & 0 & 0 \\   0 & 0 & 1  \end{bmatrix}</script><p>è®°ä¸Šé¢çš„çŸ©é˜µä¸º R90ï¼Œè®°ä¸Šé¢ä»£ç ä¸­çš„ matrix ä¸º Mï¼Œè®°å•ä½çŸ©é˜µä¸º Iï¼Œé‚£ä¹ˆç¬¬ 2 è¡Œçš„æ“ä½œåˆ™æ˜¯ç­‰åŒäºŽä¸‹é¢çš„è¡¨è¾¾å¼ï¼š</p><script type="math/tex; mode=display">M = R90Â·M</script><p>ä¹Ÿå°±æ˜¯:</p><script type="math/tex; mode=display">M = R90Â·I</script><p>æ³¨æ„ä¸Šé¢çš„ç‚¹ä¹˜é¡ºåºæ˜¯ R90 åœ¨å‰ï¼ŒI åœ¨åŽï¼ˆè™½ç„¶è¿™é‡Œ R90Â·I å’Œ IÂ·R90 ç»“æžœæ˜¯ä¸€æ ·ï¼Œä½†åˆ«çš„åœºæ™¯æœªå¿…å¦‚æ­¤ï¼‰ã€‚åŽŸå› æ˜¯ ä»£ç ä¸­æ˜¯ <code>postRotate</code> æ–¹æ³•ï¼Œè¿™é‡Œ <code>post</code> è¡¨ç¤ºæ˜¯æŠŠ rotate æ”¾åœ¨å˜æ¢çš„æœ€åŽä¸€æ­¥ã€‚è€Œå˜æ¢çŸ©é˜µä½œç”¨ R90Â·M ä½œç”¨åœ¨ç›®æ ‡å‘é‡ V æ—¶ï¼Œå°†ä¼šæ˜¯è¡¨è¾¾å¼ï¼š</p><script type="math/tex; mode=display">R90Â·MÂ·V</script><p>è¿™æ ·å°±å¯ä»¥ç†è§£ä¸ºæ˜¯å…ˆ MÂ·V ç„¶åŽè¿™ä¸ªç»“æžœå†è¢« R90 ä¹˜ï¼Œæ‰€ä»¥æ˜¯å…ˆåš M æœ¬æ¥çš„å˜æ¢ï¼Œç„¶åŽå†åš R90 çš„å˜æ¢ï¼Œä¹Ÿå°±æ˜¯ rotate 90Â° åœ¨æœ€åŽä¸€æ­¥ã€‚è¿™ä¹Ÿå°±æ˜¯ç¬¬ 2 è¡Œä»£ç çš„ postRotate 90Â° ç­‰ä»·äºŽ M = R90Â·M ä¹Ÿå°±æ˜¯ M = R90Â·I çš„åŽŸå› ã€‚</p><p>æ‰€ä»¥ç¬¬ 3 è¡Œä»£ç ä¼ å…¥çš„ matrix å°±æ˜¯ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}   0 & -1 & 0 \\   1 & 0 & 0 \\   0 & 0 & 1  \end{bmatrix}</script><p>çŽ°åœ¨æˆ‘ä»¬è¿›å…¥å‰é¢è¯´çš„ createBitmap è¿™ä¸ªæ–¹æ³•ä¸­åŽ»çœ‹çœ‹æºç æ˜¯æ€Žä¹ˆå®žçŽ°è¿™ä¸ªå˜æ¢çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">createBitmap</span><span class="params">(Bitmap source, <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> width, <span class="keyword">int</span> height, Matrix m, <span class="keyword">boolean</span> filter)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    Rect srcR = <span class="keyword">new</span> Rect(x, y, x + width, y + height);</span><br><span class="line">    RectF dstR = <span class="keyword">new</span> RectF(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">    RectF deviceR = <span class="keyword">new</span> RectF();</span><br><span class="line">    m.mapRect(deviceR, dstR);</span><br><span class="line">    neww = Math.round(deviceR.width());</span><br><span class="line">    newh = Math.round(deviceR.height());</span><br><span class="line">    bitmap = createBitmap(neww, newh, transformedConfig, transformed || source.hasAlpha());</span><br><span class="line">    </span><br><span class="line">    Canvas canvas = <span class="keyword">new</span> Canvas(bitmap);</span><br><span class="line">    canvas.translate(-deviceR.left, -deviceR.top);</span><br><span class="line">    canvas.concat(m);</span><br><span class="line">    canvas.drawBitmap(source, srcR, dstR, paint);</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> bitmap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ç¬¬ 3 è¡Œ srcR å°†æ˜¯ source Bitmap ä¸­è¦è¢«è½¬æ¢çš„éƒ¨åˆ†ã€‚è€Œ dstR æ˜¯åŒæ ·å®½é«˜ä½†æ˜¯å·¦ä¸Šè§’åœ¨ (0, 0) çš„çŸ©å½¢ã€‚ç¬¬ 6 è¡Œåˆ™æ˜¯å°† dstR å˜æ¢åŽå¾—åˆ° deviceRï¼Œæ ¹æ®å‰é¢æ‰€çŸ¥ çš„ m çš„å€¼ï¼Œå¯çŸ¥deviceR å°†ä¼šæ˜¯ left, top, right, bottom åˆ†åˆ«æ˜¯ -height, 0, 0, width:</p><p><img src="http://tao93.top/images/2018/12/04/1543937277.png" alt=""></p><p>å³ deviceR æ˜¯ dstR ç»•åŽŸç‚¹é¡ºæ—¶é’ˆæ—‹è½¬ 90Â° å¾—åˆ°çš„ã€‚ç´§æŽ¥ç€ä»£ç  7ã€8 è¡Œå¾—åˆ°è½¬æ¢åŽçš„ Bitmap çš„å®½é«˜ã€‚ç„¶åŽç¬¬ 9 è¡Œä»¥æ­¤å®½é«˜åˆ›å»ºäº†æ–°çš„ Bitmapã€‚ç¬¬ 11 è¡ŒåŸºäºŽæ­¤ Bitmap åˆ›å»ºäº† canvasã€‚</p><p>é‡ç‚¹æ¥äº†ï¼Œç¬¬ 12 è¡Œå¯¹æ­¤ canvas è¿›è¡Œå¹³ç§»å˜æ¢ï¼Œå¹³ç§»çš„ç›®çš„æ˜¯è®© deviceR çš„å·¦ä¸Šè§’ç§»åŠ¨åˆ°åŽŸç‚¹ã€‚ä»Žè€Œè®©å®ƒä½äºŽ x éžè´Ÿä¸” y éžè´Ÿçš„è±¡é™ã€‚è€Œç¬¬ 13 è¡Œåˆ™å°† m çŸ©é˜µçš„å˜æ¢ä½œç”¨åœ¨æ­¤ canvas æ˜¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¬¬ 12ã€13 è¡Œçš„å˜æ¢ï¼Œéƒ½æ˜¯ pre çš„å˜æ¢è€Œä¸æ˜¯ post çš„ã€‚æ‰€ä»¥å¯ä»¥çœ‹æˆ 13 è¡Œçš„å˜æ¢å…¶å®žæ˜¯æ¯”ç¬¬ 12 è¡Œçš„å¹³ç§»å…ˆæ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªå˜æ¢è¿‡ç¨‹å¯ç†è§£ä¸ºå…ˆç»•åŽŸç‚¹é¡ºæ—¶é’ˆæ—‹è½¬ 90Â°ï¼Œç„¶åŽå†å°†å·¦ä¸Šè§’å¹³ç§»åˆ°åŽŸç‚¹ï¼Œè¿™æ ·å°±æˆåŠŸçš„å®Œæˆäº†å°†åŽŸ Bitmap æ—‹è½¬ 90Â° å¹¶åˆ›å»ºæ–° Bitmap çš„æ“ä½œï¼Œè™½ç„¶è¿™é‡Œé™¤äº† rotateï¼Œå…¶å®žè¿˜åˆ©ç”¨äº† translation æ“ä½œã€‚</p><p>ç”¨ 3Ã—3 çŸ©é˜µåœ¨ xy å¹³é¢å†…å˜æ¢ï¼Œå¯ä»¥åˆ†ä¸º translate, rotate, scale, skew ä¸€å…± 4 ç§ï¼Œè¡¨ç¤ºè¿™å››ç§æ“ä½œçš„çŸ©é˜µåˆ†åˆ«è®°ä½œï¼š</p><script type="math/tex; mode=display">T(a, b),\ R(\theta),\ S(u, v),\ SKx(\theta), SKy(\theta)</script><p>é‚£ä¹ˆå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}   1 & 0 & a \\   0 & 1 & b \\   0 & 0 & 1\end{bmatrix},\ \begin{bmatrix}   cos(\theta) & -sin(\theta) & 0 \\   sin(\theta) & cos(\theta) & 0 \\   0 & 0 & 1\end{bmatrix},\ \begin{bmatrix}   u & 0 & 0 \\   0 & v & 0 \\   0 & 0 & 1\end{bmatrix},\ \begin{bmatrix}   1 & tan(\theta) & 0 \\   0 & 1 & 0 \\   0 & 0 & 1\end{bmatrix},\ \begin{bmatrix}   1 & 0 & 0 \\   tan(\theta) & 1 & 0 \\   0 & 0 & 1\end{bmatrix}</script><p>åˆ†åˆ«è¡¨ç¤ºçš„å«ä¹‰æ˜¯ï¼š</p><ol><li>å‘ +x æ–¹å‘å¹³ç§» a ä¸”å‘ +y æ–¹å‘å¹³ç§» bï¼›</li><li>ä»¥åŽŸç‚¹ä¸ºä¸­å¿ƒåœ¨ xy å¹³é¢æ—‹è½¬ theta è§’åº¦ï¼›</li><li>ä»¥åŽŸç‚¹ä¸º pivotï¼Œx æ–¹å‘å’Œ y æ–¹å‘åˆ†åˆ«ä¼¸ç¼©å€¼ä¸º u å’Œ v çš„æ¯”ä¾‹ï¼›</li><li>æ¯ä¸ªç‚¹çš„ $x$ åæ ‡å˜ä¸º $x + yÂ·tan(\theta)$ï¼Œè€Œ $y$ åæ ‡ä¸å˜ï¼Œè§†è§‰è¡¨çŽ°ä¸ºå›¾å½¢å‘ +y æ–¹å‘å€¾æ–œï¼Œå€¾æ–œè§’åº¦ä¸º $\theta$;</li><li>æ¯ä¸ªç‚¹çš„ $y$ åæ ‡å˜ä¸º $xÂ·tan(\theta) + y$ï¼Œè€Œ $x$ åæ ‡ä¸å˜ï¼Œè§†è§‰è¡¨çŽ°ä¸ºå›¾å½¢å‘ +x æ–¹å‘å€¾æ–œï¼Œå€¾æ–œè§’åº¦ä¸º $\theta$.</li></ol><p>æ³¨æ„, $T(a, 0)$ å’Œ $T(0, b)$ ç»„åˆèµ·æ¥çš„å˜æ¢ï¼Œç­‰ä»·äºŽ $T(a, b)$ï¼Œä¸”å’Œç»„åˆé¡ºåºæ— å…³ï¼Œè¿™ä»ŽçŸ©é˜µä¹˜æ³•ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}1 & 0 & a \\0 & 1 & 0 \\0 & 0 & 1\end{bmatrix}Â·\begin{bmatrix}1 & 0 & 0 \\0 & 1 & b \\0 & 0 & 1\end{bmatrix}=\begin{bmatrix}1 & 0 & 0 \\0 & 1 & b \\0 & 0 & 1\end{bmatrix}Â·\begin{bmatrix}1 & 0 & a \\0 & 1 & 0 \\0 & 0 & 1\end{bmatrix}=\begin{bmatrix}1 & 0 & a \\0 & 1 & b \\0 & 0 & 1\end{bmatrix}</script><p>åŒæ ·çš„ï¼Œ$S(u, 0)$ å’Œ $S(0, v)$ ç»„åˆèµ·æ¥ç­‰ä»·äºŽ $S(u, v)$ ä¸”å’Œç»„åˆé¡ºåºæ— å…³ã€‚è€Œ Skew æ— æ­¤æ€§è´¨ã€‚äº‹å®žä¸Šï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}1 & tan(\alpha) & 0 \\0 & 1 & 0 \\0 & 0 & 1\end{bmatrix}Â·\begin{bmatrix}1 & 0 & 0 \\tan(\beta) & 1 & 0 \\0 & 0 & 1\end{bmatrix}=\begin{bmatrix}1+tan(\alpha)tan(\beta) & tan(\alpha) & 0 \\tan(\beta) & 1 & 0 \\0 & 0 & 1\end{bmatrix}</script><p>è€Œï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}1 & 0 & 0 \\tan(\beta) & 1 & 0 \\0 & 0 & 1\end{bmatrix}Â·\begin{bmatrix}1 & tan(\alpha) & 0 \\0 & 1 & 0 \\0 & 0 & 1\end{bmatrix}=\begin{bmatrix}1 & tan(\alpha) & 0 \\tan(\beta) & 1+tan(\alpha)tan(\beta) & 0 \\0 & 0 & 1\end{bmatrix}</script><p>æŽ¥ä¸‹æ¥è¯´è¯´ Android ä¸­å’Œ 3Ã—3 çŸ©é˜µç›¸å…³çš„ä¸€äº›ç±»ï¼Œä¹Ÿå°±æ˜¯ <a href="https://developer.android.com/reference/android/graphics/Matrix" target="_blank" rel="noopener">Matrix</a>, <a href="https://developer.android.com/reference/android/graphics/Canvas" target="_blank" rel="noopener">Canvas</a>, <a href="https://developer.android.com/reference/android/graphics/Camera" target="_blank" rel="noopener">Camera</a> è¿™ 3 ä¸ªç±»ï¼Œæ³¨æ„æœ€åŽè¿™ä¸ª  Camera ç±»æ˜¯ android.graphics åŒ…ä¸­çš„ï¼Œè€Œä¸æ˜¯ android.hardware ä¸­çš„ã€‚</p><p>Matrix å¯¹è±¡è¡¨ç¤ºä¸€ä¸ª 3Ã—3 çŸ©é˜µï¼Œå¸¸ç”¨äºŽæŒ‡ç¤º x y å¹³é¢å†…çš„å˜æ¢ï¼Œæž„é€ å‡½æ•°åˆ›å»ºçš„éƒ½æ˜¯å•ä½çŸ©é˜µã€‚Matrix æœ‰ä¸€ç³»åˆ— set æ–¹æ³•ï¼Œç”¨äºŽè®¾ç½®çŸ©é˜µçš„å€¼ï¼Œè¿™äº›æ–¹æ³•å¯¹åº”äºŽä¸€äº›å¸¸è§çš„å˜æ¢æ“ä½œï¼Œæ¯”å¦‚ setScale(int sx, int sy) æ–¹æ³•ï¼Œå…¶å®žå°±æ˜¯æŠŠçŸ©é˜µ(ä¸ç®¡åŽŸæ¥æ˜¯ä»€ä¹ˆå€¼)å˜æˆä¸‹é¢çš„å€¼ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}sx & 0 & 0 \\0 & sy & 0 \\0 & 0 & 1\end{bmatrix}</script><p>ä¸Šé¢çš„ç¼©æ”¾æ˜¯ä»¥åŽŸç‚¹ä¸º pivot ç¼©æ”¾çš„ï¼Œæ­¤å¤–ï¼Œè¿˜æœ‰ setScale(float sx, float sy, float px, float py) è¿™æ ·ä»¥ (px, py) ä¸º pivot è¿›è¡Œç¼©æ”¾çš„æ“ä½œï¼Œç­‰ä»·äºŽæŠŠçŸ©é˜µå˜ä¸ºä¸‹é¢è¿™æ ·ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}sx & 0 & px(1-sx) \\0 & sy & py(1-sy) \\0 & 0 & 1\end{bmatrix}</script><p>æ³¨æ„ä»¥ä¸ŠçŸ©é˜µæ˜¯å¯ä»¥åˆ†è§£çš„ï¼Œåˆ†è§£ä¸ºä¸¤ä¸ªçŸ©é˜µï¼Œä¸”è¿™ä¸¤ä¸ªçŸ©é˜µäº¤æ¢ä½ç½®åŽçš„ç§¯ä¹Ÿæ˜¯ä¸Šé¢çš„çŸ©é˜µã€‚å…¶ä»–çš„ set æ–¹æ³•ä¸Žæ­¤ç±»ä¼¼ï¼Œå°±ä¸å¤šè¯´äº†ã€‚</p><p>Matrix è¿˜æœ‰ä¸€ç³»åˆ— post æ–¹æ³•å’Œ pre æ–¹æ³•ï¼Œæ¯”å¦‚ postRotate(int degrees) å’Œ preSkew(int kx, int ky) æ–¹æ³•ï¼Œå‰è€…ç›¸å½“äºŽ $M=R(degrees)Â·M$ï¼ŒåŽè€…ç›¸å½“äºŽ $M=MÂ·SK(kx,\ ky)$. æ³¨æ„è¿™é‡ŒçŸ©é˜µç›¸ä¹˜çš„é¡ºåºå–å†³äºŽæ˜¯ post è¿˜æ˜¯ pre.</p><p>å…¶å®ž Matrix ä¹Ÿå¯ä»¥åœ¨ 3 ç»´ç©ºé—´ä¸­å˜æ¢ï¼Œæ¯”å¦‚ä½¿ç”¨å®ƒçš„ setPolyToPoly æ–¹æ³•ï¼Œå¯ä»¥å¾—åˆ°æ»¡è¶³æŒ‡å®šçš„æ˜ å°„å…³ç³»çš„çŸ©é˜µã€‚è€Œè¿™ç§æ˜ å°„å…³ç³»å¯èƒ½éœ€è¦ 3 ä¸ºç©ºé—´çš„å˜æ¢æ‰èƒ½æ»¡è¶³ã€‚</p><p>Canvas ç±»åŒ…å«ä¸€ä¸ªå˜æ¢çŸ©é˜µï¼Œè¿™ä¸ªçŸ©é˜µå¯ä»¥ get ä¹Ÿå¯ä»¥ setï¼Œä¹Ÿå¯ä»¥ç”¨ concact(Matrix mat) æ¥æ”¹å˜ Canvas çš„å˜æ¢çŸ©é˜µçš„å€¼ï¼Œè¿™ä¸ªè¿‡ç¨‹ç­‰ä»·äºŽ $M=MÂ·mat$. å¦å¤–ï¼ŒCanvas çš„ drawBitmap æ–¹æ³•ä¹Ÿå¯ä»¥ä¼ å…¥ Matrix å¯¹è±¡æ¥æŽ§åˆ¶ bitmap è¢« draw æ—¶éœ€è¦çš„æ–½åŠ çš„å˜æ¢ã€‚Canvas çš„ translate å’Œ rotate ç­‰æ–¹æ³•ï¼Œéƒ½æ˜¯ pre ç±»åž‹çš„ï¼Œå¹¶ä¸”è¿™ç§å˜åŒ–ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯å¯¹ canvas çš„åæ ‡ç³»è¿›è¡Œå˜åŒ–ã€‚æ— å˜æ¢æ—¶ï¼Œåæ ‡ç³»åŽŸç‚¹åœ¨å¯è§åŒºåŸŸçš„å·¦ä¸Šè§’ï¼Œè€Œ +x å‘å³ï¼Œ+y å‘ä¸‹ã€‚translate(10, 0) åŽï¼Œcanvas åŽŸç‚¹å‘å³ç§»åŠ¨ 10ï¼Œæ­¤åŽç»˜åˆ¶åœ¨ (0, 0) ä½ç½®çš„ä¸œè¥¿ï¼Œå…¶å®žæ˜¯ä½äºŽå¯è§åŒºåŸŸçš„å·¦ä¸Šè§’å³ä¾§è·ç¦»ä¸º 10 çš„åœ°æ–¹ã€‚</p><p>ä»¥ä¸Šè¯´çš„å¯è§åŒºåŸŸï¼Œå…¶å®žæ˜¯ Canvas ä¸­çš„ clip æ¦‚å¿µï¼Œè¿™æ˜¯ä¸€ä¸ªæè¿°å¯è§åŒºåŸŸçš„çŸ©å½¢ã€‚ä¸€èˆ¬ Canvas çš„åˆå§‹ clip çš„ ltrb fåˆ†åˆ«ä¸º 0, 0, view width, view height. å½“ Canvas å˜æ¢æ—¶ï¼Œå¯ç†è§£ä¸ºå…¶åæ ‡ç³»å˜æ¢äº†ï¼Œé‚£ä¹ˆè‡ªç„¶ clip ä¹Ÿä¼šè·Ÿç€å˜åŒ–ï¼Œæ¯”å¦‚ translate(10, 0) åŽï¼Œclip çš„ ltrb å°±å˜ä¸º -10, 0, view width - 10, view height.</p><p>Canvas å‡ºäºŽçµæ´»æ€§è€ƒè™‘ï¼Œæœ‰ save å’Œ restore ä¸¤ä¸ªæ–¹æ³•ç”¨äºŽä¿å­˜å’Œæ¢å¤å˜æ¢çš„çŠ¶æ€ï¼Œå¸¸ç”¨åšæ³•æ˜¯ï¼Œåœ¨æ— å˜æ¢æ—¶ save ä¸€ä¸‹ï¼Œç„¶åŽå˜æ¢å¹¶åšç»˜åˆ¶ï¼Œæœ€åŽrestoreï¼Œä»¥é¿å…å½±å“å…¶å®ƒç»˜åˆ¶å·¥ä½œã€‚å‡ºäº†translateã€rotateã€Skewã€Scale è¿™äº› 2 ç»´å˜æ¢ï¼ŒCanvas è¿˜æœ‰ä¸€ç³»åˆ— clip æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å°† Canvas è¿›ä¸€æ­¥å‰ªè£ï¼Œå¹¶æ ¹æ®å‰ªè£åŽå¯è§åŒºåŸŸæ˜¯å¦ä¸ºç©ºè¿”å›žå¸ƒå°”å€¼ã€‚å‰ªè£æ“ä½œä¹Ÿæ˜¯å¯ä»¥ save å’Œ restore çš„ï¼Œä½†æ˜¯æ³¨æ„å‰ªè£æ“ä½œå¹¶ä¸å˜æ¢åæ ‡ç³»ã€‚</p><p>Camera å¯¹è±¡ä¸“é—¨ç”¨äºŽè®¡ç®—å˜æ¢ï¼Œä¸”åŒ…å« 3 ç»´ç©ºé—´ä¸­çš„å˜æ¢(ç›¸å Matrix å¯¹è±¡å…¶å®žåªæ˜¯ xy å¹³é¢å†…çš„å˜æ¢)ï¼Œå®ƒçš„å˜æ¢è®¡ç®—ç»“æžœæ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œå¯é€šè¿‡ getMatrix æ–¹æ³•å¾—åˆ°ï¼Œä¸€èˆ¬ä¼šå°†æ­¤çŸ©é˜µç”¨ä½œå®ƒç”¨ï¼Œå¯ä»¥å°† Camera ç†è§£ä¸ºä¸€ä¸ªå˜æ¢è®¡ç®—å™¨ã€‚å‡ºäºŽçµæ´»æ€§çš„è€ƒè™‘ï¼ŒCamera å¯¹è±¡ä¸­æœ‰ save å’Œ restore æ“ä½œï¼Œè¿™å°±åƒæ˜¯ git ä¸­çš„ stash å’Œ pop stash æ“ä½œä¸€æ ·ï¼Œå¯ä»¥æŠŠå½“å‰çš„å˜æ¢ä¿å­˜ï¼Œå¹¶åœ¨åŽé¢æŸä¸ªæ—¶å€™æ¢å¤å‡ºæ¥ï¼Œæ¢å¤ä¹‹å‰çš„å€¼å°†ä¼šä¸¢å¤±ã€‚ä¸åŒçš„æ˜¯ï¼Œgit stash åŽ working tree å°†æ˜¯ clean çš„ï¼Œå³å·²ä¿®æ”¹çš„å†…å®¹éƒ½æ¸…ç©ºäº†ï¼Œè€Œ Camera å¯¹è±¡ save åŽï¼Œå®ƒçš„çŸ©é˜µè¿˜æ˜¯ save ä¹‹å‰çš„ï¼Œå¹¶ä¸ä¼šå˜æˆå•ä½çŸ©é˜µã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCamera çš„åæ ‡ç³»ï¼Œ+x æ˜¯å‘å³çš„ï¼Œ+y æ˜¯å‘ä¸Šçš„ï¼Œè€Œ +z æ˜¯å‘å±å¹•é‡Œé¢çš„ã€‚æ‰€ä»¥æ¯”å¦‚ Camera çš„ rotateZ(int degrees) æ–¹æ³•å’Œ Matrix çš„ [pre|post]Rotate(int degree) çš„æ—‹è½¬æ–¹å‘æ˜¯åè¿‡æ¥çš„ã€‚å‰è€…ç­‰ä»·äºŽé€†æ—¶é’ˆæ–¹å‘è½¬ï¼ŒåŽè€…åˆ™æ˜¯é¡ºæ—¶é’ˆæ–¹å‘è½¬ã€‚ä¸‹é¢çš„ä¾‹å­å¯ä»¥è¯´æ˜Žè¿™ä¸€ç‚¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Matrix mat1 = <span class="keyword">new</span> Matrix();</span><br><span class="line">Camera camera = <span class="keyword">new</span> Camera();</span><br><span class="line"></span><br><span class="line">camera.rotateZ(-<span class="number">90</span>);</span><br><span class="line">camera.getMatrix(mat1);</span><br><span class="line"></span><br><span class="line">Matrix mat2 = <span class="keyword">new</span> Matrix();</span><br><span class="line">mat2.preRotate(<span class="number">90</span>);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç æ‰§è¡ŒåŽ mat1 å’Œ mat2 éƒ½æ˜¯ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}0 & -1 & 0 \\1 & 0 & 0 \\0 & 0 & 1\end{bmatrix}</script><p>å¯¹äºŽ Camera å¯¹è±¡ï¼Œ è°ƒç”¨å®ƒçš„ translate ç­‰æ–¹æ³•ï¼Œä¼šä½¿å¾—å®ƒçš„ matrix å˜ä¸º Camera çš„åæ ‡ç³»ä¸­å¯¹åº”æ­¤å˜æ¢çš„å€¼ï¼Œè€Œè¿™æ ·çš„çŸ©é˜µï¼Œåœ¨åº”ç”¨åœ¨ Canvas ä¸Šè¿›è¡Œç»˜åˆ¶æ—¶ï¼Œåˆæ˜¯ä½œç”¨åœ¨ +y å‘ä¸‹çš„åæ ‡ç³»ä¸­ã€‚æ‰€ä»¥æ¯”å¦‚ Camera translate(10, -20, 0) åŽå¾—åˆ°çš„çŸ©é˜µæ˜¯ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}1 & 0 & 10 \\0 & 1 & 20 \\0 & 0 & 1\end{bmatrix}</script><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ Camera åœ¨ z æ–¹å‘è¿›è¡Œ translate æ“ä½œæ—¶ï¼Œå˜æ¢å¯¹è±¡åœ¨å±å¹•ä¸Šçš„æŠ•å½±å¤§å°å‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥ï¼Œå®žé™…å˜æ¢æ•ˆæžœæ˜¯ä¸€ä¸ªç¼©æ”¾å˜æ¢ï¼Œæ‰€ä»¥ Camera getMatrix çš„ç»“æžœï¼Œä¹Ÿæ˜¯ä¸€ä¸ªäºŒç»´ç¼©æ”¾å˜æ¢çš„çŸ©é˜µã€‚Camera çš„ location ä¹Ÿå°±æ˜¯ 3D æŠ•å½±ä¸­çš„ camera ä½ç½®ï¼ˆè§‚å¯Ÿè€…ä½ç½®ï¼‰ï¼Œæ­¤ä½ç½®é»˜è®¤æ˜¯ (0, 0, -8)ï¼Œæ³¨æ„è¿™ä¸ª -8 å®žé™…ç›¸å½“äºŽ -576 ä¸ªåƒç´ ã€‚å½“ z æ–¹å‘ translate è·ç¦»ä¸ºæ­£æ—¶ï¼Œç›¸å½“äºŽè¿œç¦»è§‚å¯Ÿè€…ï¼Œæœ€ç»ˆå°±æ˜¯ç¼©å°çš„å˜æ¢ï¼Œåæ­£æ˜¯æ”¾å¤§çš„å˜æ¢ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è®©æˆ‘ä»¬å…ˆä»Žä½äºŽ android.graphics åŒ…ä¸­çš„ Bitmap ç±»çš„ä¸€ä¸ªæ–¹æ³•å¼€å§‹è¯´èµ·ï¼Œä¹Ÿå°±æ˜¯ createBitmap(Bitmap source, int x, int y, int width, int height, Matrix m, boolean fil
      
    
    </summary>
    
    
      <category term="Android" scheme="https://tao93.top/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>å¾®ä¿¡ Android ç‰ˆæ˜¯å¦‚ä½•è®¡æ­¥çš„</title>
    <link href="https://tao93.top/2018/11/23/%E5%BE%AE%E4%BF%A1%20Android%20%E7%89%88%E6%98%AF%E5%A6%82%E4%BD%95%E8%AE%A1%E6%AD%A5%E7%9A%84/"/>
    <id>https://tao93.top/2018/11/23/å¾®ä¿¡ Android ç‰ˆæ˜¯å¦‚ä½•è®¡æ­¥çš„/</id>
    <published>2018-11-24T04:54:22.998Z</published>
    <updated>2019-07-05T14:04:04.030Z</updated>
    
    <content type="html"><![CDATA[<p>å¾ˆæ—©ä»¥å‰ï¼Œæˆ‘ä½¿ç”¨ä¸€éƒ¨ iPhone 5S æ‰‹æœºï¼Œè¿™æ˜¯ç¬¬ä¸€æ¬¾å¸¦æœ‰è®¡æ­¥åŠŸèƒ½çš„ iPhone æœºåž‹ï¼Œè‹¹æžœç§°ä¹‹ä¸ºæ­è½½è¿åŠ¨åå¤„ç†å™¨ã€‚å¦‚æžœæˆ‘æ²¡è®°é”™ï¼ŒiOS çš„è¿åŠ¨æ•°æ®ï¼Œæ—¢å¯ä»¥è¢«ç¬¬ä¸‰æ–¹ app è¯»å–ï¼Œä¹Ÿå¯ä»¥è¢«å†™å…¥ã€‚è¯»å–å¥½è¯´ï¼Œå†™å…¥æ˜¯å› ä¸ºç”¨æˆ·å¯èƒ½ä½¿ç”¨æ‰‹çŽ¯ä¹‹ç±»çš„ä¸œè¥¿æ¥è®°å½•æ•°æ®ï¼Œé‚£ä¹ˆè¿™äº›æ•°æ®å¯èƒ½æ¯” iOS ç³»ç»Ÿä¸­çš„æ•°æ®æ›´å—ç”¨æˆ·é‡è§†ï¼Œæ‰€ä»¥å°±å¯ä»¥æŠŠ iOS ç³»ç»Ÿä¸­çš„æ•°æ®æ›¿æ¢ä¸ºæ‰‹çŽ¯äº§ç”Ÿçš„æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦å…è®¸å†™å…¥ã€‚ä¸è¿‡ç›®å‰è€Œè¨€ï¼ŒAndroid ç³»ç»Ÿä¸­ï¼Œç¬¬ä¸‰æ–¹åº”ç”¨ä¼¼ä¹Žæ— æ³•å†™å…¥ç³»ç»Ÿçš„è¿åŠ¨æ•°æ®ï¼Œè€Œåªèƒ½è¯»å–ã€‚</p><p>å›žåˆ°æ­£é¢˜ï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œå¾®ä¿¡æœ‰ä¸ªå¾®ä¿¡è¿åŠ¨åŠŸèƒ½ã€‚Android ç‰ˆå¾®ä¿¡æ˜¯æ€Žä¹ˆè®¡æ­¥çš„å‘¢ï¼Ÿæˆ‘æœ€å…ˆæ˜¯åœ¨å¾®ä¿¡çš„æƒé™é¡µå‘çŽ°å¾®ä¿¡å£°æ˜Žäº† Body Sensors æƒé™ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="http://tao93.top/images/2018/11/23/1542956043.png" alt=""></p><p>è¿™ä¸ªæƒé™å¾ˆæœ‰è¿·æƒ‘æ€§ï¼Œè®©äººä»¥ä¸ºæœ‰è¿™ä¸ªå°±å¯ä»¥è¯» Android ç³»ç»Ÿäº§ç”Ÿçš„è®¡æ­¥æ•°æ®äº†ã€‚äº‹å®žä¸Šï¼ŒæŠŠè¿™ä¸ªæƒé™å…³äº†ï¼Œç„¶åŽæ™ƒåŠ¨æ‰‹æœº 20 æ¬¡ï¼Œå†è¿›å…¥å¾®ä¿¡è¿åŠ¨ï¼Œæ­¥æ•°å¾ˆå‡†ç¡®çš„å¢žåŠ äº† 20 æ¬¡å·¦å³ï¼Œæ‰€ä»¥è¿™ä¸ªæƒé™å¹¶ä¸å½±å“è¯»å–è®¡æ­¥æ•°æ®ã€‚</p><p>é‚£è¿™ä¸ªæƒé™å¯ä»¥å¹²å˜›å‘¢ï¼ŸBody Sensors æƒé™è¢«åˆ—ä¸º dangerous permissionï¼Œæ‰€å±žçš„ permission group ä»…æœ‰è¿™ä¸€ä¸ªæƒé™ã€‚ä¸è¿‡å¾ˆé—æ†¾ï¼Œæˆ‘åœ¨ç½‘ä¸ŠæŸ¥äº†æŒºä¹…ï¼Œæ²¡æœ‰æŸ¥åˆ°èŽ·å¾—è¿™ä¸ªæƒé™åŽå¯ä»¥ç”¨æ¥å†™ä»€ä¹ˆä»£ç åšä»€ä¹ˆäº‹æƒ…ã€‚å€˜è‹¥æƒ³è¦äº†è§£æ­¤æƒé™çš„æ ¹åº•ï¼Œä¼°è®¡éœ€è¦åœ¨ AOSP ä¸­æ‰¾ç­”æ¡ˆäº†ã€‚å¯æƒœæˆ‘ç”µè„‘ä¸Šæ¬¡å‡çº§å¤±è´¥åŽï¼Œç›®å‰æˆ‘ç”µè„‘ä¸­æ²¡æœ‰å®Œæ•´çš„ AOSPã€‚</p><p>å°±ç›®å‰æˆ‘åœ¨ç½‘ä¸Šäº†è§£åˆ°çš„ä¿¡æ¯è€Œè¨€ï¼Œæ­¤æƒé™ä¼¼ä¹Žæ²¡ä»€ä¹ˆç”¨ï¼Œå¾ˆå¤šå¸–å­éƒ½åœ¨è¯¢é—® Google Play Services ä¸ºä½•è¦ä½¿ç”¨æ­¤æƒé™ä»¥åŠæ˜¯å¦å¯ä»¥å…³é—­è¯¥æƒé™ã€‚æˆ‘æ‰‹ä¸­çš„ Pixel XL ä¹Ÿä»…æœ‰ Google Play Services å’Œå¾®ä¿¡å£°æ˜Žäº†æ­¤æƒé™ï¼š</p><p><img src="http://tao93.top/images/2018/11/24/1543033517.png" alt=""></p><p>æ ¹æ®ç½‘ä¸Šçš„å¸–å­ï¼Œåœ¨ Android 7 æ—¶ä»£çš„æŸä¸ªæ—¶å€™ï¼ŒGmail æœ‰ä¸ª bugï¼Œå³å…³é—­ Google Play Services çš„ Body Sensors æƒé™åŽï¼ŒGmail ç–¯ç‹‚å¼¹æ¡†æ˜¾ç¤ºã€ŒThis app wonâ€™t work properly unless you allow Google Play Servicesâ€™ request to access the foloowing: <strong>Body Sensors</strong>ã€ï¼Œå°½ç®¡ Gmail ä»èƒ½æ­£å¸¸å·¥ä½œã€‚å› ä¸ºæ­¤å¼¹æ¡†å¤ªè¿‡æ€ªå¼‚ï¼ŒéšåŽè°·æ­Œä¿®å¤äº†æ­¤é—®é¢˜ï¼Œè¿™è¯´æ˜Žå³ä½¿æ˜¯ Google è‡ªå·±çš„åº”ç”¨ï¼Œä¹Ÿæ²¡æœ‰ä¸¥æ ¼å®¡æŸ¥è‡ªå·±æ˜¯å¦å£°æ˜Žäº†ä¸å¿…è¦çš„æƒé™ã€‚</p><p>å½“ç„¶æŠŠ Google Play Services çš„ Body Sensors æƒé™å…³é—­åŽï¼Œæ‰“å¼€ Google Fit åº”ç”¨æ—¶ï¼Œå¼¹å‡ºå’Œä¸Šé¢ç±»ä¼¼çš„æ¶ˆæ¯ï¼Œå¹¶ä¸” Google Fit ä¸å†æ˜¾ç¤ºæˆ‘çš„æ­¥æ•°ï¼Œä¹ä¸€çœ‹ï¼Œè¿™ä¼¼ä¹Žè¯´å¾—é€šã€‚ä½†æ˜¯ï¼Œæ­¤æ—¶å¾®ä¿¡ä»ç„¶å¯ä»¥æ­£å¸¸è®¡æ­¥ã€‚è¿™è¯´æ˜Žä½†å°±è®¡æ­¥è¿™ä¸€åŠŸèƒ½çœ‹ï¼ŒBody Sensors å¹¶éžå¿…è¦çš„ã€‚</p><p>äº‹å®žä¸Šæˆ‘çš„è®¡æ­¥ Demo åº”ç”¨å¦‚ä¸Šè¿°å¾®ä¿¡ä¸€æ ·ï¼Œä¹Ÿè¿˜å¯ä»¥è®¡æ­¥ã€‚è®¡æ­¥ Demo ä¸­çš„ä»£ç éžå¸¸ç®€å•ï¼ŒGoogle è‡ªå·±ä¹Ÿæœ‰ä¸ªå±•ç¤ºæ­¤åŠŸèƒ½çš„ç®€å•é¡¹ç›® <a href="https://github.com/googlesamples/android-BatchStepSensor" target="_blank" rel="noopener">android-BatchStepSensor</a>ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒGoogle çš„ç®€å•é¡¹ç›®ä¸­ manifest å£°æ˜Žäº†ä¸¤é¡¹ use-featureï¼Œä½†å…¶å®žè¿™ä¹Ÿä¸æ˜¯å¿…è¦çš„ã€‚ç¬¬ä¸‰æ–¹åº”ç”¨æ— éœ€å£°æ˜Žä»»ä½•æƒé™ï¼Œæ— éœ€å£°æ˜Žä»»ä½• use-featureï¼Œåªéœ€æ³¨å†Œä¸€ä¸ª android.hardware.SensorEventListener æŽ¥å£ï¼Œå³å¯åœ¨æ­¤æŽ¥å£çš„ onSensorChanged æ–¹æ³•ä¸­æºæºä¸æ–­çš„æ”¶åˆ°æ­¥æ•°æ›´æ–°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSensorChanged</span><span class="params">(SensorEvent event)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (event.sensor.getType()) &#123;</span><br><span class="line">        <span class="keyword">case</span> Sensor.TYPE_STEP_DETECTOR:</span><br><span class="line">            stepDetector ++;</span><br><span class="line">            tvDetector.setText(stepDetector + <span class="string">""</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> Sensor.TYPE_STEP_COUNTER:</span><br><span class="line">            <span class="comment">// event.values[0] is step count since last reboot of Android device</span></span><br><span class="line">            stepCounter = (<span class="keyword">int</span>) event.values[<span class="number">0</span>];</span><br><span class="line">            tvCounter.setText(stepCounter + <span class="string">""</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ç¬¬ä¸‰æ–¹åº”ç”¨å°±å¯ä»¥è®¡æ­¥äº†ï¼Œå³ä½¿ç¬¬ä¸‰æ–¹åº”ç”¨è¿›ç¨‹ç»ˆæ­¢ï¼Œä¹Ÿå¯ä»¥åœ¨åº”ç”¨å†æ¬¡è¿è¡Œæ—¶ï¼Œåœ¨ onSensorChanged æ–¹æ³•ä¸­å¾—çŸ¥æ–°çš„æ­¥æ•°ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç³»ç»Ÿè¿”å›žçš„æ­¥æ•°å§‹ç»ˆæ˜¯ä¸Šæ¬¡é‡å¯è®¾å¤‡åŽçš„æ€»æ­¥æ•°ã€‚é‚£ä¹ˆç¬¬ä¸‰æ–¹åº”ç”¨ä½¿ç”¨è¿™ç§æ–¹å¼è®¡æ­¥æ—¶ï¼Œä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå³åº”ç”¨è¿›ç¨‹è¢«æ€åŽï¼Œå¦‚æžœç”¨æˆ·å…ˆè¿åŠ¨ï¼Œç„¶åŽé‡å¯è®¾å¤‡ï¼Œç„¶åŽæ‰æ‰“å¼€ç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œé‚£ä¹ˆç¬¬ä¸‰æ–¹åº”ç”¨ä¼šä¸¢å¤±ä»Žåº”ç”¨è¢«æ€åˆ°è®¾å¤‡é‡å¯ä¹‹é—´çš„æ­¥æ•°ï¼Œè€ŒåªçŸ¥é“è®¾å¤‡é‡å¯åŽæ–°å¢žäº†å¤šå°‘æ­¥æ•°ã€‚</p><p>ç»è¿‡éªŒè¯ï¼Œæˆ‘çš„ demoã€å¾®ä¿¡è¿˜æœ‰ Google Fit å‡å­˜åœ¨æ­¤é—®é¢˜ã€‚è¿™è¯´æ˜Žå¾®ä¿¡å’Œ Google Fit (æˆ–è€…å®ƒä¾èµ–çš„ Google Play Services) éƒ½æ˜¯é€šè¿‡æ³¨å†Œ SensorEventListener æŽ¥å£æ¥èŽ·çŸ¥æ­¥æ•°çš„ã€‚è¿™ä¹Ÿè¯´æ˜Žäº†å¾®ä¿¡å£°æ˜Ž Body Sensors æƒé™æ˜¯å†—ä½™çš„ã€‚</p><p>é‚£ä¹ˆ Body Sensors æƒé™åˆ°åº•å¯ä»¥ç”¨æ¥åšä»€ä¹ˆï¼Ÿè¿™æ˜¯ä¸€ä¸ªå¾…å¡«çš„å‘ã€‚</p><p>å¯¹äº†ï¼Œç½‘ä¸Šè¿˜æœ‰ç§æ–¹å¼ï¼Œé€šè¿‡ç›‘å¬æ‰‹æœºåŠ é€Ÿåº¦æ„Ÿåº”å™¨çš„äº‹ä»¶æ¥è‡ªå·±è®¡æ­¥ï¼Œè‡³äºŽå‡†ç¡®æ€§ï¼Œé‚£å°±å—è‡ªå·±çš„ç®—æ³•çš„ç§‘å­¦æ€§å’Œå¤æ‚æ€§çš„é™åˆ¶äº†ã€‚æ–¹æ³•ä¹Ÿæ˜¯æ³¨å†Œ SensorEventListenerï¼Œä¸è¿‡æ³¨å†Œçš„ type æ˜¯ android.hardware.Sensor.TYPE_ACCELEROMETER è€Œéžå‰é¢çš„ TYPE_STEP_COUNTERã€‚æ›´å¤šç»†èŠ‚è§<a href="http://www.gadgetsaint.com/android/create-pedometer-step-counter-android/#.W_jYq5MzYkp" target="_blank" rel="noopener">æ­¤å¸–å­</a>ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¾ˆæ—©ä»¥å‰ï¼Œæˆ‘ä½¿ç”¨ä¸€éƒ¨ iPhone 5S æ‰‹æœºï¼Œè¿™æ˜¯ç¬¬ä¸€æ¬¾å¸¦æœ‰è®¡æ­¥åŠŸèƒ½çš„ iPhone æœºåž‹ï¼Œè‹¹æžœç§°ä¹‹ä¸ºæ­è½½è¿åŠ¨åå¤„ç†å™¨ã€‚å¦‚æžœæˆ‘æ²¡è®°é”™ï¼ŒiOS çš„è¿åŠ¨æ•°æ®ï¼Œæ—¢å¯ä»¥è¢«ç¬¬ä¸‰æ–¹ app è¯»å–ï¼Œä¹Ÿå¯ä»¥è¢«å†™å…¥ã€‚è¯»å–å¥½è¯´ï¼Œå†™å…¥æ˜¯å› ä¸ºç”¨æˆ·å¯èƒ½ä½¿ç”¨æ‰‹çŽ¯ä¹‹ç±»çš„ä¸œè¥¿æ¥è®°å½•æ•°æ®ï¼Œé‚£ä¹ˆè¿™äº›æ•°æ®å¯èƒ½
      
    
    </summary>
    
    
      <category term="Android" scheme="https://tao93.top/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>ä¸ä¸€æ ·çš„ RelativeLayout measure è¿‡ç¨‹</title>
    <link href="https://tao93.top/2018/11/01/%E4%B8%8D%E4%B8%80%E6%A0%B7%E7%9A%84%20RelativeLayout%20measure%20%E8%BF%87%E7%A8%8B/"/>
    <id>https://tao93.top/2018/11/01/ä¸ä¸€æ ·çš„ RelativeLayout measure è¿‡ç¨‹/</id>
    <published>2018-11-02T02:59:59.975Z</published>
    <updated>2019-07-05T14:03:32.140Z</updated>
    
    <content type="html"><![CDATA[<p>ç›´æŽ¥ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­å±•ç¤º RelativeLayout çš„ä¸ä¸€æ ·ä¹‹å¤„ï¼š</p><p><img src="http://tao93.top/images/2018/11/01/1541079447.png" alt=""></p><p>å›¾ä¸­ï¼Œå·¦è¾¹æ˜¯ä¸€ä¸ªç®€å•çš„ Android layout ä¾‹å­ï¼Œä¾‹å­ä¸­åœ¨å¤–ä¾§æ˜¯ä¸€ä¸ªæœ€å¤§çš„ horizontal çš„ LinearLayoutï¼Œå®ƒæœ‰ 3 ä¸ª childï¼Œåˆ†åˆ«æ˜¯å·¦éƒ¨ã€åˆ†å‰²çº¿å’Œå³éƒ¨ã€‚å·¦éƒ¨å’Œå³éƒ¨éžå¸¸ç›¸ä¼¼ï¼Œéƒ½æ˜¯å¤–é¢ä¸€ä¸ª ViewGroup å†…åµŒä¸€ä¸ª TextViewï¼Œä¸” ViewGroup çš„é«˜åº¦éƒ½æ˜¯ wrapContent è€Œå†…åµŒçš„ TextView çš„é«˜åº¦éƒ½æ˜¯ matchParent.</p><p>å› ä¸º TextView èƒŒæ™¯éƒ½æ˜¯çº¢è‰²ï¼Œæ‰€ä»¥ä»Ž preview å¯ä»¥æ¸…æ™°çœ‹åˆ°ï¼Œå·¦éƒ¨çš„ TextView ç­‰æ•ˆäºŽ wrapContentï¼Œè€Œå³éƒ¨çš„ TextView åˆ™ç­‰æ•ˆäºŽ matchParentï¼Œè¿™å°±æ˜¯ RelativeLayout çš„ä¸ä¸€æ ·ã€‚ç®€è€Œè¨€ä¹‹å°±æ˜¯ï¼ŒRelativeLayout ä¸­å†…åµŒçš„ child tree çš„æ ¹èŠ‚ç‚¹ size å¦‚æžœæ˜¯ matchParentï¼Œé‚£ä¹ˆæ­¤ child tree æµ‹é‡å¾—åˆ°çš„ size å°†ä¼šæ˜¯æœ€å¤§åŒ–çš„ï¼Œå¯è¾¾åˆ° RelativeLayout size çš„ä¸Šé™ï¼Œè€Œå…¶ä½™å¸¸è§ ViewGroup æ²¡æœ‰æ­¤ç‰¹ç‚¹ï¼Œæ¯”å¦‚ LinearLayout, FrameLayout, ConstraintLayout ç­‰ã€‚</p><p>ç©¶å…¶åŽŸå› ï¼Œå¯ä»¥ä»Ž RelativeLayout ä¸­çš„ onMeasure æ–¹æ³•æ‰¾ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">        <span class="keyword">final</span> View child = views[i];</span><br><span class="line">        <span class="keyword">if</span> (child.getVisibility() != GONE) &#123;</span><br><span class="line">            <span class="keyword">final</span> LayoutParams params = (LayoutParams) child.getLayoutParams();</span><br><span class="line"></span><br><span class="line">            applyVerticalSizeRules(params, myHeight, child.getBaseline());</span><br><span class="line">            measureChild(child, params, myWidth, myHeight);</span><br><span class="line">            ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯ RelativeLayout#onMeasure çš„ç‰‡æ®µï¼Œå¯çŸ¥å¯¹æ‰€æœ‰ child è°ƒç”¨äº† measureChild æ–¹æ³•ï¼Œè€Œè¿™æ˜¯ä¸ª RelativeLayout çš„ private æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Measure a child. The child should have left, top, right and bottom information</span></span><br><span class="line"><span class="comment"> * stored in its LayoutParams. If any of these values is VALUE_NOT_SET it means</span></span><br><span class="line"><span class="comment"> * that the view can extend up to the corresponding edge.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> child Child to measure</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params LayoutParams associated with child</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> myWidth Width of the the RelativeLayout</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> myHeight Height of the RelativeLayout</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">measureChild</span><span class="params">(View child, LayoutParams params, <span class="keyword">int</span> myWidth, <span class="keyword">int</span> myHeight)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> childWidthMeasureSpec = getChildMeasureSpec(params.mLeft,</span><br><span class="line">            params.mRight, params.width,</span><br><span class="line">            params.leftMargin, params.rightMargin,</span><br><span class="line">            mPaddingLeft, mPaddingRight,</span><br><span class="line">            myWidth);</span><br><span class="line">    <span class="keyword">int</span> childHeightMeasureSpec = getChildMeasureSpec(params.mTop,</span><br><span class="line">            params.mBottom, params.height,</span><br><span class="line">            params.topMargin, params.bottomMargin,</span><br><span class="line">            mPaddingTop, mPaddingBottom,</span><br><span class="line">            myHeight);</span><br><span class="line">    child.measure(childWidthMeasureSpec, childHeightMeasureSpec);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»Žä¸Šè¿°æ–¹æ³•çœ‹ï¼Œå…ˆèŽ·å–åˆ° child measureSpecï¼Œç„¶åŽä¾æ¬¡ä¸ºå‚æ•°æ¥ measure æ¯ä¸ª childã€‚å†è¿›å…¥åˆ° RelativeLayout#getChildMeasureSpec è¿™ä¸ªæ–¹æ³•ä¸­çœ‹çœ‹ä¸‹é¢çš„é€»è¾‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (childStart != VALUE_NOT_SET &amp;&amp; childEnd != VALUE_NOT_SET) &#123;</span><br><span class="line">    <span class="comment">// Constraints fixed both edges, so child must be an exact size.</span></span><br><span class="line">    childSpecMode = isUnspecified ? MeasureSpec.UNSPECIFIED : MeasureSpec.EXACTLY;</span><br><span class="line">    childSpecSize = Math.max(<span class="number">0</span>, maxAvailable);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (childSize &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// Child wanted an exact size. Give as much as possible.</span></span><br><span class="line">        childSpecMode = MeasureSpec.EXACTLY;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (maxAvailable &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// We have a maximum size in this dimension.</span></span><br><span class="line">            childSpecSize = Math.min(maxAvailable, childSize);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// We can grow in this dimension.</span></span><br><span class="line">            childSpecSize = childSize;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childSize == LayoutParams.MATCH_PARENT) &#123;</span><br><span class="line">        <span class="comment">// Child wanted to be as big as possible. Give all available</span></span><br><span class="line">        <span class="comment">// space.</span></span><br><span class="line">        childSpecMode = isUnspecified ? MeasureSpec.UNSPECIFIED : MeasureSpec.EXACTLY;</span><br><span class="line">        childSpecSize = Math.max(<span class="number">0</span>, maxAvailable);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childSize == LayoutParams.WRAP_CONTENT) &#123;</span><br><span class="line">        <span class="comment">// Child wants to wrap content. Use AT_MOST to communicate</span></span><br><span class="line">        <span class="comment">// available space if we know our max size.</span></span><br><span class="line">        <span class="keyword">if</span> (maxAvailable &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// We have a maximum size in this dimension.</span></span><br><span class="line">            childSpecMode = MeasureSpec.AT_MOST;</span><br><span class="line">            childSpecSize = maxAvailable;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// We can grow in this dimension. Child can be as big as it</span></span><br><span class="line">            <span class="comment">// wants.</span></span><br><span class="line">            childSpecMode = MeasureSpec.UNSPECIFIED;</span><br><span class="line">            childSpecSize = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»Žä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼ŒchileSpecMode èµ‹å€¼ä¸º MeasureSpec.AT_MOST çš„åœ°æ–¹åªæœ‰ 27 è¡Œä¸€ä¸ªåœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯åªè¦ child å£°æ˜Žä¸º match_parentï¼Œé‚£ä¹ˆ child çš„ specMode ä¸å‡ºæ„å¤–å°±ä¼šæ˜¯ EXACTLYã€‚è€Œ EXACTLY æ„å‘³ç€æ­¤ child ä¸ºæ ¹èŠ‚ç‚¹çš„ view tree çš„æµ‹é‡ç»“æžœå°†ä¼šæ˜¯æ­¤ child çš„ specSizeï¼Œè€Œè¿™ä¸ª specSize æ˜¾ç„¶å°±æ˜¯ RelativeLayout èƒ½è¾¾åˆ°çš„æœ€å¤§ size (å¯èƒ½éœ€è¦å‡åŽ» paddingï¼ŒRelativeLayout å…¶å®ƒ child å æ®çš„ç©ºé—´ç­‰)ã€‚</p><p>é¡ºä¾¿å†çœ‹çœ‹ LinearLayout ç­‰ç­‰ä¸ºå•¥ä¸æ˜¯è¿™æ ·çš„ï¼Œäº‹å®žä¸Š LinearLayout ç­‰ä½¿ç”¨çš„æ˜¯ ViewGroup è¿™ä¸ªæŠ½è±¡åŸºç±»ä¸­çš„ getChildMeasureSpec æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getChildMeasureSpec</span><span class="params">(<span class="keyword">int</span> spec, <span class="keyword">int</span> padding, <span class="keyword">int</span> childDimension)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> specMode = MeasureSpec.getMode(spec);</span><br><span class="line">    <span class="keyword">int</span> specSize = MeasureSpec.getSize(spec);</span><br><span class="line">    <span class="keyword">int</span> size = Math.max(<span class="number">0</span>, specSize - padding);</span><br><span class="line">    <span class="keyword">int</span> resultSize = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> resultMode = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">switch</span> (specMode) &#123;</span><br><span class="line">    <span class="comment">// Parent has imposed an exact size on us</span></span><br><span class="line">    <span class="keyword">case</span> MeasureSpec.EXACTLY:</span><br><span class="line">        <span class="keyword">if</span> (childDimension &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            resultSize = childDimension;</span><br><span class="line">            resultMode = MeasureSpec.EXACTLY;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == LayoutParams.MATCH_PARENT) &#123;</span><br><span class="line">            <span class="comment">// Child wants to be our size. So be it.</span></span><br><span class="line">            resultSize = size;</span><br><span class="line">            resultMode = MeasureSpec.EXACTLY;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == LayoutParams.WRAP_CONTENT) &#123;</span><br><span class="line">            <span class="comment">// Child wants to determine its own size. It can't be</span></span><br><span class="line">            <span class="comment">// bigger than us.</span></span><br><span class="line">            resultSize = size;</span><br><span class="line">            resultMode = MeasureSpec.AT_MOST;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Parent has imposed a maximum size on us</span></span><br><span class="line">    <span class="keyword">case</span> MeasureSpec.AT_MOST:</span><br><span class="line">        <span class="keyword">if</span> (childDimension &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// Child wants a specific size... so be it</span></span><br><span class="line">            resultSize = childDimension;</span><br><span class="line">            resultMode = MeasureSpec.EXACTLY;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == LayoutParams.MATCH_PARENT) &#123;</span><br><span class="line">            <span class="comment">// Child wants to be our size, but our size is not fixed.</span></span><br><span class="line">            <span class="comment">// Constrain child to not be bigger than us.</span></span><br><span class="line">            resultSize = size;</span><br><span class="line">            resultMode = MeasureSpec.AT_MOST;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == LayoutParams.WRAP_CONTENT) &#123;</span><br><span class="line">            <span class="comment">// Child wants to determine its own size. It can't be</span></span><br><span class="line">            <span class="comment">// bigger than us.</span></span><br><span class="line">            resultSize = size;</span><br><span class="line">            resultMode = MeasureSpec.AT_MOST;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">//noinspection ResourceType</span></span><br><span class="line">    <span class="keyword">return</span> MeasureSpec.makeMeasureSpec(resultSize, resultMode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»Žä¸Šè¿°ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æžœ child å£°æ˜Žä¸º matchParent ä½†æ˜¯ RelativeLayout çš„ specMode æ˜¯ AT_MOST çš„è¯ï¼Œé‚£ä¹ˆ child çš„ specMode å¦‚ç¬¬ 35 è¡Œæ‰€ç¤ºå°†ä¼šæ˜¯ AT_MOSTï¼Œè¿™å°±æ˜¯å’Œ RelativeLayout çš„ä¸åŒä¹‹å¤„ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œå³ä½¿ RelativeLayout çš„ specMode æ˜¯ AT_MOSTï¼Œåªè¦å®ƒçš„ child å£°æ˜Ž matchParentï¼Œé‚£ä¹ˆ child çš„ SpecMode ä¸€èˆ¬ä¼šæ˜¯ EXACTLYï¼Œæ­¤ child ä¸ºæ ¹èŠ‚ç‚¹çš„ viewTree çš„æµ‹é‡ç»“æžœå°±æ˜¯æœ€å¤§åŒ–çš„ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç›´æŽ¥ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­å±•ç¤º RelativeLayout çš„ä¸ä¸€æ ·ä¹‹å¤„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://tao93.top/images/2018/11/01/1541079447.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;å›¾ä¸­ï¼Œå·¦è¾¹æ˜¯ä¸€ä¸ªç®€å•çš„ Androi
      
    
    </summary>
    
    
      <category term="Android" scheme="https://tao93.top/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€é”®è®¾ç½® Android http proxy çš„å°è¯•</title>
    <link href="https://tao93.top/2018/10/31/%E4%B8%80%E9%94%AE%E8%AE%BE%E7%BD%AE%20Android%20http%20proxy%20%E7%9A%84%E5%B0%9D%E8%AF%95/"/>
    <id>https://tao93.top/2018/10/31/ä¸€é”®è®¾ç½® Android http proxy çš„å°è¯•/</id>
    <published>2018-11-01T03:04:32.507Z</published>
    <updated>2018-11-01T03:04:32.507Z</updated>
    
    <content type="html"><![CDATA[<p>è‡ªæ‰“æ¥åˆ°æ­å·žåŽï¼Œè°ƒè¯• Android app æ—¶ç”¨ Charles åšä»£ç†çš„åœºæ™¯æˆäº†éžå¸¸å¸¸è§çš„æ“ä½œï¼Œè€Œè®©äººçƒ¦æ¼çš„æ˜¯ï¼Œæ¯æ¬¡éƒ½éœ€è¦è¿›å…¥æ‰‹æœºçš„ WiFi -&gt; ç‚¹å‡»å½“å‰ WiFi -&gt; ç‚¹å‡»ç¼–è¾‘ -&gt; ç‚¹å‡» Advanced options -&gt; proxy é€‰æ‹© None æˆ–è€… Manual -&gt; ä¸Šä¸€æ­¥å¦‚æžœé€‰äº† Manual, åˆ™éœ€è¦è¾“å…¥ IP åœ°å€å’Œç«¯å£å· -&gt; ä¿å­˜ã€‚</p><p>è¿™æ ·ä¸€ä¸ªå…­ä¸ƒæ­¥çš„æ­¥éª¤ï¼ŒçœŸçš„å¾ˆè®©äººçƒ¦ï¼Œè€Œå¦‚æžœç”µè„‘çš„å±€åŸŸç½‘ IP åœ°å€ä¸å›ºå®šçš„è¯ï¼Œå°±æ›´åŠ è®©äººä¸çˆ½äº†ï¼Œæ„å‘³ç€æ¯æ¬¡ç”µè„‘é‡æ–°è”ç½‘åŽï¼Œæ‰‹æœºéƒ½éœ€è¦é‡æ–°è®¾ç½®ä»£ç†çš„ IPã€‚å°±ç®—ç”µè„‘ IP å›ºå®šï¼Œå½“æ‰‹æœºéœ€è¦ä½¿ç”¨ Charles ä»£ç†æˆ–è€…å…³é—­ä»£ç†ï¼Œéƒ½æ¯”è¾ƒéº»çƒ¦ã€‚æ‰€ä»¥å¾ˆä¹…å‰æˆ‘å°±æƒ³æœ‰æ²¡æœ‰æ–¹æ³•å¯ä»¥ä¸€é”®è®¾ç½®ä»£ç†ã€‚</p><p>æˆ‘çš„æž„æƒ³æ˜¯ï¼Œå¦‚æžœç”µè„‘ IP åœ°å€ä¸å›ºå®šï¼Œé‚£ä¹ˆä¸€é”®è®¾ç½®éœ€è¦åœ¨ç”µè„‘ä¸Šæ“ä½œï¼Œä¸ç„¶æ— æ³•èŽ·çŸ¥ç”µè„‘çš„ IPï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”µè„‘è¿è¡Œä¸ª socket serverï¼Œç„¶åŽæ‰‹æœºè¿žæŽ¥ï¼Œç„¶åŽç”µè„‘æŠŠ IP å‘ç»™æ‰‹æœºã€‚å¦‚æžœç”µè„‘ IP åœ°å€å›ºå®šï¼Œæœ€ç†æƒ³çš„åˆ™æ˜¯æ‰‹æœºä¸Šä¸€é”®è®¾ç½®ï¼Œè¿™æ ·å°±ä¸éœ€è¦ adb è¿žæŽ¥äº†ã€‚</p><p>ç»è¿‡ä¸€ç•ª google å’Œæƒ¨ç—›çš„å°è¯•ï¼Œæˆ‘å¾—çŸ¥äº†ä¸¤ç§å¹¶ä¸å®Œç¾Žçš„æ–¹æ³•ã€‚</p><p>æ–¹æ³•ä¸€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®ä»£ç†ä¿¡æ¯ exclListæ˜¯æ·»åŠ ä¸ç”¨ä»£ç†çš„ç½‘å€ç”¨çš„</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setHttpProxySetting</span><span class="params">(Context context, String host, <span class="keyword">int</span> port)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ClassNotFoundException, NoSuchMethodException, InvocationTargetException,</span></span><br><span class="line"><span class="function">            IllegalAccessException, NoSuchFieldException </span>&#123;</span><br><span class="line">        WifiManager wifiManager =(WifiManager)context.getSystemService(Context.WIFI_SERVICE);</span><br><span class="line">        WifiConfiguration config = getCurrentWifiConfiguration(wifiManager);</span><br><span class="line">        ProxyInfo mInfo = ProxyInfo.buildDirectProxy(host,port);</span><br><span class="line">        <span class="keyword">if</span> (config != <span class="keyword">null</span>)&#123;</span><br><span class="line">            Class clazz = Class.forName(<span class="string">"android.net.wifi.WifiConfiguration"</span>);</span><br><span class="line">            Class parmars = Class.forName(<span class="string">"android.net.ProxyInfo"</span>);</span><br><span class="line">            Method method = clazz.getMethod(<span class="string">"setHttpProxy"</span>,parmars);</span><br><span class="line">            method.invoke(config,mInfo);</span><br><span class="line">            Object mIpConfiguration = getDeclaredFieldObject(config,<span class="string">"mIpConfiguration"</span>);</span><br><span class="line"></span><br><span class="line">            setEnumField(mIpConfiguration, <span class="string">"STATIC"</span>, <span class="string">"proxySettings"</span>);</span><br><span class="line">            setDeclardFildObject(config,<span class="string">"mIpConfiguration"</span>, mIpConfiguration);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// save the settings</span></span><br><span class="line">            wifiManager.updateNetwork(config);</span><br><span class="line">            wifiManager.disconnect();</span><br><span class="line">            wifiManager.reconnect();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å–æ¶ˆä»£ç†è®¾ç½®</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">unSetHttpProxy</span><span class="params">(Context context)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ClassNotFoundException, InvocationTargetException, IllegalAccessException,</span></span><br><span class="line"><span class="function">            NoSuchFieldException, NoSuchMethodException </span>&#123;</span><br><span class="line">        WifiManager wifiManager = (WifiManager) context.getSystemService(Context.WIFI_SERVICE);</span><br><span class="line">        WifiConfiguration configuration = getCurrentWifiConfiguration(wifiManager);</span><br><span class="line">        ProxyInfo mInfo = ProxyInfo.buildDirectProxy(<span class="keyword">null</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (configuration != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;</span><br><span class="line">                configuration.setHttpProxy(mInfo);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Class clazz = Class.forName(<span class="string">"android.net.wifi.WifiConfiguration"</span>);</span><br><span class="line">                Class parmars = Class.forName(<span class="string">"android.net.ProxyInfo"</span>);</span><br><span class="line">                Method method = clazz.getMethod(<span class="string">"setHttpProxy"</span>,parmars);</span><br><span class="line">                method.invoke(configuration,mInfo);</span><br><span class="line">                Object mIpConfiguration = getDeclaredFieldObject(configuration,<span class="string">"mIpConfiguration"</span>);</span><br><span class="line">                setEnumField(mIpConfiguration, <span class="string">"NONE"</span>, <span class="string">"proxySettings"</span>);</span><br><span class="line">                setDeclardFildObject(configuration,<span class="string">"mIpConfiguration"</span>,mIpConfiguration);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            wifiManager.updateNetwork(configuration);</span><br><span class="line">            wifiManager.disconnect(); </span><br><span class="line">            wifiManager.reconnect();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ–¹æ³•ç›´æŽ¥èŽ·å–åˆ°å½“å‰è¿žæŽ¥çš„ WiFi configurationï¼Œç„¶åŽæŠŠå®ƒçš„ http proxy ç±»åž‹ (æžšä¸¾å˜é‡ï¼Œä¸»è¦æ˜¯ NONE å’Œ STATIC ä¸¤ä¸ªå€¼)ï¼Œå’Œå€¼ (å³ IP å’Œ port) ç”¨åå°„çš„æ–¹æ³•è®¾ç½®è¿›åŽ»ï¼Œç„¶åŽæ›´æ–° WiFi configurationï¼Œå¹¶æ–­å¼€ WiFi å¹¶é‡æ–°è¿žæŽ¥ WiFiã€‚ä»¥ä¸Šè®¾ç½®ä»£ç†å’Œå…³é—­ä»£ç†çš„åŠ¨ä½œï¼Œå…¨éƒ¨ç”±ä¸Šé¢çš„ä»£ç ä¸€é”®å®Œæˆï¼Œç›´æŽ¥åœ¨æ‰‹æœºä¸Šè¿è¡Œå³å¯ï¼Œå¹¶ä¸”ä»£ç è¿è¡Œç»“æžœå’Œæ‰‹æœº Settings ä¸­çš„ UI ç»“æžœæ˜¯ä¸€è‡´çš„ï¼Œæ„Ÿè§‰ç›¸å½“å®Œç¾Žã€‚</p><p>ç„¶è€Œæ–¹æ³•ä¸€ä¸æ”¯æŒ API 23 ä»¥ä¸Šçš„ Android ç³»ç»Ÿï¼Œè€Œæ‰€ç”¨ API 21 æµ‹è¯•æ˜¯å¯ä»¥å®Œç¾Žè¿è¡Œçš„ï¼Œåœ¨å¦‚ä»Š API 28 éƒ½å‘å¸ƒäº†çš„æ—¶å€™ï¼Œä¸æ”¯æŒ API 23 ä»¥ä¸Šå¯ä»¥è¯´è®©å®žç”¨æ€§å¤§æ‰“æŠ˜æ‰£ã€‚ä¸è¿‡è¿™æ˜¯å¯ä»¥ç†è§£çš„ï¼Œæ¯•ç«Ÿå¤„äºŽå®‰å…¨è€ƒè™‘ï¼Œä¸èƒ½è®©ç”¨æˆ·çš„æ‰‹æœºéšä¾¿è¢«ç¬¬ä¸‰æ–¹ app é»˜é»˜ä¿®æ”¹äº†ä»£ç†ï¼Œè¿™å¤ªå±é™©äº†ã€‚</p><p>æ–¹æ³•äºŒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell settings put global http_proxy &lt;ip&gt;:&lt;port&gt;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä»¥ä¸Šå‘½ä»¤åŽï¼ŒSettings ä¸­çš„ UI å¹¶æœªæ›´æ”¹ï¼Œä½†æ˜¯ä»£ç†å·²ç»ç”Ÿæ•ˆã€‚è¿™ä¸€æ–¹æ³•å®žé™…æ˜¯æ–°å¢žäº† Settings Provider ä¸­çš„ key valueï¼Œæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥æŸ¥çœ‹åˆ°è¿™ä¸€æ–°å¢ž key value:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb shell settings get global http_proxy</span><br><span class="line">adb shell settings get global global_http_proxy_host</span><br><span class="line">adb shell settings get global global_http_proxy_port</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String httpProxy = android.provider.Settings.Global.getString(contentResolver, android.provider.Settings.Global.HTTP_PROXY);</span><br><span class="line">String httpProxyHost = android.provider.Settings.Global.getString(contentResolver, android.provider.Settings.Global.GLOBAL_HTTP_PROXY_HOST);</span><br><span class="line">String httpProxyPort = android.provider.Settings.Global.getString(contentResolver, android.provider.Settings.Global.GLOBAL_HTTP_PROXY_PORT);</span><br></pre></td></tr></table></figure><p>Android ä¸è¿è¡Œç¬¬ä¸‰æ–¹åº”ç”¨æ–°å¢žè¿™æ ·çš„å±žæ€§å€¼ï¼Œè€Œåªæœ‰ read çš„æƒé™ï¼Œæ‰€ä»¥éœ€è¦ adb æ¥æ–°å¢žè¿™äº›å±žæ€§å€¼ï¼Œé™¤äº†è¿™ä¸ªç¼ºç‚¹ï¼Œè¿˜æœ‰æ›´è‡´å‘½çš„ç¼ºé™·ã€‚æ–¹æ³•äºŒçš„ reset proxy çš„æ–¹æ³•æ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">adb shell settings delete global http_proxy</span><br><span class="line">adb shell settings delete global global_http_proxy_host</span><br><span class="line">adb shell settings delete global global_http_proxy_port</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¯çš„ï¼Œç›®å‰æˆ‘å·²çŸ¥çš„æ–¹æ³•ï¼Œåªæœ‰é‡å¯æ‰èƒ½è®©ä¸Šè¿° delete ç”Ÿæ•ˆï¼Œå½“ç„¶æ‰‹åŠ¨é‡å¯éƒ½å¯ä»¥ã€‚</span></span><br><span class="line">adb reboot</span><br></pre></td></tr></table></figure><p>è¦ reset proxyï¼Œåˆ é™¤ key value å’Œé‡å¯ (ç›®å‰æˆ‘åªçŸ¥é“é‡å¯å¯ä»¥) ç¼ºä¸€ä¸å¯ï¼Œå¦åˆ™è®¾å¤‡åªèƒ½é€šè¿‡ proxy ä½¿ç”¨ httpã€‚ä¹Ÿå°±æ˜¯è¿žåˆ«çš„ wifi æˆ–è€…ä½¿ç”¨æ•°æ®æµé‡éƒ½ä¸èƒ½ä½¿ç”¨ httpï¼è¦æƒ³ä¸é‡å¯ï¼Œé™¤éžåœ¨å°† key value è®¾ç½®ä¸ºå¦ä¸€ä¸ªæœ‰æ•ˆçš„ proxy é…ç½®ï¼Œè¿™ä¸ªç¼ºé™·å¯ä»¥è¯´éžå¸¸è‡´å‘½äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è‡ªæ‰“æ¥åˆ°æ­å·žåŽï¼Œè°ƒè¯• Android app æ—¶ç”¨ Charles åšä»£ç†çš„åœºæ™¯æˆäº†éžå¸¸å¸¸è§çš„æ“ä½œï¼Œè€Œè®©äººçƒ¦æ¼çš„æ˜¯ï¼Œæ¯æ¬¡éƒ½éœ€è¦è¿›å…¥æ‰‹æœºçš„ WiFi -&amp;gt; ç‚¹å‡»å½“å‰ WiFi -&amp;gt; ç‚¹å‡»ç¼–è¾‘ -&amp;gt; ç‚¹å‡» Advanced options -&amp;gt; prox
      
    
    </summary>
    
    
      <category term="Android" scheme="https://tao93.top/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>ShadowSocks for Gradle &amp; Shell</title>
    <link href="https://tao93.top/2018/10/18/%E6%B3%A8%E6%84%8F%E4%B8%8B%E9%9D%A2%E7%9A%84%E7%AB%AF%E5%8F%A3%E5%8F%B7%E4%B8%8D%E4%B8%80%E5%AE%9A%E6%98%AF%201086/"/>
    <id>https://tao93.top/2018/10/18/æ³¨æ„ä¸‹é¢çš„ç«¯å£å·ä¸ä¸€å®šæ˜¯ 1086/</id>
    <published>2018-10-18T07:11:58.403Z</published>
    <updated>2019-07-05T14:04:20.267Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://shadowsocks.org/" target="_blank" rel="noopener">ShadowSocks</a> æ˜¯ä¸ªå¾ˆå¥½çš„å·¥å…·ï¼Œå®ƒè‡ªå¸¦ PAC æ¨¡å¼å’Œå…¨å±€æ¨¡å¼ã€‚</p><p>ä¸è¿‡è¿™ä¸ªå…¨å±€æ¨¡å¼å¹¶ä¸èƒ½å®Œå…¨è®©æ•´å°ç”µè„‘çš„æ‰€æœ‰ç½‘ç»œè®¿é—®å…¨éƒ¨é€šè¿‡ä»£ç†è¿›è¡Œï¼Œæ¯”å¦‚ç»ˆç«¯å‘½ä»¤å°±ä¸å¯ä»¥ã€‚æˆ‘æ‰“å¼€å…¨å±€ä»£ç†åŽï¼Œç„¶åŽåœ¨ç»ˆç«¯æ‰§è¡Œ curl ip.cn å‘½ä»¤ï¼Œç»“æžœæ˜¾ç¤ºæ£€æŸ¥åˆ°çš„ IP åœ°å€ä¾ç„¶æ˜¯æœ¬æœºçœŸå®žçš„å…¬ç½‘ IP:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">âžœ  ~ <span class="selector-tag">curl</span> <span class="selector-tag">ip</span><span class="selector-class">.cn</span></span><br><span class="line">å½“å‰ <span class="selector-tag">IP</span>ï¼š122<span class="selector-class">.225</span><span class="selector-class">.224</span><span class="selector-class">.218</span> æ¥è‡ªï¼šæµ™æ±Ÿçœæ­å·žå¸‚ ç”µä¿¡</span><br></pre></td></tr></table></figure><p>è¦è®© shell ä¹Ÿä½¿ç”¨ä»£ç†ï¼Œå¯ä»¥æ‰§è¡Œä¸€ä¸‹å‘½ä»¤æ¥è®¾ç½®ä»£ç†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„ä¸‹é¢çš„ç«¯å£å·ä¸ä¸€å®šæ˜¯ 1086</span></span><br><span class="line"><span class="built_in">export</span> ALL_PROXY=socks5://127.0.0.1:1086</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æˆ‘ä½¿ç”¨çš„ç«¯å£å·æ˜¯ 1086ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘çš„ ShadowSocks å®¢æˆ·ç«¯çš„åå¥½è®¾ç½®ä¸­å¦‚ä¸‹æ‰€ç¤ºçš„è®¾ç½®é¡¹æ˜¯ 1086:</p><p><img src="http://tao93.top/images/2018/10/18/1539842647.png" alt=""></p><p>ä½†æ˜¯æ¯æ¬¡éƒ½æ‰§è¡Œä¸Šé¢çš„ export å‘½ä»¤å¾ˆéº»çƒ¦ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ shell çš„é…ç½®æ–‡ä»¶ä¸­è®¾ç½® aliasï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># enable proxy</span></span><br><span class="line"><span class="built_in">alias</span> proxy=<span class="string">"export ALL_PROXY=socks5://127.0.0.1:1086"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># disable proxy</span></span><br><span class="line"><span class="built_in">alias</span> unproxy=<span class="string">"unset ALL_PROXY"</span></span><br></pre></td></tr></table></figure><p>å‰ä¸¤å¤©æˆ‘å‘çŽ°åœ¨å®¶çš„æ—¶å€™ï¼ŒAndroid Studio æ— æ³•è®¿é—® Google çš„ maven ä»“åº“ï¼Œå³ä½¿æˆ‘å¼€å…¨å±€ä»£ç†ä¹Ÿä¸è¡Œï¼Œå³ä½¿æˆ‘åœ¨ terminal ä¸­æŒ‰å‰é¢æ–¹æ³•è®¾ç½® proxy å¹¶ä¸”ä½¿ç”¨ gradle å‘½ä»¤æ¥æž„å»ºä¹Ÿä¸è¡Œã€‚</p><p>ä¸ºæ­¤ï¼Œæˆ‘æ‰¾åˆ°äº†å‘ gradle è®¾ç½® proxy çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯åœ¨é¡¹ç›®çš„ local.properties æ–‡ä»¶ï¼ˆä¹‹æ‰€ä»¥é€‰è¿™ä¸ªæ–‡ä»¶æ˜¯å› ä¸ºè¿™ä¸ªæ–‡ä»¶ä¸€èˆ¬æ˜¯ä¸çº³å…¥ git ç®¡ç†çš„ï¼Œæ‰€ä»¥æˆ‘å¯ä»¥éšä¾¿è‡ªå®šä¹‰åœ°ä¿®æ”¹ï¼‰åŠ å…¥ä¸‹é¢çš„è®¾ç½®ï¼Œå³å¯è®© gradle ä½¿ç”¨ä»£ç†ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.gradle.<span class="attribute">jvmargs</span>=-Xmx4536m <span class="attribute">-DsocksProxyHost</span>=127.0.0.1 <span class="attribute">-DsocksProxyPort</span>=1086</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ç«¯å£å·å’Œå‰é¢çš„æ–¹æ³•ä¸­æ˜¯ä¸€è‡´çš„ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;https://shadowsocks.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ShadowSocks&lt;/a&gt; æ˜¯ä¸ªå¾ˆå¥½çš„å·¥å…·ï¼Œå®ƒè‡ªå¸¦ PAC æ¨¡å¼å’Œå…¨å±€æ¨¡å¼ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡è¿™ä¸ªå…¨å±€æ¨¡å¼å¹¶ä¸èƒ½å®Œå…¨è®©æ•´å°ç”µè„‘çš„æ‰€æœ‰ç½‘ç»œ
      
    
    </summary>
    
    
      <category term="ShadowSocks" scheme="https://tao93.top/tags/ShadowSocks/"/>
    
  </entry>
  
  <entry>
    <title>Don&#39;t let Your App Drain your Users&#39; Battery</title>
    <link href="https://tao93.top/2018/10/10/Don&#39;t%20let%20Your%20App%20Drain%20your%20Users&#39;%20Battery/"/>
    <id>https://tao93.top/2018/10/10/Don&#39;t let Your App Drain your Users&#39; Battery/</id>
    <published>2018-10-10T08:52:40.506Z</published>
    <updated>2019-07-05T14:01:39.879Z</updated>
    
    <content type="html"><![CDATA[<h3 id="What-drives-battery-Life"><a href="#What-drives-battery-Life" class="headerlink" title="What drives battery Life?"></a>What drives battery Life?</h3><ol><li>Hardware (Screen etc.)</li><li>Operating System</li><li>Apps &amp; Services</li><li>User Interaction</li></ol><h3 id="Efforts-to-improve-battery"><a href="#Efforts-to-improve-battery" class="headerlink" title="Efforts to improve battery"></a>Efforts to improve battery</h3><ol><li><a href="https://developer.android.google.cn/reference/android/app/job/JobScheduler" target="_blank" rel="noopener">Job Scheduler</a> (Since API 21)</li><li>Doze &amp; App Standby(Since API 23)</li><li>Doze on-the-go (Since API 24)</li><li>Background Limits (Since API 26)</li><li>Adaptive Battery, Background Restrictions etc. (Since API 28)</li></ol><p>Among the above <strong>only Job Scheduler</strong> could be directly leveraged by app developers in the code.</p><h4 id="Job-Scheduler-Since-API-21"><a href="#Job-Scheduler-Since-API-21" class="headerlink" title="Job Scheduler (Since API 21)"></a>Job Scheduler (Since API 21)</h4><p>Job Scheduler is suitable when we want to do something in a specified circumstance, such as:</p><blockquote><p>Batterry is not Low</p><p>With specified Netwoek Status</p><p>Is Charging</p><p>Storage is not Low</p><p>Device is Idle</p></blockquote><p>Without Job Scheduler, we may need to keep a service running to monitor specified system broadcast and then do what we want, which is not optimized for battery comparing to Job Scheduler. </p><p>Here is a simple example of Job Scheduler:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyJobService</span> <span class="keyword">extends</span> <span class="title">JobService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onStartJob</span><span class="params">(<span class="keyword">final</span> JobParameters params)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> AsyncTask&lt;Void, Void, Void&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> Void <span class="title">doInBackground</span><span class="params">(Void... voids)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// stuffs that consumes a lot of time like making a backup to the cloud</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPostExecute</span><span class="params">(Void aVoid)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// tell scheduler our job is done</span></span><br><span class="line">                jobFinished(params, <span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.execute();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// return true to tell scheduler our job is not finished.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onStopJob</span><span class="params">(JobParameters params)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> sJobId = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> JobScheduler mJobScheduler;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        mJobScheduler = (JobScheduler)getSystemService(Context.JOB_SCHEDULER_SERVICE);</span><br><span class="line"></span><br><span class="line">        findViewById(R.id.schedule_btn).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                scheduleAJob();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scheduleAJob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (JobInfo info : mJobScheduler.getAllPendingJobs()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (info.getId() == sJobId) &#123;</span><br><span class="line">                <span class="comment">// the last scheduled job is not finished yet</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// build the jobInfo that requires charging, idle and network that won't charge.</span></span><br><span class="line">        JobInfo jobInfo = <span class="keyword">new</span> JobInfo.Builder(++ sJobId, <span class="keyword">new</span> ComponentName(<span class="keyword">this</span>, MyJobService.class))</span><br><span class="line">                .setRequiresCharging(<span class="keyword">true</span>)</span><br><span class="line">                .setRequiresDeviceIdle(<span class="keyword">true</span>)</span><br><span class="line">                .setRequiredNetworkType(JobInfo.NETWORK_TYPE_UNMETERED)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        mJobScheduler.schedule(jobInfo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Doze-Since-API-23"><a href="#Doze-Since-API-23" class="headerlink" title="Doze (Since API 23)"></a>Doze (Since API 23)</h4><p>Unplugged and stationary for a period of time, a device would be in doze mode, which restricts all apps regardless whether they targets api 23. However, the OS periodically exits Doze for a brief time to let apps complete their deferred jobs. The bried time slot is called Maintenance window. Below is a figure showing the mode changing:</p><p><img src="http://tao93.top/images/2018/10/10/1539151703.png" alt=""></p><p>In doze mode, the following are restricted:</p><ol><li>Network access is suspended</li><li>WakeLock is ignored</li><li>Standard AlarmManager alarms (setExact() and setWindow()) are deferred to the next maintenance window</li><li>No Wi-Fi scaning</li><li>No <a href="https://developer.android.com/reference/android/content/AbstractThreadedSyncAdapter.html" target="_blank" rel="noopener">Sync Adapters</a></li><li>No JobScheduler jobs</li></ol><p>Stuffs not restricted by Doze:</p><ol><li>FCM high priority msg</li><li>Alarms set with setAndAllowWhileIdle() and setExactAndAllowWhileIdle()</li></ol><p>Testing Doze:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># if your device is connected with a cable, use the following to disable charging</span></span><br><span class="line">adb shell dumpsys battery unplug</span><br><span class="line"></span><br><span class="line"><span class="comment"># Force the system into Doze mode</span></span><br><span class="line">adb shell dumpsys deviceidle force-idle</span><br><span class="line"></span><br><span class="line"><span class="comment"># exit idle mode &amp; reactivate the device</span></span><br><span class="line">adb shell dumpsys deviceidle unforce</span><br><span class="line">adb shell dumpsys battery reset <span class="comment"># this also recovers charging</span></span><br></pre></td></tr></table></figure><h4 id="App-Standby-Since-API-23"><a href="#App-Standby-Since-API-23" class="headerlink" title="App Standby (Since API 23)"></a>App Standby (Since API 23)</h4><p>An app is idle if the followings are satisfies:</p><ol><li>No user touching for a certain period of time</li><li>No processes in the foreground (either as an activity or foreground service)</li><li>No notifications showing on the lock screen or in the notification center.</li><li>Not charging</li></ol><p>Testing App Standby:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># if your device is connected with a cable, use the following to disable charging</span></span><br><span class="line">adb shell dumpsys battery unplug</span><br><span class="line"></span><br><span class="line"><span class="comment"># check whether your app is in standby mode. A 'Idle=false' output means not in standby mode</span></span><br><span class="line">adb shell am get-inactive &lt;packageName&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Force the app into App Standby mode</span></span><br><span class="line">adb shell am <span class="built_in">set</span>-inactive &lt;packageName&gt; <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># exit Standby mode for your app</span></span><br><span class="line">adb shell am <span class="built_in">set</span>-inactive &lt;packageName&gt; <span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="Doze-on-the-go-Since-API-24"><a href="#Doze-on-the-go-Since-API-24" class="headerlink" title="Doze on-the-go (Since API 24)"></a>Doze on-the-go (Since API 24)</h3><p>A lighter Doze mode which activates when the phone is moving in our pockets or hands. Doze on-the-go allows WakeLock, Wifi Scaning and GPS etc, thatâ€™s why itâ€™s lighter than former Doze mode introduced in API 23.</p><p>Ignore Doze configuration:</p><p><img src="http://tao93.top/images/2018/10/10/1539154768.png" alt=""></p><h4 id="Background-Limits-Since-API-26"><a href="#Background-Limits-Since-API-26" class="headerlink" title="Background Limits (Since API 26)"></a>Background Limits (Since API 26)</h4><p>Background Limits affects apps that targets API 26 or higher and includes Background Service Limitations and Broadcast Limitations.</p><h5 id="Background-Service-Limitations"><a href="#Background-Service-Limitations" class="headerlink" title="Background Service Limitations"></a>Background Service Limitations</h5><p>For an app that targets API 26 or higher, itâ€™s in background if:</p><ol><li>No visible Activity</li><li>No foreground Service</li><li>Not InputMethod Service, Wallpaper service etc.</li></ol><p>After several minutes of being in background, background services are stopped by the OS. Replacing background services with Scheduler Jobs is fine in many cases.</p><h5 id="Broadcast-Limitations-Introduced-in-API-25-and-strengthened-in-API-26"><a href="#Broadcast-Limitations-Introduced-in-API-25-and-strengthened-in-API-26" class="headerlink" title="Broadcast Limitations (Introduced in API 25 and strengthened in API 26)"></a>Broadcast Limitations (Introduced in API 25 and strengthened in API 26)</h5><p>For an app that targets API 26 or higher, it:</p><ol><li>canâ€™t register receivers for implicit broadcasts in Manifest file</li><li>can register receivers for explicit broadcasts in Manifest file</li><li>can register receivers for any broadcasts runtimely</li></ol><p>Broadcasts that require a <a href="https://developer.android.com/guide/topics/manifest/permission-element.html#plevel" target="_blank" rel="noopener">signature permission</a> are exempted from this restriction.</p><p>In some cases, registering system broadcasts could be replaced by Scheduler Jobs, such as if we want to do something when the device is charging.</p><h3 id="Adaptive-Battery-Since-API-29"><a href="#Adaptive-Battery-Since-API-29" class="headerlink" title="Adaptive Battery (Since API 29)"></a>Adaptive Battery (Since API 29)</h3><p>A new feature based on Machine Learning.</p><ol><li>Limit battery for apps that are not used often.</li><li>Apps should be able to run quickly when they are needed.</li><li>Donâ€™t bother users to manage manually.</li></ol><p>Apps are arranged into 4 standby buckets: <code>Active</code>, <code>Working set</code>, <code>Frequent</code> and <code>Rare</code>. Limits are increased from <code>Active</code> to <code>Rare</code>:</p><p><img src="http://tao93.top/images/2018/10/10/1539157914.png" alt=""></p><p>An app is in <code>Active</code> if it:</p><ol><li>has launched an activity</li><li>is running a foreground service</li><li>has a sync adapter associated with a content provider used by a foreground app</li><li>has a notification clicked by the user</li></ol><p>An app is in <code>Working set</code> if it runs often but isnâ€™t active.</p><p>An app is in <code>Frequent</code> if it is used regularly, but not necessarily every day.</p><p>An app is in <code>Rare</code> if it is not often used.</p><p>Find out what bucket the app is currently in programmatically:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UsageStatsManager.getAppStandbyBucket()</span><br></pre></td></tr></table></figure><p>Test Standby Buckets:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># assgin your app into a specified bucket</span></span><br><span class="line">adb shell am <span class="built_in">set</span>-standby-bucket &lt;packagename&gt; active|working_set|frequent|rare</span><br><span class="line"></span><br><span class="line"><span class="comment"># check bucket assignments for one app or all apps</span></span><br><span class="line"><span class="comment"># the output '10 20 30 40' mean Active, Working set, Frequent, Rare respectively</span></span><br><span class="line">adb shell am get-standby-bucket [&lt;packagename&gt;]</span><br></pre></td></tr></table></figure><h3 id="Battery-Saver"><a href="#Battery-Saver" class="headerlink" title="Battery Saver"></a>Battery Saver</h3><p>New battery saver in API 29:</p><ol><li>No red status bar and has animation</li><li>Location service is off when screen is off</li><li>Battery level threshold is adjustable</li></ol><p>Apps are encouraged to switch to dark theme when battery saver is on.</p><p>Check whether battery saver is on programmatically:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((PowerManager)getSystemService(Context.POWER_SERVICE)).isPowerSaveMode()</span><br></pre></td></tr></table></figure><p>Test battery saver:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pretend to be in low battery status</span></span><br><span class="line">adb shell settings put global low_power 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># reset all configurations</span></span><br><span class="line">adb shell dumpsys battery reset</span><br></pre></td></tr></table></figure><h3 id="Background-Restrictions-Since-API-29"><a href="#Background-Restrictions-Since-API-29" class="headerlink" title="Background Restrictions (Since API 29)"></a>Background Restrictions (Since API 29)</h3><p>Two criterias:</p><ol><li>Apps targeting pre-Oreo and using background services</li><li>Excessive WakeLocks (&gt; 1hr in background)</li></ol><p>Background restrictions are decided by the users:</p><p><img src="http://tao93.top/images/2018/10/10/1539156945.png" alt=""></p><p>When Background Restrictions is enabled for an app, fllowings are restricted:</p><ol><li>Background jobs, alarms, services and network accessing</li><li>Location related updates </li><li>Foreground services</li></ol><p>Except GUI operation, Background restrictions could alse be finished via adb:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># enable background restrictions</span></span><br><span class="line">adb shell appops <span class="built_in">set</span> &lt;package_name&gt; RUN_ANY_IN_BACKGROUND ignore</span><br><span class="line"></span><br><span class="line"><span class="comment"># disable background restrictions</span></span><br><span class="line">adb shell appops <span class="built_in">set</span> &lt;package_name&gt; RUN_ANY_IN_BACKGROUND allow</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;What-drives-battery-Life&quot;&gt;&lt;a href=&quot;#What-drives-battery-Life&quot; class=&quot;headerlink&quot; title=&quot;What drives battery Life?&quot;&gt;&lt;/a&gt;What drives b
      
    
    </summary>
    
    
      <category term="Android" scheme="https://tao93.top/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>é€šè¿‡ wifi è¿žæŽ¥ adb</title>
    <link href="https://tao93.top/2018/09/26/%E9%80%9A%E8%BF%87%20wifi%20%E8%BF%9E%E6%8E%A5%20adb/"/>
    <id>https://tao93.top/2018/09/26/é€šè¿‡ wifi è¿žæŽ¥ adb/</id>
    <published>2018-09-26T07:47:46.693Z</published>
    <updated>2018-09-26T07:47:46.694Z</updated>
    
    <content type="html"><![CDATA[<p>Android è°ƒè¯•æœ‰ä¸ªè®©äººä¸å¼€å¿ƒçš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯å¦‚æžœç”¨çœŸæœºè°ƒè¯•ï¼Œéœ€è¦ç”¨æ•°æ®çº¿è¿žæŽ¥åˆ° Android è®¾å¤‡ï¼Œè€Œå¯¹äºŽ type C æŽ¥å£çš„ MacBookï¼Œå¦‚æžœæ²¡æœ‰åŒç«¯ type C æ•°æ®çº¿ï¼Œé‚£ä¹ˆè¿˜å¾—ç”¨è½¬æŽ¥å™¨æ‰è¡Œã€‚ç›¸æ¯”è¾ƒçœŸæœºè°ƒè¯•ï¼Œå…¶å®žè¿˜å¯ä»¥ç”¨æ¨¡æ‹Ÿå™¨ï¼Œä¸è¿‡æ¨¡æ‹Ÿå™¨åªèƒ½æ”¯æŒ x86 ç±»åž‹çš„ native åº“ï¼Œå¹¶ä¸”ä¹Ÿè¿˜ä¼šæœ‰ä¸€äº›å…¶ä»–å±€é™æ€§ã€‚</p><p>å…¶å®žï¼ŒçœŸæœºä¹Ÿæ˜¯å¯ä»¥ç”¨å±€åŸŸç½‘æ— çº¿è¿žæŽ¥çš„ï¼Œåªéœ€è¦ç”µè„‘å’Œ Android è®¾å¤‡åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…ã€‚å¤§è‡´æ­¥éª¤å°±æ˜¯ä¸‹é¢å‡ æ¡å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…ˆç”¨æ•°æ®çº¿è¿žæŽ¥ï¼Œç¡®ä¿ adb devices å¯ä»¥çœ‹åˆ°è®¾å¤‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®© adb server é‡æ–°ä»¥ tcp æ¨¡å¼å¯åŠ¨ï¼Œç«¯å£æŒ‡å®šä¸º 5555</span></span><br><span class="line">adb tcpip 5555</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”µè„‘å’Œæ‰‹æœºä¹‹é—´å»ºç«‹æ— çº¿è¿žæŽ¥</span></span><br><span class="line">adb connect &lt;IP address of your Computer&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹”æŽ‰æ•°æ®çº¿ï¼Œæ­¤æ—¶å†æ£€æŸ¥ä¸€éæ˜¯å¦æ— çº¿è¿žæŽ¥æˆåŠŸ</span></span><br><span class="line">adb devices</span><br></pre></td></tr></table></figure><p>æ¯æ¬¡éƒ½æƒ³ä¸Šé¢è¿™æ ·æ‰§è¡Œä¸¤ä¸‰æ¡å‘½ä»¤æ˜¾ç„¶å¤ªç¹æ‚ï¼Œå°¤å…¶æ˜¯å…¶ä¸­è¿˜æœ‰ä¸€æ­¥è¦æ›¿æ¢ä¸ºç”µè„‘çš„å½“å‰å†…ç½‘ IPï¼Œæ‰€ä»¥åº”è¯¥å†™ä¸€ä¸ªè„šæœ¬æ¥æŠŠä¸Šé¢çš„ä¸œè¥¿ä¸€é”®æžå®šï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ˆæ–­å¼€ä¸€ä¸‹</span></span><br><span class="line">adb disconnect</span><br><span class="line"></span><br><span class="line">adb tcpip 5555</span><br><span class="line"></span><br><span class="line"><span class="comment"># sleep ä¸¤ç§’ï¼Œä¸ç„¶çš„è¯å› ä¸ºåˆšæ‰§è¡Œ adb tcpip 5555 é‚£ä¹ˆåŽç»­çš„å‘½ä»¤ä¼šæ‰¾ä¸åˆ° devices</span></span><br><span class="line">sleep 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥æ˜¯å¦å®‰è£…äº†é»‘åŸŸ</span></span><br><span class="line">adb shell pm list packages | grep <span class="string">'me\.piebridge\.brevent'</span></span><br><span class="line">has_brevent=$?</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$has_brevent</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="comment"># é‡æ–°å¯åŠ¨é»‘é˜ˆ</span></span><br><span class="line">    adb -d shell sh /data/data/me.piebridge.brevent/brevent.sh</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># èŽ·å– android è®¾å¤‡çš„ IP åœ°å€</span></span><br><span class="line">android_ip=`adb shell <span class="string">"ifconfig"</span> | grep <span class="string">'inet.*cast'</span> | awk <span class="string">'&#123;print $2&#125;'</span> | awk -F<span class="string">':'</span> <span class="string">'&#123;print $2&#125;'</span>`</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'Android device IP: '</span> <span class="variable">$android_ip</span></span><br><span class="line">adb connect <span class="variable">$android_ip</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„è„šæœ¬ä¸­ï¼Œä¼šæ£€æŸ¥æ˜¯å¦å®‰è£…äº†<a href="https://play.google.com/store/apps/details?id=me.piebridge.brevent&amp;hl=zh" target="_blank" rel="noopener">é»‘é˜ˆ</a>ï¼Œå¦‚æžœå®‰è£…äº†ï¼Œå°±ä¼šé‡æ–°å¯åŠ¨é»‘é˜ˆã€‚é»‘é˜ˆæ˜¯ä¸€æ¬¾ç®¡ç† Android åº”ç”¨è¿è¡ŒçŠ¶æ€çš„åº”ç”¨ï¼Œç”¨æ¥é™åˆ¶åº”ç”¨å”¤é†’å’Œå¸¸é©»åŽå°ã€‚Android 8.0 ä»¥ä¸Šçš„ç³»ç»Ÿï¼Œåªè¦ USB è°ƒè¯•é€‰é¡¹å‘ç”Ÿå˜æ›´ï¼Œé»‘é˜ˆå°±ä¼šåœæ­¢èµ·ä½œç”¨ï¼Œæ‰€ä»¥æ­¤å¤„éœ€è¦é‡æ–°è®©å®ƒè¿è¡Œèµ·æ¥ã€‚å¦å¤–ä¸Šé¢çš„è„šæœ¬ä¸­è¿˜é€šè¿‡ ifconfig å‘½ä»¤æ¥èŽ·å–åˆ°ç”µè„‘çš„å†…ç½‘ IPï¼Œç”¨äºŽæ‰§è¡Œ adb connect å‘½ä»¤ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Android è°ƒè¯•æœ‰ä¸ªè®©äººä¸å¼€å¿ƒçš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯å¦‚æžœç”¨çœŸæœºè°ƒè¯•ï¼Œéœ€è¦ç”¨æ•°æ®çº¿è¿žæŽ¥åˆ° Android è®¾å¤‡ï¼Œè€Œå¯¹äºŽ type C æŽ¥å£çš„ MacBookï¼Œå¦‚æžœæ²¡æœ‰åŒç«¯ type C æ•°æ®çº¿ï¼Œé‚£ä¹ˆè¿˜å¾—ç”¨è½¬æŽ¥å™¨æ‰è¡Œã€‚ç›¸æ¯”è¾ƒçœŸæœºè°ƒè¯•ï¼Œå…¶å®žè¿˜å¯ä»¥ç”¨æ¨¡æ‹Ÿå™¨ï¼Œä¸è¿‡æ¨¡æ‹Ÿå™¨åªèƒ½æ”¯æŒ x86 
      
    
    </summary>
    
    
      <category term="Android" scheme="https://tao93.top/tags/Android/"/>
    
      <category term="adb" scheme="https://tao93.top/tags/adb/"/>
    
  </entry>
  
  <entry>
    <title>è®°ä¸€æ¬¡æ··æ·†é—®é¢˜å¯¼è‡´çš„ bug</title>
    <link href="https://tao93.top/2018/09/26/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B7%E6%B7%86%E9%97%AE%E9%A2%98%E5%AF%BC%E8%87%B4%E7%9A%84%20bug/"/>
    <id>https://tao93.top/2018/09/26/è®°ä¸€æ¬¡æ··æ·†é—®é¢˜å¯¼è‡´çš„ bug/</id>
    <published>2018-09-26T07:47:46.691Z</published>
    <updated>2019-07-05T14:04:42.596Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æŠŠ <a href="https://github.com/card-io/card.io-Android-SDK" target="_blank" rel="noopener">Card.IO</a> æ”¹é€ æˆä¸€ä¸ª aar ä¾èµ–æä¾›ç»™å…¬å¸çš„é¡¹ç›®ä½¿ç”¨ã€‚è¿™ä¸ª aar ä¸­ä½¿ç”¨äº†å‡ ä¸ª so åº“ã€‚åªä¸è¿‡æ²¡æœ‰æä¾› armeabi ç±»åž‹çš„ so åº“ï¼Œè€Œåªæœ‰ armeabi-v7a å’Œ armeabi-v8a ä¹‹ç±»çš„ so åº“ã€‚æ‰€ä»¥åˆæ¬¡æä¾›ç»™å…¬å¸é¡¹ç›®ä½¿ç”¨æ—¶ï¼Œå‡ºçŽ°äº†æ‰¾ä¸åˆ° so çš„é”™è¯¯ï¼Œä¹Ÿå°±æ˜¯ UnsatisfiedLinkError é”™è¯¯ã€‚ä¹Ÿå°±æ˜¯ä¸‹é¢è¿™æ ·çš„æç¤ºï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535807292.png" alt=""></p><p>åŽé¢æˆ‘æƒ³å°½åŠžæ³•æä¾›äº† armeabi ç±»åž‹çš„ so åº“ï¼Œè¿™ä¸ªé—®é¢˜å°±ç®—å‘Šä¸€æ®µè½äº†ï¼Œç„¶åŽè¿™è¿˜ä¸æ˜¯ç»“æŸã€‚ä»Šå¤©ï¼Œæµ‹è¯•åˆå‘äº†ä¸€æ®µå´©æºƒæ—¥å¿—ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢è¿™æ ·çš„æ—¥å¿—ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535807316.png" alt=""></p><p>å› ä¸ºä¹‹å‰å‡ºçŽ°è¿‡æ‰¾ä¸åˆ° so åº“çš„é—®é¢˜ï¼Œæ‰€ä»¥ä¹ä¸€çœ‹ä¸Šé¢çš„æ—¥å¿—ï¼Œæˆ‘ä»¬éƒ½ä»¥ä¸ºåˆæ˜¯æ‰¾ä¸åˆ° so åº“ (ä¸ºæˆ‘ä»¬çš„èœè¡¨ç¤ºç¾žæ„§ ðŸ¤©)ã€‚ç„¶åŽç»è¿‡ä¸Šç½‘æŸ¥æ‰¾ï¼Œå¹¶å’Œ native çš„ä»£ç å¯¹æ¯”ï¼Œæˆ‘æ‰æ„è¯†åˆ°ï¼Œä¸Šé¢çš„æ—¥å¿—å…¶å®žæ˜¯ so åº“æ˜¯æ‰¾åˆ°äº†çš„ï¼Œåªä¸è¿‡æ˜¯åŠ è½½ so åº“æ—¶ï¼Œè°ƒç”¨ JNI_onLoad è¿™ä¸ª native æ–¹æ³•æ—¶å‡ºé”™äº†ã€‚æ­¤å¤–ï¼Œå‘æµ‹è¯•è¦äº† debug åŒ…ï¼Œå‘çŽ°æ²¡æœ‰é—®é¢˜ï¼Œæ‰€ä»¥åˆæ­¥æ–­å®šæ˜¯æ··æ·†çš„é—®é¢˜ï¼Œç„¶åŽå°±æ˜¯æŽ’æŸ¥äº†ã€‚</p><p>æˆ‘æŠŠæµ‹è¯•æä¾›ç»™æˆ‘çš„ release åŒ…åç¼–è¯‘ï¼Œç„¶åŽå’Œ JNI_onLoad æ–¹æ³•ä¸­çš„ native ä»£ç å¯¹æ¯”ï¼Œç»ˆäºŽæ‰¾åˆ°åŽŸå› äº†ï¼šrelease åŒ…ä¸­ï¼Œæˆ‘æä¾›çš„åº“çš„æŸä¸ªæ–¹æ³•è¢«æ··æ·†æŽ‰äº†ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•æ˜¯éœ€è¦è¢« JNI_onLoad æ–¹æ³•è°ƒç”¨çš„ã€‚æ‰€ä»¥é—®é¢˜å°±æ˜¯ï¼šä¸€ä¸ªéœ€è¦è¢« so åº“è°ƒç”¨çš„ Java æ–¹æ³•è¢«æ··æ·†äº†ï¼å…¶å®žï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬çš„é¡¹ç›®å¼•å…¥ä¸€äº›è‘—åçš„ç¬¬ä¸‰æ–¹åŒ… (æ¯”å¦‚ Knife ä¹‹ç±»çš„) æ—¶ï¼Œéƒ½ä¼šåœ¨æˆ‘ä»¬çš„é¡¹ç›®çš„ Proguard é…ç½®æ–‡ä»¶ä¸­å£°æ˜Žä¸è¦æ··æ·†è¿™äº›ä¸‰æ–¹åŒ…çš„ä»£ç ï¼Œä¸ºçš„å°±æ˜¯é¿å…ä¸Šé¢è¿™ä¸ªé—®é¢˜ã€‚è¯´ä¸€å¥æ˜¾å¾—æœ‰ç‚¹åºŸè¯çš„è¯ï¼šç¬¬ä¸‰æ–¹åŒ…å‘å¸ƒæ··æ·†åŒ…æ—¶ï¼Œä»–ä»¬çš„ Proguard é…ç½®æ–‡ä»¶åªèƒ½åœ¨ä»–ä»¬çš„ aar åŒ…æž„å»ºæ—¶ç”Ÿæ•ˆï¼Œè€Œåœ¨ä»–ä»¬çš„ aar æž„å»ºåˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­æ—¶ï¼Œä»–ä»¬çš„ Proguard æ—©å·²éž­é•¿èŽ«åŠä¸èµ·ä½œç”¨äº†ã€‚</p><p>å›žåˆ°æˆ‘é‡åˆ°çš„è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æœ¬åœ°è‡ªæµ‹æ—¶ï¼Œå¾ˆå°‘ä¼šè¿›è¡Œæ··æ·†ï¼Œæœ¬åœ°çš„ release é»˜è®¤éƒ½æ˜¯æœªæ··æ·†çš„ (minifyEnabled æ˜¯ false)ï¼Œæ‰€ä»¥è‡ªæµ‹çš„æ—¶å€™æ ¹æœ¬æ²¡æœ‰æ³¨æ„åˆ°è¿™ä¸ªé—®é¢˜ã€‚è¿™æ¬¡è¿™ä¸ª bug çš„è§£å†³åŠžæ³•ä¹‹ä¸€æ˜¯ï¼Œåœ¨æœ€ç»ˆä½¿ç”¨æˆ‘çš„ aar çš„é¡¹ç›®ä¸­ï¼Œæ˜¾ç¤ºå£°æ˜Žä¸è¦æ··æ·†æˆ‘è¿™ä¸ª aar ä¸­çš„æŸäº›ä»£ç ï¼Œè¿™å°±å’Œä¸Šä¸€æ®µè¯´çš„å£°æ˜Žä¸æ··æ·†ç¬¬ä¸‰æ–¹åŒ…çš„ä»£ç æ˜¯ä¸€æ ·çš„ã€‚Butï¼Œè¿˜æœ‰ä¸€ç§æ›´å¥½çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯ä½¿ç”¨ com.android.support.support-annotations æ”¯æŒåº“ä¸­çš„ @Keep æ³¨è§£ï¼Œæ­¤æ³¨è§£å¯ä»¥æ ‡è®°å“ªäº›æ–¹æ³•æˆ–è€…ç±»åœ¨æœ€ç»ˆæž„å»º apk æ—¶ä¸ä¼šè¢«æ··æ·†æŽ‰ (å½“ç„¶åœ¨å‰é¢çš„ aar æž„å»ºç­‰è¿‡ç¨‹è‡ªç„¶ä¹Ÿä¸ä¼šæ··æ·†)ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œå½“å‰é¡¹ç›®çš„ Proguard é…ç½®æ–‡ä»¶åªèƒ½åœ¨å½“å‰é¡¹ç›®æž„å»ºè¾“å‡ºäº§ç‰©æ—¶èµ·ä½œç”¨ï¼Œè€Œæ— æ³•ç¡®ä¿è¾“å‡ºçš„äº§ç‰©äº¤ç»™å…¶ä»–é¡¹ç›®é›†æˆæ—¶ä¸è¢«æ··æ·†ã€‚è‹¥è¦ç¡®ä¿åŽè€…ï¼Œé‚£å°±å¯ä»¥ç”¨ support-annotations æ”¯æŒåº“ä¸­çš„æ³¨è§£äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘æŠŠ &lt;a href=&quot;https://github.com/card-io/card.io-Android-SDK&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Card.IO&lt;/a&gt; æ”¹é€ æˆä¸€ä¸ª aar ä¾èµ–æä¾›ç»™å…¬å¸çš„é¡¹ç›®ä½¿ç”¨ã€‚è¿™ä¸ª aar ä¸­ä½¿ç”¨
      
    
    </summary>
    
    
      <category term="Android" scheme="https://tao93.top/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>è®°ä¸€ä¸ªç®€å•çš„é€’å½’é—®é¢˜ä¸Žè§£æ³•</title>
    <link href="https://tao93.top/2018/09/26/%E8%AE%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E9%80%92%E5%BD%92%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E6%B3%95/"/>
    <id>https://tao93.top/2018/09/26/è®°ä¸€ä¸ªç®€å•çš„é€’å½’é—®é¢˜ä¸Žè§£æ³•/</id>
    <published>2018-09-26T07:47:46.682Z</published>
    <updated>2019-07-05T14:04:38.082Z</updated>
    
    <content type="html"><![CDATA[<p>é€’å½’é—®é¢˜å°±åƒæ˜¯ä¿„ç½—æ–¯å¥—å¨ƒä¸€æ ·ç²¾å¦™ï¼Œå¤§çš„å¥—å°çš„ï¼Œä¸€å±‚ä¸€å±‚å¥—åœ¨ä¸€èµ·ã€‚</p><p>å‰äº›æ—¥å­ï¼Œä¸€ä¸ªæœ‹å‹è¯´çœ‹åˆ°ä¸€ä¸ªç®—æ³•é¢˜ç›®ï¼Œç„¶åŽé—®æˆ‘æœ‰æ€è·¯å—ï¼Ÿé—®é¢˜å°±æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535807089.png" alt=""></p><p>è¿™ä¸ªé—®é¢˜å¾ˆæ˜Žæ˜¾æ˜¯ä¸ªé€’å½’é—®é¢˜ã€‚æˆ‘å½“æ—¶å°±å¤¸ä¸‹æµ·å£è¯´ï¼Œ10åˆ†é’Ÿç»™ä½ å†™ä¸ª Python è„šæœ¬ã€‚è™½ç„¶å®žé™…ä¸Šç”¨äº†æŽ¥è¿‘ 30 åˆ†é’Ÿã€‚ã€‚ã€‚</p><p>è¨€å½’æ­£ä¼ ï¼Œè¿™ä¸ªé—®é¢˜çš„é€’å½’å…³ç³»åŒ…å«ä¸¤ç§ï¼Œ<strong>åµŒå¥—å…³ç³»</strong>å’Œ<strong>å¹¶åˆ—å…³ç³»</strong>ã€‚æ¯”å¦‚ 2[a]3[c] æœ€å¤–å±‚æ˜¯å¹¶åˆ—å…³ç³»ï¼Œå³ 2[a] å’Œ 3[c] æ˜¯ä¸¤ä¸ªäº’ç›¸å¹¶åˆ—çš„å­é—®é¢˜ï¼Œä»–ä»¬çš„è§£ç­”ä¸²èµ·æ¥å°±æ˜¯ 2[a]3[c] çš„è§£ç­”ã€‚è€Œ 2[2[a]] æœ€å¤–å±‚åˆ™æ˜¯ä¸€ä¸ªåµŒå¥—å…³ç³»ï¼Œå³è¦æ±‚ 2[2[a]] çš„è§£ç­”éœ€è¦å…ˆæ±‚å­é—®é¢˜ 2[a] çš„è§£ç­” (è¿™ä¸ªè§£ç­”æ˜¾ç¤ºå°±æ˜¯ aa)ï¼Œæ‰€ä»¥é—®é¢˜åŒ–è§£ä¸º 2[aa]ã€‚</p><p>æ‰€ä»¥æ€è·¯å°±æ˜¯ï¼Œå¯¹äºŽä¸€ä¸ªé—®é¢˜ Xï¼Œå…ˆæŒ‰å¹¶åˆ—å…³ç³»åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå­é—®é¢˜ X1, X2, â€¦, Xnï¼›å¦‚æžœ n å¤§äºŽ 1ï¼Œé‚£ä¹ˆå„ä¸ªå­é—®é¢˜çš„ç­”æ¡ˆä¸²èµ·æ¥å°±æ˜¯ç­”æ¡ˆäº†ï¼›å¦‚æžœ n ç­‰äºŽ 1ï¼Œé‚£ä¹ˆè¯´æ˜Ž X æœ€å¤–å±‚å¹¶ä¸æ˜¯å¹¶åˆ—å…³ç³»è€Œæ˜¯åµŒå¥—å…³ç³»æˆ–è€…æ ¹æœ¬å°±æ˜¯å•ä¸ªå­—æ¯ï¼Œå¦‚æžœ X æ˜¯å•ä¸ªå­—æ¯ï¼Œé‚£ä¹ˆç­”æ¡ˆå°±æ˜¯å®ƒæœ¬èº«ï¼Œåä¹‹ï¼Œé‚£ä¹ˆ X ä¸€å®šæ˜¯ s[Y] çš„å½¢å¼ï¼Œç­”æ¡ˆå°±æ˜¯ s ä¸ª Y çš„ç­”æ¡ˆä¸²èµ·æ¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">p_loc</span><span class="params">(input, left)</span>:</span></span><br><span class="line">    count = <span class="number">1</span></span><br><span class="line">    i = left</span><br><span class="line">    <span class="keyword">while</span> count &gt; <span class="number">0</span>:</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> input[i] == <span class="string">']'</span>:</span><br><span class="line">            count -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> input[i] == <span class="string">'['</span>:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do</span><span class="params">(input)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'['</span> <span class="keyword">not</span> <span class="keyword">in</span> input:</span><br><span class="line">        <span class="keyword">return</span> input</span><br><span class="line">    first = input.find(<span class="string">'['</span>)</span><br><span class="line">    i = p_loc(input, first)</span><br><span class="line">    <span class="keyword">if</span> i &lt; len(input) <span class="number">-1</span>:</span><br><span class="line">        parts = []</span><br><span class="line">        <span class="keyword">while</span> i &lt; len(input) <span class="number">-1</span>:</span><br><span class="line">            parts.append(input[:i+<span class="number">1</span>])</span><br><span class="line">            input = input[i+<span class="number">1</span>:]</span><br><span class="line">            first = input.find(<span class="string">'['</span>)</span><br><span class="line">            i = p_loc(input, first)</span><br><span class="line">        parts.append(input[:i+<span class="number">1</span>])</span><br><span class="line">        res = <span class="string">''</span></span><br><span class="line">        <span class="keyword">for</span> part <span class="keyword">in</span> parts:</span><br><span class="line">            res += do(part)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        right = p_loc(input, first)</span><br><span class="line">        sub_res = do(input[first+<span class="number">1</span>:right])</span><br><span class="line">        <span class="keyword">return</span> int(input[:first]) * sub_res</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">print(do(<span class="string">'2[a]3[c]'</span>))</span><br><span class="line">print(do(<span class="string">'2[2[a]]'</span>))</span><br><span class="line">print(do(<span class="string">'2[2[a]]3[c]'</span>))</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;é€’å½’é—®é¢˜å°±åƒæ˜¯ä¿„ç½—æ–¯å¥—å¨ƒä¸€æ ·ç²¾å¦™ï¼Œå¤§çš„å¥—å°çš„ï¼Œä¸€å±‚ä¸€å±‚å¥—åœ¨ä¸€èµ·ã€‚&lt;/p&gt;
&lt;p&gt;å‰äº›æ—¥å­ï¼Œä¸€ä¸ªæœ‹å‹è¯´çœ‹åˆ°ä¸€ä¸ªç®—æ³•é¢˜ç›®ï¼Œç„¶åŽé—®æˆ‘æœ‰æ€è·¯å—ï¼Ÿé—®é¢˜å°±æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://tao93.top/images/2018/09/01/153580
      
    
    </summary>
    
    
      <category term="Algorithm" scheme="https://tao93.top/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>æ—¥å¸¸ä¿® Bug</title>
    <link href="https://tao93.top/2018/09/26/%E6%97%A5%E5%B8%B8%E4%BF%AE%20Bug/"/>
    <id>https://tao93.top/2018/09/26/æ—¥å¸¸ä¿® Bug/</id>
    <published>2018-09-26T07:47:46.680Z</published>
    <updated>2019-07-05T14:04:13.348Z</updated>
    
    <content type="html"><![CDATA[<p>å‰å‡ å¤©æœ‰äººæŠ¥å‘Šå·´è¥¿ç‰ˆæœ¬ä¹˜å®¢ç«¯æ‰«æé“¶è¡Œå¡çš„ç•Œé¢æœ‰ bugï¼Œå³å±å¹•å³ä¾§æœ‰ä¸€æ¡ç™½çº¿ï¼Œä¹Ÿå°±æ˜¯ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="http://tao93.top/images/2018/09/01/1535790364.png" alt=""></p><p>é‰´äºŽæŠ¥å‘Šäººæ²¡æå…·ä½“çš„ç‰ˆæœ¬å·ï¼Œä¹Ÿæ²¡ææ€Žä¹ˆå‡ºçŽ°çš„ï¼Œä¹Ÿæ²¡ææ˜¯ä»€ä¹ˆæœºåž‹å‡ºçŽ°çš„ï¼Œæˆ‘å°±å’ŒæŠ¥å‘Šäººè¯´æ²Ÿé€šäº†ä¸€ç•ªã€‚æŠ¥å‘Šäººè¯´åº”è¯¥æ˜¯å°ç±³ 6 å‡ºçŽ°è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘é‚å€Ÿäº†ä¸€éƒ¨å°ç±³ 6ï¼Œç„¶åŽè¿è¡Œ demo å¹¶æ²¡æœ‰å¤çŽ°ã€‚çŽ°åœ¨å°±æœ‰ä¸¤ç§å¯èƒ½ï¼Œç¬¬ä¸€æ˜¯åªæœ‰æŠ¥å‘Šäººé‚£å°å°ç±³ 6 æœ‰é—®é¢˜ï¼Œç¬¬äºŒæ˜¯ demo æ²¡é—®é¢˜ä½†æ˜¯é›†æˆåˆ°å·´è¥¿ç‰ˆæœ¬åŽå°±æœ‰é—®é¢˜äº†ã€‚ç»è¿‡è‰°è‹¦äº¤æ¶‰ï¼Œç»ˆäºŽä»Žå¯¹æ–¹é‚£é‡Œè¦åˆ°äº†ä¸€ä¸ªå®‰è£…åŒ…åŽï¼Œæˆ‘æ‰‹é‡Œæ‰‹æœºå¤çŽ°äº†æ­¤é—®é¢˜ï¼Œäº‹å®žå¾ˆå¿«å°±æ¸…æ¥šäº†ï¼šdemo æ²¡é—®é¢˜ä½†æ˜¯é›†æˆåŽæœ‰é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯å’Œæœºåž‹åŽ‹æ ¹æ²¡å…³ç³»ã€‚</p><p>å…ˆç›´æŽ¥ç»™å‡ºæœ€åŽä¿®å¤çš„æ–¹æ³•ï¼Œä¿®å¤æ–¹æ³•æ˜¯åœ¨æˆ‘çš„æ‰«å¡åº“çš„ activity ä¸­ï¼Œè°ƒç”¨ä»¥ä¸‹ä¸€è¡Œå°± OK äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»™ PhoneWindow è®¾ç½®ä¸€ä¸ªèƒŒæ™¯ </span></span><br><span class="line">getWindow().setBackgroundDrawable(<span class="keyword">new</span> ColorDrawable(Color.TRANSPARENT));</span><br></pre></td></tr></table></figure><p>å—¯ï¼Œä¿®å¤æ–¹æ³•å¾ˆç®€å•ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¿™æ ·åšå°± work äº†å‘¢ï¼ŸæŽ¥ä¸‹æ¥å°±æ˜¯è°ƒè¯•çš„è¿‡ç¨‹äº†.</p><p>é¦–å…ˆèŽ·å–ä¸€ä¸‹è¿™ä¸ªç•Œé¢çš„ layout ä¿¡æ¯ï¼Œå°è¯•çœ‹çœ‹å³ä¾§ç™½è‰²ç»†çº¿æ˜¯ä¸æ˜¯é¢å¤–å¡žè¿›åŽ»çš„è§†å›¾ï¼Œç»“æžœå¹¶ä¸æ˜¯ã€‚ç„¶åŽæˆ‘å†çœ‹æ˜¯å¦æ˜¯è®¾ç½®äº†ä»€ä¹ˆ padding å¯¼è‡´äº†è¿™ä¸ªé—®é¢˜ã€‚äº‹å®žä¸Šï¼Œæ­£å¼è¿™æ ·çš„ï¼Œå¯æƒœæˆ‘å¯èƒ½æ˜¯çžŽäº†çœ¼ï¼Œå±…ç„¶æ²¡æœ‰çœ‹åˆ°ä¸‹é¢çš„çº¿ç´¢ï¼Œå³ DecorView çš„å³ä¾§ padding æ˜¯ 2ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535790424.png" alt=""></p><p>æˆ‘åªçœ‹åˆ°äº†ä¸‹é¢çš„ LinearLayout çš„å®½åº¦æ˜¯1438ï¼Œæ¯”æˆ‘çš„æ‰‹æœºå±å¹•å®½åº¦1440å°‘äº†2ä¸ªåƒç´ ï¼Œæ˜¾ç„¶å°±æ˜¯å³ä¾§çš„ç™½çº¿äº†ã€‚</p><p><img src="http://tao93.top/images/2018/09/01/1535790483.png" alt=""></p><p>æ‰€ä»¥æˆ‘æ€Žä¹ˆåŠžå‘¢ï¼Œæˆ‘å¼€å§‹è°ƒè¯• measure å’Œ layout çš„è¿‡ç¨‹ã€‚å› ä¸º DecorView çš„å®½åº¦æ˜¯ 1440 æ²¡é”™ï¼Œå¯æ˜¯å®ƒçš„ Child LinearLayout å®½åº¦åªæœ‰ 1438ï¼Œæ‰€ä»¥æˆ‘å…ˆæ¡ä»¶æ–­ç‚¹åœ¨ LinearLayout ç±»ä¸­çš„ onMeasure æ–¹æ³•ã€‚æ–­ç‚¹çš„æ¡ä»¶æˆ‘æœ¬æ¥æƒ³å†™ getParent() instance DecorViewï¼Œç»“æžœå‘çŽ°æ— æ³•åº”ç”¨ DecorViewï¼ŒäºŽæ˜¯æˆ‘å°±æ”¹æˆäº† getParent() != null &amp;&amp; getParent().getParent() == nullï¼Œå…¶å®žè¿™æ˜¯ä¸å¯¹çš„ï¼ŒDecorView åŒæ ·æœ‰ Parentï¼Œä¹Ÿå°±æ˜¯ ViewRootImpl å¯¹è±¡ï¼Œæˆ‘æŠŠè¿™ä¸ªç»™å¿˜äº†ã€‚æ‰€ä»¥æ–­ç‚¹æ¡ä»¶å°±æˆäº†ä¸‹é¢è¿™æ ·è‡ƒè‚¿çš„äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getParent() != <span class="keyword">null</span> &amp;&amp; getParent().getParent() != <span class="keyword">null</span> &amp;&amp; getParent().getParent().getParent() == <span class="keyword">null</span> </span><br><span class="line"><span class="comment">// å½“ç„¶å…¶å®žè¿˜æœ‰æ›´ç®€æ´çš„æ–¹å¼ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ · </span></span><br><span class="line">getClass().getName.endswith(<span class="string">"DecorView"</span>)</span><br></pre></td></tr></table></figure><p>ç„¶åŽå‘çŽ°ä¸ç®¡æ˜¯ measure è¿˜æ˜¯ layout çš„è¿‡ç¨‹ï¼ŒLinearLayout å®½åº¦å§‹ç»ˆå°±æ˜¯ 1438ï¼ŒDecorView å°±åªç»™å®ƒç•™äº†è¿™ä¸ªå¤§ç©ºé—´ã€‚ç„¶åŽæˆ‘å¼€å§‹è°ƒè¯•åˆ° DecorView çš„æµ‹é‡è¿‡ç¨‹ä¸­ï¼Œæœ€åŽå‘çŽ°åœ¨ ViewGroup (è¿™é‡Œä»…ä»…æ˜¯ç”±äºŽ DecorView æ˜¯ç»§æ‰¿è‡ª ViewGroup çš„) çš„ measureChildWithMargins æ–¹æ³•ä¸­ï¼Œæ‰¾åˆ°äº†å…³é”®çº¿ç´¢ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535790538.png" alt=""></p><p>ä¹Ÿå°±æ˜¯ä¸Šé¢çš„ mPaddingRight çš„å€¼å±…ç„¶æ˜¯ 2 è€Œä¸æ˜¯ 0ï¼Œè¿™æ„å‘³ç€ DecorView çš„å³ä¾§ padding æ˜¯2ï¼Œè¿™æ ·å°±èƒ½è§£é‡Šé€šä¸ºå•¥ DecorView çš„ child å®½åº¦å°äº† 2 äº†ã€‚è¿™æ˜¯æˆ‘èµ¶ç´§å›žåŽ»çœ‹ layout ä¿¡æ¯ï¼Œç„¶åŽå°±å‘çŽ°äº†æˆ‘æœ¬æ¥æ—©å°±è¯¥å‘çŽ°çš„çº¿ç´¢äº†ã€‚</p><p>OKï¼ŒæŽ¥ä¸‹æ¥æ˜¯è¦çŸ¥é“ï¼Œè°æŠŠ DecorView çš„å³ä¾§ padding åŠ äº† 2 çš„ã€‚æˆ‘å¯¹ View ç±»çš„ mPaddingRight å±žæ€§åŠ äº†ä¸‹å›¾æ‰€ç¤ºçš„æ–­ç‚¹ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535790585.png" alt=""></p><p>æžœç„¶ï¼Œä¸ä¸€ä¼šå„¿ï¼Œæˆ‘å°±æœ‰äº†æ”¶èŽ·ï¼Œå¾—åˆ°äº†ä¸‹é¢çš„å †æ ˆï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535790614.png" alt=""></p><p>ä¸Šé¢å †æ ˆæ¸…æ™°äº†å±•ç¤ºäº†å³ä¾§ padding æ˜¯æ€Žä¹ˆè¢«è®¾ç½®ä¸º 2 çš„ï¼Œæ¦‚æ‹¬æ¥è¯´ï¼Œå°±æ˜¯ PhoneWindow åœ¨å‡†å¤‡ DecorView æ—¶ï¼Œæ£€æŸ¥åˆ°æœ‰ä¸€ä¸ª Drawableï¼Œç„¶åŽåœ¨è®¾ç½®è¿™ä¸ª Drawable æ—¶ï¼ŒåŽ»è®¾ç½®äº† paddingã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè®¾ç½® Drawable éœ€è¦è®¾ç½® padding å‘¢ï¼Ÿçœ‹ä¸‹å›¾å°±æ˜Žç™½äº†ï¼š</p><p><img src="http://tao93.top/images/2018/09/01/1535790640.png" alt=""></p><p>åŽŸæ¥ï¼Œè¿™æ˜¯ä¸ªè‡ªå¸¦ padding çš„ NinePatchDrawableã€‚æŽ¥ä¸‹æ¥ï¼Œæˆ‘å°±æŸ¥æ‰¾äº†ä¸€ä¸‹ï¼Œå‘çŽ°è¿™ä¸ª drawable å°±æ˜¯ PhoneWindow ä¸­çš„ mBackgroundsource å±žæ€§è§£æžè€Œæ¥ã€‚è¿™ä¸ªå±žæ€§æ˜¯ä»Žåº”ç”¨ä¸»é¢˜ä¸­æŒ‡å®šçš„ã€‚çŽ°åœ¨å›žåˆ°å‰é¢æˆ‘æå‰è´´å‡ºçš„è§£å†³æ–¹æ³•ä¹‹ä¸€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getWindow().setBackgroundDrawable(<span class="keyword">new</span> ColorDrawable(Color.TRANSPARENT))</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç è°ƒç”¨ PhoneWindow çš„ setBackgroundDrawable æ–¹æ³•ï¼Œè¿™ä¸ªè°ƒç”¨é™¤äº†è®¾ç½® bg drawable å¤–ï¼Œè¿˜ç›´æŽ¥è®© mBackgroundsource å˜ä¸º 0ï¼Œæ‰€ä»¥åŽé¢å°±è½®ä¸åˆ°é‚£ä¸ª NinePatchDrawable äº†ã€‚</p><p>å…¶å®žï¼Œä¸Šé¢çš„è§£å†³æ–¹æ³•è¿˜æ˜¯æœ‰ç‚¹çªå…€ï¼Œå¦ä¸€ç§æ–¹æ³•æ˜¯ï¼Œåœ¨æ‰«å¡çš„åº“ä¸­è®¾ç½®ä¸€ä¸ªä¸»é¢˜ï¼Œè¿™æ ·çš„è¯ï¼Œå°±ä¸ä¼šåº”ç”¨å·´è¥¿ç‰ˆæœ¬ä¹˜å®¢ç«¯é¡¹ç›®ä¸­å£°æ˜Žçš„ä¸»é¢˜äº†ï¼Œè‡ªç„¶ä¹Ÿå°±ä¸ä¼šæŠŠé‚£ä¸ª NinePatchDrawable è®¾ç½®è¿›æ¥ã€‚</p><p>å†è¯´ç‚¹åˆ«çš„ã€‚è¿™ä¸ªæ‰«å¡çš„åº“ï¼Œè¢«é›†æˆåˆ°å¦ä¸€ä¸ªåº“ä¸­ï¼Œç„¶åŽå¦ä¸€ä¸ªåº“å†é›†æˆåˆ°å·´è¥¿ç‰ˆæœ¬ä¸­ã€‚ä¸­é—´è¿™ä¸ªåº“ï¼Œæˆ‘æ˜¯æ²¡æœ‰æ¶‰è¶³çš„ã€‚æ‰€ä»¥ä¸ºä¹ˆéªŒè¯æˆ‘æœ‰æ²¡æœ‰ä¿®å¤æˆåŠŸï¼Œæˆ‘åªèƒ½åœ¨æœ€ç»ˆçš„é¡¹ç›®ä¸­å†å¼•ç”¨ä¸€ä¸‹æˆ‘çš„åº“ç»è¿‡æ”¹åŠ¨åŽçš„ç‰ˆæœ¬ï¼Œå½“ç„¶ç‰ˆæœ¬å·ä¹Ÿè¦å¢žåŠ ä¸€ä¸‹ã€‚è¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥æ–°çš„è¦†ç›–æ—§çš„ï¼ŒæŠŠä¸­é—´é‚£ä¸ªåº“å¯¹æ‰«å¡åº“çš„å¼•ç”¨ç»™è¦†ç›–çš„ã€‚å”‰ï¼ŒçœŸæ˜¯æŠ˜è…¾ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å‰å‡ å¤©æœ‰äººæŠ¥å‘Šå·´è¥¿ç‰ˆæœ¬ä¹˜å®¢ç«¯æ‰«æé“¶è¡Œå¡çš„ç•Œé¢æœ‰ bugï¼Œå³å±å¹•å³ä¾§æœ‰ä¸€æ¡ç™½çº¿ï¼Œä¹Ÿå°±æ˜¯ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://tao93.top/images/2018/09/01/1535790364.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;é‰´äºŽæŠ¥å‘Šäººæ²¡
      
    
    </summary>
    
    
      <category term="Android" scheme="https://tao93.top/tags/Android/"/>
    
  </entry>
  
</feed>
